"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7333],{44573:function(e,t,s){s.d(t,{AOx:function(){return extension},Ao0:function(){return eC},IGC:function(){return keyBinding},JZE:function(){return isNodeExtension},Nj1:function(){return findUploadPlaceholderPayload},QR:function(){return z},WDe:function(){return command},ZQL:function(){return isRemirrorManager},_y:function(){return helper},cTq:function(){return uploadFile},cx:function(){return cx},en2:function(){return setUploadPlaceholderAction},fZ6:function(){return findUploadPlaceholderPos},gQe:function(){return eE},i8b:function(){return ee},klI:function(){return eu},nNj:function(){return X},orf:function(){return ec},uS7:function(){return J},w9d:function(){return toggleMark}});var r,i,n,a,o,l,d,c,u,h,p,m,g,f,v,_,y,S,x,k,E=s(57555),b=s(378),C=s(31857),M=s(27398),A=s(47650),w=s(61082),O=s(13017),P=s(48776),N=s(12806),R=s(2376),T=s(27784),H=s(25804),G=s(84348),K=s(36912),D=s(60440),I=s(69400),L=s(84799),V=s(48111),B=s(45298),U=Object.defineProperty,F=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,s,r)=>{for(var i,n=r>1?void 0:r?F(t,s):t,a=e.length-1;a>=0;a--)(i=e[a])&&(n=(r?i(t,s,n):i(n))||n);return r&&n&&U(t,s,n),n},__accessCheck=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},__privateGet=(e,t,s)=>(__accessCheck(e,t,"read from private field"),s?s.call(e):t.get(e)),__privateAdd=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},__privateSet=(e,t,s,r)=>(__accessCheck(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s);function defaultEquals(e,t){return e===t}function getChangedOptions(e){let{previousOptions:t,update:s,equals:r=defaultEquals}=e,i=(0,E.vV)({...t,...s}),n=(0,E.Ry)(),a=(0,E.XP)(t);for(let e of a){let s=t[e],a=i[e];if(r(s,a)){n[e]={changed:!1};continue}n[e]={changed:!0,previousValue:s,value:a}}return{changes:(0,E.vV)(n),options:i,pickChanged:e=>{let t=(0,E.Ry)();for(let s of e){let e=n[s];(null==e?void 0:e.changed)&&(t[s]=e.value)}return t}}}var W={[b.mA.DUPLICATE_HELPER_NAMES]:"helper method",[b.mA.DUPLICATE_COMMAND_NAMES]:"command method"};function throwIfNameNotUnique(e){let{name:t,set:s,code:r}=e,i=W[r];(0,E.kG)(!s.has(t),{code:r,message:`There is a naming conflict for the name: ${t} used in this '${i}'. Please rename or remove from the editor to avoid runtime errors.`}),s.add(t)}function cx(...e){return(0,E.Nb)((0,w.cx)(...e).split(" ")).join(" ")}var j="__IGNORE__",q=class{constructor(e,...[t]){this["~O"]={},this._mappedHandlers=(0,E.Ry)(),this.populateMappedHandlers(),this._options=this._initialOptions=(0,E.RH)(e,this.constructor.defaultOptions,t??(0,E.Ry)(),this.createDefaultHandlerOptions()),this._dynamicKeys=this.getDynamicKeys(),this.init()}get options(){return this._options}get dynamicKeys(){return this._dynamicKeys}get initialOptions(){return this._initialOptions}init(){}getDynamicKeys(){let e=[],{customHandlerKeys:t,handlerKeys:s,staticKeys:r}=this.constructor;for(let i of(0,E.XP)(this._options))r.includes(i)||s.includes(i)||t.includes(i)||e.push(i);return e}ensureAllKeysAreDynamic(e){if(M.NZ.isProduction)return;let t=[];for(let s of(0,E.XP)(e))this._dynamicKeys.includes(s)||t.push(s);(0,E.kG)((0,E.yD)(t),{code:b.mA.INVALID_SET_EXTENSION_OPTIONS,message:`Invalid properties passed into the 'setOptions()' method: ${JSON.stringify(t)}.`})}setOptions(e){var t;let s=this.getDynamicOptions();this.ensureAllKeysAreDynamic(e);let{changes:r,options:i,pickChanged:n}=getChangedOptions({previousOptions:s,update:e});this.updateDynamicOptions(i),null==(t=this.onSetOptions)||t.call(this,{reason:"set",changes:r,options:i,pickChanged:n,initialOptions:this._initialOptions})}resetOptions(){var e;let t=this.getDynamicOptions(),{changes:s,options:r,pickChanged:i}=getChangedOptions({previousOptions:t,update:this._initialOptions});this.updateDynamicOptions(r),null==(e=this.onSetOptions)||e.call(this,{reason:"reset",options:r,changes:s,pickChanged:i,initialOptions:this._initialOptions})}getDynamicOptions(){return A(this._options,[...this.constructor.customHandlerKeys,...this.constructor.handlerKeys])}updateDynamicOptions(e){this._options={...this._options,...e}}populateMappedHandlers(){for(let e of this.constructor.handlerKeys)this._mappedHandlers[e]=[]}createDefaultHandlerOptions(){let e=(0,E.Ry)();for(let t of this.constructor.handlerKeys)e[t]=(...e)=>{var s;let{handlerKeyOptions:r}=this.constructor,i=null==(s=r[t])?void 0:s.reducer,n=null==i?void 0:i.getDefault(...e);for(let[,s]of this._mappedHandlers[t]){let a=s(...e);if(function(e,t,s){let{__ALL__:r}=e,i=e[s];return(!!r||!!i)&&(!!i&&i.earlyReturnValue!==j&&((0,E.mf)(i.earlyReturnValue)?!0===i.earlyReturnValue(t):t===i.earlyReturnValue)||!!r&&r.earlyReturnValue!==j&&((0,E.mf)(r.earlyReturnValue)?!0===r.earlyReturnValue(t):t===r.earlyReturnValue))}(r,n=i?i.accumulator(n,a,...e):a,t))break}return n};return e}addHandler(e,t,s=b.xV.Default){return this._mappedHandlers[e].push([s,t]),this.sortHandlers(e),()=>this._mappedHandlers[e]=this._mappedHandlers[e].filter(([,e])=>e!==t)}hasHandlers(e){return(this._mappedHandlers[e]??[]).length>0}sortHandlers(e){this._mappedHandlers[e]=(0,E.DY)(this._mappedHandlers[e],([e],[t])=>t-e)}addCustomHandler(e,t){var s;return(null==(s=this.onAddCustomHandler)?void 0:s.call(this,{[e]:t}))??E.ZT}};q.defaultOptions={},q.staticKeys=[],q.handlerKeys=[],q.handlerKeyOptions={},q.customHandlerKeys=[];var $=class extends q{constructor(...e){for(let t of(super(Q,...e),this["~E"]={},this._extensions=(0,E.uw)(this.createExtensions(),e=>e.constructor),this.extensionMap=new Map,this._extensions))this.extensionMap.set(t.constructor,t)}get priority(){return this.priorityOverride??this.options.priority??this.constructor.defaultPriority}get constructorName(){return`${(0,C.Ho)(this.name)}Extension`}get store(){return(0,E.kG)(this._store,{code:b.mA.MANAGER_PHASE_ERROR,message:"An error occurred while attempting to access the 'extension.store' when the Manager has not yet set created the lifecycle methods."}),(0,E.vV)(this._store,{requireKeys:!0})}get extensions(){return this._extensions}replaceChildExtension(e,t){this.extensionMap.has(e)&&(this.extensionMap.set(e,t),this._extensions=this.extensions.map(s=>t.constructor===e?t:s))}createExtensions(){return[]}getExtension(e){let t=this.extensionMap.get(e);return(0,E.kG)(t,{code:b.mA.INVALID_GET_EXTENSION,message:`'${e.name}' does not exist within the preset: '${this.name}'`}),t}isOfType(e){return this.constructor===e}setStore(e){this._store||(this._store=e)}clone(...e){return new this.constructor(...e)}setPriority(e){this.priorityOverride=e}};$.defaultPriority=b.xV.Default;var X=class extends ${static get[b.By](){return b.lk.PlainExtensionConstructor}get[b.By](){return b.lk.PlainExtension}},J=class extends ${static get[b.By](){return b.lk.MarkExtensionConstructor}get[b.By](){return b.lk.MarkExtension}get type(){return(0,E.fp)(this.store.schema.marks,this.name)}constructor(...e){super(...e)}};J.disableExtraAttributes=!1;var z=class extends ${static get[b.By](){return b.lk.NodeExtensionConstructor}get[b.By](){return b.lk.NodeExtension}get type(){return(0,E.fp)(this.store.schema.nodes,this.name)}constructor(...e){super(...e)}};z.disableExtraAttributes=!1;var Q={priority:void 0,extraAttributes:{},disableExtraAttributes:!1,exclude:{}};function isExtension(e){return(0,M.gf)(e)&&(0,M.pI)(e,[b.lk.PlainExtension,b.lk.MarkExtension,b.lk.NodeExtension])}function isPlainExtension(e){return(0,M.gf)(e)&&(0,M.pI)(e,b.lk.PlainExtension)}function isNodeExtension(e){return(0,M.gf)(e)&&(0,M.pI)(e,b.lk.NodeExtension)}function isMarkExtension(e){return(0,M.gf)(e)&&(0,M.pI)(e,b.lk.MarkExtension)}function extension(e){return t=>{let{defaultOptions:s,customHandlerKeys:r,handlerKeys:i,staticKeys:n,defaultPriority:a,handlerKeyOptions:o,...l}=e,d=(0,E.RF)(t);for(let[e,t]of(s&&(d.defaultOptions=s),a&&(d.defaultPriority=a),o&&(d.handlerKeyOptions=o),d.staticKeys=n??[],d.handlerKeys=i??[],d.customHandlerKeys=r??[],Object.entries(l)))d[e]||(d[e]=t);return(0,E.RF)(d)}}var Z=class extends X{constructor(){super(...arguments),this.attributeList=[],this.attributeObject=(0,E.Ry)(),this.updateAttributes=(e=!0)=>{this.transformAttributes(),e&&this.store.commands.forceUpdate("attributes")}}get name(){return"attributes"}onCreate(){this.transformAttributes(),this.store.setExtensionStore("updateAttributes",this.updateAttributes)}transformAttributes(){var e,t,s;if(this.attributeObject=(0,E.Ry)(),null==(e=this.store.managerSettings.exclude)?void 0:e.attributes){this.store.setStoreKey("attributes",this.attributeObject);return}for(let e of(this.attributeList=[],this.store.extensions)){if(null==(t=e.options.exclude)?void 0:t.attributes)continue;let r=null==(s=e.createAttributes)?void 0:s.call(e),i={...r,class:cx(...e.classNames??[],null==r?void 0:r.class)};this.attributeList.unshift(i)}for(let e of this.attributeList)this.attributeObject={...this.attributeObject,...e,class:cx(this.attributeObject.class,e.class)};this.store.setStoreKey("attributes",this.attributeObject)}};function helper(e={}){return(t,s,r)=>{(t.decoratedHelpers??(t.decoratedHelpers={}))[s]=e}}function command(e={}){return(t,s,r)=>{(t.decoratedCommands??(t.decoratedCommands={}))[s]=e}}function keyBinding(e){return(t,s,r)=>{(t.decoratedKeybindings??(t.decoratedKeybindings={}))[s]=e}}var Y=class{constructor(e){this.promiseCreator=e,this.failureHandlers=[],this.successHandlers=[],this.validateHandlers=[],this.generateCommand=()=>e=>{let t=!0,{view:s,tr:r,dispatch:i}=e;if(!s)return!1;for(let s of this.validateHandlers)if(!s({...e,dispatch:()=>{}})){t=!1;break}if(!i||!t)return t;let n=this.promiseCreator(e);return n.then(e=>{this.runHandlers(this.successHandlers,{value:e,state:s.state,tr:s.state.tr,dispatch:s.dispatch,view:s})}).catch(e=>{this.runHandlers(this.failureHandlers,{error:e,state:s.state,tr:s.state.tr,dispatch:s.dispatch,view:s})}),i(r),!0}}validate(e,t="push"){return this.validateHandlers[t](e),this}success(e,t="push"){return this.successHandlers[t](e),this}failure(e,t="push"){return this.failureHandlers[t](e),this}runHandlers(e,t){var s;for(let s of e)if(!s({...t,dispatch:()=>{}}))break;null==(s=t.dispatch)||s.call(t,t.tr)}};function toggleMark(e){let{type:t,attrs:s,range:r,selection:i}=e;return e=>{let{dispatch:n,tr:a,state:o}=e,l=(0,E.HD)(t)?o.schema.marks[t]:t;if((0,E.kG)(l,{code:b.mA.SCHEMA,message:`Mark type: ${t} does not exist on the current schema.`}),r||i){let{from:e,to:o}=(0,M.b0)(i??r??a.selection,a.doc);return(0,M.yw)({trState:a,type:t,...r})?null==n||n(a.removeMark(e,o,l)):null==n||n(a.addMark(e,o,l.create(s))),!0}return(0,T.A_)((0,H.w9)(l,s))(e)}}var ee=class extends X{constructor(){super(...arguments),this.decorated=new Map,this.forceUpdateTransaction=(e,...t)=>{let{forcedUpdates:s}=this.getCommandMeta(e);return this.setCommandMeta(e,{forcedUpdates:(0,E.Nb)([...s,...t])}),e}}get name(){return"commands"}get transaction(){let e=this.store.getState();this._transaction||(this._transaction=e.tr);let t=this._transaction.before.eq(e.doc),s=!(0,E.yD)(this._transaction.steps);if(!t){let t=e.tr;if(s)for(let e of this._transaction.steps)t.step(e);this._transaction=t}return this._transaction}onCreate(){this.store.setStoreKey("getForcedUpdates",this.getForcedUpdates.bind(this))}onView(e){var t;let{extensions:s,helpers:r}=this.store,i=(0,E.Ry)(),n=new Set,a=(0,E.Ry)(),chain=t=>{var s;let r=(0,E.Ry)(),getTr=()=>t??this.transaction,n=[],getChain=()=>n;for(let[e,t]of Object.entries(i))null!=(s=a[e])&&s.disableChaining||(r[e]=this.chainedFactory({chain:r,command:t.original,getTr,getChain}));let dispatch=e=>{(0,E.kG)(e===getTr(),{message:"Chaining currently only supports `CommandFunction` methods which do not use the `state.tr` property. Instead you should use the provided `tr` property."})};return r.run=(t={})=>{let s=n;for(let e of(n=[],s))if(!e(dispatch)&&t.exitEarly)return;e.dispatch(getTr())},r.tr=()=>{let e=n;for(let t of(n=[],e))t(dispatch);return getTr()},r.enabled=()=>{for(let e of n)if(!e())return!1;return!0},r.new=e=>chain(e),r};for(let e of s){let s=(null==(t=e.createCommands)?void 0:t.call(e))??{},o=e.decoratedCommands??{},l={};for(let[t,i]of(a={...a,decoratedCommands:o},Object.entries(o))){let n=(0,E.HD)(i.shortcut)&&i.shortcut.startsWith("_|")?{shortcut:r.getNamedShortcut(i.shortcut,e.options)}:void 0;this.updateDecorated(t,{...i,name:e.name,...n}),s[t]=e[t].bind(e),i.active&&(l[t]=()=>{var t;return(null==(t=i.active)?void 0:t.call(i,e.options,this.store))??!1})}(0,E.Qr)(s)||this.addCommands({active:l,names:n,commands:i,extensionCommands:s})}let o=chain();for(let[e,t]of Object.entries(o))chain[e]=t;this.store.setStoreKey("commands",i),this.store.setStoreKey("chain",chain),this.store.setExtensionStore("commands",i),this.store.setExtensionStore("chain",chain)}onStateUpdate({state:e}){this._transaction=e.tr}createPlugin(){return{}}customDispatch(e){return e}insertText(e,t={}){return(0,E.HD)(e)?function(e,t={}){return({tr:s,dispatch:r,state:i})=>{let n=i.schema,a=s.selection,{from:o=a.from,to:l=o??a.to,marks:d={}}=t;if(!r)return!0;s.insertText(e,o,l);let c=(0,E.fp)(s.steps,s.steps.length-1).getMap().map(l);for(let[e,t]of(0,E.qh)(d))s.addMark(o,c,(0,E.fp)(n.marks,e).create(t));return r(s),!0}}(e,t):this.store.createPlaceholderCommand({promise:e,placeholder:{type:"inline"},onSuccess:(e,s,r)=>this.insertText(e,{...t,...s})(r)}).generateCommand()}selectText(e,t={}){return({tr:s,dispatch:r})=>{let i=(0,M.b0)(e,s.doc),n=s.selection.anchor===i.anchor&&s.selection.head===i.head;return(!n||!!t.forceUpdate)&&(null==r||r(s.setSelection(i)),!0)}}selectMark(e){return t=>{let{tr:s}=t,r=(0,M.IH)(s.selection.$from,e);return!!r&&this.store.commands.selectText.original({from:r.from,to:r.to})(t)}}delete(e){return({tr:t,dispatch:s})=>{let{from:r,to:i}=e??t.selection;return null==s||s(t.delete(r,i)),!0}}emptyUpdate(e){return({tr:t,dispatch:s})=>(s&&(null==e||e(),s(t)),!0)}forceUpdate(...e){return({tr:t,dispatch:s})=>(null==s||s(this.forceUpdateTransaction(t,...e)),!0)}updateNodeAttributes(e,t){return({tr:s,dispatch:r})=>(null==r||r(s.setNodeMarkup(e,void 0,t)),!0)}setContent(e,t){return s=>{let{tr:r,dispatch:i}=s,n=this.store.manager.createState({content:e,selection:t});return!!n&&(null==i||i(r.replaceRangeWith(0,r.doc.nodeSize-2,n.doc)),!0)}}resetContent(){return e=>{let{tr:t,dispatch:s}=e,r=this.store.manager.createEmptyDoc();return r?this.setContent(r)(e):(null==s||s(t.delete(0,t.doc.nodeSize)),!0)}}emptySelection(){return({tr:e,dispatch:t})=>!e.selection.empty&&(null==t||t(e.setSelection(R.Bs.near(e.selection.$anchor))),!0)}insertNewLine(){return({dispatch:e,tr:t})=>!!(0,M.hT)(t.selection)&&(null==e||e(t.insertText("\n")),!0)}insertNode(e,t={}){return({dispatch:s,tr:r,state:i})=>{var n;let{attrs:a,range:o,selection:l,replaceEmptyParentBlock:d=!1}=t,{from:c,to:u,$from:h}=(0,M.b0)(l??o??r.selection,r.doc);if((0,M.PH)(e)||(0,M.mt)(e)){let t=h.before(h.depth);return null==s||s(d&&c===u&&(0,M.mp)(h.parent)?r.replaceWith(t,t+h.parent.nodeSize,e):r.replaceWith(c,u,e)),!0}let p=(0,E.HD)(e)?i.schema.nodes[e]:e;(0,E.kG)(p,{code:b.mA.SCHEMA,message:`The requested node type ${e} does not exist in the schema.`});let m=null==(n=t.marks)?void 0:n.map(e=>{if(e instanceof N.vc)return e;let t=(0,E.HD)(e)?i.schema.marks[e]:e;return(0,E.kG)(t,{code:b.mA.SCHEMA,message:`The requested mark type ${e} does not exist in the schema.`}),t.create()}),g=p.createAndFill(a,(0,E.HD)(t.content)?i.schema.text(t.content):t.content,m);if(!g)return!1;let f=c!==u;return null==s||s(f?r.replaceRangeWith(c,u,g):r.insert(c,g)),!0}}focus(e){return t=>{let{dispatch:s,tr:r}=t,{view:i}=this.store;if(!1===e||i.hasFocus()&&(void 0===e||!0===e))return!1;if(void 0===e||!0===e){let{from:t=0,to:s=t}=r.selection;e={from:t,to:s}}return s&&this.delayedFocus(),this.selectText(e)(t)}}blur(e){return t=>{let{view:s}=this.store;return!!s.hasFocus()&&(requestAnimationFrame(()=>{s.dom.blur()}),!e||this.selectText(e)(t))}}setBlockNodeType(e,t,s,r=!0){return(0,M.uJ)(e,t,s,r)}toggleWrappingNode(e,t,s){return(0,M.bm)(e,t,s)}toggleBlockNodeItem(e){return(0,M.zU)(e)}wrapInNode(e,t,s){return(0,M.ym)(e,t,s)}applyMark(e,t,s){return({tr:r,dispatch:i,state:n})=>{let a=(0,M.b0)(s??r.selection,r.doc),o=(0,M.Lp)(a),l=(0,E.HD)(e)?n.schema.marks[e]:e;if((0,E.kG)(l,{code:b.mA.SCHEMA,message:`Mark type: ${e} does not exist on the current schema.`}),a.empty&&!o||!function(e,t,s){for(let{$from:r,$to:i}of s){let s=0===r.depth&&t.type.allowsMarkType(e);if(t.nodesBetween(r.pos,i.pos,t=>{if(s)return!1;s=t.inlineContent&&t.type.allowsMarkType(e)}),s)return!0}return!1}(l,r.doc,a.ranges))return!1;if(!i)return!0;if(o)return r.removeStoredMark(l),t&&r.addStoredMark(l.create(t)),i(r),!0;let d=!1;for(let{$from:e,$to:t}of a.ranges){if(d)break;d=r.doc.rangeHasMark(e.pos,t.pos,l)}for(let{$from:e,$to:s}of a.ranges)d&&r.removeMark(e.pos,s.pos,l),t&&r.addMark(e.pos,s.pos,l.create(t));return i(r),!0}}toggleMark(e){return toggleMark(e)}removeMark(e){return(0,M.P9)(e)}setMeta(e,t){return({tr:s})=>(s.setMeta(e,t),!0)}selectAll(){return this.selectText("all")}copy(){return e=>!e.tr.selection.empty&&(e.dispatch&&document.execCommand("copy"),!0)}paste(){return this.store.createPlaceholderCommand({promise:async()=>{var e;return(null==(e=navigator.clipboard)?void 0:e.readText)?await navigator.clipboard.readText():""},placeholder:{type:"inline"},onSuccess:(e,t,s)=>this.insertNode((0,M.OC)({content:e,schema:s.state.schema}),{selection:t})(s)}).generateCommand()}cut(){return e=>!e.tr.selection.empty&&(e.dispatch&&document.execCommand("cut"),!0)}replaceText(e){return(0,M.lp)(e)}getAllCommandOptions(){let e={};for(let[t,s]of this.decorated)(0,E.Qr)(s)||(e[t]=s);return e}getCommandOptions(e){return this.decorated.get(e)}getCommandProp(){return{tr:this.transaction,dispatch:this.store.view.dispatch,state:this.store.view.state,view:this.store.view}}updateDecorated(e,t){if(!t){this.decorated.delete(e);return}let s=this.decorated.get(e)??{name:""};this.decorated.set(e,{...s,...t})}handleIosFocus(){M.NZ.isIos&&this.store.view.dom.focus()}delayedFocus(){this.handleIosFocus(),requestAnimationFrame(()=>{this.store.view.focus(),this.store.view.dispatch(this.transaction.scrollIntoView())})}getForcedUpdates(e){return this.getCommandMeta(e).forcedUpdates}getCommandMeta(e){let t=e.getMeta(this.pluginKey)??{};return{...et,...t}}setCommandMeta(e,t){let s=this.getCommandMeta(e);e.setMeta(this.pluginKey,{...s,...t})}addCommands(e){let{extensionCommands:t,commands:s,names:r,active:i}=e;for(let[e,n]of(0,E.qh)(t))throwIfNameNotUnique({name:e,set:r,code:b.mA.DUPLICATE_COMMAND_NAMES}),(0,E.kG)(!es.has(e),{code:b.mA.DUPLICATE_COMMAND_NAMES,message:"The command name you chose is forbidden."}),s[e]=this.createUnchainedCommand(n,i[e])}unchainedFactory(e){return(...t)=>{let s;let{shouldDispatch:r=!0,command:i}=e,{view:n}=this.store,{state:a}=n;return r&&(s=n.dispatch),i(...t)({state:a,dispatch:s,view:n,tr:a.tr})}}createUnchainedCommand(e,t){let s=this.unchainedFactory({command:e});return s.enabled=this.unchainedFactory({command:e,shouldDispatch:!1}),s.isEnabled=s.enabled,s.original=e,s.active=t,s}chainedFactory(e){return(...t)=>{let{chain:s,command:r,getTr:i,getChain:n}=e,a=n(),{view:o}=this.store,{state:l}=o;return a.push(e=>r(...t)({state:l,dispatch:e,view:o,tr:i()})),s}}};__decorateClass([command()],ee.prototype,"customDispatch",1),__decorateClass([command()],ee.prototype,"insertText",1),__decorateClass([command()],ee.prototype,"selectText",1),__decorateClass([command()],ee.prototype,"selectMark",1),__decorateClass([command()],ee.prototype,"delete",1),__decorateClass([command()],ee.prototype,"emptyUpdate",1),__decorateClass([command()],ee.prototype,"forceUpdate",1),__decorateClass([command()],ee.prototype,"updateNodeAttributes",1),__decorateClass([command()],ee.prototype,"setContent",1),__decorateClass([command()],ee.prototype,"resetContent",1),__decorateClass([command()],ee.prototype,"emptySelection",1),__decorateClass([command()],ee.prototype,"insertNewLine",1),__decorateClass([command()],ee.prototype,"insertNode",1),__decorateClass([command()],ee.prototype,"focus",1),__decorateClass([command()],ee.prototype,"blur",1),__decorateClass([command()],ee.prototype,"setBlockNodeType",1),__decorateClass([command()],ee.prototype,"toggleWrappingNode",1),__decorateClass([command()],ee.prototype,"toggleBlockNodeItem",1),__decorateClass([command()],ee.prototype,"wrapInNode",1),__decorateClass([command()],ee.prototype,"applyMark",1),__decorateClass([command()],ee.prototype,"toggleMark",1),__decorateClass([command()],ee.prototype,"removeMark",1),__decorateClass([command()],ee.prototype,"setMeta",1),__decorateClass([command({description:({t:e})=>e(P.Vb.SELECT_ALL_DESCRIPTION),label:({t:e})=>e(P.Vb.SELECT_ALL_LABEL),shortcut:b.vO.SelectAll})],ee.prototype,"selectAll",1),__decorateClass([command({description:({t:e})=>e(P.Vb.COPY_DESCRIPTION),label:({t:e})=>e(P.Vb.COPY_LABEL),shortcut:b.vO.Copy,icon:"fileCopyLine"})],ee.prototype,"copy",1),__decorateClass([command({description:({t:e})=>e(P.Vb.PASTE_DESCRIPTION),label:({t:e})=>e(P.Vb.PASTE_LABEL),shortcut:b.vO.Paste,icon:"clipboardLine"})],ee.prototype,"paste",1),__decorateClass([command({description:({t:e})=>e(P.Vb.CUT_DESCRIPTION),label:({t:e})=>e(P.Vb.CUT_LABEL),shortcut:b.vO.Cut,icon:"scissorsFill"})],ee.prototype,"cut",1),__decorateClass([command()],ee.prototype,"replaceText",1),__decorateClass([helper()],ee.prototype,"getAllCommandOptions",1),__decorateClass([helper()],ee.prototype,"getCommandOptions",1),__decorateClass([helper()],ee.prototype,"getCommandProp",1),ee=__decorateClass([extension({defaultPriority:b.xV.Highest,defaultOptions:{trackerClassName:"remirror-tracker-position",trackerNodeName:"span"},staticKeys:["trackerClassName","trackerNodeName"]})],ee);var et={forcedUpdates:[]},es=new Set(["run","chain","original","raw","enabled","tr","new"]),er=class extends X{constructor(){super(...arguments),this.placeholders=G.EH.empty,this.placeholderWidgets=new Map,this.createPlaceholderCommand=e=>{let t=(0,E.EL)(),{promise:s,placeholder:r,onFailure:i,onSuccess:n}=e;return new Y(s).validate(e=>this.addPlaceholder(t,r)(e)).success(e=>{let{state:s,tr:r,dispatch:a,view:o,value:l}=e,d=this.store.helpers.findPlaceholder(t);if(!d){let e=Error("The placeholder has been removed");return(null==i?void 0:i({error:e,state:s,tr:r,dispatch:a,view:o}))??!1}return this.removePlaceholder(t)({state:s,tr:r,view:o,dispatch:()=>{}}),n(l,d,{state:s,tr:r,dispatch:a,view:o})}).failure(e=>(this.removePlaceholder(t)({...e,dispatch:()=>{}}),(null==i?void 0:i(e))??!1))}}get name(){return"decorations"}onCreate(){this.store.setExtensionStore("createPlaceholderCommand",this.createPlaceholderCommand)}createPlugin(){return{state:{init:()=>{},apply:e=>{var t,s,r,i,n,a;let{added:o,clearTrackers:l,removed:d,updated:c}=this.getMeta(e);if(l){for(let[,e]of(this.placeholders=G.EH.empty,this.placeholderWidgets))null==(s=(t=e.spec).onDestroy)||s.call(t,this.store.view,e.spec.element);this.placeholderWidgets.clear();return}for(let[,t]of(this.placeholders=this.placeholders.map(e.mapping,e.doc,{onRemove:e=>{var t,s;let r=this.placeholderWidgets.get(e.id);r&&(null==(s=(t=r.spec).onDestroy)||s.call(t,this.store.view,r.spec.element))}}),this.placeholderWidgets))null==(i=(r=t.spec).onUpdate)||i.call(r,this.store.view,t.from,t.spec.element,t.spec.data);for(let t of o){if("inline"===t.type){this.addInlinePlaceholder(t,e);continue}if("node"===t.type){this.addNodePlaceholder(t,e);continue}if("widget"===t.type){this.addWidgetPlaceholder(t,e);continue}}for(let{id:t,data:s}of c){let r=this.placeholderWidgets.get(t);if(!r)continue;let i=G.p.widget(r.from,r.spec.element,{...r.spec,data:s});this.placeholders=this.placeholders.remove([r]).add(e.doc,[i]),this.placeholderWidgets.set(t,i)}for(let e of d){let t=this.placeholders.find(void 0,void 0,t=>t.id===e&&t.__type===en),s=this.placeholderWidgets.get(e);s&&(null==(a=(n=s.spec).onDestroy)||a.call(n,this.store.view,s.spec.element)),this.placeholders=this.placeholders.remove(t),this.placeholderWidgets.delete(e)}}},props:{decorations:e=>{let t=this.options.decorations(e);for(let s of(t=t.add(e.doc,this.placeholders.find()),this.store.extensions)){if(!s.createDecorations)continue;let r=s.createDecorations(e).find();t=t.add(e.doc,r)}return t},handleDOMEvents:{blur:e=>(this.options.persistentSelectionClass&&e.dispatch(e.state.tr.setMeta(ea,!1)),!1),focus:e=>(this.options.persistentSelectionClass&&e.dispatch(e.state.tr.setMeta(ea,!0)),!1)}}}}updateDecorations(){return({tr:e,dispatch:t})=>(null==t||t(e),!0)}addPlaceholder(e,t,s){return({dispatch:r,tr:i})=>!!this.addPlaceholderTransaction(e,t,i,!r)&&(null==r||r(s?i.deleteSelection():i),!0)}updatePlaceholder(e,t){return({dispatch:s,tr:r})=>!!this.updatePlaceholderTransaction({id:e,data:t,tr:r,checkOnly:!s})&&(null==s||s(r),!0)}removePlaceholder(e){return({dispatch:t,tr:s})=>!!this.removePlaceholderTransaction({id:e,tr:s,checkOnly:!t})&&(null==t||t(s),!0)}clearPlaceholders(){return({tr:e,dispatch:t})=>!!this.clearPlaceholdersTransaction({tr:e,checkOnly:!t})&&(null==t||t(e),!0)}findPlaceholder(e){return this.findAllPlaceholders().get(e)}findAllPlaceholders(){let e=new Map,t=this.placeholders.find(void 0,void 0,e=>e.__type===en);for(let s of t)e.set(s.spec.id,{from:s.from,to:s.to});return e}createDecorations(e){var t,s,r;let{persistentSelectionClass:i}=this.options;return!i||(null==(t=this.store.view)?void 0:t.hasFocus())||(null==(r=(s=this.store.helpers).isInteracting)?void 0:r.call(s))?G.EH.empty:function(e,t,s){let{selection:r,doc:i}=e;if(r.empty)return t;let{from:n,to:a}=r,o=(0,M.EG)(r)?G.p.node(n,a,s):G.p.inline(n,a,s);return t.add(i,[o])}(e,G.EH.empty,{class:(0,E.HD)(i)?i:"selection"})}onApplyState(){}addWidgetPlaceholder(e,t){let{pos:s,createElement:r,onDestroy:i,onUpdate:n,className:a,nodeName:o,id:l,type:d}=e,c=(null==r?void 0:r(this.store.view,s))??document.createElement(o);c.classList.add(a);let u=G.p.widget(s,c,{id:l,__type:en,type:d,element:c,onDestroy:i,onUpdate:n});this.placeholderWidgets.set(l,u),this.placeholders=this.placeholders.add(t.doc,[u])}addInlinePlaceholder(e,t){let s;let{from:r=t.selection.from,to:i=t.selection.to,className:n,nodeName:a,id:o,type:l}=e;if(r===i){let e=document.createElement(a);e.classList.add(n),s=G.p.widget(r,e,{id:o,type:l,__type:en,widget:e})}else s=G.p.inline(r,i,{nodeName:a,class:n},{id:o,__type:en});this.placeholders=this.placeholders.add(t.doc,[s])}addNodePlaceholder(e,t){let{pos:s,className:r,nodeName:i,id:n}=e,a=(0,E.hj)(s)?t.doc.resolve(s):t.selection.$from,o=(0,E.hj)(s)?a.nodeAfter?{pos:s,end:a.nodeAfter.nodeSize}:void 0:(0,M.hK)(a);if(!o)return;let l=G.p.node(o.pos,o.end,{nodeName:i,class:r},{id:n,__type:en});this.placeholders=this.placeholders.add(t.doc,[l])}withRequiredBase(e,t){let{placeholderNodeName:s,placeholderClassName:r}=this.options,{nodeName:i=s,className:n,...a}=t,o=(n?[r,n]:[r]).join(" ");return{nodeName:i,className:o,...a,id:e}}getMeta(e){let t=e.getMeta(this.pluginKey)??{};return{...ei,...t}}setMeta(e,t){let s=this.getMeta(e);e.setMeta(this.pluginKey,{...s,...t})}addPlaceholderTransaction(e,t,s,r=!1){let i=this.findPlaceholder(e);if(i)return!1;if(r)return!0;let{added:n}=this.getMeta(s);return this.setMeta(s,{added:[...n,this.withRequiredBase(e,t)]}),!0}updatePlaceholderTransaction(e){let{id:t,tr:s,checkOnly:r=!1,data:i}=e,n=this.findPlaceholder(t);if(!n)return!1;if(r)return!0;let{updated:a}=this.getMeta(s);return this.setMeta(s,{updated:(0,E.Nb)([...a,{id:t,data:i}])}),!0}removePlaceholderTransaction(e){let{id:t,tr:s,checkOnly:r=!1}=e,i=this.findPlaceholder(t);if(!i)return!1;if(r)return!0;let{removed:n}=this.getMeta(s);return this.setMeta(s,{removed:(0,E.Nb)([...n,t])}),!0}clearPlaceholdersTransaction(e){let{tr:t,checkOnly:s=!1}=e,r=this.getPluginState();return r!==G.EH.empty&&(!!s||(this.setMeta(t,{clearTrackers:!0}),!0))}};__decorateClass([command()],er.prototype,"updateDecorations",1),__decorateClass([command()],er.prototype,"addPlaceholder",1),__decorateClass([command()],er.prototype,"updatePlaceholder",1),__decorateClass([command()],er.prototype,"removePlaceholder",1),__decorateClass([command()],er.prototype,"clearPlaceholders",1),__decorateClass([helper()],er.prototype,"findPlaceholder",1),__decorateClass([helper()],er.prototype,"findAllPlaceholders",1),er=__decorateClass([extension({defaultOptions:{persistentSelectionClass:void 0,placeholderClassName:"placeholder",placeholderNodeName:"span"},staticKeys:["placeholderClassName","placeholderNodeName"],handlerKeys:["decorations"],handlerKeyOptions:{decorations:{reducer:{accumulator:(e,t,s)=>e.add(s.doc,t.find()),getDefault:()=>G.EH.empty}}},defaultPriority:b.xV.Low})],er);var ei={added:[],updated:[],clearTrackers:!1,removed:[]},en="placeholderDecoration",ea="persistentSelectionFocus",eo=class extends X{get name(){return"docChanged"}onStateUpdate(e){let{firstUpdate:t,transactions:s,tr:r}=e;!t&&(s??[r]).some(e=>null==e?void 0:e.docChanged)&&this.options.docChanged(e)}};eo=__decorateClass([extension({handlerKeys:["docChanged"],handlerKeyOptions:{docChanged:{earlyReturnValue:!1}},defaultPriority:b.xV.Lowest})],eo);var el=class extends X{get name(){return"helpers"}onCreate(){var e;this.store.setStringHandler("text",this.textToProsemirrorNode.bind(this)),this.store.setStringHandler("html",M.OC);let t=(0,E.Ry)(),s=(0,E.Ry)(),r=(0,E.Ry)(),i=new Set;for(let n of this.store.extensions){isNodeExtension(n)&&(s[n.name]=e=>(0,M.Ig)({state:this.store.getState(),type:n.type,attrs:e}),r[n.name]=e=>{var t;return null==(t=(0,M.EM)({state:this.store.getState(),type:n.type,attrs:e}))?void 0:t.node.attrs}),isMarkExtension(n)&&(s[n.name]=e=>(0,M.yw)({trState:this.store.getState(),type:n.type,attrs:e}),r[n.name]=e=>{let t=(0,M.IH)(this.store.getState().selection.$from,n.type);return t&&e?(0,M.V1)(t.mark,e)?t.mark.attrs:void 0:null==t?void 0:t.mark.attrs});let a=(null==(e=n.createHelpers)?void 0:e.call(n))??{};for(let e of Object.keys(n.decoratedHelpers??{}))a[e]=n[e].bind(n);if(!(0,E.Qr)(a))for(let[e,s]of(0,E.qh)(a))throwIfNameNotUnique({name:e,set:i,code:b.mA.DUPLICATE_HELPER_NAMES}),t[e]=s}this.store.setStoreKey("attrs",r),this.store.setStoreKey("active",s),this.store.setStoreKey("helpers",t),this.store.setExtensionStore("attrs",r),this.store.setExtensionStore("active",s),this.store.setExtensionStore("helpers",t)}isSelectionEmpty(e=this.store.getState()){return(0,M.Ab)(e)}isViewEditable(e=this.store.getState()){var t,s;return(null==(s=(t=this.store.view.props).editable)?void 0:s.call(t,e))??!1}getStateJSON(e=this.store.getState()){return e.toJSON()}getJSON(e=this.store.getState()){return e.doc.toJSON()}getRemirrorJSON(e=this.store.getState()){return this.getJSON(e)}insertHtml(e,t){return s=>{let{state:r}=s,i=(0,M.OC)({content:e,schema:r.schema,fragment:!0});return this.store.commands.insertNode.original(i,t)(s)}}getText({lineBreakDivider:e="\n\n",state:t=this.store.getState()}={}){return t.doc.textBetween(0,t.doc.content.size,e,b.Vp)}getTextBetween(e,t,s=this.store.getState().doc){return s.textBetween(e,t,"\n\n",b.Vp)}getHTML(e=this.store.getState()){return(0,M.Em)(e.doc,this.store.document)}textToProsemirrorNode(e){let t=`<pre>${e.content}</pre>`;return this.store.stringHandlers.html({...e,content:t})}};__decorateClass([helper()],el.prototype,"isSelectionEmpty",1),__decorateClass([helper()],el.prototype,"isViewEditable",1),__decorateClass([helper()],el.prototype,"getStateJSON",1),__decorateClass([helper()],el.prototype,"getJSON",1),__decorateClass([helper()],el.prototype,"getRemirrorJSON",1),__decorateClass([command()],el.prototype,"insertHtml",1),__decorateClass([helper()],el.prototype,"getText",1),__decorateClass([helper()],el.prototype,"getTextBetween",1),__decorateClass([helper()],el.prototype,"getHTML",1),el=__decorateClass([extension({})],el);var ed=class extends X{get name(){return"inputRules"}onCreate(){this.store.setExtensionStore("rebuildInputRules",this.rebuildInputRules.bind(this))}createExternalPlugins(){return[this.generateInputRulesPlugin()]}generateInputRulesPlugin(){var e,t;let s=[],r=this.store.markTags[b.eX.ExcludeInputRules];for(let i of this.store.extensions)if((null==(e=this.store.managerSettings.exclude)||!e.inputRules)&&i.createInputRules&&(null==(t=i.options.exclude)||!t.inputRules))for(let e of i.createInputRules())e.shouldSkip=this.options.shouldSkipInputRule,e.invalidMarks=r,s.push(e);return(0,K.Hw)({rules:s})}rebuildInputRules(){this.store.updateExtensionPlugins(this)}};ed=__decorateClass([extension({defaultPriority:b.xV.Default,handlerKeys:["shouldSkipInputRule"],handlerKeyOptions:{shouldSkipInputRule:{earlyReturnValue:!0}}})],ed);var ec=class extends X{constructor(){super(...arguments),this.extraKeyBindings=[],this.backwardMarkExitTracker=new Map,this.keydownHandler=null,this.onAddCustomHandler=({keymap:e})=>{var t,s;if(e)return this.extraKeyBindings=[...this.extraKeyBindings,e],null==(s=(t=this.store).rebuildKeymap)||s.call(t),()=>{var t,s;this.extraKeyBindings=this.extraKeyBindings.filter(t=>t!==e),null==(s=(t=this.store).rebuildKeymap)||s.call(t)}},this.rebuildKeymap=()=>{this.setupKeydownHandler()}}get name(){return"keymap"}get shortcutMap(){let{shortcuts:e}=this.options;return(0,E.HD)(e)?ep[e]:e}onCreate(){this.store.setExtensionStore("rebuildKeymap",this.rebuildKeymap)}createExternalPlugins(){var e;return(null==(e=this.store.managerSettings.exclude)?void 0:e.keymap)?[]:(this.setupKeydownHandler(),[new R.Sy({props:{handleKeyDown:(e,t)=>{var s;return null==(s=this.keydownHandler)?void 0:s.call(this,e,t)}}})])}setupKeydownHandler(){let e=this.generateKeymapBindings();this.keydownHandler=(0,D.$)(e)}generateKeymapBindings(){var e;let t=[],s=this.shortcutMap,r=this.store.getExtension(ee),extractNamesFactory=e=>t=>extractShortcutNames({shortcut:t,map:s,store:this.store,options:e.options});for(let i of this.store.extensions){let n=i.decoratedKeybindings??{};if(null==(e=i.options.exclude)||!e.keymap)for(let[e,a]of(i.createKeymap&&t.push(function(e,t){let s,r;let i={};for(let[n,a]of((0,E.kJ)(e)?[r,s]=e:s=e,(0,E.qh)(s)))i[normalizeShortcutName(n,t)]=a;return(0,E.o8)(r)?i:[r,i]}(i.createKeymap(extractNamesFactory(i)),s)),(0,E.qh)(n))){if(a.isActive&&!a.isActive(i.options,this.store))continue;let n=i[e].bind(i),o=extractShortcutNames({shortcut:a.shortcut,map:s,options:i.options,store:this.store}),l=(0,E.mf)(a.priority)?a.priority(i.options,this.store):a.priority??b.xV.Low,d=(0,E.Ry)();for(let e of o)d[e]=n;t.push([l,d]),a.command&&r.updateDecorated(a.command,{shortcut:o})}}let i=this.sortKeymaps([...this.extraKeyBindings,...t]),n=(0,M.bk)(i);return n}arrowRightShortcut(e){let t=this.store.markTags[b.eX.PreventExits],s=this.store.nodeTags[b.eX.PreventExits];return this.exitMarkForwards(t,s)(e)}arrowLeftShortcut(e){let t=this.store.markTags[b.eX.PreventExits],s=this.store.nodeTags[b.eX.PreventExits];return(0,M.Q2)(this.exitNodeBackwards(s),this.exitMarkBackwards(t,s))(e)}backspace(e){let t=this.store.markTags[b.eX.PreventExits],s=this.store.nodeTags[b.eX.PreventExits];return(0,M.Q2)(this.exitNodeBackwards(s,!0),this.exitMarkBackwards(t,s,!0))(e)}createKeymap(){let{selectParentNodeOnEscape:e,undoInputRuleOnBackspace:t,excludeBaseKeymap:s}=this.options,r=(0,E.Ry)();if(!s)for(let[e,t]of(0,E.qh)(H.YR))r[e]=(0,T.A_)(t);return t&&H.YR.Backspace&&(r.Backspace=(0,T.A_)((0,H.QF)(K.dU,H.YR.Backspace))),e&&(r.Escape=(0,T.A_)(H.N0)),[b.xV.Low,r]}getNamedShortcut(e,t={}){return e.startsWith("_|")?extractShortcutNames({shortcut:e,map:this.shortcutMap,store:this.store,options:t}):[e]}onSetOptions(e){var t,s;let{changes:r}=e;(r.excludeBaseKeymap.changed||r.selectParentNodeOnEscape.changed||r.undoInputRuleOnBackspace.changed)&&(null==(s=(t=this.store).rebuildKeymap)||s.call(t))}sortKeymaps(e){return(0,E.DY)(e.map(e=>(0,E.kJ)(e)?e:[b.xV.Default,e]),(e,t)=>t[0]-e[0]).map(e=>e[1])}exitMarkForwards(e,t){return s=>{let{tr:r,dispatch:i}=s;if(!(0,M.OA)(r.selection))return!1;let n=(0,M.Tr)({selection:r.selection,types:t});if(n)return!1;let a=r.selection.$from,o=a.marks().filter(t=>!e.includes(t.type.name));if((0,E.yD)(o))return!1;if(!i)return!0;for(let e of o)r.removeStoredMark(e);return i(r.insertText(" ",r.selection.from)),!0}}exitNodeBackwards(e,t=!1){return s=>{let{tr:r}=s,i=t?M.GK:M.sg;if(!i(r.selection))return!1;let n=r.selection.$anchor.node();return!(!(0,M.mp)(n)||(0,M.xN)(n)||e.includes(n.type.name))&&this.store.commands.toggleBlockNodeItem.original({type:n.type})(s)}}exitMarkBackwards(e,t,s=!1){return r=>{let{tr:i,dispatch:n}=r,a=s?M.GK:M.sg;if(!a(i.selection)||this.backwardMarkExitTracker.has(i.selection.anchor))return this.backwardMarkExitTracker.clear(),!1;let o=(0,M.Tr)({selection:i.selection,types:t});if(o)return!1;let l=[...i.storedMarks??[],...i.selection.$from.marks()].filter(t=>!e.includes(t.type.name));if((0,E.yD)(l))return!1;if(!n)return!0;for(let e of l)i.removeStoredMark(e);return this.backwardMarkExitTracker.set(i.selection.anchor,!0),n(i),!0}}};function extractShortcutNames({shortcut:e,map:t,options:s,store:r}){return(0,E.HD)(e)?[normalizeShortcutName(e,t)]:(0,E.kJ)(e)?e.map(e=>normalizeShortcutName(e,t)):extractShortcutNames({shortcut:e=e(s,r),map:t,options:s,store:r})}function normalizeShortcutName(e,t){return(0,E.q9)((0,E.VO)(b.vO),e)?t[e]:e}__decorateClass([keyBinding({shortcut:"ArrowRight",isActive:e=>e.exitMarksOnArrowPress})],ec.prototype,"arrowRightShortcut",1),__decorateClass([keyBinding({shortcut:"ArrowLeft",isActive:e=>e.exitMarksOnArrowPress})],ec.prototype,"arrowLeftShortcut",1),__decorateClass([keyBinding({shortcut:"Backspace",isActive:e=>e.exitMarksOnArrowPress})],ec.prototype,"backspace",1),__decorateClass([helper()],ec.prototype,"getNamedShortcut",1),ec=__decorateClass([extension({defaultPriority:b.xV.Low,defaultOptions:{shortcuts:"default",undoInputRuleOnBackspace:!0,selectParentNodeOnEscape:!1,excludeBaseKeymap:!1,exitMarksOnArrowPress:!0},customHandlerKeys:["keymap"]})],ec);var eu={[b.vO.Copy]:"Mod-c",[b.vO.Cut]:"Mod-x",[b.vO.Paste]:"Mod-v",[b.vO.PastePlain]:"Mod-Shift-v",[b.vO.SelectAll]:"Mod-a",[b.vO.Undo]:"Mod-z",[b.vO.Redo]:M.NZ.isMac?"Shift-Mod-z":"Mod-y",[b.vO.Bold]:"Mod-b",[b.vO.Italic]:"Mod-i",[b.vO.Underline]:"Mod-u",[b.vO.Strike]:"Mod-d",[b.vO.Code]:"Mod-`",[b.vO.Paragraph]:"Mod-Shift-0",[b.vO.H1]:"Mod-Shift-1",[b.vO.H2]:"Mod-Shift-2",[b.vO.H3]:"Mod-Shift-3",[b.vO.H4]:"Mod-Shift-4",[b.vO.H5]:"Mod-Shift-5",[b.vO.H6]:"Mod-Shift-6",[b.vO.TaskList]:"Mod-Shift-7",[b.vO.BulletList]:"Mod-Shift-8",[b.vO.OrderedList]:"Mod-Shift-9",[b.vO.Quote]:"Mod->",[b.vO.Divider]:"Mod-Shift-|",[b.vO.Codeblock]:"Mod-Shift-~",[b.vO.ClearFormatting]:"Mod-Shift-C",[b.vO.Superscript]:"Mod-.",[b.vO.Subscript]:"Mod-,",[b.vO.LeftAlignment]:"Mod-Shift-L",[b.vO.CenterAlignment]:"Mod-Shift-E",[b.vO.RightAlignment]:"Mod-Shift-R",[b.vO.JustifyAlignment]:"Mod-Shift-J",[b.vO.InsertLink]:"Mod-k",[b.vO.Find]:"Mod-f",[b.vO.FindBackwards]:"Mod-Shift-f",[b.vO.FindReplace]:"Mod-Shift-H",[b.vO.AddFootnote]:"Mod-Alt-f",[b.vO.AddComment]:"Mod-Alt-m",[b.vO.ContextMenu]:"Mod-Shift-\\",[b.vO.IncreaseFontSize]:"Mod-Shift-.",[b.vO.DecreaseFontSize]:"Mod-Shift-,",[b.vO.IncreaseIndent]:"Tab",[b.vO.DecreaseIndent]:"Shift-Tab",[b.vO.Shortcuts]:"Mod-/",[b.vO.Format]:M.NZ.isMac?"Alt-Shift-f":"Shift-Ctrl-f"},eh={...eu,[b.vO.Strike]:"Mod-Shift-S",[b.vO.Code]:"Mod-Shift-M",[b.vO.Paragraph]:"Mod-Alt-0",[b.vO.H1]:"Mod-Alt-1",[b.vO.H2]:"Mod-Alt-2",[b.vO.H3]:"Mod-Alt-3",[b.vO.H4]:"Mod-Alt-4",[b.vO.H5]:"Mod-Alt-5",[b.vO.H6]:"Mod-Alt-6",[b.vO.OrderedList]:"Mod-Alt-7",[b.vO.BulletList]:"Mod-Alt-8",[b.vO.Quote]:"Mod-Alt-9",[b.vO.ClearFormatting]:"Mod-\\",[b.vO.IncreaseIndent]:"Mod-[",[b.vO.DecreaseIndent]:"Mod-]"},ep={default:eu,googleDoc:eh},em=class extends X{get name(){return"nodeViews"}createPlugin(){let e=[],t=(0,E.Ry)();for(let t of this.store.extensions){if(!t.createNodeViews)continue;let s=t.createNodeViews();e.unshift((0,E.mf)(s)?{[t.name]:s}:s)}for(let s of(e.unshift(this.store.managerSettings.nodeViews??{}),e))Object.assign(t,s);return{props:{nodeViews:t}}}},eg=class extends X{get name(){return"pasteRules"}createExternalPlugins(){return[this.generatePasteRulesPlugin()]}generatePasteRulesPlugin(){var e,t;let s=[];for(let r of this.store.extensions){if((null==(e=this.store.managerSettings.exclude)?void 0:e.pasteRules)||!r.createPasteRules||(null==(t=r.options.exclude)?void 0:t.pasteRules))continue;let i=r.createPasteRules(),n=(0,E.kJ)(i)?i:[i];s.push(...n)}return(0,I.N)(s)}},ef=class extends X{constructor(){super(...arguments),this.plugins=[],this.managerPlugins=[],this.applyStateHandlers=[],this.initStateHandlers=[],this.appendTransactionHandlers=[],this.pluginKeys=(0,E.Ry)(),this.stateGetters=new Map,this.getPluginStateCreator=e=>t=>e.getState(t??this.store.getState()),this.getStateByName=e=>{let t=this.stateGetters.get(e);return(0,E.kG)(t,{message:"No plugin exists for the requested extension name."}),t()}}get name(){return"plugins"}onCreate(){let{setStoreKey:e,setExtensionStore:t,managerSettings:s,extensions:r}=this.store;this.updateExtensionStore();let{plugins:i=[]}=s;for(let e of(this.updatePlugins(i,this.managerPlugins),r))e.onApplyState&&this.applyStateHandlers.push(e.onApplyState.bind(e)),e.onInitState&&this.initStateHandlers.push(e.onInitState.bind(e)),e.onAppendTransaction&&this.appendTransactionHandlers.push(e.onAppendTransaction.bind(e)),this.extractExtensionPlugins(e);this.managerPlugins=i,this.store.setStoreKey("plugins",this.plugins),e("pluginKeys",this.pluginKeys),e("getPluginState",this.getStateByName),t("getPluginState",this.getStateByName)}createPlugin(){return{appendTransaction:(e,t,s)=>{let r=s.tr,i={previousState:t,tr:r,transactions:e,state:s};for(let e of this.appendTransactionHandlers)e(i);return this.options.appendTransaction(i),r.docChanged||r.steps.length>0||r.selectionSet||r.storedMarksSet?r:void 0},state:{init:(e,t)=>{for(let e of this.initStateHandlers)e(t)},apply:(e,t,s,r)=>{let i={previousState:s,state:r,tr:e};for(let e of this.applyStateHandlers)e(i);this.options.applyState(i)}}}}extractExtensionPlugins(e){var t,s;let r=!e.createPlugin&&!e.createExternalPlugins;if(!r&&(null==(t=this.store.managerSettings.exclude)||!t.plugins)&&(null==(s=e.options.exclude)||!s.plugins)){if(e.createPlugin){let t=new R.H$(e.name);this.pluginKeys[e.name]=t;let s=this.getPluginStateCreator(t);e.pluginKey=t,e.getPluginState=s,this.stateGetters.set(e.name,s),this.stateGetters.set(e.constructor,s);let r={...e.createPlugin(),key:t},i=new R.Sy(r);this.updatePlugins([i],e.plugin?[e.plugin]:void 0),e.plugin=i}if(e.createExternalPlugins){let t=e.createExternalPlugins();this.updatePlugins(t,e.externalPlugins),e.externalPlugins=t}}}updatePlugins(e,t){if(!t||(0,E.yD)(t)){this.plugins=[...this.plugins,...e];return}if(e.length!==t.length){this.plugins=[...this.plugins.filter(e=>!t.includes(e)),...e];return}let s=new Map;for(let[r,i]of e.entries())s.set((0,E.fp)(t,r),i);this.plugins=this.plugins.map(e=>t.includes(e)?s.get(e):e)}updateExtensionStore(){let{setExtensionStore:e}=this.store;e("updatePlugins",this.updatePlugins.bind(this)),e("dispatchPluginUpdate",this.dispatchPluginUpdate.bind(this)),e("updateExtensionPlugins",this.updateExtensionPlugins.bind(this))}updateExtensionPlugins(e){let t=isExtension(e)?e:(0,M.gf)(e)&&(0,M.pI)(e,[b.lk.PlainExtensionConstructor,b.lk.MarkExtensionConstructor,b.lk.NodeExtensionConstructor])?this.store.manager.getExtension(e):this.store.extensions.find(t=>t.name===e);(0,E.kG)(t,{code:b.mA.INVALID_MANAGER_EXTENSION,message:`The extension ${e} does not exist within the editor.`}),this.extractExtensionPlugins(t),this.store.setStoreKey("plugins",this.plugins),this.dispatchPluginUpdate()}dispatchPluginUpdate(){(0,E.kG)(this.store.phase>=b.RC.EditorView,{code:b.mA.MANAGER_PHASE_ERROR,message:"`dispatchPluginUpdate` should only be called after the view has been added to the manager."});let{view:e,updateState:t}=this.store,s=e.state.reconfigure({plugins:this.plugins});t(s)}};ef=__decorateClass([extension({defaultPriority:b.xV.Highest,handlerKeys:["applyState","appendTransaction"]})],ef);var ev=class extends X{constructor(){super(...arguments),this.dynamicAttributes={marks:(0,E.Ry)(),nodes:(0,E.Ry)()}}get name(){return"schema"}onCreate(){let{managerSettings:e,tags:t,markNames:s,nodeNames:r,extensions:i}=this.store,{defaultBlockNode:n,disableExtraAttributes:a,nodeOverride:o,markOverride:l}=e;if(e.schema){let{nodes:t,marks:s}=function(e){let t=(0,E.Ry)(),s=(0,E.Ry)();for(let[s,r]of Object.entries(e.nodes))t[s]=r.spec;for(let[t,r]of Object.entries(e.marks))s[t]=r.spec;return{nodes:t,marks:s}}(e.schema);this.addSchema(e.schema,t,s);return}let d=n&&t[b.eX.Block].includes(n)?{doc:(0,E.Ry)(),[n]:(0,E.Ry)()}:(0,E.Ry)(),c=(0,E.Ry)(),u=function(e){let{settings:t,gatheredSchemaAttributes:s,nodeNames:r,markNames:i,tags:n}=e,a=(0,E.Ry)();if(t.disableExtraAttributes)return a;let o=[...s,...t.extraAttributes??[]];for(let e of o??[]){let t=function(e){let{identifiers:t,nodeNames:s,markNames:r,tags:i}=e;if("nodes"===t)return s;if("marks"===t)return r;if("all"===t)return[...s,...r];if((0,E.kJ)(t))return t;(0,E.kG)((0,E.PO)(t)&&(0,E.kJ)(t.tags),{code:b.mA.EXTENSION_EXTRA_ATTRIBUTES,message:"Invalid value passed as an identifier when creating `extraAttributes`."});let{tags:n=[],names:a=[],behavior:o="any",excludeNames:l,excludeTags:d,type:c}=t,u=new Set,h="mark"===c?r:"node"===c?s:[...r,...s],isNameValid=e=>h.includes(e)&&!(null==l?void 0:l.includes(e));for(let e of a)isNameValid(e)&&u.add(e);let p=new Map;for(let e of n)if(null==d||!d.includes(e))for(let t of i[e]){if(!isNameValid(t))continue;if("any"===o){u.add(t);continue}let s=p.get(t)??new Set;s.add(e),p.set(t,s)}for(let[e,t]of p)t.size===n.length&&u.add(e);return[...u]}({identifiers:e.identifiers,nodeNames:r,markNames:i,tags:n});for(let s of t){let t=a[s]??{};a[s]={...t,...e.attributes}}}return a}({settings:e,gatheredSchemaAttributes:this.gatherExtraAttributes(i),nodeNames:r,markNames:s,tags:t});for(let e of i){u[e.name]={...u[e.name],...e.options.extraAttributes};let t=!0===a||!0===e.options.disableExtraAttributes||!0===e.constructor.disableExtraAttributes;if(isNodeExtension(e)){let{spec:s,dynamic:r}=createSpec({createExtensionSpec:(t,s)=>e.createNodeSpec(t,s),extraAttributes:(0,E.fp)(u,e.name),override:{...o,...e.options.nodeOverride},ignoreExtraAttributes:t,name:e.constructorName,tags:e.tags});e.spec=s,d[e.name]=s,Object.keys(r).length>0&&(this.dynamicAttributes.nodes[e.name]=r)}if(isMarkExtension(e)){let{spec:s,dynamic:r}=createSpec({createExtensionSpec:(t,s)=>e.createMarkSpec(t,s),extraAttributes:(0,E.fp)(u,e.name),override:{...l,...e.options.markOverride},ignoreExtraAttributes:t,name:e.constructorName,tags:e.tags??[]});e.spec=s,c[e.name]=s,Object.keys(r).length>0&&(this.dynamicAttributes.marks[e.name]=r)}}let h=new N.V_({nodes:d,marks:c,topNode:"doc"});this.addSchema(h,d,c)}createPlugin(){return{appendTransaction:(e,t,s)=>{let{tr:r}=s,i=e.some(e=>e.docChanged);return i&&(0!==Object.keys(this.dynamicAttributes.nodes).length||0!==Object.keys(this.dynamicAttributes.marks).length)?(r.doc.descendants((e,t)=>(this.checkAndUpdateDynamicNodes(e,t,r),this.checkAndUpdateDynamicMarks(e,t,r),!0)),r.steps.length>0?r:null):null}}}addSchema(e,t,s){for(let r of(this.store.setStoreKey("nodes",t),this.store.setStoreKey("marks",s),this.store.setStoreKey("schema",e),this.store.setExtensionStore("schema",e),this.store.setStoreKey("defaultBlockNode",(0,M.JN)(e).name),Object.values(e.nodes)))if("doc"!==r.name&&(r.isBlock||r.isTextblock))break}checkAndUpdateDynamicNodes(e,t,s){for(let[r,i]of(0,E.qh)(this.dynamicAttributes.nodes))if(e.type.name===r)for(let[r,n]of(0,E.qh)(i)){if(!(0,E.le)(e.attrs[r]))continue;let i={...e.attrs,[r]:n(e)};s.setNodeMarkup(t,void 0,i),(0,L.gn)(s)}}checkAndUpdateDynamicMarks(e,t,s){for(let[r,i]of(0,E.qh)(this.dynamicAttributes.marks)){let n=(0,E.fp)(this.store.schema.marks,r),a=e.marks.find(e=>e.type.name===r);if(a)for(let[e,r]of(0,E.qh)(i)){if(!(0,E.le)(a.attrs[e]))continue;let i=(0,M.IH)(s.doc.resolve(t),n);if(!i)continue;let{from:o,to:l}=i,d=n.create({...a.attrs,[e]:r(a)});s.removeMark(o,l,n).addMark(o,l,d),(0,L.gn)(s)}}}gatherExtraAttributes(e){let t=[];for(let s of e)s.createSchemaAttributes&&t.push(...s.createSchemaAttributes());return t}};function createSpec(e){var t,s,r;let{createExtensionSpec:i,extraAttributes:n,ignoreExtraAttributes:a,name:o,tags:l,override:d}=e,c=(0,E.Ry)(),u=!1,h=(s=function(){u=!0},r=function(e,t){c[e]=t},()=>{s();let e=(0,E.Ry)();if(a)return e;for(let[t,s]of(0,E.qh)(n)){let i=getExtraAttributesObject(s),n=i.default;(0,E.mf)(n)&&(r(t,n),n=null),e[t]=void 0===n?{}:{default:n}}return e}),p=i({defaults:h,parse:e=>{let t=(0,E.Ry)();if(a)return t;for(let[s,r]of(0,E.qh)(n)){let{parseDOM:i,...n}=getExtraAttributesObject(r);if((0,M.jd)(e)){if((0,E.le)(i)){t[s]=e.getAttribute(s)??n.default;continue}if((0,E.mf)(i)){t[s]=i(e)??n.default;continue}t[s]=e.getAttribute(i)??n.default}}return t},dom:e=>{let t=(0,E.Ry)();if(a)return t;function updateDomAttributes(s,r){if(s){if((0,E.HD)(s)){t[r]=s;return}if((0,E.kJ)(s)){let[i,n]=s;t[i]=n??e.attrs[r];return}for(let[e,r]of(0,E.qh)(s))t[e]=r}}for(let[s,r]of(0,E.qh)(n)){let{toDOM:i,parseDOM:n}=getExtraAttributesObject(r);if((0,E.le)(i)){let r=(0,E.HD)(n)?n:s;t[r]=e.attrs[s];continue}if((0,E.mf)(i)){updateDomAttributes(i(e.attrs,(0,M.PH)(e)?{node:e}:(0,M.K_)(e)?{mark:e}:{}),s);continue}updateDomAttributes(i,s)}return t}},d);return(0,E.kG)(a||u,{code:b.mA.EXTENSION_SPEC,message:`When creating a node specification you must call the 'defaults', and parse, and 'dom' methods. To avoid this error you can set the static property 'disableExtraAttributes' of '${o}' to 'true'.`}),p.group=[...(null==(t=p.group)?void 0:t.split(" "))??[],...l].join(" ")||void 0,{spec:p,dynamic:c}}function getExtraAttributesObject(e){return(0,E.HD)(e)||(0,E.mf)(e)?{default:e}:((0,E.kG)(e,{message:`${(0,E.BB)(e)} is not supported`,code:b.mA.EXTENSION_EXTRA_ATTRIBUTES}),e)}ev=__decorateClass([extension({defaultPriority:b.xV.Highest})],ev);var e_=class extends X{constructor(){super(...arguments),this.onAddCustomHandler=({suggester:e})=>{var t;if(e&&(null==(t=this.store.managerSettings.exclude)||!t.suggesters))return(0,L.Ek)(this.store.getState(),e)}}get name(){return"suggest"}onCreate(){this.store.setExtensionStore("addSuggester",e=>(0,L.Ek)(this.store.getState(),e)),this.store.setExtensionStore("removeSuggester",e=>(0,L.C$)(this.store.getState(),e))}createExternalPlugins(){var e,t;let s=[];for(let r of this.store.extensions){if(null==(e=this.store.managerSettings.exclude)?void 0:e.suggesters)break;if(!r.createSuggesters||(null==(t=r.options.exclude)?void 0:t.suggesters))continue;let i=r.createSuggesters(),n=(0,E.kJ)(i)?i:[i];s.push(...n)}return[(0,L.D7)(...s)]}getSuggestState(e){return(0,L.hu)(e??this.store.getState())}getSuggestMethods(){let{addIgnored:e,clearIgnored:t,removeIgnored:s,ignoreNextExit:r,setMarkRemoved:i,findMatchAtPosition:n,findNextTextSelection:a,setLastChangeFromAppend:o}=this.getSuggestState();return{addIgnored:e,clearIgnored:t,removeIgnored:s,ignoreNextExit:r,setMarkRemoved:i,findMatchAtPosition:n,findNextTextSelection:a,setLastChangeFromAppend:o}}isSuggesterActive(e){var t;return(0,E.q9)((0,E.kJ)(e)?e:[e],null==(t=this.getSuggestState().match)?void 0:t.suggester.name)}};__decorateClass([helper()],e_.prototype,"getSuggestState",1),__decorateClass([helper()],e_.prototype,"getSuggestMethods",1),__decorateClass([helper()],e_.prototype,"isSuggesterActive",1),e_=__decorateClass([extension({customHandlerKeys:["suggester"]})],e_);var ey=class extends X{constructor(){super(...arguments),this.allTags=(0,E.Ry)(),this.plainTags=(0,E.Ry)(),this.markTags=(0,E.Ry)(),this.nodeTags=(0,E.Ry)()}get name(){return"tags"}onCreate(){for(let e of(this.resetTags(),this.store.extensions))this.updateTagForExtension(e);this.store.setStoreKey("tags",this.allTags),this.store.setExtensionStore("tags",this.allTags),this.store.setStoreKey("plainTags",this.plainTags),this.store.setExtensionStore("plainTags",this.plainTags),this.store.setStoreKey("markTags",this.markTags),this.store.setExtensionStore("markTags",this.markTags),this.store.setStoreKey("nodeTags",this.nodeTags),this.store.setExtensionStore("nodeTags",this.nodeTags)}resetTags(){let e=(0,E.Ry)(),t=(0,E.Ry)(),s=(0,E.Ry)(),r=(0,E.Ry)();for(let i of(0,E.VO)(b.eX))e[i]=[],t[i]=[],s[i]=[],r[i]=[];this.allTags=e,this.plainTags=t,this.markTags=s,this.nodeTags=r}updateTagForExtension(e){var t,s;let r=new Set([...e.tags??[],...(null==(t=e.createTags)?void 0:t.call(e))??[],...e.options.extraTags??[],...(null==(s=this.store.managerSettings.extraTags)?void 0:s[e.name])??[]]);for(let t of r)(0,E.kG)((0,E.q9)((0,E.VO)(b.eX),t),{code:b.mA.EXTENSION,message:`The tag provided by the extension: ${e.constructorName} is not supported by the editor. To add custom tags you can use the 'mutateTag' method.`}),this.allTags[t].push(e.name),isPlainExtension(e)&&this.plainTags[t].push(e.name),isMarkExtension(e)&&this.markTags[t].push(e.name),isNodeExtension(e)&&this.nodeTags[t].push(e.name);e.tags=[...r]}};ey=__decorateClass([extension({defaultPriority:b.xV.Highest})],ey);var eS=new R.H$("remirrorFilePlaceholderPlugin");function findUploadPlaceholderPos(e,t){var s,r;let i;let n=null==(s=eS.getState(e))?void 0:s.set;if(n){let s=n.find(void 0,void 0,e=>e.id===t),i=null==(r=null==s?void 0:s[0])?void 0:r.from;if(null!=i&&i<e.doc.content.size){let s=e.doc.resolve(i),r=s.nodeAfter;if((null==r?void 0:r.attrs.id)===t)return i}}return e.doc.descendants((e,s)=>(e.attrs.id===t&&(i=s),void 0===i)),i}function findUploadPlaceholderPayload(e,t){var s;let r=null==(s=eS.getState(e))?void 0:s.payloads;if(r)return r.get(t)}function setUploadPlaceholderAction(e,t){return e.setMeta(eS,t)}function uploadFile({file:e,pos:t,view:s,fileType:r,uploadHandler:i}){let n=(0,E.EL)("file-placeholder-"),a=function(){let e={},t=(0,V.i)();return{set:(s,r)=>{e[s]=r,t.emit("set",e)},get:t=>e[t],addListener:e=>t.on("set",e)}}(),o=function({id:e,context:t,file:s,pos:r,view:i,fileType:n,uploadHandler:a}){let o=i.state.tr,l=function(e,t,s){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),s))return t;if(0===r.parentOffset)for(let e=r.depth-1;e>=0;e--){let t=r.index(e);if(r.node(e).canReplaceWith(t,t,s))return r.before(e+1);if(t>0)return null}for(let e=r.depth-1;e>=0;e--){let t=r.indexAfter(e);if(r.node(e).canReplaceWith(t,t,s))return r.after(e+1);if(t<r.node(e).childCount)break}return null}(o.doc,(0,E.hj)(r)?r:o.selection.from,n);if(!(0,E.hj)(l))return;let d=a(),c={...d.insert(s),id:e};return o.insert(l,n.createChecked(c)),setUploadPlaceholderAction(o,{type:0,id:e,pos:l,payload:{context:t,fileUploader:d}}),i.dispatch(o),d}({id:n,context:a,file:e,pos:t,view:s,fileType:r,uploadHandler:i});null==o||o.upload(a).then(e=>onFileLoaded({id:n,fileType:r,view:s,attrs:e})).catch(e=>onFileLoaded({id:n,fileType:r,view:s,attrs:{error:e.message}}))}function onFileLoaded({id:e,attrs:t,fileType:s,view:r}){let i=findUploadPlaceholderPos(r.state,e);if(null==i)return;let n=r.state.doc.resolve(i),a=n.nodeAfter;if(!a||a.type!==s||a.attrs.id!==e){let t=r.state.tr;setUploadPlaceholderAction(t,{type:1,id:e}),r.dispatch(t);return}let o=r.state.tr;setUploadPlaceholderAction(o,{type:1,id:e});let l={...a.attrs,...t,id:null};o.setNodeMarkup(i,void 0,l),r.dispatch(o)}var ex=class extends X{get name(){return"upload"}createExternalPlugins(){return[function(){let e=new R.Sy({key:eS,state:{init:()=>({set:G.EH.empty,payloads:new Map}),apply(t,{set:s,payloads:r}){s=s.map(t.mapping,t.doc);let i=t.getMeta(e);if(i){if(0===i.type){let e=document.createElement("placeholder"),n=G.p.widget(i.pos,e,{id:i.id});s=s.add(t.doc,[n]),r.set(i.id,i.payload)}else 1===i.type&&(s=s.remove(s.find(void 0,void 0,e=>e.id===i.id)),r.delete(i.id))}return{set:s,payloads:r}}},props:{decorations(t){var s;return(null==(s=e.getState(t))?void 0:s.set)??null}}});return e}()]}},ek=class extends X{get name(){return"meta"}onCreate(){if(this.store.setStoreKey("getCommandMeta",this.getCommandMeta.bind(this)),this.options.capture)for(let e of this.store.extensions)this.captureCommands(e),this.captureKeybindings(e)}createPlugin(){return{}}captureCommands(e){let t=e.decoratedCommands??{},s=e.createCommands;for(let s of Object.keys(t)){let t=e[s];e[s]=(...r)=>i=>{var n;let a=t(...r)(i);return i.dispatch&&a&&this.setCommandMeta(i.tr,{type:"command",chain:i.dispatch!==(null==(n=i.view)?void 0:n.dispatch),name:s,extension:e.name,decorated:!0}),a}}s&&(e.createCommands=()=>{let t=s();for(let[s,r]of Object.entries(t))t[s]=(...t)=>i=>{var n;let a=r(...t)(i);return i.dispatch&&a&&this.setCommandMeta(i.tr,{type:"command",chain:i.dispatch!==(null==(n=i.view)?void 0:n.dispatch),name:s,extension:e.name,decorated:!1}),a};return t})}captureKeybindings(e){}getCommandMeta(e){return e.getMeta(this.pluginKey)??[]}setCommandMeta(e,t){let s=this.getCommandMeta(e);e.setMeta(this.pluginKey,[...s,t])}};ek=__decorateClass([extension({defaultOptions:{capture:M.NZ.isDevelopment},staticKeys:["capture"],defaultPriority:b.xV.Highest})],ek);var eE=class{constructor(e){__privateAdd(this,r,(0,E.EL)()),__privateAdd(this,i,void 0),__privateAdd(this,n,void 0),__privateAdd(this,a,!0),__privateAdd(this,o,(0,V.i)()),__privateAdd(this,l,void 0),__privateAdd(this,d,void 0),this.getState=()=>this.view.state??this.initialEditorState,this.getPreviousState=()=>this.previousState,this.dispatchTransaction=e=>{var t,s;(0,E.kG)(!this.manager.destroyed,{code:b.mA.MANAGER_PHASE_ERROR,message:"A transaction was dispatched to a manager that has already been destroyed. Please check your set up, or open an issue."}),e=(null==(s=(t=this.props).onDispatchTransaction)?void 0:s.call(t,e,this.getState()))??e;let r=this.getState(),{state:i,transactions:a}=r.applyTransaction(e);__privateSet(this,n,r),this.updateState({state:i,tr:e,transactions:a});let o=this.manager.store.getForcedUpdates(e);(0,E.yD)(o)||this.updateViewProps(...o)},this.onChange=(e=(0,E.Ry)())=>{var t,s;let r=this.eventListenerProps(e);__privateGet(this,a)&&__privateSet(this,a,!1),null==(s=(t=this.props).onChange)||s.call(t,r)},this.onBlur=e=>{var t,s;let r=this.eventListenerProps();null==(s=(t=this.props).onBlur)||s.call(t,r,e),__privateGet(this,o).emit("blur",r,e)},this.onFocus=e=>{var t,s;let r=this.eventListenerProps();null==(s=(t=this.props).onFocus)||s.call(t,r,e),__privateGet(this,o).emit("focus",r,e)},this.setContent=(e,{triggerChange:t=!1}={})=>{let{doc:s}=this.manager.createState({content:e}),r=this.getState(),{state:i}=this.getState().applyTransaction(r.tr.replaceRangeWith(0,r.doc.nodeSize-2,s));if(t)return this.updateState({state:i,triggerChange:t});this.view.updateState(i)},this.clearContent=({triggerChange:e=!1}={})=>{this.setContent(this.manager.createEmptyDoc(),{triggerChange:e})},this.createStateFromContent=(e,t)=>this.manager.createState({content:e,selection:t}),this.focus=e=>{this.manager.store.commands.focus(e)},this.blur=e=>{this.manager.store.commands.blur(e)};let{getProps:t,initialEditorState:s,element:c}=e;if(__privateSet(this,i,t),__privateSet(this,d,s),this.manager.attachFramework(this,this.updateListener.bind(this)),this.manager.view)return;let u=this.createView(s,c);this.manager.addView(u)}get addHandler(){return __privateGet(this,l)??__privateSet(this,l,__privateGet(this,o).on.bind(__privateGet(this,o)))}get updatableViewProps(){return{attributes:()=>this.getAttributes(),editable:()=>this.props.editable??!0}}get firstRender(){return __privateGet(this,a)}get props(){return __privateGet(this,i).call(this)}get previousState(){return this.previousStateOverride??__privateGet(this,n)??this.initialEditorState}get manager(){return this.props.manager}get view(){return this.manager.view}get uid(){return __privateGet(this,r)}get initialEditorState(){return __privateGet(this,d)}updateListener(e){let{state:t,tr:s}=e;return __privateGet(this,o).emit("updated",this.eventListenerProps({state:t,tr:s}))}update(e){let{getProps:t}=e;return __privateSet(this,i,t),this}updateViewProps(...e){let t=O(this.updatableViewProps,e);this.view.setProps({...this.view.props,...t})}getAttributes(e){var t;let{attributes:s,autoFocus:r,classNames:i=[],label:n,editable:a}=this.props,o=null==(t=this.manager.store)?void 0:t.attributes,l=(0,E.mf)(s)?s(this.eventListenerProps()):s,d={};(r||(0,E.hj)(r))&&(d=e?{autoFocus:!0}:{autofocus:"true"});let c=(0,E.Nb)(cx(e&&"Prosemirror","remirror-editor",null==o?void 0:o.class,...i).split(" ")).join(" "),u={role:"textbox",...d,"aria-multiline":"true",...a??!0?{}:{"aria-readonly":"true"},"aria-label":n??"",...o,class:c};return(0,E.Yc)({...u,...l})}addFocusListeners(){this.view.dom.addEventListener("blur",this.onBlur),this.view.dom.addEventListener("focus",this.onFocus)}removeFocusListeners(){this.view.dom.removeEventListener("blur",this.onBlur),this.view.dom.removeEventListener("focus",this.onFocus)}destroy(){__privateGet(this,o).emit("destroy"),this.view&&this.removeFocusListeners()}eventListenerProps(e=(0,E.Ry)()){let{state:t,tr:s,transactions:r}=e;return{tr:s,transactions:r,internalUpdate:!s,view:this.view,firstRender:__privateGet(this,a),state:t??this.getState(),createStateFromContent:this.createStateFromContent,previousState:this.previousState,helpers:this.manager.store.helpers}}get baseOutput(){return{manager:this.manager,...this.manager.store,addHandler:this.addHandler,focus:this.focus,blur:this.blur,uid:__privateGet(this,r),view:this.view,getState:this.getState,getPreviousState:this.getPreviousState,getExtension:this.manager.getExtension.bind(this.manager),hasExtension:this.manager.hasExtension.bind(this.manager),clearContent:this.clearContent,setContent:this.setContent}}};r=new WeakMap,i=new WeakMap,n=new WeakMap,a=new WeakMap,o=new WeakMap,l=new WeakMap,d=new WeakMap;var eb=class{constructor(e,t={}){__privateAdd(this,c,void 0),__privateAdd(this,u,(0,E.Ry)()),__privateAdd(this,h,(0,E.Ry)()),__privateAdd(this,p,void 0),__privateAdd(this,m,void 0),__privateAdd(this,g,b.RC.None),__privateAdd(this,f,void 0),__privateAdd(this,v,!0),__privateAdd(this,_,{create:[],view:[],update:[],destroy:[]}),__privateAdd(this,y,[]),__privateAdd(this,S,(0,V.i)()),__privateAdd(this,x,void 0),__privateAdd(this,k,void 0),this.getState=()=>{var e;return __privateGet(this,g)>=b.RC.EditorView?this.view.state:((0,E.kG)(__privateGet(this,x),{code:b.mA.MANAGER_PHASE_ERROR,message:"`getState` can only be called after the `Framework` or the `EditorView` has been added to the manager`. Check your plugins to make sure that the decorations callback uses the state argument."}),null==(e=__privateGet(this,x))?void 0:e.initialEditorState)},this.updateState=e=>{let t=this.getState();this.view.updateState(e),this.onStateUpdate({previousState:t,state:e})};let{extensions:s,extensionMap:r}=function(e,t){let s=[],r=new WeakMap,i=new WeakMap,n=[],a={duplicateMap:i,parentExtensions:[],gatheredExtensions:n,settings:t};for(let t of e)!function gatherRawExtensions(e,t){var s;let{gatheredExtensions:r,duplicateMap:i,parentExtensions:n,settings:a}=e,{extension:o,parentExtension:l}=t,{names:d=[]}=t;(0,E.kG)(isExtension(o),{code:b.mA.INVALID_MANAGER_EXTENSION,message:`An invalid extension: ${o} was provided to the [[\`RemirrorManager\`]].`});let c=o.extensions;if(o.setPriority(null==(s=a.priority)?void 0:s[o.name]),r.push(o),function(e){let{duplicateMap:t,extension:s,parentExtension:r}=e,i=s.constructor,n=t.get(i),a=r?[r]:[];t.set(i,n?[...n,...a]:a)}({duplicateMap:i,extension:o,parentExtension:l}),0!==c.length){if(d.includes(o.name)){(0,B.Z)(!1,`Circular dependency encountered when loading extensions: ${d.join(" > ")} > ${o.name}`);return}for(let t of(d=[...d,o.name],n.push(o),c))gatherRawExtensions(e,{names:d,extension:t,parentExtension:o})}}(a,{extension:t});n=(0,E.DY)(n,(e,t)=>t.priority-e.priority);let o=new WeakSet,l=new Set;for(let e of n){let t=e.constructor,n=e.name,a=i.get(t);(0,E.kG)(a,{message:`No entries were found for the ExtensionConstructor ${e.name}`,code:b.mA.INTERNAL}),o.has(t)||l.has(n)||(o.add(t),l.add(n),s.push(e),r.set(t,e),a.forEach(s=>null==s?void 0:s.replaceChildExtension(t,e)))}let d=[];for(let e of s)!function(e){let{extension:t,found:s,missing:r}=e;if(t.requiredExtensions)for(let e of t.requiredExtensions??[])s.has(e)||r.push({Constructor:e,extension:t})}({extension:e,found:o,missing:d});return(0,E.kG)((0,E.yD)(d),{code:b.mA.MISSING_REQUIRED_EXTENSION,message:d.map(({Constructor:e,extension:t})=>`The extension '${t.name}' requires '${e.name} in order to run correctly.`).join("\n")}),{extensions:s,extensionMap:r}}(e,t);for(let e of(__privateSet(this,f,t),__privateSet(this,p,(0,E.vV)(s)),__privateSet(this,m,r),__privateSet(this,c,this.createExtensionStore()),__privateSet(this,g,b.RC.Create),this.setupLifecycleHandlers(),__privateGet(this,_).create)){let t=e();t&&__privateGet(this,y).push(t)}}static create(e,t={}){return new eb([...(0,E.r2)(e),...function(e={}){let t={exitMarksOnArrowPress:ec.defaultOptions.exitMarksOnArrowPress,excludeBaseKeymap:ec.defaultOptions.excludeBaseKeymap,selectParentNodeOnEscape:ec.defaultOptions.selectParentNodeOnEscape,undoInputRuleOnBackspace:ec.defaultOptions.undoInputRuleOnBackspace,persistentSelectionClass:er.defaultOptions.persistentSelectionClass};e={...t,...e};let s=O(e,["excludeBaseKeymap","selectParentNodeOnEscape","undoInputRuleOnBackspace"]),r=O(e,["persistentSelectionClass"]);return[new ey,new ev,new Z,new ef,new ed,new eg,new em,new e_,new ee,new el,new ec(s),new eo,new ex,new er(r)]}(t.builtin)],t)}get[b.By](){return b.lk.Manager}get destroyed(){return __privateGet(this,g)===b.RC.Destroy}get mounted(){return __privateGet(this,g)>=b.RC.EditorView&&__privateGet(this,g)<b.RC.Destroy}get output(){var e;return null==(e=__privateGet(this,x))?void 0:e.frameworkOutput}get frameworkAttached(){return!!__privateGet(this,x)}get extensions(){return __privateGet(this,p)}get stringHandlers(){return __privateGet(this,u)}get store(){return(0,E.vV)(__privateGet(this,h))}get extensionStore(){return(0,E.vV)(__privateGet(this,c))}get tr(){return this.getExtension(ee).transaction}get nodes(){return __privateGet(this,h).nodes}get marks(){return __privateGet(this,h).marks}get schema(){return __privateGet(this,h).schema}get extensionTags(){return __privateGet(this,h).tags}get view(){return __privateGet(this,h).view}get settings(){return __privateGet(this,f)}get document(){return __privateGet(this,f).document??(0,M.Me)()}setupLifecycleHandlers(){let e=__privateGet(this,c),t=__privateGet(this,_),s=[],r=[],i=[];for(let n of(e.nodeNames=s,e.markNames=r,e.plainNames=i,__privateGet(this,p)))!function(e){var t,s,r,i;let{extension:n,nodeNames:a,markNames:o,plainNames:l,store:d,handlers:c}=e;n.setStore(d);let u=null==(t=n.onCreate)?void 0:t.bind(n),h=null==(s=n.onView)?void 0:s.bind(n),p=null==(r=n.onStateUpdate)?void 0:r.bind(n),m=null==(i=n.onDestroy)?void 0:i.bind(n);u&&c.create.push(u),h&&c.view.push(h),p&&c.update.push(p),m&&c.destroy.push(m),isMarkExtension(n)&&o.push(n.name),isNodeExtension(n)&&"doc"!==n.name&&a.push(n.name),isPlainExtension(n)&&l.push(n.name)}({extension:n,nodeNames:s,markNames:r,plainNames:i,handlers:t,store:e})}setStringHandler(e,t){__privateGet(this,u)[e]=t}setStoreKey(e,t){__privateGet(this,h)[e]=t}getStoreKey(e){let t=__privateGet(this,h)[e];return(0,E.kG)(!(0,E.le)(t),{code:b.mA.MANAGER_PHASE_ERROR,message:"`getStoreKey` should not be called before the values are available."}),t}setExtensionStore(e,t){(0,E.kG)(__privateGet(this,g)<=b.RC.EditorView,{code:b.mA.MANAGER_PHASE_ERROR,message:"`setExtensionStore` should only be called during the `onCreate` lifecycle hook. Make sure to only call it within the returned methods."}),__privateGet(this,c)[e]=t}createExtensionStore(){let e,t;let s=(0,E.Ry)();return Object.defineProperties(s,{extensions:{get:()=>__privateGet(this,p),enumerable:!0},phase:{get:()=>__privateGet(this,g),enumerable:!0},view:{get:()=>this.view,enumerable:!0},managerSettings:{get:()=>(0,E.vV)(__privateGet(this,f)),enumerable:!0},getState:{value:this.getState,enumerable:!0},updateState:{value:this.updateState,enumerable:!0},isMounted:{value:()=>this.mounted,enumerable:!0},getExtension:{value:this.getExtension.bind(this),enumerable:!0},manager:{get:()=>this,enumerable:!0},document:{get:()=>this.document,enumerable:!0},stringHandlers:{get:()=>__privateGet(this,u),enumerable:!0},currentState:{get:()=>e??(e=this.getState()),set:t=>{e=t},enumerable:!0},previousState:{get:()=>t,set:e=>{t=e},enumerable:!0}}),s.getStoreKey=this.getStoreKey.bind(this),s.setStoreKey=this.setStoreKey.bind(this),s.setExtensionStore=this.setExtensionStore.bind(this),s.setStringHandler=this.setStringHandler.bind(this),s}addView(e){if(__privateGet(this,g)>=b.RC.EditorView)return this;for(let t of(__privateSet(this,v,!0),__privateSet(this,g,b.RC.EditorView),__privateGet(this,h).view=e,__privateGet(this,_).view)){let s=t(e);s&&__privateGet(this,y).push(s)}return this}attachFramework(e,t){var s;__privateGet(this,x)!==e&&(__privateGet(this,x)&&(__privateGet(this,x).destroy(),null==(s=__privateGet(this,k))||s.call(this)),__privateSet(this,x,e),__privateSet(this,k,this.addHandler("stateUpdate",t)))}createEmptyDoc(){var e;let t=null==(e=this.schema.nodes.doc)?void 0:e.createAndFill();return(0,E.kG)(t,{code:b.mA.INVALID_CONTENT,message:"An empty node could not be created due to an invalid schema."}),t}createState(e={}){let{onError:t,defaultSelection:s="end"}=this.settings,{content:r=this.createEmptyDoc(),selection:i=s,stringHandler:n=this.settings.stringHandler}=e,{schema:a,plugins:o}=this.store,l=(0,M.EP)({stringHandler:(0,E.HD)(n)?this.stringHandlers[n]:n,document:this.document,content:r,onError:t,schema:a,selection:i});return R.yy.create({schema:a,doc:l,plugins:o,selection:(0,M.b0)(i,l)})}addHandler(e,t){return __privateGet(this,S).on(e,t)}onStateUpdate(e){let t=__privateGet(this,v);__privateGet(this,c).currentState=e.state,__privateGet(this,c).previousState=e.previousState,t&&(__privateSet(this,g,b.RC.Runtime),__privateSet(this,v,!1));let s={...e,firstUpdate:t};for(let e of __privateGet(this,_).update)e(s);__privateGet(this,S).emit("stateUpdate",s)}getExtension(e){let t=__privateGet(this,m).get(e);return(0,E.kG)(t,{code:b.mA.INVALID_MANAGER_EXTENSION,message:`'${e.name}' doesn't exist within this manager. Make sure it is properly added before attempting to use it.`}),t}hasExtension(e){let t=__privateGet(this,m).get(e);return!!t}clone(){let e=__privateGet(this,p).map(e=>e.clone(e.options)),t=eb.create(()=>e,__privateGet(this,f));return __privateGet(this,S).emit("clone",t),t}recreate(e=[],t={}){let s=__privateGet(this,p).map(e=>e.clone(e.initialOptions)),r=eb.create(()=>[...s,...e],t);return __privateGet(this,S).emit("recreate",r),r}destroy(){var e,t,s,r,i,n;for(let r of(__privateSet(this,g,b.RC.Destroy),(null==(e=this.view)?void 0:e.state.plugins)??[]))null==(s=null==(t=r.getState(this.view.state))?void 0:t.destroy)||s.call(t);for(let e of(null==(r=__privateGet(this,x))||r.destroy(),null==(i=__privateGet(this,k))||i.call(this),__privateGet(this,y)))e();for(let e of __privateGet(this,_).destroy)e();null==(n=this.view)||n.destroy(),__privateGet(this,S).emit("destroy")}includes(e){let t=[],s=[];for(let e of __privateGet(this,p))t.push(e.name,e.constructorName),s.push(e.constructor);return e.every(e=>(0,E.HD)(e)?(0,E.q9)(t,e):(0,E.q9)(s,e))}},eC=eb;function isRemirrorManager(e,t){return!!((0,M.gf)(e)&&(0,M.pI)(e,b.lk.Manager))&&(!t||e.includes(t))}c=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,f=new WeakMap,v=new WeakMap,_=new WeakMap,y=new WeakMap,S=new WeakMap,x=new WeakMap,k=new WeakMap}}]);