(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4431],{78557:function(e,n,r){"use strict";r.d(n,{V:function(){return addBacklinkToNote}});var o=r(25038),a=r(15965),i=r(28418);function addBacklinkToNote(e){var n;let{noteStore:r,contactStore:s,backlink:l,matchByLabel:c=!0}=e,d=function(e){let{noteStore:n,contactStore:r,backlink:o,matchByLabel:s=!1}=e,l=o.id,c=l?n.findById(l):null;if(c)return c;if(o.dailyAt?c=n.findOrCreateDailyNoteByDate(o.dailyAt):s&&o.label&&(c=n.findBySubject(o.label)),!c){let e=function(e){let{backlink:n,graphId:r,contactStore:o}=e,s=n.contactId;if(!s)return null;let l=o.find(s);return l?(0,a.FT)((0,i.ct)(l,r)):null}({backlink:o,graphId:n.assertGraph.id,contactStore:r});c=n.createNote({subject:o.label,document:null!=e?e:void 0},{emptyList:!1})}return c}({noteStore:r,contactStore:s,backlink:l,matchByLabel:c});d.incrementBacklinkedCount();let u=d.assertGraph,p=null!==(n=l.insertLabel)&&void 0!==n?n:l.label;return(0,o.yV)({backlink_created:!0}),(0,o.j)("backlink_created"),{...l,graphId:u.id,label:p,id:d.id}}},60381:function(e,n,r){"use strict";r.d(n,{Dh:function(){return rewriteBacklinks},Px:function(){return rewriteIncomingBacklinkLabels}});var o=r(15965);function rewriteBacklinks(e,n,r){let a=e.outgoingBacklinks.find(e=>e.toNoteId===n);if(a)return e.changeManager.modifyDocument(e=>(0,o.Ne)(e,e=>{(0,o.YK)(e,n,r)}))}function rewriteIncomingBacklinkLabels(e,n){for(let a of e.incomingBacklinks){var r;let i=null===(r=e.noteStore)||void 0===r?void 0:r.findById(a.fromNoteId);i&&function(e,n){let{backlinkId:r,label:a}=n;e.changeManager.modifyDocument(e=>(0,o.Ne)(e,e=>{(0,o.YK)(e,r,r,{label:a})}))}(i,{backlinkId:e.id,label:n})}return!0}},6553:function(e,n,r){"use strict";r.d(n,{m:function(){return PromiseTimeoutError}});let PromiseTimeoutError=class PromiseTimeoutError extends Error{constructor(){super("Promise timed out"),this.name="PromiseTimeoutError"}}},39411:function(e,n,r){"use strict";r.d(n,{AA:function(){return GraphMigratingError},Kg:function(){return GraphDoesNotExistError},bZ:function(){return GraphOldSaveRejectedError},fD:function(){return FailedFetchingGraphVersionError}});let GraphDoesNotExistError=class GraphDoesNotExistError extends Error{constructor(e){super("Graph ".concat(e," does not exist")),this.name="GraphDoesNotExistError"}};let GraphMigratingError=class GraphMigratingError extends Error{constructor(e){super("Graph ".concat(e.graph.id," is currently migrating to version ").concat(e.migratingVersion)),this.name="GraphMigratingError"}};let GraphOldSaveRejectedError=class GraphOldSaveRejectedError extends Error{constructor(){super("Attempted to save during migration or in newer format than latest migration"),this.name="GraphOldSaveRejectedError"}};let FailedFetchingGraphVersionError=class FailedFetchingGraphVersionError extends Error{constructor(){super("Failed to fetch graph version"),this.name="FailedFetchingGraphVersionError"}}},80339:function(e,n,r){"use strict";r.d(n,{KL:function(){return MissingYjsDocError},UG:function(){return FailedReadingNoteError},h3:function(){return MissingDocError}});let MissingDocError=class MissingDocError extends Error{constructor(e){super("Note ".concat(e.graphId,"/").concat(e.id," is missing the document")),this.name="MissingDocError"}};let MissingYjsDocError=class MissingYjsDocError extends Error{constructor(e){super("Note ".concat(e.graphId,"/").concat(e.id," is missing YDoc")),this.name="MissingYjsDocError"}};let FailedReadingNoteError=class FailedReadingNoteError extends Error{constructor({id:e,error:n}){super("Failed reading note ".concat(e,": ").concat(n)),this.name="FailedReadingNoteError"}}},71992:function(e,n,r){"use strict";r.d(n,{Cn:function(){return CommitExistsError},WA:function(){return FailedFetchingCommitsError},Xn:function(){return CommitTooLargeError}});let CommitExistsError=class CommitExistsError extends Error{constructor(){super("Cannot create a commit, it already exists"),this.name="CommitExistsError"}};let CommitTooLargeError=class CommitTooLargeError extends Error{constructor(){super("Commit is too large"),this.name="CommitTooLargeError"}};let FailedFetchingCommitsError=class FailedFetchingCommitsError extends Error{constructor(e){super("Failed fetching commits: ".concat(e)),this.name="FailedFetchingCommitsError"}}},29354:function(e,n,r){"use strict";r.d(n,{Ln:function(){return expandAliasedBacklinks},bd:function(){return unaliasedSubject},gO:function(){return aliasesFromSubject}});var o=r(89734),a=r.n(o),i=r(44717);function expandAliasedBacklinks(e,n){let r=[];for(let o of e)if(o.label.includes("//")){let e=o.label.split("//").map(e=>e.trim()).filter(e=>e);e=a()(e,e=>e.length),e=a()(e,e=>n?e.toLowerCase().includes(n.toLowerCase())?-1:1:0);let s=e.shift();s&&r.push({...o,label:s,normalizedLabel:(0,i.U)(s)})}else r.push(o);return r}function aliasesFromSubject(e){return e.split("//").map(e=>e.trim())}function unaliasedSubject(e){let[n]=e.split("//",2);return n.trim()}},29823:function(e,n,r){"use strict";r.d(n,{f:function(){return i}});var o=r(97582),a=r(53699);let i=class extends(0,a.Hnr)({id:a.UB4,name:(0,a.vgT)(),primary:(0,a.vgT)(),enabled:(0,a.vgT)().withSetter(),priority:(0,a.vgT)(0)}){get sortOrder(){return this.primary?0:this.priority}};i=(0,o.gn)([(0,a.o4J)("Calendar")],i)},46954:function(e,n,r){"use strict";r.d(n,{Z:function(){return ChangeObserver}});var o=r(44908),a=r.n(o),i=r(68949),s=r(20740),l=r(13861);let ChangeObserver=class ChangeObserver{async dispose(){await (0,s.$)(this.listeners)}observeChanges(){let e=(0,i.reaction)(()=>this.changeStore.pendingCommits.map(e=>{let n=e.commit;return{pointer:e,size:n.yjsUpdates.length}}),(e,n)=>this.handleChange(e,n),{delay:this.debounce});this.listeners.push(e)}handleChange(e,n){let{changed:r}=function(e){let{previous:n,current:r,objectKey:o,versionKey:a}=e,i=[],s=[],l=new Map,c=new Map,d=new Set;for(let e of n){let n=o(e);d.add(n),l.set(n,e)}for(let e of r){let n=o(e);d.add(n),c.set(n,e)}for(let e of d){let n=l.get(e),r=c.get(e);n&&!r?s.push(n):!n&&r?i.push(r):n&&r&&a&&a(n)!==a(r)&&i.push(r)}return{removed:s,changed:i}}({current:e,previous:n,objectKey:e=>{let{pointer:n}=e;return n.commit.id},versionKey:e=>{let{size:n}=e;return n.toString()}}),o=a()(r.filter(e=>{let{pointer:n}=e;return n.graphId===this.graphId}).map(e=>{let{pointer:n}=e;return n.noteId}).filter(l.Dw));o.length>0&&this.onChange(o)}constructor({graphId:e,changeStore:n,onChange:r,debounce:o}){this.listeners=[],this.graphId=e,this.changeStore=n,this.onChange=r,this.debounce=o,this.observeChanges()}}},39234:function(e,n,r){"use strict";r.d(n,{Q:function(){return createPendingCommit},a:function(){return collectUpdates}});var o=r(52300),a=r(87776);function createPendingCommit(e){let{updates:n,forceSave:r=!1}=e;return new a.i({yjsUpdates:n.map(e=>(0,o.kZ)(e)),forceSave:r})}function collectUpdates(e){let n=[];for(let r of e)if(r.yjsUpdates)for(let e of r.yjsUpdates)n.push(e);return n}},48480:function(e,n,r){"use strict";r.d(n,{Me:function(){return p},iv:function(){return h.i}});var o=r(97582),a=r(15965),i=r(53699),s=r(46551),l=r(14066),c=r(44915),d=r(39234);let u=class extends(0,i.Hnr)({graphId:(0,i.vgT)().withSetter(),noteId:(0,i.vgT)().withSetter(),commit:(0,i.vgT)().withSetter()}){};u=(0,o.gn)([(0,i.o4J)("PendingCommitPointer")],u);let p=class extends(0,i.Hnr)({pendingCommits:(0,i.vgT)(()=>[])}){onAttachedToRootStore(){this.logger.info("[ChangeStore] Attached with commits ".concat(this.shortCommitsDebug)),this.logPendingCommits("attach")}onPersist(){this.logger.info("[ChangeStore] Persisted with commits ".concat(this.shortCommitsDebug))}logPendingCommits(e){for(let n of this.pendingCommits){let r=n.commit.yjsUpdates.length,o="<Commit graphId=".concat(n.graphId," noteId=").concat(n.noteId," length=").concat(r,">");this.logger.info("[ChangeStore] (".concat(e.toUpperCase(),") Change Store pending commit: ").concat(o," (app loaded ").concat(this.loadedAgo,"s ago)"),{graphId:n.graphId,noteId:n.noteId})}}addPendingUpdates(e){let{note:n,forceSave:r,...o}=e,i=o.updates.length>0?[a.pU.mergeUpdates(o.updates)]:[],l=a.pU.mergeUpdates(i),c=(0,s.Q)(l,n.assertYDoc);if(!c&&!r)return;let u=this.getPendingCommit(n);if(u)u.addUpdates(i);else{var p;let e=n.removePlaceholderCommit(),r=null!==(p=null==e?void 0:e.yjsUpdatesArrays)&&void 0!==p?p:[];u=(0,d.Q)({updates:[...r,...i]}),this.setPendingCommit(n,u)}return r&&u.setForceSave(r),u}setPendingUpdates(e){var n;let{note:r,updates:o}=e,a=this.getPendingCommit(r),i=null!==(n=null==a?void 0:a.forceSave)&&void 0!==n&&n;if(o.length>0){let e=(0,d.Q)({updates:o,forceSave:i});return this.setPendingCommit(r,e),e}if(i){let e=(0,d.Q)({updates:[],forceSave:i});this.setPendingCommit(r,e)}else this.clearPendingCommit(r);this.logger.info("[ChangeStore] Consolidated to commits ".concat(this.shortCommitsDebug))}getPointer(e){return this.pendingCommits.find(n=>n.graphId===e.graphId&&n.noteId===e.id)}getPendingCommit(e){var n;return null===(n=this.getPointer(e))||void 0===n?void 0:n.commit}setPendingCommit(e,n){(0,l.hu)(e.graphId,"Note must have graphId");let r=this.getPointer(e);if(r)return r.setCommit(n),r;{let r=new u({graphId:e.graphId,noteId:e.id,commit:n});return this.pendingCommits.push(r),r}}clearPendingCommit(e){let n=this.getPointer(e);n&&(0,i.ogt)(n)}ensureCommit(e){let{note:n,forceSave:r}=e;this.addPendingUpdates({note:n,updates:[],forceSave:r})}savePendingChanges(e){for(let n of this.pendingCommits){let{graphId:r,noteId:o}=n;if(r!==e.id)continue;let a=e.noteStore.findById(n.noteId);if(!a){this.logger.warn("no note was found for pending commit ".concat(r,"/").concat(o),{graphId:r,noteId:o});continue}a.changeManager.handleReconnect()}}get shortCommitsDebug(){let e=this.pendingCommits.map(e=>e.commit.yjsUpdates.length);return"["+e.join(", ")+"]"}get rootStore(){return(0,c.w0)(this)}get logger(){return this.rootStore.logger}get loadedAgo(){return Math.floor((new Date().getTime()-this.loadedAt.getTime())/1e3)}constructor(...e){super(...e),this.loadedAt=new Date}};(0,o.gn)([i.ZBq],p.prototype,"setPendingCommit",null),(0,o.gn)([i.ZBq],p.prototype,"clearPendingCommit",null),p=(0,o.gn)([(0,i.o4J)("ChangeStore")],p);var h=r(87776);r(84828)},84828:function(e,n,r){"use strict";r.d(n,{u:function(){return PendingCommitCache}});var o=r(18446),a=r.n(o);let PendingCommitCache=class PendingCommitCache{matchesDoc(e){return a()(this.docVector,e)}matchesUpdates(e){return this.updatesCount===e.length}constructor(e){this.docVector=e.docVector,this.updatesCount=e.updatesCount,this.ydoc=e.ydoc,this.doc=e.doc}}},87776:function(e,n,r){"use strict";r.d(n,{i:function(){return m}});var o=r(97582),a=r(15965),i=r(52300),s=r(10928),l=r.n(s),c=r(68949),d=r(53699),u=r(80339),p=r(46551),h=r(34102),g=r(84828);let m=class extends(0,d.Hnr)({id:d.UB4,yjsUpdates:(0,d.vgT)(),forceSave:(0,d.vgT)(!1).withSetter()}){addUpdates(e){for(let n of e)this.yjsUpdates.push((0,i.kZ)(n))}get yjsUpdatesArrays(){return this.yjsUpdates.map(e=>(0,i._f)(e))}get shouldSave(){return this.yjsUpdates.length>0||this.forceSave}get isEmpty(){return 0===this.yjsUpdates.length}setIsPlaceholder(e){this.isPlaceholder=e}get debugString(){let e=this.yjsUpdatesArrays,n=e.map(e=>"".concat(e.length)).join(", "),r=this.isPlaceholder?"*":"";return"(".concat(e.length,") [").concat(n).concat(r,"]")}getPendingDoc(e){return this.getCache(e).doc}getPendingYDoc(e){return this.getCache(e).ydoc}getCache(e){if(!e.yDoc)throw new u.KL(e);let n=a.pU.encodeStateVector(e.yDoc),r=this.cachedResult,o=this.yjsUpdates.length;return r&&r.matchesDoc(n)?(r.matchesUpdates(this.yjsUpdatesArrays)||((0,p.Bu)(r.ydoc,this.yjsUpdatesArrays),r.updatesCount=this.yjsUpdatesArrays.length,r.doc=(0,a.x4)(r.ydoc)),r):this.createCache({note:e,docVector:n,updatesCount:o})}createCache(e){let{note:n,docVector:r,updatesCount:o}=e,i=this.createYDocCopy(n);(0,p.Bu)(i,this.yjsUpdatesArrays);let s=(0,a.x4)(i),l=new g.u({docVector:r,updatesCount:o,ydoc:i,doc:s});return this.cachedResult=l,l}createYDocCopy(e){let n=e.yDocAsUpdateArray;if(!n)throw new u.KL(e);let r=new a.pU.Doc;return a.pU.applyUpdate(r,n),r}consolidate(e){var n;let r=e.assertYDoc,o=a.pU.mergeUpdates(this.yjsUpdatesArrays),i=(0,p.Q)(o,r),s=i?[o]:[];return null===(n=e.changeStore)||void 0===n||n.setPendingUpdates({note:e,updates:s}),s.length}encodeStateVector(){let e=l()(this.yjsUpdatesArrays);return e?a.pU.encodeStateVectorFromUpdate(e):null}async backup(e){let{note:n}=e,r=n.assertGraph,o=r.logger;if(o.info("[YjsPendingCommit] Backing up pending commit!"),0===this.yjsUpdates.length){o.warn("[YjsPendingCommit] Backup: no steps");return}await (0,h._j)({note:n,commit:this})}constructor(...e){super(...e),this.isPlaceholder=!1}};(0,o.gn)([d.ZBq],m.prototype,"addUpdates",null),(0,o.gn)([c.computed],m.prototype,"yjsUpdatesArrays",null),(0,o.gn)([c.computed],m.prototype,"debugString",null),m=(0,o.gn)([(0,d.o4J)("PendingCommit")],m)},20034:function(e,n,r){"use strict";r.d(n,{k:function(){return tc}});var o=r(97582),a=r(44908),i=r.n(a),s=r(90233),l=r(68949),c=r(53699),d=r(28418),u=r(1469),p=r.n(u),h=r(95440);async function getGraphEncryptionKey(e){let{graphId:n}=e,r=await getLocalStorageGraphEncryptionKeys();return r[n]}async function getLocalStorageGraphEncryptionKeys(){let e=await h.j.keys(),n=e.filter(e=>e.startsWith("graph-store")),r={};for(let e of n){let n=await h.j.getItem(e),a=n?JSON.parse(n):null;if(p()(null==a?void 0:a.graphs))for(let e of a.graphs){var o;let n=null!==(o=e.$modelId)&&void 0!==o?o:e.id;n&&e.encryptionKey&&(r[n]=e.encryptionKey)}}return r}var g=r(20740),m=r(44915),y=r(58997),f=r(75606),v=r(65422),b=r(39828),w=r(8400),k=r.n(w),S=r(26655),x=r(98930);async function batchCreateTags(e){let{graphId:n,tags:r,batchSize:o=500}=e;for(let e of k()(r,o)){let r=x.RZ.writeBatch(S.db);for(let o of e){let e=(0,v.kb)({db:S.db,graphId:n,tag:o});r.set(e,{created_at:b.Timestamp.now()},{merge:!0})}await r.commit()}}var N=r(70586);r(10928);var D=r(91935),T=r(7165);async function _001_migrate_dates(e){let{graph:n}=e,r=await (0,D.c)(n);for(let e of r){if("string"!=typeof e.createdAt&&"string"!=typeof e.updatedAt&&"string"!=typeof e.editedAt)continue;console.log("[migrate-001] Migrating note",e);let r=function(e){let n={...e};return"string"==typeof e.createdAt&&(n.createdAt=new Date(e.createdAt).getTime()),"string"==typeof e.editedAt&&(n.editedAt=new Date(e.editedAt).getTime()),n.updatedAt=new Date().getTime(),n}(e),o=new d.jC({...r,id:r.$modelId||r.id});await (0,T.h)(n,o)}}async function _002_migrate_slate(e){let{graph:n}=e;console.log("[migrate-002] noop")}var I=r(15965);async function _003_migrate_editor(e){let{graph:n}=e,r=await (0,D.c)(n);for(let e of r){var o,a;if(!e.document)continue;let r=null!==(a=null===(o=e.document.attrs)||void 0===o?void 0:o.version)&&void 0!==a?a:0;r>2||await migrateNote(n,e)}}async function migrateNote(e,n){console.log("[migrate-003] Migrating note",n);let r=function(e){let n={...e};if(n.document=e.document?(0,I.$b)(e.document):(0,d.Tw)().toJSON(),n.updatedAt=new Date().getTime(),!n.document)throw Error("003-migration issue - blank document");return n}(n),o=new d.jC({...r,id:r.$modelId||r.id});await (0,T.h)(e,o)}var C=r(52300),A=r(14066),M=r(55714),_=r(9069),E=r(39541);async function unsafeBatchSetNotes(e){let{graph:n,notes:r,batchSize:o=500,progress:a}=e;null==a||a.setTotal(r.length);let i=await convertNotes(n,r);for(let e of k()(i,o)){let r=x.RZ.writeBatch(S.db);for(let o of e){let e=(0,v.lB)({db:S.db,graphId:n.id,noteId:o.id});r.set(e,o.data,{merge:!0})}await r.commit(),null==a||a.increment(e.length)}}async function convertNotes(e,n){return await Promise.all(n.map(n=>convertNote(e,n)))}async function convertNote(e,n){let r=await function(e,n){let r=function(e){let{lastCommitId:n,...r}=e.createSnapshot();return r}(n),o=!!e.encryptionKey&&!n.public;return docFromValues(r,{encrypt:o,itemId:n.id,key:e.encryptionKey})}(e,n);return{id:n.id,data:r}}async function docFromValues(e,n){var r,o,a,i,s,l;let c={id:e.id,version:4,acl:e.acl,created_at:(0,E.M)(e.createdAt),updated_at:(0,E.M)(e.updatedAt),edited_at:(0,E.M)(null!==(r=e.editedAt)&&void 0!==r?r:null),deleted_at:(0,E.M)(e.deletedAt),backlinked_count:e.backlinkedCount,daily:e.daily,ignored_backlink_from_note_ids:e.ignoredBacklinkFromNoteIds,ignored_backlink_labels:await (0,_.FS)(null!==(o=e.ignoredBacklinkLabels)&&void 0!==o?o:[],n),ignored_contact_names:await (0,_.FS)(null!==(a=e.ignoredContactNames)&&void 0!==a?a:[],n),pinned_index:null!==(i=e.pinnedIndex)&&void 0!==i?i:null,system_metadata:null!==(s=e.systemMetadata)&&void 0!==s?s:null,subject:await (0,_.Wu)(null!==(l=e.subject)&&void 0!==l?l:"",n),document_json:e.yDocAsUpdate?null:await (0,_.ec)(e.document,n)};return e.yDocAsUpdate&&(c.yjs_doc=await function(e,n){(0,A.hu)(e,"yDocAsUpdate is required");let r=(0,C._f)(e);return(0,M.RY)({plain:r,...n})}(e.yDocAsUpdate,n)),c}async function _004_resave_notes(e){let{graph:n,progress:r}=e;if(await needsToResave({graph:n})){console.log("[migrate-004] Re-saving notes");let e=n.noteStore.allNotes.models;await unsafeBatchSetNotes({graph:n,notes:e,progress:r})}}async function needsToResave(e){let{graph:n}=e;try{await (0,D.c)(n)}catch(e){return!0}return!1}async function _005_encryption_check(){}async function _006_note_format_v4(){}async function _007_collab(){}var F=r(81486);async function _008_resave(e){let{progress:n,graph:r}=e,{noteStore:o}=r,a=await (0,F.qC)({store:r.noteStore,onError:()=>console.error("Snapshot failed")});await (0,l.when)(()=>"live"===o.mode),a();let i=o.allNotes.models;for(let e of i){var s,c,d;if("number"==typeof e.lastCommitId){console.warn("[migrate-008] Skipping document migration for note with lastCommitId",e.id);continue}let n=null!==(d=null===(c=e.document)||void 0===c?void 0:null===(s=c.attrs)||void 0===s?void 0:s.version)&&void 0!==d?d:0;e.document&&n!==I.KZ&&(e.setDocument((0,I.$b)(e.document)),e.touchUpdatedAt())}await unsafeBatchSetNotes({graph:r,notes:i,progress:n,batchSize:100})}var R=r(46551),U=r(10256),B=r(83856),j=r(69963);async function _009_yjs(e){let{graph:n,progress:r}=e;n.logger.info("[009-yjs] Migrating server..."),await enableYjs({graph:n,progress:r})}async function enableYjs(e){let{graph:n,progress:r}=e,{noteStore:o,logger:a}=n;await syncNoteStore(o);let i=o.allNotes.models.filter(e=>e.document),s=o.allNotes.models.filter(e=>!e.document);s.length>0&&(0,j.uT)("[009-yjs] Found notes with missing document",{extra:{notes:s.map(e=>{var n;return{id:e.id,deletedAt:e.deletedAt,subjectLength:null===(n=e.subject)||void 0===n?void 0:n.length}})}}),function(e,n){for(let r of(e=e.filter(e=>!e.yDocAsUpdate),n.info("Found ".concat(e.length," notes without YJS"),{migration:9}),e))(function(e,n){if(e.yDocAsUpdate)throw Error("Note already converted to YJS");try{let{ydoc:n}=(0,R.kg)(e.assertDocument,{template:!0}),r=I.pU.encodeStateAsUpdate(n);e.setYDocAsUpdateArray(r)}catch(r){n.error("Couldn't initialize YJS document: ".concat(r.name," (").concat(r.message,")"),{noteId:e.id}),(0,j.Tb)(r,{extra:{noteId:e.id,doc:(0,B.wk)(e.assertDocument)}})}})(r,n)}(i,a);let l=i.filter(e=>!1!==e.persisted);await (0,T.g)({graph:n,notes:l,batchSize:100,progress:r,createInitialCommit:!1}),await (0,U.Z)(300)}async function syncNoteStore(e){let n=await (0,F.qC)({store:e,onError:()=>console.error("Snapshot failed")});await (0,l.when)(()=>"live"===e.mode&&e.hasSynced),n()}async function _010_yjs_prepare(e){let n=e.graph.logger;n.info("[010-yjs-prepare] Migrating server...",{migration:10}),await prepare(e)}async function prepare(e){let{graph:n}=e;n.logger.info("[010-yjs-prepare] Preparing...",{migration:10});let{changeStore:r}=n.assertRootStore;r.savePendingChanges(n)}async function _011_migrate_pinned(e){let n=e.graph.logger;n.info("[011-migrate-pinned] Migrating server...",{migration:11});let r=x.RZ.doc(S.db,"graphs",e.graph.id),o=x.RZ.collection(r,"notes").withConverter((0,v.sh)()),a=x.RZ.query(o,x.RZ.where("pinned","==",!0)),{docs:i}=await x.RZ.getDocsFromServer(a);for(let[e,n]of i.entries())await x.RZ.updateDoc(n.ref,{pinned_index:e,updated_at:b.Timestamp.now()})}var P=r(40127),K=r(622);async function _012_migrate_templates(e){let{graph:n}=e,r=n.logger;r.info("[012-migrate-templates] Migrating server...",{migration:11});let o=await (0,P.i1)(),a=x.RZ.collection(S.db,"users",o.uid,"templates").withConverter((0,v.sh)()),{docs:i}=await x.RZ.getDocsFromServer(a),s=i.map(e=>new d.YS({name:e.data().name,document:JSON.parse(e.data().document),createdAt:e.data().created_at.toMillis()}));for(let e of s)await (0,K.zX)(n,e);for(let e of i)await x.RZ.deleteDoc(e.ref)}var O=r(64487);async function _013_ensure_ydoc(e){let{graph:n,progress:r}=e,o=n.logger.child({migration:13});o.info("[013-ensure-yjs] Migrating server...");let a=(0,v.J4)({db:S.db,graphId:n.id}),i=await x.RZ.getDocsFromServer(a),s=i.docs;for(let e of s){let r=e.id,a=e.data();"document_json"in a&&!a.yjs_doc&&a.document_json&&(o.info("Fixing note ".concat(r)),await fixNote(r,a,n,o))}n.noteStore.setSyncedAt(null),null==r||r.setProgress({total:1,finished:1})}async function fixNote(e,n,r,o){let a;let{noteStore:i}=r,s=(0,v.J4)({db:S.db,graphId:r.id}),l=await readDocument(e,n,r);if(!l){(0,O.uT)("[013-ensure-ydoc] Failed decrypting document",{extra:{noteId:e}});return}try{a=await createYjsDoc(e,l,r)}catch(n){(0,O.Tb)(n,{extra:{migration:13,noteId:e}}),o.error("Failed converting note ".concat(e," to YJS: ").concat(n.message));return}let d=x.RZ.doc(s,e);await x.RZ.setDoc(d,{yjs_doc:a},{merge:!0});let u=i.findById(e);u&&(0,c.ogt)(u)}async function readDocument(e,n,r){let o={key:r.encryptionKey,itemId:e},a=await (0,M.MJ)({type:"Note",value:n.document_json,...o});return a?JSON.parse(a):void 0}async function createYjsDoc(e,n,r){let{ydoc:o}=(0,R.kg)(n,{template:!0}),a=I.pU.encodeStateAsUpdate(o),i=(0,C.kZ)(a);return await function(e,n){(0,A.hu)(e,"yDocAsUpdate is required");let r=(0,C._f)(e);return(0,M.RY)({plain:r,...n})}(i,{encrypt:!0,itemId:e,key:r.encryptionKey})}async function _014_kill_old_format(){}var L=r(24828);function getAllMigrations(){return[{version:1,run:_001_migrate_dates},{version:2,run:_002_migrate_slate},{version:3,run:_003_migrate_editor},{version:4,run:_004_resave_notes},{version:5,run:_005_encryption_check},{version:6,run:_006_note_format_v4},{version:7,run:_007_collab},{version:8,run:_008_resave},{version:9,run:_009_yjs},{version:10,run:_010_yjs_prepare},{version:11,run:_011_migrate_pinned},{version:12,run:_012_migrate_templates},{version:13,run:_013_ensure_ydoc},{version:14,run:_014_kill_old_format},{version:15,run:L.Z}]}function latestMigrationVersion(){let e=getAllMigrations();return Math.max(...e.map(e=>e.version))}function migrationsToApply(e){var n;let r=e.version;if(!e.ready)throw Error("migrations can only be applied to a graph that is ready");if(null===r)throw Error("Graph ".concat(e.id," has no version"));return(function(e){let n=getAllMigrations(),r=[];for(let o of n){if(o.requiredFlag&&!e.includes(o.requiredFlag))break;r.push(o)}return r})(null!==(n=e.flags)&&void 0!==n?n:[]).filter(e=>e.version>r)}function needsMigrating(e){if(null===e.version)return!1;let n=migrationsToApply(e);return n.length>0}var G=r(89734),Z=r.n(G),q=r(45578),H=r.n(q),Y=r(13861),z=r(68825),J=r(47927),V=r(85760),W=r(39288),Q=r(46954),$=r(12428);let X=(0,W.Z)(J.i),tt=class extends(0,c.Hnr)({persistEnabled:(0,c.vgT)(!0)}){onAttachedToRootStore(){return this.setup(),()=>this.beforeDetach()}beforeDetach(){var e;null===(e=this.table)||void 0===e||e.detach()}async setup(){let e=new X({name:"".concat(this.assertGraph.id,"-note-backlinks"),persistEnabled:this.persistEnabled,version:1});this.table=e,e.attach(),await e.waitUntilLoaded(),this.refreshAllIfNeeded(),this.observeNoteChanges(),this.observeCommitChanges(),this.setPersistenceReady(!0)}refreshAllIfNeeded(){let e=this.assertTable;0===e.count&&this.refreshAll()}observeNoteChanges(){this.notesObserver=new V.P({table:this.noteTable,onChange:e=>this.handleNoteChange(e),debounce:3e3}),this.listeners.push(()=>{var e;return null===(e=this.notesObserver)||void 0===e?void 0:e.dispose()})}handleNoteChange(e){let{updatedRows:n,deletedRowIds:r}=e,o=[...n.map(e=>e.id),...r],a=n.map(e=>e.id);this.refresh({noteIdsToClear:o,noteIdsToCreate:a})}observeCommitChanges(){this.changesObserver=new Q.Z({graphId:this.graphId,changeStore:this.changeStore,onChange:this.handleCommitsChange.bind(this),debounce:3e3}),this.listeners.push(()=>{var e;return null===(e=this.changesObserver)||void 0===e?void 0:e.dispose()})}handleCommitsChange(e){this.refresh({noteIdsToClear:e,noteIdsToCreate:e})}refreshAll(){this.refresh({clearAll:!0,noteIdsToCreate:this.noteTable.allIds})}refreshForNote(e){this.refresh({noteIdsToClear:[e],noteIdsToCreate:[e]})}refresh(e){let{clearAll:n=!1,noteIdsToClear:r=[],noteIdsToCreate:o}=e,a=this.assertTable,i=this.backlinkIdsForNotes(r),s=o.map(e=>this.noteTable.get(e)).filter(Y.Dw),l=this.backlinksFromNotes(s);n?a.replaceAll(l):a.replaceMany(i,l)}backlinkIdsForNotes(e){let n=this.assertTable.filter(n=>e.includes(n.fromNoteId));return n.map(e=>e.id)}backlinksFromNotes(e){let n=[];for(let r of e){let e=this.getBacklinksForNoteRow(r).map(e=>({...e,id:(0,z.O)()}));n=[...n,...e]}return n}getBacklinksForNoteRow(e){var n;let{node:r}=(0,$.tE)(e,this.noteAdapter);if(!r)return[];let o=null!==(n=e.snapshot.daily?e.derived.dailyDate:null)&&void 0!==n?n:e.snapshot.createdAt;return function(e,n){let r=e?(0,I.rc)(e):[];return r.map(e=>({graphId:n.graphId,label:e.label,contextHtml:e.contextHtml,fromNoteId:n.fromNoteId,fromNoteCreatedAt:n.fromNoteCreatedAt,toNoteId:e.id}))}(r,{graphId:this.assertGraph.id,fromNoteId:e.snapshot.id,fromNoteCreatedAt:o})}getOutgoingBacklinks(e){return this.all.filter(n=>n.fromNoteId===e)}getSortedIncomingBacklinks(e){let n=this.query.results.filter(n=>n.toNoteId===e&&n.fromNoteId!==e);return n=H()(n,e=>[e.fromNoteId,e.toNoteId,e.contextHtml].join("-")),n=Z()(n,e=>e.fromNoteCreatedAt).reverse()}get all(){return this.assertTable.values}get query(){let e=this.assertTable.query();return e.loggingName="NoteBacklinkStore.query",e}setPersistenceReady(e){this.persistenceReady=e}get assertRootStore(){return(0,m.pE)(this)}get assertGraph(){return(0,m.w0)(this)}get changeStore(){return this.assertRootStore.changeStore}get graphId(){return this.assertGraph.id}get assertNoteStore(){return this.assertGraph.noteStore}get noteTable(){return this.assertNoteStore.assertTable}get noteAdapter(){return this.assertNoteStore.assertAdapter}get assertTable(){return(0,m.wi)(this,"table")}constructor(...e){super(...e),this.listeners=[],this.persistenceReady=!1}};(0,o.gn)([l.observable],tt.prototype,"persistenceReady",void 0),(0,o.gn)([l.computed],tt.prototype,"query",null),(0,o.gn)([l.action],tt.prototype,"setPersistenceReady",null),tt=(0,o.gn)([(0,c.o4J)("NoteBacklinkStore")],tt);var te=r(51085),tn=r(33002),tr=r(41179);let GraphBackupManager=class GraphBackupManager{setup(){this.listeners.push((0,l.autorun)(()=>{!this.hasTodaysBackup&&this.readyToBackup&&this.backupWhenIdle()}))}dispose(){(0,g.$)(this.listeners)}get readyToBackup(){let{ready:e,needsEncryptionSetup:n,noteStore:r}=this.graph;return e&&!n&&r.allNotes.count>0}get hasTodaysBackup(){let{lastBackupAt:e}=this.graph;return e&&(0,te.Z)(e)}async backup(){this.graph.setLastBackupAt(new Date),await (0,tr.hp)(this.graph)}backupWhenIdle(){(0,tn.ZP)(()=>{this.backup()})}constructor(e){this.listeners=[],this.graph=e,(0,l.makeObservable)(this),this.setup()}};(0,o.gn)([l.computed],GraphBackupManager.prototype,"readyToBackup",null),(0,o.gn)([l.computed],GraphBackupManager.prototype,"hasTodaysBackup",null);var to=r(39411);let Progress=class Progress{setTotal(e){this.total=e,this.finished=0}setProgress(e){let{total:n,finished:r}=e;this.total=n,this.finished=r}increment(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.finished+=e}reset(){this.total=0,this.finished=0}get progress(){return this.total>0?Math.min(this.finished/this.total,1):0}get isComplete(){return this.progress>=1}get percentFormatted(){return formatProgress(this.progress)}constructor({total:e=0,finished:n=0}={}){this.total=e,this.finished=n,(0,l.makeObservable)(this)}};(0,o.gn)([l.observable],Progress.prototype,"total",void 0),(0,o.gn)([l.observable],Progress.prototype,"finished",void 0),(0,o.gn)([l.action],Progress.prototype,"setTotal",null),(0,o.gn)([l.action],Progress.prototype,"setProgress",null),(0,o.gn)([l.action],Progress.prototype,"increment",null),(0,o.gn)([l.action],Progress.prototype,"reset",null),(0,o.gn)([l.computed],Progress.prototype,"progress",null),(0,o.gn)([l.computed],Progress.prototype,"isComplete",null),(0,o.gn)([l.computed],Progress.prototype,"percentFormatted",null);let formatProgress=e=>""+Math.round(100*e);var ta=r(25038);async function runMigrations(e){let{graph:n,progress:r}=e,o=n.logger;o.info("Running migrations...");let a=await (0,y.E)(n.id);if(n.version!==a&&n.setVersion(a),a>=latestMigrationVersion()){o.info("On latest version ".concat(a));return}await n.assertBackupManager.backup(),n.isEncrypted&&(0,A.Ee)(n.encryptionKey);let i=migrationsToApply(n);for(let e of i)o.info("Migrating to ".concat(e.version,"...")),await (0,y.h4)(n,e.version),await e.run({graph:n,progress:r}),o.info("Successfully migrated to ".concat(e.version,"...")),await (0,y.w$)({graph:n,version:e.version});o.info("Finished migrations")}let GraphMigrationManager=class GraphMigrationManager{async setup(){await (0,l.when)(()=>this.readyToMigrate),this.migrate()}dispose(){}get readyToMigrate(){return this.graph.ready&&!this.graph.versionUnsupported&&!this.graph.needsEncryptionSetup}async migrate(){let e=this.graph.logger,n=new Progress,{graph:r}=this;if(needsMigrating(this.graph)){e.info("Starting migrations"),(0,ta.j)("migration_started",{graphId:this.graph.id,version:this.graph.version}),this.setMigrationProgress(n);try{await runMigrations({graph:r,progress:n})}catch(e){if(e instanceof to.fD){this.setMigrationStatus({type:"offline"}),this.graph.logger.warn("Migration can't run because the device is offline");return}throw this.handleMigrationFailure(e,r),e}this.setMigrationStatus(null)}}setMigrationProgress(e){this.migrationStatus={type:"running",progress:e}}setMigrationStatus(e){this.migrationStatus=e}handleMigrationFailure(e,n){this.setMigrationStatus({type:"failed"}),n.logger.error("Migration failed: ".concat(e.name," (").concat(e.message,")")),(0,j.Tb)(e),(0,ta.j)("migration_failed",{graphId:n.id})}get migrating(){var e;return(null===(e=this.migrationStatus)||void 0===e?void 0:e.type)==="running"}get migrationProgress(){let e=this.migrationStatus;return(null==e?void 0:e.type)==="running"?e.progress:null}get migrationFailed(){var e;return(null===(e=this.migrationStatus)||void 0===e?void 0:e.type)==="failed"}get migrationOffline(){var e;return(null===(e=this.migrationStatus)||void 0===e?void 0:e.type)==="offline"}constructor(e){this.migrationStatus=null,this.graph=e,(0,l.makeObservable)(this),this.setup()}};(0,o.gn)([l.observable],GraphMigrationManager.prototype,"migrationStatus",void 0),(0,o.gn)([l.computed],GraphMigrationManager.prototype,"readyToMigrate",null),(0,o.gn)([l.action],GraphMigrationManager.prototype,"setMigrationProgress",null),(0,o.gn)([l.action],GraphMigrationManager.prototype,"setMigrationStatus",null);var ti=r(95534),ts=r.n(ti),tl=r(54892);function pickRandomGraphColor(){return ts()(tl.b)}let tc=class extends(0,c.Hnr)({id:c.UB4,name:(0,c.vgT)("").withSetter(),acl:(0,c.vgT)(()=>[]),tags:(0,c.vgT)(()=>[]).withSetter(),hasSetup:(0,c.vgT)(!0),encryptionKey:(0,c.vgT)(null),version:(0,c.vgT)(null).withSetter(),migratingVersion:(0,c.vgT)(null),ready:(0,c.vgT)(!1).withSetter(),flags:(0,c.vgT)(null).withSetter(),lastBackupAt:(0,c.vgT)(null).withTransform((0,c.h8)()).withSetter(),colorHex:(0,c.vgT)(pickRandomGraphColor()).withSetter(),noteStore:(0,c.vgT)(()=>new d.Dj({})),noteBacklinkStore:(0,c.vgT)(()=>new tt({})),noteOperationStore:(0,c.vgT)(()=>new d.Jo({})),bookStore:(0,c.vgT)(()=>new d.ux({})),templateStore:(0,c.vgT)(()=>new d.j$({})),audioRecordingStore:(0,c.vgT)(()=>new d.xB({}))}){onAttachedToRootStore(){return this.logger.info("Attached graph to root store"),this.prepareMigrationManager(),this.prepareBackupManager(),this.prepareSetup(),this.observeSnapshot(),this.observeTags(),this.observeFirebaseDebug(),()=>this.beforeDetach()}prepareMigrationManager(){this.migrationManager=new GraphMigrationManager(this),this.listeners.push(()=>{var e;return null===(e=this.migrationManager)||void 0===e?void 0:e.dispose()})}prepareBackupManager(){this.backupManager=new GraphBackupManager(this),this.listeners.push(()=>{var e;return null===(e=this.backupManager)||void 0===e?void 0:e.dispose()})}async prepareSetup(){await (0,l.when)(()=>this.readyToSetup),(0,f.Vz)(this)}observeSnapshot(){this.listeners.push((0,y.B6)(this.id,async e=>{console.log("[Graph] [".concat(this.id,"] Graph snapshot"),{snapshot:e}),await this.setGraph(e)}))}observeTags(){this.listeners.push(function(e,n){let r=(0,v.ql)({db:S.db,graphId:e});return x.RZ.onSnapshot(r,e=>{n(e.docs.map(e=>e.id))})}(this.id,e=>this.setTags(e)))}observeFirebaseDebug(){this.listeners.push((0,l.reaction)(()=>this.hasFlag("firestore_debug_loglevel"),e=>{let n=e?"debug":"error";console.log("Updating Firebase log level: ".concat(n)),x.RZ.setLogLevel(n)},{fireImmediately:!0}))}beforeDetach(){return(0,g.$)(this.listeners)}get needsEncryptionSetup(){return this.isEncrypted&&!this.encryptionKey}get logger(){var e;return N.k.child({graphId:this.id,userId:null===(e=this.user)||void 0===e?void 0:e.id})}get assertMigrationManager(){return(0,m.wi)(this,"migrationManager")}get assertBackupManager(){return(0,m.wi)(this,"backupManager")}get nameWithId(){return this.name===this.id?this.name:"".concat(this.name," (").concat(this.id,")")}aclCanRead(e){return!!e&&(this.aclCanWrite(e)||this.acl.includes("public")||this.acl.includes("read.".concat(e)))}aclCanWrite(e){return!!e&&(this.aclIsOwner(e)||this.acl.includes("write.".concat(e)))}aclIsOwner(e){return!!e&&this.acl.includes("owner.".concat(e))}hasFlag(e){var n;let r=null!==(n=this.flags)&&void 0!==n?n:[];return r.includes(e)}get tasksEnabled(){return this.hasFlag("tasks")}get yjsDebug(){return this.hasFlag("yjs_debug")}get user(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.currentUser}get rootStore(){return(0,c.k0l)(this)}get assertRootStore(){return(0,m.wi)(this,"rootStore")}get assertNoteStore(){return(0,m.wi)(this,"noteStore")}get assertUser(){return(0,m.wi)(this,"user")}get assertEncryptionKey(){if(!this.encryptionKey)throw Error("blank encryptionKey");return this.encryptionKey}get uid(){var e;return null===(e=this.user)||void 0===e?void 0:e.id}get assertUid(){let e=this.uid;if(!e)throw Error("blank uid");return e}get canRead(){return this.aclCanRead(this.uid)}get canWrite(){return this.aclCanWrite(this.uid)}get isOwner(){return this.aclIsOwner(this.uid)}get readyToSetup(){return!this.hasSetup&&this.readyToInitStores&&this.isOwner}matchTags(e){let n=e.replace(/^#/,""),r=(0,s.matchSorter)(this.tags,n);return r.map(e=>({label:e,id:e}))}deleteTag(e){this.tags=this.tags.filter(n=>n!==e),function(e,n){let r=(0,v.kb)({db:S.db,graphId:e,tag:n});x.RZ.deleteDoc(r)}(this.id,e)}updateColorHex(e){this.setColorHex(e),this.update()}update(){return(0,y.A9)(this)}findOrCreateTag(e){return this.tags.find(n=>n===e)||this.createTag(e)}createTag(e){return this.tags=this.tags.includes(e)?this.tags:this.tags.concat([e]),function(e,n){let r=(0,v.kb)({db:S.db,graphId:e,tag:n});x.RZ.setDoc(r,{created_at:b.Timestamp.now()})}(this.id,e),e}async batchCreateTags(e){let n=new Set(this.tags),r=i()(e).filter(e=>!n.has(e));return this.tags=this.tags.concat(r),await batchCreateTags({graphId:this.id,tags:r}),r}onTagAdd(e){let n=(e.id||e.label).trim().toLowerCase().replace(/\s+/g,"-").substring(0,50);return this.createTag(n),{id:n,graphId:this.id,label:n}}setEncryptionKey(e){this.encryptionKey=e}async setGraph(e){var n,r;this.name=e.name,this.acl=e.acl,this.hasSetup=e.hasSetup,this.version=e.version,this.migratingVersion=e.migratingVersion,this.ready=e.ready,this.flags=null!==(n=e.flags)&&void 0!==n?n:[],this.colorHex=null!==(r=e.colorHex)&&void 0!==r?r:pickRandomGraphColor(),this.encryptionKey||await this.attemptToRecoverEncryptionKey()}async attemptToRecoverEncryptionKey(){if(!this.isEncrypted||this.encryptionKey)return;let e=await getGraphEncryptionKey({graphId:this.id});e&&this.setEncryptionKey(e)}get readyToInitStores(){return!(!this.ready||this.needsEncryptionSetup||this.assertMigrationManager.migrating||needsMigrating(this))}get storesReadyAndNotesOnline(){return this.readyToInitStores&&this.noteStore.online}get versionUnsupported(){return null!==this.version&&this.version>latestMigrationVersion()}get migratingElsewhere(){return null!==this.migratingVersion}constructor(...e){super(...e),this.listeners=[],this.isEncrypted=!0}};(0,o.gn)([l.computed],tc.prototype,"needsEncryptionSetup",null),(0,o.gn)([l.computed],tc.prototype,"logger",null),(0,o.gn)([l.computed],tc.prototype,"tasksEnabled",null),(0,o.gn)([l.computed],tc.prototype,"yjsDebug",null),(0,o.gn)([l.computed],tc.prototype,"user",null),(0,o.gn)([l.computed],tc.prototype,"uid",null),(0,o.gn)([l.computed],tc.prototype,"canRead",null),(0,o.gn)([l.computed],tc.prototype,"canWrite",null),(0,o.gn)([l.computed],tc.prototype,"isOwner",null),(0,o.gn)([l.computed],tc.prototype,"readyToSetup",null),(0,o.gn)([c.ZBq],tc.prototype,"deleteTag",null),(0,o.gn)([c.ZBq],tc.prototype,"findOrCreateTag",null),(0,o.gn)([c.ZBq],tc.prototype,"createTag",null),(0,o.gn)([c.ZBq],tc.prototype,"batchCreateTags",null),(0,o.gn)([c.ZBq],tc.prototype,"setEncryptionKey",null),(0,o.gn)([c.ZBq],tc.prototype,"setGraph",null),(0,o.gn)([l.computed],tc.prototype,"readyToInitStores",null),(0,o.gn)([l.computed],tc.prototype,"storesReadyAndNotesOnline",null),(0,o.gn)([l.computed],tc.prototype,"versionUnsupported",null),tc=(0,o.gn)([(0,c.o4J)("Graph")],tc)},92784:function(e,n,r){"use strict";r.d(n,{H:function(){return findGraph}});var o=r(53699),a=r(20034);function findGraph(e){return(0,o.oU$)(e,e=>e instanceof a.k)}},28418:function(e,n,r){"use strict";r.d(n,{c4:function(){return ec.c4},A3:function(){return ec.A3},xB:function(){return b},ps:function(){return ec.ps},ux:function(){return S},lw:function(){return ec.lw},r8:function(){return Contact},fc:function(){return C},hJ:function(){return K},lT:function(){return U},PM:function(){return W},t6:function(){return l},kJ:function(){return ti.k},gH:function(){return ta},mt:function(){return ec.mt},O9:function(){return ec.O9},Ag:function(){return tv},Z4:function(){return ts},BE:function(){return ty},jC:function(){return tX.j},Dj:function(){return t$},Jo:function(){return ee},_H:function(){return ec._H},UC:function(){return ec.UC},iv:function(){return x.iv},Vi:function(){return en},Ob:function(){return ea},LD:function(){return el},iD:function(){return tJ},R0:function(){return ec.R0},YS:function(){return ep},j$:function(){return eh},zt:function(){return c},n5:function(){return ev},U6:function(){return eg},L8:function(){return s},GQ:function(){return tZ.GQ},E9:function(){return docFromNoteRowOrPool},ct:function(){return t0.ct},Tw:function(){return t0.tk},Mr:function(){return t0.Mr},_F:function(){return t0._F},FW:function(){return isValidIndexingRow},vm:function(){return tZ.vm},II:function(){return t1.II},GR:function(){return useBacklinkStore},v_:function(){return useBookStore},sx:function(){return useContactStore},DV:function(){return useCredentialStore},Fq:function(){return useCurrentGraph},xJ:function(){return useCurrentUser},nB:function(){return useDailyEditorView},BG:function(){return useGraphStore},Pw:function(){return useMainView},bG:function(){return useMaybePreferenceStore},EC:function(){return useMeetingStore},dw:function(){return useNoteStore},Jf:function(){return usePreferenceStore},Ru:function(){return usePrimaryEditorView},Xt:function(){return usePromptTemplateStore},Yh:function(){return useRootStore},BO:function(){return useSecondaryEditorView},B0:function(){return useUiStateStore},LM:function(){return useUserStore}});var o,a,i,s,l,c,d=r(97582),u=r(68949),p=r(53699);let h=class extends(0,p.Hnr)({id:p.UB4,status:(0,p.vgT)(),completedAt:(0,p.vgT)(),createdAt:(0,p.vgT)()}){get isProcessing(){return"pending"===this.status||"processing"===this.status}};(0,d.gn)([u.computed],h.prototype,"isProcessing",null),h=(0,d.gn)([(0,p.o4J)("AudioRecording")],h);var g=r(20740),m=r(44915),y=r(65422),f=r(26655),v=r(98930);function convertAudioRecording(e){var n,r;let o=e.data();return new h({id:e.id,status:o.status,createdAt:o.created_at.toDate().getTime(),completedAt:null===(r=o.completed_at)||void 0===r?void 0:null===(n=r.toDate)||void 0===n?void 0:n.call(r).getTime()})}let b=class extends(0,p.Hnr)({audioRecordings:(0,p.vgT)(()=>[])},{toSnapshotProcessor:()=>({})}){get graph(){return(0,m.w0)(this)}get isProcessing(){return this.audioRecordings.some(e=>e.isProcessing)}get processingCount(){return this.audioRecordings.filter(e=>e.isProcessing).length}replaceAudioRecordings(e){this.audioRecordings=e}addSnapshotListener(){this.listeners.push(function(e,n){let r=(0,y.t1)({db:f.db,graphId:e.id});return v.RZ.onSnapshot(r,e=>{n(e.docs.map(convertAudioRecording))})}(this.graph,e=>{this.replaceAudioRecordings(e)}))}onAttachedToRootStore(){return this.listeners.push((0,u.autorun)(e=>{this.graph.readyToInitStores&&(this.addSnapshotListener(),e.dispose())},{delay:2e3})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};(0,d.gn)([u.computed],b.prototype,"isProcessing",null),(0,d.gn)([u.computed],b.prototype,"processingCount",null),(0,d.gn)([p.ZBq],b.prototype,"replaceAudioRecordings",null),b=(0,d.gn)([(0,p.o4J)("AudioRecordingStore")],b);var w=r(47927);function TableSyncMixin(e){return class extends e{async attach(){super.attach(),await this.snapshotSubscribe()}async snapshotSubscribe(){var e;if(!this.syncEnabled)return;let n=await this.queryResolver();null===(e=this.unsubscribeCallback)||void 0===e||e.call(this),this.unsubscribeCallback=v.RZ.onSnapshot(n,e=>{this.onSnapshot(e)}),console.log("%c\uD83D\uDD04 [".concat(this.name,"] subscribed to snapshot"),"background: darkred; color: #fff;")}async detach(){var e;super.detach(),null===(e=this.unsubscribeCallback)||void 0===e||e.call(this)}onSnapshot(e){let n=new Map(e.docs.map(e=>[e.id,{id:e.id,...e.data()}]));this.hasSynced=!0,this.updateMany(n)}constructor(e){var n;super(e),this.queryResolver=e.query,this.syncEnabled=null===(n=e.syncEnabled)||void 0===n||n,this.hasSynced=!1}}}let Book=class Book{get listingUrl(){var e;return e=this.asin,"https://www.amazon.com/gp/product/".concat(e)}matchIndex(e){let n=e.toLowerCase(),r=[this.title,this.authors.join(" ")].map(e=>null==e?void 0:e.toLowerCase()).filter(e=>e);for(let[e,o]of r.entries())if(null==o?void 0:o.includes(n))return r.length-e;return -1}static build(e){return new Book({id:e.id,asin:e.asin,authors:e.authors,title:e.title,coverSrc:e.cover_src})}constructor(e){var n;this.id=e.id,this.asin=e.asin,this.authors=e.authors,this.title=e.title,this.coverSrc=null!==(n=e.coverSrc)&&void 0!==n?n:null}};let k=TableSyncMixin(w.i),S=class extends(0,p.Hnr)({enabled:(0,p.vgT)(!0)}){get assertGraph(){return(0,m.w0)(this)}findByAsin(e){let n=this.table.query().find(n=>n.asin===e);return n?Book.build(n):null}onAttachedToRootStore(){return this.table.attach(),()=>this.table.detach()}constructor(...e){super(...e),this.syncQuery=async()=>(0,y.DB)({db:f.db,graphId:this.assertGraph.id}),this.table=new k({name:"books",query:this.syncQuery,syncEnabled:this.enabled,loggingEnabled:!1})}};S=(0,d.gn)([(0,p.o4J)("BookStore")],S),r(29823);var x=r(48480),N=r(33002),D=r(36650),T=r(39288);function getName(e){return e.custom_name||joinName(e.given_name,e.family_name)}function joinName(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.filter(Boolean).join(" ")}let I=TableSyncMixin((0,T.Z)(w.i)),C=class extends(0,p.Hnr)({syncEnabled:(0,p.vgT)(!0),persistEnabled:(0,p.vgT)(!0)}){onAttachedToRootStore(){return this.prepare(),()=>this.table.detach()}prepare(){(0,N.ZP)(()=>{this.table.attach()})}get validContacts(){return this.table.query().filter(e=>!!getName(e)&&!!(e.emails&&e.emails.length>0)).uniqBy(e=>getName(e))}find(e){let n=this.table.get(e);return n?Contact.build(n):null}searchContacts(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=e.toLowerCase(),o=this.validContacts.filterWithLimit(e=>{let n=joinName(e.given_name,e.family_name);return n.toLowerCase().includes(r)},n).results;return o.map(e=>Contact.build(e))}findByName(e){if(!e)return null;let n=this.validContacts.find(n=>n.custom_name&&n.custom_name===e||joinName(n.given_name,n.family_name)===e);return n?Contact.build(n):null}sampleContacts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.table.values.slice(0,e).map(e=>Contact.build(e))}findByEmail(e){let n=this.validContacts.filter(n=>{var r,o;return null!==(o=null===(r=n.email_values)||void 0===r?void 0:r.includes(e))&&void 0!==o&&o}).sortBy(e=>e.custom_name?[1,e.id]:e.given_name||e.family_name?[2,e.id]:[3,e.id]),r=n.results[0];return r?Contact.build(r):null}constructor(...e){super(...e),this.table=new I({name:"contacts",query:()=>(0,D.YO)(),syncEnabled:this.syncEnabled,persistEnabled:this.persistEnabled,loggingEnabled:!1})}};(0,d.gn)([u.computed],C.prototype,"validContacts",null),C=(0,d.gn)([(0,p.o4J)("ContactStore")],C);var A=r(44908),M=r.n(A),_=r(68825),E=r(88306),F=r.n(E);function lodash_memoize_memoize(){return function(e,n,r){r.get?r.get=F()(r.get,function(){return this}):r.value=F()(r.value)}}let Contact=class Contact{get primaryEmail(){return this.emailValues[0]}get name(){return this.customName?this.customName:[this.givenName,this.familyName].filter(e=>e).join(" ")}get emailValues(){let e=this.emails.slice().sort((e,n)=>(e.primary?-1:1)-(n.primary?-1:1)).map(e=>{var n;return null===(n=e.value)||void 0===n?void 0:n.toLowerCase()});return M()(e)}get phoneNumberValues(){let e=this.phoneNumbers.slice().sort((e,n)=>(e.primary?-1:1)-(n.primary?-1:1)).map(e=>e.value);return M()(e)}get validName(){return/^[a-z]/i.test(this.name)}get isValid(){return this.validName&&this.emails.length>0}static build(e){var n,r,o,a;return new Contact({id:e.id,givenName:null!==(n=e.given_name)&&void 0!==n?n:"",familyName:null!==(r=e.family_name)&&void 0!==r?r:"",customName:null!==(o=e.custom_name)&&void 0!==o?o:"",emails:e.emails,phoneNumbers:e.phone_numbers,photoUrl:null!==(a=e.photo_url)&&void 0!==a?a:void 0})}static buildFromParts(e){let{name:n,email:r}=e,[o,...a]=(n||"").split(" "),i=a.join(" "),s=r?[{value:r,primary:!0}]:[];return new Contact({givenName:o,familyName:i,emails:s})}constructor(e){var n,r,o,a,i;this.id=null!==(n=e.id)&&void 0!==n?n:(0,_.O)(),this.givenName=null!==(r=e.givenName)&&void 0!==r?r:"",this.familyName=null!==(o=e.familyName)&&void 0!==o?o:"",this.customName=e.customName,this.emails=null!==(a=e.emails)&&void 0!==a?a:[],this.phoneNumbers=null!==(i=e.phoneNumbers)&&void 0!==i?i:[],this.photoUrl=e.photoUrl}};(0,d.gn)([lodash_memoize_memoize()],Contact.prototype,"name",null),(0,d.gn)([lodash_memoize_memoize()],Contact.prototype,"emailValues",null),(0,d.gn)([lodash_memoize_memoize()],Contact.prototype,"phoneNumberValues",null),(0,d.gn)([lodash_memoize_memoize()],Contact.prototype,"validName",null),(0,d.gn)([lodash_memoize_memoize()],Contact.prototype,"isValid",null);var R=r(68070);let U=class extends(0,p.Hnr)({credentials:(0,p.vgT)(()=>[])}){get hasCredentials(){return this.credentials.length>0}get googleCredentials(){return this.credentials.filter(e=>"google"===e.provider)}get microsoftCredentials(){return this.credentials.filter(e=>"microsoft"===e.provider)}setCredentials(e){this.credentials=e}onAttachedToRootStore(){let e=(0,R.p2)(e=>{this.setCredentials(e)});return async()=>(await e)()}};(0,d.gn)([u.computed],U.prototype,"hasCredentials",null),(0,d.gn)([u.computed],U.prototype,"googleCredentials",null),(0,d.gn)([u.computed],U.prototype,"microsoftCredentials",null),(0,d.gn)([p.ZBq],U.prototype,"setCredentials",null),U=(0,d.gn)([(0,p.o4J)("CredentialStore")],U);var B=r(75472),j=r.n(B),P=r(7935);let K=class extends(0,p.Hnr)({id:p.UB4,provider:(0,p.vgT)(),email:(0,p.vgT)(),contactsCount:(0,p.vgT)(),calendars:(0,p.vgT)(()=>[]).withSetter(),status:(0,p.vgT)("connected"),errors:(0,p.vgT)(null).withSetter()}){get sortedCalendars(){return j()(this.calendars,[e=>e.sortOrder,e=>e.name],["asc","asc"])}get enabledCalendars(){return this.sortedCalendars.filter(e=>e.enabled)}get errorMessage(){var e;let n=null===(e=this.errors)||void 0===e?void 0:e.filter(e=>e);return(null==n?void 0:n.length)?"It seems that we cannot connect to this third-party account. Please try to revoke it and re-connect it.\n\n"+n.join("\n"):null}async revoke(){await (0,R.bL)(this.id)}onAttachedToRootStore(){return this.listeners.push((0,P.mq)(this.id,e=>{this.setCalendars(e)})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};(0,d.gn)([u.computed],K.prototype,"sortedCalendars",null),(0,d.gn)([u.computed],K.prototype,"enabledCalendars",null),(0,d.gn)([u.computed],K.prototype,"errorMessage",null),K=(0,d.gn)([(0,p.o4J)("Credential")],K);var O=r(77349),L=r(9005),G=r(42699),Z=r(69119),q=r(7069),H=r(27661),Y=r(540),z=r(70173),J=r(88829);let V=class extends(0,p.Hnr)({}){setCursor(e,n){this.editorKey=null!=e?e:null,this.selection=n}updateCursor(e){if(e.editor){let n=e.editor.getSelectionPositions();this.setCursor(e.editorKey,n)}}getCursor(e){return this.editorKey===e?this.selection:null}constructor(...e){super(...e),this.editorKey=null,this.selection=null}};(0,d.gn)([u.observable],V.prototype,"editorKey",void 0),(0,d.gn)([u.observable],V.prototype,"selection",void 0),(0,d.gn)([u.action],V.prototype,"setCursor",null),V=(0,d.gn)([(0,p.o4J)("SelectionView")],V);let W=class extends(0,p.Hnr)({selectionView:(0,p.vgT)(()=>new V({}))}){get rootStore(){return(0,p.k0l)(this)}get noteStore(){return(0,p.G_R)(this)}get assertDailyStore(){return this.assertNoteStore.dailyStore}get assertNoteStore(){return(0,m.w0)(this)}get mainView(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.mainView}get isEndAtMoreThanToday(){let e=(0,Z.Z)(new Date);return(0,G.Z)(e,this.endAt)}get selectedNote(){return this.selectedDate?this.findByDate(this.selectedDate):null}get searchEnabled(){return!!(this.searchQuery||this.searchNodeGuid)}getSelectionOption(e){var n,r;return null===(r=null!==(n=this.selectingEdge)&&void 0!==n?n:this.selectionView.getCursor(e))||void 0===r||r}get isActive(){var e;return(null===(e=this.mainView)||void 0===e?void 0:e.activeEditor)===this.role&&this.mainView.screen===Y.oK.NoteDaily}get selectedNoteIndex(){let e=this.selectedNote;return e?this.notes.indexOf(e):-1}findById(e){var n;return null!==(n=this.notes.find(n=>n.id===e))&&void 0!==n?n:null}findByDate(e){var n;let r=(0,Z.Z)(e).getTime();return null!==(n=this.notes.find(e=>e.dailyAt===r))&&void 0!==n?n:null}isDateInRange(e){return(0,J.ZQ)(e,{startAt:this.startAt,endAt:this.endAt})}get range(){return{startAt:this.startAt,endAt:this.endAt}}setRange(e,n){this.startAt=e,this.endAt=n,this.assertDailyStore.updateGeneratedNotes(this.range)}setCursorDate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.setRange((0,Z.Z)((0,q.Z)(e,n)),(0,Z.Z)((0,O.Z)(e,n)))}setSelectingEdge(e){this.selectingEdge=e}setSelectingScroll(e){this.selectingScroll=e}clearSearch(){this.searchQuery="",this.searchNodeGuid=""}setSelectedDate(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{scroll:r=!0,focus:o=!1,edge:a=null,searchQuery:i,searchNodeGuid:s}=n;this.selectedDate=e,this.selectingScroll=r,this.selectingEdge=a,null!=i&&(this.searchQuery=i),null!=s&&(this.searchNodeGuid=s),o&&this.requestForceFocus(),this.isDateInRange(e)||this.setCursorDate(e)}setSelectedNote(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{scroll:r=!0,edge:o=null}=n;this.setSelectedDate(e.dailyOrCreatedDate,{scroll:r,edge:o})}requestForceFocus(){this.forceFocus=!0}resetForceFocus(){this.forceFocus=!1}get noteStoreDailyNotes(){return this.assertNoteStore.allNotes.filter(e=>e.snapshot.daily)}get dailyNotesInRangeQuery(){let e=this.startAt.getTime(),n=this.endAt.getTime();return this.noteStoreDailyNotes.filter(r=>!!r.derived.dailyDate&&r.derived.dailyDate>=e&&r.derived.dailyDate<=n)}get dailyNotesInRange(){return this.dailyNotesInRangeQuery.models}get notes(){return this.assertDailyStore.combine(this.dailyNotesInRange)}get todaysDailyNote(){var e,n;let r=(0,z.l5)((0,H.zO)());return null!==(n=null===(e=this.noteStoreDailyNotes.find(e=>e.id===r))||void 0===e?void 0:e.value)&&void 0!==n?n:null}selectToday(){this.setSelectedDate(new Date,{scroll:!0,focus:!0,edge:"end"})}prependNotes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;this.setRange((0,q.Z)(this.startAt,e),this.endAt)}appendNotes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15;this.setRange(this.startAt,(0,O.Z)(this.endAt,e))}checkSelectedDateIsWithinBounds(){this.selectedDate&&!this.isDateInRange(this.selectedDate)&&this.setCursorDate(this.selectedDate)}get daysInRange(){return(0,L.Z)({start:this.startAt,end:this.endAt})}onAttachedToRootStore(){return this.setCursorDate(new Date),this.listeners.push((0,u.autorun)(()=>{this.checkSelectedDateIsWithinBounds()})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.role="primary",this.selectedDate=null,this.selectingEdge=null,this.searchQuery="",this.searchNodeGuid="",this.selectingScroll=!1,this.forceFocus=!1,this.startAt=new Date(Number.NaN),this.endAt=new Date(Number.NaN),this.listeners=[]}};(0,d.gn)([u.observable],W.prototype,"selectedDate",void 0),(0,d.gn)([u.observable],W.prototype,"selectingEdge",void 0),(0,d.gn)([u.observable],W.prototype,"searchQuery",void 0),(0,d.gn)([u.observable],W.prototype,"searchNodeGuid",void 0),(0,d.gn)([u.observable],W.prototype,"selectingScroll",void 0),(0,d.gn)([u.observable],W.prototype,"forceFocus",void 0),(0,d.gn)([u.observable],W.prototype,"startAt",void 0),(0,d.gn)([u.observable],W.prototype,"endAt",void 0),(0,d.gn)([u.computed],W.prototype,"isEndAtMoreThanToday",null),(0,d.gn)([u.computed],W.prototype,"selectedNote",null),(0,d.gn)([u.computed],W.prototype,"isActive",null),(0,d.gn)([u.computed],W.prototype,"selectedNoteIndex",null),(0,d.gn)([u.computed],W.prototype,"range",null),(0,d.gn)([u.action],W.prototype,"setRange",null),(0,d.gn)([u.action],W.prototype,"setSelectingEdge",null),(0,d.gn)([u.action],W.prototype,"setSelectingScroll",null),(0,d.gn)([u.action],W.prototype,"clearSearch",null),(0,d.gn)([u.action],W.prototype,"setSelectedDate",null),(0,d.gn)([u.action],W.prototype,"requestForceFocus",null),(0,d.gn)([u.action],W.prototype,"resetForceFocus",null),(0,d.gn)([u.computed],W.prototype,"noteStoreDailyNotes",null),(0,d.gn)([u.computed],W.prototype,"dailyNotesInRangeQuery",null),(0,d.gn)([u.computed],W.prototype,"dailyNotesInRange",null),(0,d.gn)([u.computed],W.prototype,"notes",null),(0,d.gn)([u.computed],W.prototype,"todaysDailyNote",null),(0,d.gn)([u.action],W.prototype,"checkSelectedDateIsWithinBounds",null),W=(0,d.gn)([(0,p.o4J)("DailyEditorView")],W);let Q=class extends(0,p.Hnr)({role:(0,p.vgT)(),selectionView:(0,p.vgT)(()=>new V({}))}){get selectedNote(){if(this.selectedNoteId){var e;return null!==(e=this.assertNoteStore.findById(this.selectedNoteId))&&void 0!==e?e:null}return null}get hasSelectedNote(){return!!this.selectedNote}clearSearch(){this.searchQuery="",this.searchNodeGuid=""}get searchEnabled(){return!!(this.searchQuery||this.searchNodeGuid)}setSelectedNote(e){var n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setSelectedNoteId(null!==(n=null==e?void 0:e.id)&&void 0!==n?n:null,r)}setSelectedNoteId(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{searchQuery:r="",searchNodeGuid:o=""}=n;this.selectedNoteId=e,this.searchQuery=r,this.searchNodeGuid=o}get noteStore(){return(0,p.G_R)(this)}get assertNoteStore(){if(!this.noteStore)throw Error("EditNoteStore must be used within a NoteStore");return this.noteStore}constructor(...e){super(...e),this.selectedNoteId=null,this.searchQuery="",this.searchNodeGuid=""}};(0,d.gn)([u.observable],Q.prototype,"selectedNoteId",void 0),(0,d.gn)([u.observable],Q.prototype,"searchQuery",void 0),(0,d.gn)([u.observable],Q.prototype,"searchNodeGuid",void 0),(0,d.gn)([u.computed],Q.prototype,"selectedNote",null),(0,d.gn)([u.action],Q.prototype,"clearSearch",null),(0,d.gn)([u.action],Q.prototype,"setSelectedNoteId",null),Q=(0,d.gn)([(0,p.o4J)("EditorView")],Q);var $=r(64487),X=r(8804),tt=r.n(X),te=r(29895);let AuthSyncWeb=class AuthSyncWeb extends te.Uw{setUser(){}clearUser(){}setGraphId(){}};let tn=(0,te.fo)("AuthSync",{web:new AuthSyncWeb});var tr=r(35339),to=r(70586);let ta=class extends(0,p.Hnr)({currentGraphId:(0,p.vgT)(null),graphs:(0,p.vgT)(()=>[]),volatileGraphs:(0,p.vgT)(()=>[])},{toSnapshotProcessor:e=>{let{currentGraphId:n,graphs:r}=e;return{currentGraphId:n,graphs:r}}}){get allGraphs(){return this.graphs.concat(this.volatileGraphs)}get currentGraph(){return this.allGraphs.find(e=>e.id===this.currentGraphId)}get assertCurrentGraph(){let e=this.currentGraph;if(!e)throw Error("graph blank");return e}get ownedGraphs(){return this.allGraphs.filter(e=>e.isOwner)}findById(e){return this.allGraphs.find(n=>n.id===e)}setCurrentGraph(e){this.setCurrentGraphId(e.id)}setCurrentGraphId(e){this.currentGraphId=e}ensureGraphId(e){let n=this.graphs.find(n=>n.id===e);n||(console.info("Loading graph:",e),this.graphs.push(new ti.k({id:e}))),this.volatileGraphs=this.volatileGraphs.filter(n=>n.id!==e)}ensureVolatileGraphId(e){this.findById(e)||(console.info("Loading volatile graph:",e),this.volatileGraphs.push(new ti.k({id:e})))}onUserSnapshot(e){if(e.graphIds.forEach(e=>this.ensureGraphId(e)),e.ready)for(let n of this.graphs)e.graphIds.includes(n.id)||(0,p.ogt)(n);if(this.currentGraphId&&!this.findById(this.currentGraphId)&&(this.currentGraphId=null),!this.currentGraphId&&this.graphs.length>0){var n;this.setCurrentGraphId(null!==(n=tt()(e.graphIds))&&void 0!==n?n:null)}}addGraph(e){let n=this.findById(e.id);n&&(0,p.ogt)(n),this.graphs.push(e)}onAttachedToRootStore(){return this.listeners.push((0,tr.Mo)(e=>{to.k.info("[GraphStore] on user-snapshot ".concat(e.id," (").concat(e.email,")")),this.onUserSnapshot(e)})),this.listeners.push((0,u.reaction)(()=>this.currentGraphId,e=>{var n;$.YA("graph_id",null!=e?e:null),tn.setGraphId({graphId:null!==(n=this.currentGraphId)&&void 0!==n?n:null})},{fireImmediately:!0})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};(0,d.gn)([u.computed],ta.prototype,"allGraphs",null),(0,d.gn)([u.computed],ta.prototype,"currentGraph",null),(0,d.gn)([u.computed],ta.prototype,"ownedGraphs",null),(0,d.gn)([p.ZBq],ta.prototype,"setCurrentGraphId",null),(0,d.gn)([p.ZBq],ta.prototype,"ensureGraphId",null),(0,d.gn)([p.ZBq],ta.prototype,"ensureVolatileGraphId",null),(0,d.gn)([p.ZBq],ta.prototype,"onUserSnapshot",null),(0,d.gn)([p.ZBq],ta.prototype,"addGraph",null),ta=(0,d.gn)([(0,p.o4J)("GraphStore")],ta);var ti=r(20034);r(90783);let ts=class extends(0,p.Hnr)({id:p.UB4,name:(0,p.vgT)(null),email:(0,p.vgT)(null),enrichedName:(0,p.vgT)(null)}){get rootStore(){return(0,p.k0l)(this)}get isBlank(){return!this.email&&!this.name}get nameWithFallback(){var e,n;return null!==(n=null!==(e=this.name)&&void 0!==e?e:this.enrichedName)&&void 0!==n?n:null}get buildContact(){return Contact.buildFromParts({email:this.email,name:this.nameWithFallback})}setName(e){this.name=e}setEmail(e){this.email=e}delete(){(0,p.ogt)(this)}setEnrichment(e){var n,r,o;this.enrichedName=null!==(o=null==e?void 0:null===(r=e.person)||void 0===r?void 0:null===(n=r.name)||void 0===n?void 0:n.fullName)&&void 0!==o?o:this.enrichedName}};(0,d.gn)([u.computed],ts.prototype,"isBlank",null),(0,d.gn)([u.computed],ts.prototype,"nameWithFallback",null),(0,d.gn)([p.ZBq],ts.prototype,"setName",null),(0,d.gn)([p.ZBq],ts.prototype,"setEmail",null),(0,d.gn)([p.ZBq],ts.prototype,"setEnrichment",null),ts=(0,d.gn)([(0,p.o4J)("MeetingAttendee")],ts);var tl=r(83894),tc=r(43063),td=r.n(tc),tu=r(89734),tp=r.n(tu),th=r(5717),tg=r(40127);async function listMeetings(e){let{startAt:n,endAt:r,credentialId:o}=e,a=new URL("/api/meetings",location.href);a.searchParams.append("start_at",n.toISOString()),a.searchParams.append("end_at",r.toISOString()),a.searchParams.append("credential_id",o);let i=await (0,tg.$Q)(a.href);return i.map(buildMeeting)}function buildMeeting(e){var n,r,o,a;let i=e.attendees.map(e=>new ts(e)),s=e.startAt?null===(n=(0,th.Z)(e.startAt))||void 0===n?void 0:n.getTime():void 0,l=e.endAt?null===(r=(0,th.Z)(e.endAt))||void 0===r?void 0:r.getTime():void 0;return new tv({name:null!==(o=e.name)&&void 0!==o?o:void 0,description:null!==(a=e.description)&&void 0!==a?a:void 0,startAt:s,endAt:l,recurring:e.recurring,attendees:i})}var tm=r(42298);let generateDayId=e=>(0,tm.Z)(e,"yyyy-MM-dd"),ty=class extends(0,p.Hnr)({meetings:(0,p.vgT)(()=>[])}){meetingsForDay(e){let n=generateDayId(e);return this.meetings.filter(e=>e.dayId===n).map(e=>e.meeting)}meetingsForDaySorted(e){return tp()(this.meetingsForDay(e),e=>e.startAt)}async fetchAllMeetingsForDay(e){this.setStatus("loading");let n=this.credentialStore.credentials;try{await Promise.all(n.map(n=>this.fetchMeetingsForDay(n,e))),this.setStatus("success")}catch(e){console.error("Error fetching meetings",e),this.setStatus("error")}}async fetchMeetingsForDay(e,n){let r=e.id,o=(0,Z.Z)(n),a=(0,tl.Z)(n),i=await listMeetings({startAt:o,endAt:a,credentialId:r});this.replaceMeetings({day:n,credentialId:r,meetings:i})}replaceMeetings(e){let{day:n,credentialId:r,meetings:o}=e,a=generateDayId(n),i=td()(this.meetings,e=>e.dayId===a&&e.credentialId===r),s=o.map(e=>({dayId:a,credentialId:r,meeting:e}));this.meetings=[...i,...s]}setStatus(e){this.status=e}get rootStore(){return(0,m.pE)(this)}get credentialStore(){return this.rootStore.credentialStore}constructor(...e){super(...e),this.status="success"}};(0,d.gn)([u.observable],ty.prototype,"status",void 0),(0,d.gn)([p.ZBq],ty.prototype,"replaceMeetings",null),(0,d.gn)([u.action],ty.prototype,"setStatus",null),ty=(0,d.gn)([(0,p.o4J)("MeetingStore")],ty);var tf=r(88498);let tv=class extends(0,p.Hnr)({id:p.UB4,name:(0,p.vgT)(),description:(0,p.vgT)(),startAt:(0,p.vgT)(),endAt:(0,p.vgT)(),recurring:(0,p.vgT)(!1),attendees:(0,p.vgT)(()=>[]).withSetter()}){get buildContacts(){return this.validAttendees.map(e=>e.buildContact)}get rootStore(){return(0,p.k0l)(this)}get startAtDate(){return this.startAt?new Date(this.startAt):void 0}get startAtTimeFormatted(){var e,n;let r=null===(n=this.rootStore)||void 0===n?void 0:null===(e=n.preferenceStore)||void 0===e?void 0:e.timeFormat;return this.startAtDate?(0,tf.mr)(this.startAtDate,null!=r?r:"12"):void 0}get endAtDate(){return this.endAt?new Date(this.endAt):void 0}get validAttendees(){var e,n;let r=null!==(n=null===(e=this.rootStore)||void 0===e?void 0:e.currentUserAssociatedEmails)&&void 0!==n?n:[];return this.attendees.filter(e=>!r.includes(e.email))}setName(e){this.name=e}addAttendee(e){this.attendees.push(e)}addBlankAttendee(){this.addAttendee(new ts({}))}clearAttendees(){this.attendees=[]}clearBlankAttendees(){this.attendees=this.attendees.filter(e=>!e.isBlank)}};(0,d.gn)([u.computed],tv.prototype,"startAtDate",null),(0,d.gn)([u.computed],tv.prototype,"startAtTimeFormatted",null),(0,d.gn)([u.computed],tv.prototype,"endAtDate",null),(0,d.gn)([u.computed],tv.prototype,"validAttendees",null),(0,d.gn)([p.ZBq],tv.prototype,"setName",null),(0,d.gn)([p.ZBq],tv.prototype,"addAttendee",null),(0,d.gn)([p.ZBq],tv.prototype,"clearAttendees",null),(0,d.gn)([p.ZBq],tv.prototype,"clearBlankAttendees",null),tv=(0,d.gn)([(0,p.o4J)("Meeting")],tv);var tb=r(15965),tw=r(13861),tk=r(88766),tS=r(91425),tx=r(85760),tN=r(54375);let tD="undefined"!=typeof Worker?new Worker(r.tu(new URL(r.p+r.u(4587),r.b))):null,tT=tD?tN.Ud(tD):{loadFromStorage:()=>Promise.resolve(!1),search:()=>[],searchCombined:()=>[],updateIndex:async()=>{},getDocumentCount:()=>Promise.resolve(0),flush:async()=>{}};window.addEventListener("beforeunload",()=>{tT.flush()});var tI=r(46954);let tC=class extends(0,p.Hnr)({}){onAttachedToRootStore(){return this.setup(),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}async setup(){await (0,u.when)(()=>this.assertNoteStore.persistenceReady);let e=await tT.loadFromStorage({graphId:this.assertGraph.id,types:this.searchManagerTypes});e&&await this.verifyIndex()||await this.reindexFromAllNotes(),this.observeNoteChanges(),this.observeCommitChanges()}observeNoteChanges(){this.notesObserver=new tx.P({table:this.noteTable,onChange:e=>void this.handleNoteChange(e),debounce:3e3}),this.listeners.push(()=>{var e;return null===(e=this.notesObserver)||void 0===e?void 0:e.dispose()})}handleNoteChange(e){let{updatedRows:n,deletedRowIds:r}=e;this.reindexFromNotes({updatedRows:n,deletedRowIds:r})}observeCommitChanges(){this.changesObserver=new tI.Z({graphId:this.graphId,changeStore:this.changeStore,onChange:this.handleCommitsChange.bind(this),debounce:3e3}),this.listeners.push(()=>{var e;return null===(e=this.changesObserver)||void 0===e?void 0:e.dispose()})}handleCommitsChange(e){this.reindexFromNoteIds(e)}async reindexFromAllNotes(){let e=this.noteTable.values;await this.reindexFromNotes({updatedRows:e,deletedRowIds:[],reset:!0})}async reindexFromNoteIds(e){let n=e.map(e=>this.noteTable.get(e)).filter(tw.Dw);await this.reindexFromNotes({updatedRows:n,deletedRowIds:[]})}async reindexFromNotes(e){let{updatedRows:n,deletedRowIds:r,reset:o=!1}=e,a=n.filter(isValidIndexingRow).map(e=>this.docFromNoteRow(e)),i=n.filter(e=>!isValidIndexingRow(e)).map(e=>e.id);await tT.updateIndex({graphId:this.graphId,types:this.searchManagerTypes,add:a,remove:M()([...r,...i]),reset:o})}docFromNoteRow(e){return docFromNoteRowOrPool({row:e,adapter:this.noteAdapter})}async verifyIndex(){let e=await tT.getDocumentCount({graphId:this.graphId,type:"text"}),n=this.noteTable.values.filter(isValidIndexingRow).length;return e===n||(this.logger.warn("Search index is out of sync. Expected ".concat(n," documents, got ").concat(e,". Rebuilding index.")),!1)}async search(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"text"};return await tT.search({graphId:this.graphId,options:n,query:e})}async searchCombined(e){return await tT.searchCombined({graphId:this.graphId,queries:e})}get assertNoteStore(){return(0,m.w0)(this)}get noteTable(){return this.assertNoteStore.assertTable}get noteAdapter(){return this.assertNoteStore.assertAdapter}get assertGraph(){return this.assertNoteStore.assertGraph}get changeStore(){return this.assertNoteStore.assertRootStore.changeStore}get logger(){return this.assertGraph.logger}get graphId(){return this.assertGraph.id}get searchEmbeddingEnabled(){return!(0,tS.Y8)()&&!(0,tk.W)()&&!this.assertGraph.hasFlag("search_embedding_disabled")}get searchManagerTypes(){return this.searchEmbeddingEnabled?["text","embedding"]:["text"]}constructor(...e){super(...e),this.listeners=[]}};tC=(0,d.gn)([(0,p.o4J)("SearchStore")],tC);var tA=r(14066),tM=r(25038),t_=r(91935),tE=r(95534),tF=r.n(tE),tR=r(73955),tU=r.n(tR);let ModelPlaceholder=class ModelPlaceholder{get value(){return this.adapter.assertModel(this.id)}retain(){this.adapter.retain(this.id)}release(){this.adapter.release(this.id)}constructor(e){this.adapter=e.adapter,this.id=e.id,this.parentQuery=e.parentQuery,(0,u.makeObservable)(this),(0,u.onBecomeObserved)(this,"value",()=>{this.retain()}),(0,u.onBecomeUnobserved)(this,"value",()=>{this.release()})}};(0,d.gn)([u.computed],ModelPlaceholder.prototype,"value",null);let ModelAdapterQuery=class ModelAdapterQuery{get globalId(){return"ModelAdapterQuery:".concat(this.globalCounter," [").concat(this.query.loggingName,"]")}get table(){return this.adapter.table}get builder(){return this.adapter.onCreate}get results(){return this.query.results}get count(){return this.query.count}get models(){return this.placeholders.map(e=>e.value)}get placeholders(){return this.query.results.map(e=>new ModelPlaceholder({adapter:this.adapter,id:e.id,parentQuery:this}))}findById(e){let n=this.query.findById(e);return this.createPlaceholder(null==n?void 0:n.id)}find(e){let n=this.query.find(e);return this.createPlaceholder(null==n?void 0:n.id)}sample(){var e;return null!==(e=tF()(this.placeholders))&&void 0!==e?e:null}filter(e){return this.subquery(n=>n.filter(e))}refine(e){return this.subquery(n=>n.refine(e))}sort(e){return this.subquery(n=>n.sort(e))}sortBy(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{order:"asc"};return this.subquery(r=>r.sortBy(e,n))}limit(e){return this.subquery(n=>n.limit(e))}subquery(e){return new ModelAdapterQuery({adapter:this.adapter,query:e(this.query)})}createPlaceholder(e){return e?new ModelPlaceholder({adapter:this.adapter,id:e,parentQuery:this}):null}constructor(e){this.globalCounter=tU()(),this.adapter=e.adapter,this.query=e.query,(0,u.makeObservable)(this)}};(0,d.gn)([u.computed],ModelAdapterQuery.prototype,"count",null),(0,d.gn)([u.computed],ModelAdapterQuery.prototype,"models",null),(0,d.gn)([u.computed],ModelAdapterQuery.prototype,"placeholders",null);var tB=r(20841);let ModelAdapter=class ModelAdapter{attach(){this.table.attach(),this.table.on("change",this.boundSyncPool,{name:"boundSyncPool",priority:tB.g.Low})}detach(){this.table.detach()}save(e){if(!(0,p.G_R)(e))throw Error("Model must be part of the pool in order to be saved (model has no parent)");this.table.update(e.id,this.onSerialize(e),{fromModelSave:!0})}addModel(e){if((0,p.G_R)(e))throw Error("Only unattached models can be added to adapter (model has a parent)");this.pool.set(e.id,e);let n=this.onSerialize(e);this.table.update(e.id,n,{fromModelSave:!0}),this.observeModel(e)}addModels(e){for(let n of e)this.addModel(n)}ensureModel(e){let n=this.pool.get(e);if(n)return n;let r=this.buildModel(e);return r?(this.pool.set(e,r),r):null}assertModel(e){let n=this.ensureModel(e);if(!n)throw Error("Model with id ".concat(e," not found"));return n}buildModel(e){let n=this.table.get(e);if(!n)return null;let r=this.onCreate(n);return this.observeModel(r),r}deleteModel(e){this.table.delete(e.id)}observeModel(e){let n=(0,p.cfB)(e,()=>{this.save(e)});this.listeners.push(n)}retain(e){}release(e){}query(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.table.query(e);return new ModelAdapterQuery({adapter:this,query:n})}syncPool(e){let{ids:n,options:r}=e;if((null==r||!r.fromModelSave)&&this.pool)for(let e of n){let n=this.pool.get(e);if(!n)continue;let r=this.table.get(e);if(!r){setTimeout(()=>{this.pool.delete(e)},250);continue}this.onUpdate(n,r)}}constructor({table:e,onCreate:n,onUpdate:r,onSerialize:o,pool:a}){this.listeners=[],this.boundSyncPool=this.syncPool.bind(this),this.table=e,this.onCreate=n,this.onUpdate=r,this.onSerialize=o,this.pool=a}};let tj=class extends(0,p.Hnr)(()=>({models:(0,p.vgT)(()=>new p.RTE({}))})){has(e){return this.models.has(e)}get(e){return this.models.get(e)}set(e,n){this.get(e)&&this.delete(e),this.models.set(e,n)}delete(e){this.models.delete(e)}get size(){return this.models.size}clear(){this.models.clear()}};(0,d.gn)([p.ZBq],tj.prototype,"set",null),(0,d.gn)([p.ZBq],tj.prototype,"delete",null),(0,d.gn)([p.ZBq],tj.prototype,"clear",null),tj=(0,d.gn)([(0,p.o4J)("ModelPool")],tj);var tP=r(25325),tK=r.n(tP),tO=r(92784),tL=r(29354);let tG=class extends(0,p.Hnr)({}){searchBacklinks(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=this.searchNotes(e,n),o=r.map(noteToBacklink),a=this.searchContacts(e,n),i=a.map(contactToBacklink);return this.processBacklinks({noteBacklinks:o,contactBacklinks:i,query:e,limit:n})}getSampleBacklinks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=this.sampleNotes(e),r=n.map(noteToBacklink),o=this.sampleContacts(e),a=o.map(contactToBacklink);return this.processBacklinks({noteBacklinks:r,contactBacklinks:a,limit:e})}get rootStore(){return(0,m.pE)(this)}get noteStore(){var e;return null===(e=(0,tO.H)(this))||void 0===e?void 0:e.noteStore}get assertNoteStore(){return(0,m.wi)(this,"noteStore")}get contactStore(){return this.rootStore.contactStore}processBacklinks(e){let{noteBacklinks:n,contactBacklinks:r,query:o,limit:a=10}=e,i=this.combineBacklinks({noteBacklinks:n,contactBacklinks:r});return(i=(0,tL.Ln)(i,o)).slice(0,a)}combineBacklinks(e){let{noteBacklinks:n,contactBacklinks:r}=e,o=n.flatMap(e=>e.emails),a=r.filter(e=>0===tK()(e.emails,o).length);return n.concat(a)}get notes(){return this.assertNoteStore.regularNotesBacklinkedCountDesc.filter(e=>!!e.snapshot.subject)}searchNotes(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return(0,J.KK)(this.notes,e).limit(n).results}sampleNotes(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.notes.limit(e).results}searchContacts(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return this.contactStore.searchContacts(e,n)}sampleContacts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return this.contactStore.sampleContacts(e)}};function noteToBacklink(e){var n,r,o;let a=e.snapshot.systemMetadata,i=null==a?void 0:null===(n=a.data)||void 0===n?void 0:n.enrichment,s=(null==i?void 0:null===(r=i.person)||void 0===r?void 0:r.avatar)||(null==i?void 0:null===(o=i.company)||void 0===o?void 0:o.logo)||void 0;return{id:e.snapshot.id,previewSrc:s,label:e.snapshot.subject,normalizedLabel:e.derived.normalizedSubject}}function contactToBacklink(e){return{id:e.id,previewSrc:e.photoUrl,label:e.name,normalizedLabel:e.name.toLowerCase(),contactId:e.id}}tG=(0,d.gn)([(0,p.o4J)("BacklinkStore")],tG);var tZ=r(97867);let tq=class extends(0,p.Hnr)({}){setGeneratedNotes(e){this.generatedNotes=e}findGeneratedById(e){var n;return null!==(n=this.generatedNotes.find(n=>n.id===e))&&void 0!==n?n:null}combine(e){let n=this.generatedNotes.filter(n=>!e.some(e=>e.id===n.id)),r=e.concat(null!=n?n:[]);return r.sort((e,n)=>e.dailyAt-n.dailyAt)}updateGeneratedNotes(e){let n=this.assertRootStore.preferenceStore;if(!n.hasSynced)return;let r=(0,L.Z)({start:e.startAt,end:e.endAt}),o=this.generatedNotes.map(e=>e.id),a=r.filter(e=>{let n=(0,z.l5)(e);return!o.includes(n)}),i=this.generateForDates(a),s=this.generatedNotes.concat(i).filter(n=>(0,J.ZQ)(n.dailyOrCreatedDate,e)).sort((e,n)=>e.dailyAt-n.dailyAt);this.setGeneratedNotes(s)}generateForDates(e){return e.map(e=>this.assertNoteStore.buildForDate(e))}get assertNoteStore(){return(0,m.w0)(this)}get assertRootStore(){return this.assertNoteStore.assertRootStore}constructor(...e){super(...e),this.generatedNotes=[]}};(0,d.gn)([u.observable],tq.prototype,"generatedNotes",void 0),(0,d.gn)([u.action],tq.prototype,"setGeneratedNotes",null),tq=(0,d.gn)([(0,p.o4J)("DailyNoteStore")],tq);var tH=r(10928),tY=r.n(tH),tz=r(80394);let tJ="#trash",tV=class extends(0,p.Hnr)({lastSelectedNoteRef:(0,p.vgT)(),lastSelectedNotSpanNoteRef:(0,p.vgT)(),selectedNoteRefs:(0,p.vgT)(()=>[])}){get noteStore(){let e=(0,p.G_R)(this);if(!e)throw Error("blank store");return e}get rootStore(){let e=(0,p.k0l)(this);if(!e)throw Error("blank store");return e}get mainView(){return this.rootStore.mainView}get graph(){let e=this.noteStore.graph;if(!e)throw Error("no graph");return e}get hasQuery(){return!!this.query}get isTrashQuery(){return this.query===tJ}get isTagQuery(){return this.query.startsWith("#")}get deletedNotes(){return this.noteStore.deletedNotesDesc}get tagMatchNotes(){let e=this.query,n=e.replaceAll("#","");return this.noteStore.allNotes.filter(e=>!e.snapshot.deletedAt&&e.derived.tags.includes(n)).sortBy(e=>{var n;return null!==(n=e.snapshot.editedAt)&&void 0!==n?n:e.snapshot.updatedAt},{order:"desc"})}get notes(){return this.isTrashQuery?this.deletedNotes:this.isTagQuery?this.tagMatchNotes:this.noteStore.regularNotesEditedDesc}get noteIds(){return this.notes.placeholders.map(e=>e.id)}get selectedNotes(){return this.selectedNoteRefs.map(e=>e.current).filter(e=>this.noteIds.includes(e.id))}get selectedNotesAreTrashed(){return this.selectedNotes.every(e=>e.isDeleted)}get lastSelectedNotSpanNoteIndex(){var e;let n=null===(e=this.lastSelectedNotSpanNoteRef)||void 0===e?void 0:e.maybeCurrent;return n?this.noteIds.indexOf(n.id):-1}get lastSelectedNote(){var e;let n=null===(e=this.lastSelectedNoteRef)||void 0===e?void 0:e.maybeCurrent;if(n&&this.noteIds.includes(n.id))return n}get lastSelectedNoteIndex(){let e=this.lastSelectedNote;return e?this.noteIds.indexOf(e.id):-1}setQuery(e){this.query===e?this.scrollToTop():this.query=e}clearQuery(){this.setQuery("")}setScrollIndex(e){this.scrollIndex=e,this.scrollIndexCounter++}scrollToTop(){this.setScrollIndex(0)}scrollIntoView(e){let n=this.noteIds.indexOf(e.id);-1!==n&&this.setScrollIndex(n)}isSelected(e){return this.selectedNotes.includes(e)}isLastSelected(e){var n;return(null===(n=this.lastSelectedNoteRef)||void 0===n?void 0:n.maybeCurrent)===e}unselectAll(){this.selectedNoteRefs=[]}setSelectedNotes(e){this.selectedNoteRefs=e.map(e=>(0,tz.qg)(e))}setLastSelectedNote(e){let{span:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.lastSelectedNoteRef=(0,tz.qg)(e),n||(this.lastSelectedNotSpanNoteRef=(0,tz.qg)(e))}async deleteSelectedNotes(){0!==this.selectedNotes.length&&(this.query===tJ?confirm("Destroy selected notes forever?")&&await this.noteStore.batchDestroyNotes(this.selectedNotes):await this.noteStore.batchDeleteNotes(this.selectedNotes))}edit(e){this.mainView.editNote(e)}editSelected(){let[e]=this.selectedNotes;e&&this.edit(e)}selectOperation(e){let{note:n,toggle:r=!1,span:o=!1}=e;r?this.toggle(n):o?this.selectWithSpan(n):this.selectExclusively(n)}checkOperation(e){let{note:n,span:r=!1}=e;r?this.selectWithSpan(n):this.toggle(n)}toggle(e){this.selectedNotes.includes(e)?this.unselect(e):this.select(e)}selectWithSpan(e){let n=this.lastSelectedNotSpanNoteIndex,r=this.noteIds.indexOf(e.id);this.selectSpan(n,r)}selectExclusively(e){this.unselectAll(),this.select(e)}select(e){this.selectedNotes.includes(e)||(this.selectedNoteRefs.push((0,tz.qg)(e)),this.setLastSelectedNote(e),this.scrollIntoView(e))}selectAll(e){for(let n of e)this.selectedNotes.includes(n)||this.selectedNoteRefs.push((0,tz.qg)(n));let n=tY()(e);n&&(this.setLastSelectedNote(n),this.scrollIntoView(n))}unselect(e){let n=this.selectedNotes.indexOf(e);n>=0&&this.selectedNoteRefs.splice(n,1)}selectSpan(e,n){let r=Math.min(e,n),o=Math.max(e,n);if(r<0||o>=this.noteIds.length)return;let a=this.notes.placeholders,i=a.slice(r,o+1).map(e=>e.value),s=a[n].value;this.setSelectedNotes(i),this.setLastSelectedNote(s,{span:!0}),this.scrollIntoView(s)}selectDirection(e,n){let{span:r=!1}=n,o=this.lastSelectedNoteIndex+("down"===e?1:-1),a=this.notes.placeholders[o];if(a){if(r){let e=this.lastSelectedNotSpanNoteIndex;this.selectSpan(e,o)}else this.selectExclusively(a.value)}}constructor(...e){super(...e),this.query="",this.scrollIndex=0,this.scrollIndexCounter=0}};(0,d.gn)([u.observable],tV.prototype,"query",void 0),(0,d.gn)([u.observable],tV.prototype,"scrollIndex",void 0),(0,d.gn)([u.observable],tV.prototype,"scrollIndexCounter",void 0),(0,d.gn)([u.computed],tV.prototype,"hasQuery",null),(0,d.gn)([u.computed],tV.prototype,"tagMatchNotes",null),(0,d.gn)([u.computed],tV.prototype,"notes",null),(0,d.gn)([(0,u.computed)({keepAlive:!0})],tV.prototype,"noteIds",null),(0,d.gn)([u.computed],tV.prototype,"selectedNotes",null),(0,d.gn)([u.computed],tV.prototype,"selectedNotesAreTrashed",null),(0,d.gn)([u.computed],tV.prototype,"lastSelectedNotSpanNoteIndex",null),(0,d.gn)([u.computed],tV.prototype,"lastSelectedNote",null),(0,d.gn)([u.action],tV.prototype,"setQuery",null),(0,d.gn)([u.action],tV.prototype,"setScrollIndex",null),(0,d.gn)([u.action],tV.prototype,"scrollToTop",null),(0,d.gn)([p.ZBq],tV.prototype,"unselectAll",null),(0,d.gn)([p.ZBq],tV.prototype,"setSelectedNotes",null),(0,d.gn)([p.ZBq],tV.prototype,"setLastSelectedNote",null),(0,d.gn)([p.ZBq],tV.prototype,"select",null),(0,d.gn)([p.ZBq],tV.prototype,"selectAll",null),(0,d.gn)([p.ZBq],tV.prototype,"unselect",null),tV=(0,d.gn)([(0,p.o4J)("NoteListView")],tV);var tW=r(12428);let tQ=(0,T.Z)(w.i),t$=class extends(0,p.Hnr)({pool:(0,p.vgT)(()=>new tj({})),syncedAt:(0,p.vgT)(null).withTransform((0,p.h8)()).withSetter(),dailyStore:(0,p.vgT)(()=>new tq({})),searchStore:(0,p.vgT)(()=>new tC({})),backlinkStore:(0,p.vgT)(()=>new tG({})),dailyEditorView:(0,p.vgT)(()=>new W({})),primaryEditorView:(0,p.vgT)(()=>new Q({role:"primary"})),secondaryEditorView:(0,p.vgT)(()=>new Q({role:"secondary"})),listView:(0,p.vgT)(()=>new tV({}))},{toSnapshotProcessor:e=>{let{syncedAt:n}=e;return{syncedAt:n}}}){onAttachedToRootStore(){let e=new tQ({name:"".concat(this.assertGraph.id,"-notes-2"),persistEnabled:!0,loggingEnabled:!0});return this.table=e,this.adapter=new ModelAdapter({table:e,pool:this.pool,onCreate:tW.AZ,onUpdate:tW.C2,onSerialize:tW.s4}),this.table.on("load",()=>this.setPersistenceReady(!0)),this.adapter.attach(),this.listeners.push(()=>this.assertAdapter.detach()),this.setupSnapshotListenerWhenReady(),this.setupReconnectListener(),()=>this.beforeDetach()}beforeDetach(){var e;return this.snapshotRestartInterval&&clearInterval(this.snapshotRestartInterval),null===(e=this.snapshotListener)||void 0===e||e.call(this),(0,g.$)(this.listeners)}get rootStore(){return(0,p.k0l)(this)}get assertRootStore(){return(0,m.wi)(this,"rootStore")}get graph(){return(0,p.G_R)(this)}get assertGraph(){return(0,m.wi)(this,"graph")}get changeStore(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.changeStore}get assertChangeStore(){let e=this.assertRootStore.changeStore;return(0,tA.hu)(e,"ChangeStore not found"),e}get online(){var e;return!!(null===(e=this.rootStore)||void 0===e?void 0:e.online)}get offline(){return!this.online}get assertTable(){return(0,m.wi)(this,"table")}get assertAdapter(){return(0,m.wi)(this,"adapter")}setHasSynced(e){this.hasSynced=e}setPersistenceReady(e){this.persistenceReady=e}setMode(e){this.mode=e}async setupSnapshotListenerWhenReady(){await (0,u.when)(()=>this.assertGraph.readyToInitStores),this.restartSnapshotListener(),this.snapshotRestartInterval=setInterval(()=>{this.restartSnapshotListener()},36e5)}async restartSnapshotListener(){var e;null===(e=this.snapshotListener)||void 0===e||e.call(this),this.snapshotListener=void 0,this.snapshotListener=await (0,t_.qC)({store:this,onError:this.handleSnapshotError.bind(this)})}async handleSnapshotError(){await this.restartSnapshotListener()}async setupReconnectListener(){await (0,u.when)(()=>this.persistenceReady),this.listeners.push((0,u.reaction)(()=>this.hasSynced&&this.online,e=>{e&&this.handleReconnect()}))}get allNotes(){let e=this.assertAdapter.query();return e.query.loggingName="allNotes",e}get deletedNotes(){let e=this.assertAdapter.query().filter(e=>!!e.snapshot.deletedAt);return e.query.loggingName="deletedNotes",e}get deletedNotesDesc(){let e=this.deletedNotes.sort((e,n)=>n.snapshot.deletedAt-e.snapshot.deletedAt);return e.query.loggingName="deletedNotesDesc",e}get deletedNotesEditedDesc(){let e=this.deletedNotes.sortBy(e=>{var n;return null!==(n=e.snapshot.editedAt)&&void 0!==n?n:e.snapshot.updatedAt},{order:"desc"});return e.query.loggingName="deletedNotesEditedDesc",e}get undeletedNotes(){let e=this.assertAdapter.query().filter(e=>!e.snapshot.deletedAt);return e.query.loggingName="undeletedNotes",e}get undeletedUnblankNotes(){let e=this.undeletedNotes.filter(e=>!e.derived.isBlank);return e.query.loggingName="undeletedUnblankNotes",e}get undeletedHasTaskNotes(){let e=this.undeletedNotes.filter(e=>!1!==e.derived.hasTask);return e.query.loggingName="undeletedHasTaskNotes",e}get regularNotes(){let e=this.undeletedNotes.filter(e=>!e.snapshot.daily);return e.query.loggingName="regularNotes",e}get regularNotesEditedDesc(){let e=this.regularNotes.sortBy(e=>{var n;return null!==(n=e.snapshot.editedAt)&&void 0!==n?n:e.snapshot.updatedAt},{order:"desc"});return e.query.loggingName="regularNotesEditedDesc",e}get regularNotesBacklinkedCountDesc(){let e=this.regularNotes.sort((e,n)=>n.snapshot.backlinkedCount-e.snapshot.backlinkedCount||n.snapshot.updatedAt-e.snapshot.updatedAt);return e.query.loggingName="regularNotesBacklinkedCountDesc",e}get notesEditedDesc(){let e=this.undeletedNotes.sortBy(e=>{var n;return null!==(n=e.snapshot.editedAt)&&void 0!==n?n:e.snapshot.updatedAt},{order:"desc"});return e.query.loggingName="notesEditedDesc",e}get notesCreatedDesc(){let e=this.undeletedNotes.sortBy(e=>e.snapshot.createdAt,{order:"desc"});return e.query.loggingName="notesCreatedDesc",e}get pinnedNotes(){let e=this.undeletedNotes.filter(e=>"number"==typeof e.snapshot.pinnedIndex);return e.query.loggingName="pinnedNotes",e}get pinnnedNotesIndexAsc(){let e=this.pinnedNotes.sortBy(e=>e.snapshot.pinnedIndex);return e.query.loggingName="pinnnedNotesIndexAsc",e}get regularNotesPinnedAscEditedDesc(){let e=this.regularNotes.refine(e=>j()(e,[e=>e.snapshot.pinnedIndex,e=>{var n;return null!==(n=e.snapshot.editedAt)&&void 0!==n?n:e.snapshot.updatedAt}],["asc","desc"]));return e.query.loggingName="regularNotesPinnedAscEditedDesc",e}get availableMergeNotes(){let e=this.notesEditedDesc.filter(e=>!!e.snapshot.subject);return e.query.loggingName="availableMergeNotes",e}get linkNotes(){return this.filterByTag(ec.mt)}findById(e){var n;return null===(n=this.allNotes.findById(e))||void 0===n?void 0:n.value}findBySubject(e){var n;return null===(n=this.undeletedNotes.find(n=>n.snapshot.subject===e))||void 0===n?void 0:n.value}matchSubject(e){return(0,J.KK)(this.notesEditedDesc,e).results}filterByTag(e){return this.notesEditedDesc.filter(n=>n.derived.tags.includes(e))}findByAsin(e){if(!e)return;let n=this.undeletedNotes.find(n=>n.derived.contentMetadata.asin===e);return null==n?void 0:n.value}findByUrl(e){var n;return null===(n=this.linkNotes.find(n=>n.derived.linkHrefs.includes(e)))||void 0===n?void 0:n.value}get notesWithPersonTag(){return this.filterByTag(ec._H)}get notesWithCompanyTag(){return this.filterByTag(ec.lw)}findPersonTagByEmail(e){var n;return null===(n=this.filterByTag(ec._H).find(n=>n.derived.emails.includes(e)))||void 0===n?void 0:n.value}findPersonTagBySubject(e){var n;return null===(n=this.filterByTag(ec._H).find(n=>n.snapshot.subject===e))||void 0===n?void 0:n.value}findAuthorTagBySubject(e){var n;return null===(n=this.filterByTag(ec.A3).find(n=>n.snapshot.subject===e))||void 0===n?void 0:n.value}findMeetingTagBySubject(e){var n;return null===(n=this.filterByTag(ec.O9).find(n=>n.snapshot.subject===e))||void 0===n?void 0:n.value}findByContact(e){for(let n of e.emailValues){let e=this.findPersonTagByEmail(n);if(e)return e}if(e.name){let n=this.findPersonTagBySubject(e.name);if(n)return n}}get dailyNotes(){return this.undeletedNotes.filter(e=>e.snapshot.daily)}hasNonEmptyNoteForDate(e){let n=(0,z.l5)(e),r=this.allNotes.query.find(e=>e.id===n);return!!r&&!r.derived.isBlank}findRandomNote(){var e,n;return null!==(n=null===(e=this.undeletedUnblankNotes.sample())||void 0===e?void 0:e.value)&&void 0!==n?n:void 0}isValidNoteId(e){let n=this.findById(e);return!!n}getMergeNotesForNote(e,n){let r=this.availableMergeNotes.filter(r=>!!n&&!!r.snapshot.subject&&r.snapshot.id!==e.id&&r.snapshot.subject.toLocaleLowerCase()===n.toLocaleLowerCase());return r.results.map(e=>({id:e.id,label:e.snapshot.subject}))}findOrCreateByContact(e){var n;let r=this.assertGraph.id,o=this.findByContact(e);return o||(null===(n=this.graph)||void 0===n||n.findOrCreateTag(ec._H),this.createNote({subject:e.name,document:(0,tb.FT)((0,t0.ct)(e,r))}))}setSyncedChanges(e){if(this.setHasSynced(!0),e){var n;let r=this.syncedAt;this.setSyncedAt(e),null===(n=this.graph)||void 0===n||n.logger.info("Setting last synced time to ".concat(e," (previously ").concat(r,")"))}}detachAllNotes(){this.assertTable.deleteAll()}async deleteNote(e){e.setDeletedAtDate(),e.disablePublic(),await e.changeManager.saveMeta()}async destroyNote(e){let n=e.id;this.assertAdapter.deleteModel(e),await (0,t_.f_)(this.assertGraph,n)}async batchDeleteNotes(e){await Promise.all(e.map(e=>this.deleteNote(e)))}async batchDestroyNotes(e){for(let n of e)this.assertAdapter.deleteModel(n);await (0,t_.Fx)(this.assertGraph,e.map(e=>e.id))}createNote(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{emptyList:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=tX.j.build(e,{emptyList:n});return this.assertAdapter.addModel(r),r.changeManager.create(),(0,tM.j)("note_created",{daily:r.daily}),r}findOrCreateBySubject(e){return this.findBySubject(e)||this.createNote({subject:e})}findOrCreateDailyNoteByDate(e){let n=this.ensureForDate(e);return n.changeManager.ensureExists(),n}async updatePinnedIndexes(e){await Promise.all(e.map((e,n)=>{let r=this.findById(e);return null==r?void 0:r.updatePinnedIndex(n)}))}async togglePinned(e){await e.updatePinned(!e.pinned)}async togglePublish(e){await e.togglePublic()}attachNote(e){let n=(0,p.G_R)(e);return n||this.assertAdapter.addModel(e),e}ensureTodaysDailyNote(){return this.ensureForDate(new Date)}ensureForDate(e){let n=(0,z.l5)(e),r=this.findById(n);if(r);else{var o;r=null!==(o=this.dailyStore.findGeneratedById(n))&&void 0!==o?o:this.buildForDate(e),this.assertAdapter.addModel(r)}return r}get noteDateFormat(){var e,n;return null!==(n=null===(e=this.rootStore)||void 0===e?void 0:e.preferenceStore.noteDateFormat)&&void 0!==n?n:"weekDayMonthYear"}buildForDate(e){let n=(0,z.l5)(e),r=(0,tf.p6)(e,this.noteDateFormat),o=(0,t0.Xq)(r,{emptyList:!1}),a=tX.j.build({id:n,document:(0,tb.FT)(o),subject:r,daily:!0},{placeholder:!0,emptyList:!0});return a}handleReconnect(){this.assertChangeStore.savePendingChanges(this.assertGraph)}createRecoveredNote(e){let{document:n,note:r}=e;if(!n)return!1;let o="Restored: ".concat(r.subject),a=(0,tb.hH)(n),i=(0,tZ.M_)(a,o),s=tX.j.build({subject:o,document:(0,tb.FT)(i)});return this.assertAdapter.addModel(s),s}constructor(...e){super(...e),this.mode="cache",this.hasSynced=!1,this.persistenceReady=!1,this.listeners=[],this.snapshotRestartInterval=null}};(0,d.gn)([u.observable],t$.prototype,"mode",void 0),(0,d.gn)([u.observable],t$.prototype,"hasSynced",void 0),(0,d.gn)([u.observable],t$.prototype,"persistenceReady",void 0),(0,d.gn)([u.action],t$.prototype,"setHasSynced",null),(0,d.gn)([u.action],t$.prototype,"setPersistenceReady",null),(0,d.gn)([u.action],t$.prototype,"setMode",null),(0,d.gn)([u.computed],t$.prototype,"allNotes",null),(0,d.gn)([u.computed],t$.prototype,"deletedNotes",null),(0,d.gn)([u.computed],t$.prototype,"deletedNotesDesc",null),(0,d.gn)([u.computed],t$.prototype,"deletedNotesEditedDesc",null),(0,d.gn)([u.computed],t$.prototype,"undeletedNotes",null),(0,d.gn)([u.computed],t$.prototype,"undeletedUnblankNotes",null),(0,d.gn)([u.computed],t$.prototype,"undeletedHasTaskNotes",null),(0,d.gn)([u.computed],t$.prototype,"regularNotes",null),(0,d.gn)([u.computed],t$.prototype,"regularNotesEditedDesc",null),(0,d.gn)([u.computed],t$.prototype,"regularNotesBacklinkedCountDesc",null),(0,d.gn)([u.computed],t$.prototype,"notesEditedDesc",null),(0,d.gn)([u.computed],t$.prototype,"notesCreatedDesc",null),(0,d.gn)([u.computed],t$.prototype,"pinnedNotes",null),(0,d.gn)([u.computed],t$.prototype,"pinnnedNotesIndexAsc",null),(0,d.gn)([u.computed],t$.prototype,"regularNotesPinnedAscEditedDesc",null),(0,d.gn)([u.computed],t$.prototype,"availableMergeNotes",null),(0,d.gn)([u.computed],t$.prototype,"linkNotes",null),(0,d.gn)([u.computed],t$.prototype,"notesWithPersonTag",null),(0,d.gn)([u.computed],t$.prototype,"notesWithCompanyTag",null),(0,d.gn)([u.computed],t$.prototype,"dailyNotes",null),(0,d.gn)([p.ZBq],t$.prototype,"deleteNote",null),(0,d.gn)([p.ZBq],t$.prototype,"createNote",null),t$=(0,d.gn)([(0,p.o4J)("NoteStore")],t$);var tX=r(25271),t0=r(24427),t1=r(59096),t2=r(23279),t3=r.n(t2),t9=r(69963);function generateListForBookNotes(e,n){let r=n.map(e=>[e.value,e.page?"(p".concat(e.page,")"):null].join(" "));return(0,t0.Mr)(e,r)}var t4=r(78557);let t5=RegExp("^https?:\\/\\/(?:[^.]+\\.)?(?:twitter|x)\\.com\\/(?:#!\\/)?(?<user_id>[\\w/]+)\\/status(?:es)?\\/(?<tweet_id>\\d+).*"),t8="Description:";function generateLinkDescriptionItem(e,n){return tb.K3.listItem(function(e,n){if(!e)return[tb.K3.paragraphText(t8)];let r=(0,tb.Y8)(e,n),o=(0,tb._u)(r);if(1===o.length&&o[0].type.name===tb.e3){let e=o[0],n=tb.K3.text(t8+" "),r=e.copy(e.content.addToStart(n));return[r,...o.slice(1)]}{let e=tb.K3.paragraphText(t8);return[e,...o]}}(null!=e?e:"",n))}let handleListAppend=async(e,n)=>{let r,{graph:o,logger:a,rootStore:i}=n,s=o.noteStore,l=i.contactStore,{text:c,list_name:d}=e.properties,u=e.properties.note_id;if(!c){a.warn("No text to append to list");return}let p=(0,z.cB)(u);if(!(r=p?s.ensureForDate(p):s.findById(u)))throw Error("Note ".concat(u," not found"));r.changeManager.ensureExists();let onBacklinkAdd=e=>(0,t4.V)({noteStore:s,contactStore:l,backlink:e,matchByLabel:!0}),onTagAdd=e=>o.onTagAdd(e);r.changeManager.modifyDocument(e=>(0,tZ.GQ)({node:e,listName:null!=d?d:void 0,text:c,onBacklinkAdd,onTagAdd}))},t6="readwise";function findOrCreateNotes(e,n){let r=n.noteStore;return e.map(e=>r.findOrCreateBySubject(e))}function normalizeTagsToBacklinkLabels(e){return e.map(e=>e.name.replace(/^#/,""))}let t7={"list-append":handleListAppend,"readwise-sync":(e,n)=>{var r,o;let{graph:a}=n;(0,tA.hu)("readwise-sync"===e.type);let i=a.noteStore,s=e.properties,l="readwise-".concat(s.id),c=null!==(o=null===(r=e.created_at)||void 0===r?void 0:r.toDate())&&void 0!==o?o:new Date,d=function(e){let{noteStore:n,noteId:r,syncItem:o,graph:a}=e,i=n.findById(r);if(!i&&o.asin&&(i=n.findByAsin(o.asin)),!i){let e=function(e,n){if(!e)return[];let r=e.split(",").map(e=>e.trim()),o=n.noteStore;return r.map(e=>{var r;let a=o.findAuthorTagBySubject(e);return a||o.createNote({subject:e,document:(r=n.id,tb.K3.doc([tb.K3.header(e),tb.K3.list([tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Type: "),tb.K3.tag({id:ec.A3,label:ec.A3,graphId:r})]))])])).toJSON()})})}(o.author,a),n=findOrCreateNotes(normalizeTagsToBacklinkLabels(o.tags),a),s=function(e){let{graphId:n,title:r,asin:o,readwiseUrl:a,category:i,documentNote:s,authorNotes:l,tagNotes:c}=e,d=function(e){let{graphId:n,category:r,tagNotes:o}=e,a=[tb.K3.tag({id:t6,label:t6,graphId:n})];switch(r){case"books":a.push(tb.K3.tag({id:ec.ps,label:ec.ps,graphId:n}));break;case"articles":a.push(tb.K3.tag({id:ec.c4,label:ec.c4,graphId:n}));break;case"tweets":a.push(tb.K3.tag({id:ec.R0,label:ec.R0,graphId:n}));break;case"podcasts":a.push(tb.K3.tag({id:ec.UC,label:ec.UC,graphId:n}))}for(let e of o)a.push(tb.K3.backlink({id:e.id,label:e.subject,graphId:n}));for(let e=a.length-1;e>0;e--)a.splice(e,0,tb.K3.text(" "));return a}({graphId:n,category:i,tagNotes:c}),u=function(e){let{graphId:n,authorNotes:r}=e,o=r.reduce((e,o,a)=>{let i=a===r.length-1;return i?[...e,tb.K3.backlink({id:o.id,label:o.subject,graphId:n})]:[...e,tb.K3.backlink({id:o.id,label:o.subject,graphId:n}),tb.K3.text(", ")]},[]);return o}({graphId:n,authorNotes:l});return tb.K3.doc([tb.K3.header(null!=r?r:""),tb.K3.list([tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Type: "),...d])),a?tb.K3.listItem(tb.K3.paragraph([tb.K3.text("URL: "),tb.K3.link(a,a)])):null,o?tb.K3.listItem(tb.K3.paragraph([tb.K3.text("ASIN: "),tb.K3.text(o)])):null,u.length>0?tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Author: "),...u])):null,s?tb.K3.listItem(tb.K3.paragraph([tb.K3.text(s)])):null].filter(tw.Dw))])}({graphId:a.id,title:o.title,asin:o.asin,source:o.source,readwiseUrl:o.readwise_url,category:o.category,documentNote:o.document_note,authorNotes:e,tagNotes:n});i=tX.j.build({id:r,subject:o.title,document:s.toJSON()})}return i.noteStore||(n.assertAdapter.addModel(i),i.changeManager.create()),i}({noteStore:i,noteId:l,syncItem:s,graph:a});(function(e){let{note:n,syncItem:r,graph:o}=e,a=r.highlights.map(e=>({...e,notes:findOrCreateNotes(normalizeTagsToBacklinkLabels(e.tags),o)}));n.changeManager.modifyDocument(e=>(function(e){let{node:n,highlights:r,graphId:o}=e,a=(0,tb.Ne)(n,e=>{(function(e){let{ctx:n,listName:r,highlights:o,graphId:a}=e,i=function(e){let n=(0,tb.nv)(e),r=n.filter(e=>e.startsWith("https://readwise.io/open/")),o=r.map(e=>e.split("/").pop()).filter(tw.Dw);return o}(n.tr.doc),s=o.filter(e=>!i.includes(e.id));(0,tb.WJ)(n,r),(0,tb.tW)(n,r,s.map(e=>(function(e,n){var r;let o=function(e){let n=[];return(0,tb.Y8)(e).descendants(e=>{if(e.isTextblock)return n.push(e),!1}),0===n.length&&n.push(tb.K3.paragraph([])),[tb.e3,tb.tw].includes(n[0].type.name)||(n[0]=tb.K3.paragraph(n[0].content)),n}(e.text),a=o[o.length-1],i=tb.K3.link(["Loc",e.location].filter(tw.Dw).join(" "),e.readwise_url),s=(null!==(r=e.notes)&&void 0!==r?r:[]).map(e=>tb.K3.backlink({id:e.id,label:e.subject,graphId:n}));for(let e=s.length-1;e>0;e--)s.splice(e,0,tb.K3.text(" "));if(s.length>0&&s.unshift(tb.K3.text(" ")),a.type.name===tb.e3){let e=tb.K3.paragraph([tb.K3.text(" ["),i,tb.K3.text("]"),...s]),n=a.copy(a.content.append(e.content));o[o.length-1]=n}else{let e=tb.K3.paragraph([tb.K3.text("["),i,tb.K3.text("]"),...s]);o.push(e)}return e.note&&o.push(tb.K3.listItem(tb.K3.paragraphText(e.note))),tb.K3.listItem(o)})(e,a)))})({ctx:e,highlights:r,listName:"Highlights",graphId:o})});return a})({node:e,highlights:a,graphId:o.id}))})({note:d,syncItem:s,graph:a}),function(e){let{syncItem:n,noteStore:r,note:o,operationCreatedAt:a}=e,i=function(e){switch(e){case"books":return"Books";case"articles":return"Articles";case"tweets":return"Tweets";case"podcasts":return"Podcasts";default:return"Readwise"}}(n.category),s=r.ensureForDate(a);s.changeManager.modifyDocument(e=>(function(e,n,r){let o={id:n.id,label:n.subject,graphId:n.graphId};return(0,tb.Ne)(e,e=>{let n=tb.K3.listItem(tb.K3.paragraph([tb.K3.backlink(o)]));(0,tb.kv)(e,r,[n],{position:"top"})})})(e,o,i))}({syncItem:s,noteStore:i,note:d,operationCreatedAt:c}),function(e){let n=[t6,ec.ps,ec.c4,ec.UC,ec.R0];for(let r of n)e.findOrCreateTag(r)}(a)},"link-create":(e,n)=>{var r,o,a,i;let{graph:s,logger:l,rootStore:c}=n,{link:d}=e.properties,u=null!==(o=null===(r=e.created_at)||void 0===r?void 0:r.toDate())&&void 0!==o?o:new Date;if(l.info("Syncing link",{link:d}),!d.url){l.warn("Link without URL",{link:d});return}!function(e){var n,r,o,a;t5.lastIndex=0;let i=t5.exec(e);if(!i)return null;let s=null!==(o=null===(n=i.groups)||void 0===n?void 0:n.tweet_id)&&void 0!==o?o:"",l=null!==(a=null===(r=i.groups)||void 0===r?void 0:r.user_id)&&void 0!==a?a:"";return s?{tweetId:s,userId:l}:null}(d.url)||(null===(a=d.highlights)||void 0===a?void 0:a.length)||(null===(i=d.offset_highlights)||void 0===i?void 0:i.length)||d.description?function(e,n,r,o){var a,i,s,l,c,d;let u=e.noteStore,p=n.contactStore,onBacklinkAdd=e=>(0,t4.V)({noteStore:u,contactStore:p,backlink:e,matchByLabel:!0}),h={onBacklinkAdd,onTagAdd:n=>e.onTagAdd(n)},g=(0,tb.FT)((c=e.id,tb.K3.doc([tb.K3.header(null!==(d=r.title)&&void 0!==d?d:""),function(e,n,r){var o,a,i;let s=[...(null!==(o=e.offset_highlights)&&void 0!==o?o:[]).map(e=>e.text),...null!==(a=e.highlights)&&void 0!==a?a:[]];return tb.K3.list([tb.K3.listItem(tb.K3.paragraph([tb.K3.text("URL: "),tb.K3.link(e.url,e.url)])),generateLinkDescriptionItem(null!==(i=e.description)&&void 0!==i?i:"",r),tb.K3.listItem([tb.K3.paragraph([tb.K3.text("Type: "),tb.K3.tag({id:ec.mt,label:ec.mt,graphId:n})])]),(0,t0.Mr)("Highlights",s)])}(r,c,h)]))),m="link-".concat(null!==(a=r.id)&&void 0!==a?a:(0,_.O)()),y=u.findById(m)||u.findByUrl(r.url)||tX.j.build({id:m,subject:null!==(i=r.title)&&void 0!==i?i:function(e){try{return new URL(e).hostname}catch(e){return null}}(r.url),document:g});y.noteStore||(u.assertAdapter.addModel(y),y.changeManager.create());let f=[...(null!==(s=r.offset_highlights)&&void 0!==s?s:[]).map(e=>e.text),...null!==(l=r.highlights)&&void 0!==l?l:[]];y.changeManager.modifyDocument(e=>(function(e,n){let r=tb.K3.paragraphText("Highlights").content,o=(0,t0.Jr)(n);return(0,tb.Ne)(e,e=>{(0,tb.DA)(e,r,o)})})(e,f)),y.changeManager.modifyDocument(e=>{var n,o;return(o=null!==(n=r.description)&&void 0!==n?n:"")?(0,tb.Ne)(e,e=>{(0,tb.lW)(e,t8,generateLinkDescriptionItem(null!=o?o:"",h))}):e});let v=u.ensureForDate(o);v.changeManager.modifyDocument(e=>(function(e){let{document:n,linkNote:r,onBacklinkAdd:o}=e,a={id:r.id,label:r.subject,graphId:r.graphId};return(0,tb.Ne)(n,e=>{let n=o({id:"",label:"Links"}),r=tb.K3.paragraph(tb.K3.backlink(n)).content,i=tb.K3.listItem(tb.K3.paragraph([tb.K3.backlink(a)]));(0,tb.DA)(e,r,[i],{position:"top"})})})({document:e,linkNote:y,onBacklinkAdd})),function(e){e.findOrCreateTag(ec.mt)}(e)}(s,c,d,u):function(e){let{graph:n,link:r,operationCreatedAt:o}=e,a=n.noteStore,i=a.assertRootStore,s=i.contactStore,onBacklinkAdd=e=>(0,t4.V)({noteStore:a,contactStore:s,backlink:e,matchByLabel:!0}),l=a.ensureForDate(o);l.changeManager.modifyDocument(e=>(function(e){let{document:n,tweetUrl:r,onBacklinkAdd:o}=e;return(0,tb.Ne)(n,e=>{let n=o({id:"",label:"Tweets"}),a=tb.K3.paragraph(tb.K3.backlink(n)).content,i=tb.K3.tweet({url:r}),s=tb.K3.listItem([i]);(0,tb.DA)(e,a,[s],{position:"top"})})})({document:e,tweetUrl:r.url,onBacklinkAdd}))}({graph:s,link:d,operationCreatedAt:u})},"book-sync":(e,n)=>{var r;let{graph:o}=n,a=o.noteStore,{book:i}=e.properties;if(!a)return;console.log("[".concat(o.id,"] syncing book"),i);let s=(null!==(r=i.authors)&&void 0!==r?r:[]).map(e=>{var n;let r=a.findAuthorTagBySubject(e);return r||a.createNote({subject:e,document:(0,tb.FT)((n=o.id,tb.K3.doc([tb.K3.header(e),tb.K3.list([tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Type: "),tb.K3.tag({id:ec.A3,label:ec.A3,graphId:n})]))])])))})}),l=a.findByAsin(i.asin)||tX.j.build({id:(0,_.O)(),subject:i.title,document:(0,tb.FT)(function(e){let{book:n,authorNotes:r,graphId:o}=e,a=n.notes.filter(e=>{let{type:n}=e;return"highlight"===n}),i=n.notes.filter(e=>{let{type:n}=e;return"note"===n}),s=n.authors.reduce((e,o,a)=>{let i=a===n.authors.length-1,s=r.find(e=>e.subject===o);return i?[...e,tb.K3.backlink({id:s.id,label:o})]:[...e,tb.K3.backlink({id:s.id,label:o}),tb.K3.text(", ")]},[]);return tb.K3.doc([tb.K3.header(n.title),tb.K3.list([tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Type: "),tb.K3.tag({id:ec.ps,label:ec.ps,graphId:o})])),tb.K3.listItem(tb.K3.paragraphText("ASIN: ".concat(n.asin))),tb.K3.listItem(tb.K3.paragraph([tb.K3.text("Authors: "),...s])),generateListForBookNotes("Highlights",a),generateListForBookNotes("Notes",i)])])}({book:i,authorNotes:s,graphId:o.id}))});l.noteStore||(a.assertAdapter.addModel(l),l.changeManager.create()),l.changeManager.modifyDocument(e=>{var n;return function(e,n){let r=n.filter(e=>"highlight"===e.type).map(e=>[e.value,e.page?"(p".concat(e.page,")"):null].join(" ")),o=n.filter(e=>"note"===e.type).map(e=>[e.value,e.page?"(p".concat(e.page,")"):null].join(" ")),a=(0,tb.Ne)(e,e=>{(0,tb.n8)(e,"Highlights",r),(0,tb.n8)(e,"Notes",o)});return a}(e,null!==(n=i.notes)&&void 0!==n?n:[])}),function(e){e.findOrCreateTag(ec.ps)}(o)}};var et=r(39828);async function queryPendingOperations(e){let n=(0,y.CF)({db:f.db,graphId:e.graphId}),r=(0,y.IO)(n,(0,y.ZB)("synced_at","==",null),(0,y.b9)(e.limit)),o=await (0,y.PL)(r),a=o.docs.map(e=>({...e.data(),id:e.id}));return a}async function destroyOperation(e){let{graphId:n,operationId:r}=e,o=(0,y._J)({db:f.db,graphId:n,noteOperationId:r});await (0,y.oe)(o)}async function obtainOperationSyncLock(e){let{operationIds:n,graphId:r,logger:o}=e,a=n.map(e=>(0,y._J)({db:f.db,graphId:r,noteOperationId:e})),i=await v.RZ.runTransaction(f.db,async e=>{let n=[];for(let r of a){let a=await e.get(r);if(!a.exists())continue;let i=a.data();if(!i.synced_at){if(!t7[i.type]){let e="object"==typeof i?{...i,properties:"hidden_"+typeof i.properties}:typeof i;i.type||o.warn("No callback for operation ".concat(r.id," ").concat(JSON.stringify(e)));continue}n.push(r)}}for(let r of n)e.update(r,{synced_at:et.Timestamp.now()});return n.map(e=>e.id)});return i}async function syncOperations(e){for(let n=0;n<50;n++){let n=await queryPendingOperations({graphId:e.id,limit:10});if(0===n.length||(await syncOperationChunk(e,n),n.length<10))break}}async function syncOperationChunk(e,n){let r;let o=e.id,a=e.assertRootStore,i=n.map(e=>e.id);if(0===i.length)return;let s=e.logger.child({operationIds:i.join(",")});s.info("Syncing operation");try{r=await obtainOperationSyncLock({graphId:o,operationIds:i,logger:s})}catch(e){s.info("Failed to obtain sync lock for operation",{reason:null==e?void 0:e.message});return}for(let i of(s.info("Obtained sync lock for operation"),n))if(r.includes(i.id))try{let n=t7[i.type];await n(i,{graph:e,logger:s,rootStore:a}),s.info("Successfully synced operation"),await destroyOperation({graphId:o,operationId:i.id})}catch(e){s.error("Failed to sync operation",{reason:null==e?void 0:e.message}),(0,t9.Tb)(e)}}let ee=class extends(0,p.Hnr)({}){get graph(){return(0,m.w0)(this)}onAttachedToRootStore(){let e=this.graph;return this.listeners.push((0,u.when)(()=>e.storesReadyAndNotesOnline,()=>{this.listeners.push(function(e){let n,r;let syncGraphOperations=async()=>await syncOperations(e),o=t3()((n=!1,r=!1,async()=>{if(r=!0,!n)for(n=!0;r;){r=!1;try{await syncGraphOperations()}catch(e){throw e}finally{n=!1}}}),5e3);return function(e,n,r){let o=(0,y.CF)({db:f.db,graphId:e}),a=(0,y.IO)(o,(0,y.ZB)("synced_at","==",null),(0,y.b9)(1));return v.RZ.onSnapshot(a,n,e=>{(0,t9.Tb)(e),r.error("Error in operation snapshot listener: ".concat(e.message))})}(e.id,()=>void o(),e.logger)}(e))})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};ee=(0,d.gn)([(0,p.o4J)("OperationStore")],ee),(o=s||(s={})).Monday="Monday",o.Sunday="Sunday",(a=l||(l={})).DayMonthYear="dayMonthYear",a.MonthDayYear="monthDayYear",(i=c||(c={})).Hours12="12",i.Hours24="24";let en=class extends(0,p.Hnr)({dateFormat:(0,p.vgT)(()=>l.MonthDayYear).withSetter(),downloadPrompt:(0,p.vgT)(!0).withSetter(),labs:(0,p.vgT)(!1).withSetter(),shortcutPrompt:(0,p.vgT)(!0).withSetter(),spellCheck:(0,p.vgT)(!0).withSetter(),theme:(0,p.vgT)("system").withSetter(),timeFormat:(0,p.vgT)(()=>c.Hours12).withSetter(),transcriptionPrompt:(0,p.vgT)("").withSetter(),weekStart:(0,p.vgT)(()=>s.Monday).withSetter(),openaiApiKeyExcerpt:(0,p.vgT)("").withSetter(),transcriptionLanguage:(0,p.vgT)("auto").withSetter(),editorSize:(0,p.vgT)("sm").withSetter(),hasSynced:(0,p.vgT)(!1).withSetter()}){get rootStore(){return(0,p.G_R)(this)}get selectedGraph(){var e;if(this.selectedGraphId)return null===(e=this.rootStore)||void 0===e?void 0:e.graphStore.findById(this.selectedGraphId)}get noteDateFormat(){return(0,tf.$X)(this.dateFormat)}get openaiApiKeyWithFallback(){return this.openaiApiKey||this.openaiApiKeyExcerptFormatted}get openaiApiKeyExcerptFormatted(){return this.openaiApiKeyExcerpt?"sk-".concat("****-".repeat(3)).concat(this.openaiApiKeyExcerpt):""}setOpenaiApiKey(e){this.openaiApiKey=e}setScreen(e){this.screen=e}setSelectedGraph(e){this.selectedGraphId=e.id}setSelectedGraphId(e){this.selectedGraphId=e}hideDownloadPrompt(){this.downloadPrompt=!1}hideShortcutPrompt(){this.shortcutPrompt=!1}updateDateFormat(e){this.setDateFormat(e),(0,tr.Oh)({dateFormat:e})}updateWeekStart(e){this.setWeekStart(e),(0,tr.Oh)({weekStart:e})}updateTimeFormat(e){this.setTimeFormat(e),(0,tr.Oh)({timeFormat:e})}updateSpellCheck(e){this.setSpellCheck(e),(0,tr.Oh)({spellCheck:e})}updateLabs(e){this.setLabs(e),(0,tr.Oh)({labs:e})}updateTranscriptionPrompt(e){this.setTranscriptionPrompt(e),(0,tr.Oh)({transcriptionPrompt:e})}updateOpenaiApiKey(e){this.setOpenaiApiKey(e),this.setOpenaiApiKeyExcerpt(e.slice(-4)),(0,tr.mD)({openaiApiKey:e})}updateTranscriptionLanguage(e){this.setTranscriptionLanguage(e),(0,tr.Oh)({transcriptionLanguage:e})}setPreferences(e){e.timeFormat&&this.setTimeFormat(e.timeFormat),e.dateFormat&&this.setDateFormat(e.dateFormat),e.weekStart&&this.setWeekStart(e.weekStart),"boolean"==typeof e.spellCheck&&this.setSpellCheck(e.spellCheck),"boolean"==typeof e.labs&&this.setLabs(e.labs),"string"==typeof e.transcriptionPrompt&&this.setTranscriptionPrompt(e.transcriptionPrompt),"string"==typeof e.transcriptionLanguage&&this.setTranscriptionLanguage(e.transcriptionLanguage),"string"==typeof e.openaiApiKeyExcerpt&&this.setOpenaiApiKeyExcerpt(e.openaiApiKeyExcerpt),this.setHasSynced(!0)}onAttachedToRootStore(){return this.listeners.push((0,tr.Mo)(e=>{this.setPreferences(e.preferences)})),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.screen=Y.JY.Profile,this.selectedGraphId=null,this.openaiApiKey="",this.listeners=[]}};(0,d.gn)([u.observable],en.prototype,"screen",void 0),(0,d.gn)([u.observable],en.prototype,"selectedGraphId",void 0),(0,d.gn)([u.observable],en.prototype,"openaiApiKey",void 0),(0,d.gn)([u.computed],en.prototype,"noteDateFormat",null),(0,d.gn)([u.action],en.prototype,"setOpenaiApiKey",null),(0,d.gn)([u.action],en.prototype,"setScreen",null),(0,d.gn)([u.action],en.prototype,"setSelectedGraph",null),(0,d.gn)([u.action],en.prototype,"setSelectedGraphId",null),(0,d.gn)([p.ZBq],en.prototype,"hideDownloadPrompt",null),(0,d.gn)([p.ZBq],en.prototype,"hideShortcutPrompt",null),en=(0,d.gn)([(0,p.o4J)("PreferenceStore")],en);var er=r(54851);let eo=class extends(0,p.Hnr)({id:p.UB4,label:(0,p.vgT)("").withSetter(),template:(0,p.vgT)("").withSetter()}){};eo=(0,d.gn)([(0,p.o4J)("PromptTemplate")],eo);let ea=class extends(0,p.Hnr)({templates:(0,p.vgT)(()=>[])}){setTemplates(e){this.templates=e}setTemplatesFromDb(e){let n=e.map(e=>new eo(e));this.setTemplates(n)}onAttachedToRootStore(){return this.listeners.push((0,er.ln)(e=>this.setTemplatesFromDb(e))),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};function docFromNoteRowOrPool(e){let{row:n,adapter:r}=e,o=r.pool.get(n.id);if(o){let e=o.editedDocumentNode,n=e?(0,tb.kB)(e):"",r=e?(0,tb.Oj)(e):"";return{id:o.id,subject:n,line:r,enrichmentText:(0,J.a1)(o.enrichment),editedAt:o.editedOrUpdatedAt}}{var a,i,s,l;let e=null===(i=n.snapshot.systemMetadata)||void 0===i?void 0:null===(a=i.data)||void 0===a?void 0:a.enrichment,r=(0,J.a1)(e),o=null===(s=n.snapshot.document)||void 0===s?void 0:s.data,c=o?(0,tb.nM)(o):"";return{id:n.id,subject:n.snapshot.subject,line:c,enrichmentText:r,editedAt:null!==(l=n.snapshot.editedAt)&&void 0!==l?l:n.snapshot.updatedAt}}}function isValidIndexingRow(e){let n=!e.snapshot.subject&&e.derived.isBlank;return!e.snapshot.deletedAt&&!n}(0,d.gn)([p.ZBq],ea.prototype,"setTemplates",null),ea=(0,d.gn)([(0,p.o4J)("PromptTemplateStore")],ea);var ei=r(67294);let es=(0,ei.createContext)(void 0),el=es.Provider;function useRootStore(){let e=(0,ei.useContext)(es);if(!e)throw Error("useRootStore must be used within a RootStoreProvider");return e}function useNoteStore(){let{noteStore:e}=useRootStore();if(!e)throw Error("blank noteStore");return e}function useBacklinkStore(){let e=useNoteStore();return e.backlinkStore}function useUserStore(){let{userStore:e}=useRootStore();return e}function useCurrentUser(){let{userStore:e}=useRootStore();return e.currentUser}function useCurrentGraph(){let{graphStore:e}=useRootStore(),n=e.currentGraph;if(!n)throw Error("blank graph");return n}function useContactStore(){let{contactStore:e}=useRootStore();return e}function usePreferenceStore(){let{preferenceStore:e}=useRootStore();return e}function useMaybePreferenceStore(){var e;let{preferenceStore:n}=null!==(e=function(){let e=(0,ei.useContext)(es);return null!=e?e:null}())&&void 0!==e?e:{};return null!=n?n:null}function useCredentialStore(){let{credentialStore:e}=useRootStore();return e}function useGraphStore(){let{graphStore:e}=useRootStore();return e}function useBookStore(){let{bookStore:e}=useRootStore();if(!e)throw Error("blank bookStore");return e}function useMeetingStore(){let{meetingStore:e}=useRootStore();return e}function usePromptTemplateStore(){let{promptTemplateStore:e}=useRootStore();return e}function useDailyEditorView(){let{dailyEditorView:e}=useNoteStore();return e}function usePrimaryEditorView(){let{primaryEditorView:e}=useNoteStore();return e}function useSecondaryEditorView(){let{secondaryEditorView:e}=useNoteStore();return e}function useMainView(){let{mainView:e}=useRootStore();return e}function useUiStateStore(){let{uiStateStore:e}=useRootStore();return e}r(22255);var ec=r(11563),ed=r(622),eu=r(47638);let ep=class extends(0,p.Hnr)({id:p.UB4,name:(0,p.vgT)("").withSetter(),document:(0,p.vgT)().withTransform((0,eu.N)()).withSetter(),createdAt:(0,p.vgT)(()=>new Date().getTime())}){get contentTemplate(){var e;return{id:this.id,name:this.name,document:null!==(e=this.document)&&void 0!==e?e:{type:"doc"}}}get assertStore(){let e=(0,m.w0)(this);return(0,m.w0)(e)}async setRemote(){return await (0,ed.zX)(this.assertGraph,this)}async destroy(){await this.assertStore.destroyTemplate(this)}get assertGraph(){return this.assertStore.assertGraph}};(0,d.gn)([u.computed],ep.prototype,"contentTemplate",null),ep=(0,d.gn)([(0,p.o4J)("Template")],ep);let eh=class extends(0,p.Hnr)({templates:(0,p.vgT)(()=>[])}){get contentTemplates(){return this.templatesSortedByNameAsc.filter(e=>e.name).map(e=>e.contentTemplate)}get templatesSortedByNameAsc(){return j()(this.templates,e=>e.name,"asc")}get templatesSortedByCreatedAtDesc(){return j()(this.templates,e=>e.createdAt,"desc")}addBlankTemplate(){this.templates.push(new ep({}))}addTemplate(e){this.templates.push(e)}setTemplates(e){this.templates=e}async reEncryptTemplates(){await (0,ed.OG)(this.assertGraph,this.templates)}async destroyTemplate(e){(0,p.ogt)(e),await (0,ed.Xc)(this.assertGraph,e.id)}get graph(){return(0,p.G_R)(this)}get assertGraph(){return(0,m.wi)(this,"graph")}onAttachedToRootStore(){let e=(0,u.autorun)(()=>{var n;(null===(n=this.graph)||void 0===n?void 0:n.readyToInitStores)&&(this.listeners.push((0,ed.ij)(this.assertGraph,e=>this.setTemplates(e))),e())});return this.listeners.push(e),()=>this.beforeDetach()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};(0,d.gn)([u.computed],eh.prototype,"contentTemplates",null),(0,d.gn)([u.computed],eh.prototype,"templatesSortedByNameAsc",null),(0,d.gn)([u.computed],eh.prototype,"templatesSortedByCreatedAtDesc",null),(0,d.gn)([p.ZBq],eh.prototype,"addBlankTemplate",null),(0,d.gn)([p.ZBq],eh.prototype,"addTemplate",null),(0,d.gn)([p.ZBq],eh.prototype,"setTemplates",null),eh=(0,d.gn)([(0,p.o4J)("TemplateStore")],eh);let eg=class extends(0,p.Hnr)({currentUser:(0,p.vgT)(null),authUserReceived:(0,p.vgT)(!1),authUserUID:(0,p.vgT)(null)},{toSnapshotProcessor:e=>{let{currentUser:n}=e;return{currentUser:n}}}){get needsAuth(){return!this.authUserUID&&this.authUserReceived}get signedIn(){return!this.needsAuth}setCurrentUser(e){this.currentUser=e}setAuthUser(e){var n;this.authUserUID=null!==(n=null==e?void 0:e.uid)&&void 0!==n?n:null,this.authUserReceived=!0}reset(){this.authUserUID=null}onAttachedToRootStore(){return this.listeners.push((0,tg.Aj)(async e=>{this.setAuthUser(e),await this.syncUserToCapacitor(e)}),(0,tr.Mo)(e=>{this.setCurrentUser(e)})),()=>this.beforeDetach()}async syncUserToCapacitor(e){if(e){let n=await e.getIdToken();tn.setUser({userId:e.uid,idToken:n})}else tn.clearUser()}beforeDetach(){return(0,g.$)(this.listeners)}constructor(...e){super(...e),this.listeners=[]}};(0,d.gn)([u.computed],eg.prototype,"needsAuth",null),(0,d.gn)([u.computed],eg.prototype,"signedIn",null),(0,d.gn)([p.ZBq],eg.prototype,"setCurrentUser",null),(0,d.gn)([p.ZBq],eg.prototype,"setAuthUser",null),(0,d.gn)([p.ZBq],eg.prototype,"reset",null),eg=(0,d.gn)([(0,p.o4J)("UserStore")],eg);var em=r(67803),ey=r(88734),ef=r(15562);let ev=class extends(0,p.Hnr)({id:p.UB4,name:(0,p.vgT)(),email:(0,p.vgT)(),photoUrl:(0,p.vgT)(),graphIds:(0,p.vgT)(()=>[]),ready:(0,p.vgT)(!1),traits:(0,p.vgT)(()=>({})),preferences:(0,p.vgT)(()=>({})),stripeSubscriptionId:(0,p.vgT)(),stripeSubscriptionProductId:(0,p.vgT)(),stripeSubscriptionStatus:(0,p.vgT)(),trialLengthDays:(0,p.vgT)(),trialStartedAt:(0,p.vgT)()}){get givenName(){if(!this.name)return;let[e]=this.name.split(/\s/,2);return e}get familyName(){if(!this.name)return;let[,e]=this.name.split(/\s/,2);return e}get initials(){if(this.givenName&&this.familyName)return"".concat(this.givenName[0]).concat(this.familyName[0]).toUpperCase()}get isPayingCustomer(){return!!this.stripeSubscriptionId}get inGoodStanding(){return"trialing"===this.subscriptionStatus||"active"===this.subscriptionStatus||"paymentRequired"===this.subscriptionStatus}get subscriptionStatus(){if(this.trialInGoodStanding)return"trialing";switch(this.stripeSubscriptionStatus){case ef.u.Trialing:return"trialing";case ef.u.Active:return"active";case ef.u.PastDue:case ef.u.Incomplete:return"paymentRequired";default:return"missing"}}get isTrialing(){return!this.stripeSubscriptionId&&!!this.trialStartedAt}get trialDaysSpent(){return this.trialStartedAt?Math.abs((0,em.Z)((0,ey.zO)(),this.trialStartedAt)):0}get trialDaysLeft(){var e;let n=(null!==(e=this.trialLengthDays)&&void 0!==e?e:0)-this.trialDaysSpent;return n<0?0:n}get trialInGoodStanding(){return!!this.trialStartedAt&&this.trialDaysLeft>0}async updatePhoto(e){let n=URL.createObjectURL(e);this.setPhotoUrl(n),await (0,tr.tU)(this.id,e)}async updateTraits(e){this.traits={...this.traits,...e},await (0,tr.CG)(this.id,e)}setPhotoUrl(e){this.photoUrl=e}async setName(e){this.name=e,await (0,tr.gh)(e)}};(0,d.gn)([u.computed],ev.prototype,"givenName",null),(0,d.gn)([u.computed],ev.prototype,"familyName",null),(0,d.gn)([u.computed],ev.prototype,"initials",null),(0,d.gn)([u.computed],ev.prototype,"trialDaysSpent",null),(0,d.gn)([u.computed],ev.prototype,"trialDaysLeft",null),(0,d.gn)([u.computed],ev.prototype,"trialInGoodStanding",null),(0,d.gn)([p.ZBq],ev.prototype,"updateTraits",null),(0,d.gn)([p.ZBq],ev.prototype,"setPhotoUrl",null),(0,d.gn)([p.ZBq],ev.prototype,"setName",null),ev=(0,d.gn)([(0,p.o4J)("User")],ev)},90783:function(e,n,r){"use strict";r.d(n,{v:function(){return v}});var o=r(97582),a=r(23279),i=r.n(a),s=r(69579),l=r.n(s),c=r(68949),d=r(53699),u=r(28418),p=r(60381);async function mergeNotes(e){var n;let{noteStore:r,fromNote:o,toNote:a}=e,i=r.allNotes.filter(e=>e.derived.backlinkIds.includes(o.id)),s=i.models;for(let e of s)(0,p.Dh)(e,o.id,a.id);a.mergeDocument(null!==(n=o.editedDocumentNode)&&void 0!==n?n:(0,u.Tw)()),await r.destroyNote(o)}var h=r(540),g=r(14066),m=r(88766),y=r(44915),f=r(40328);let v=class extends(0,d.Hnr)({}){get semiScreen(){return this.semiScreenUser||this.semiScreenMedia}setSemiScreenUser(e){this.semiScreenUser=e}setSemiScreenMedia(e){this.semiScreenMedia=e}addTypingMeasurement(e){this.typingMeasurements=l()([...this.typingMeasurements,e],300)}focusLastEditor(){var e;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.focusEditor(null!==(e=this.lastActiveEditor)&&void 0!==e?e:"primary",n)}focusPrimary(){this.setActiveEditor("primary")}focusSecondary(){this.assertSecondaryEditorView.hasSelectedNote&&this.setActiveEditor("secondary")}focusEditor(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{skipIfCapacitor:r=!1}=n;r&&(0,m.W)()||this.setActiveEditor(e)}setActiveEditor(e){this.activeEditor=e,null!==e&&(this.lastActiveEditor=e)}handleFocus(e){this.updateFocusDebounce(e,!0)}handleBlur(e){e.note===e.editorView.selectedNote&&(e.editorView.selectionView.updateCursor(e),this.updateFocusDebounce(e,!1))}updateFocus(e,n){n?this.setFocused(e):this.setBlurred(e)}setFocused(e){let{editorView:n,note:r}=e;this.setActiveEditor(n.role),n instanceof u.PM&&n.setSelectedNote(r,{scroll:!1})}setBlurred(e){this.setActiveEditor(null)}get rootStore(){return(0,d.k0l)(this)}get noteStore(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.noteStore}get assertNoteStore(){return(0,y.wi)(this,"noteStore")}get assertDailyEditorView(){return this.assertNoteStore.dailyEditorView}get assertPrimaryEditorView(){return this.assertNoteStore.primaryEditorView}get assertSecondaryEditorView(){return this.assertNoteStore.secondaryEditorView}get dailyEditorView(){var e;return null===(e=this.noteStore)||void 0===e?void 0:e.dailyEditorView}get primaryEditorView(){var e;return null===(e=this.noteStore)||void 0===e?void 0:e.primaryEditorView}get searchModalIsOpen(){return this.modal===h.xr.Search}get shortcutsModalIsOpen(){return this.modal===h.xr.Shortcuts}screenIsActive(e){return this.screen===e}screenHasFocus(e){return!this.modal&&this.screenIsActive(e)}get screenIsEditOrDaily(){return[h.oK.NoteDaily,h.oK.NoteEdit].includes(this.screen)}get tasksHasFocus(){return this.screenHasFocus(h.oK.TaskList)}get noteHasFocus(){return this.screenHasFocus(h.oK.NoteDaily)||this.screenHasFocus(h.oK.NoteEdit)}closeModal(){this.modal=null,this.activeEditor||this.focusLastEditor({skipIfCapacitor:!0})}closeSearchModal(){this.searchModalIsOpen&&this.closeModal()}openShortcutsModal(){this.openModal(h.xr.Shortcuts)}toggleShortcutsModal(){this.shortcutsModalIsOpen?this.closeModal():this.openShortcutsModal()}openSearchModal(){this.openModal(h.xr.Search)}toggleSearchModal(){this.searchModalIsOpen?this.closeModal():this.openSearchModal()}openModal(e){this.activeEditor=null,this.modal=e}toggleSemiScreen(){this.semiScreenUser=!this.semiScreenUser}setScreen(e){this.screen=e}openListScreen(){this.setScreen(h.oK.NoteList),this.screen===h.oK.NoteList?this.assertNoteStore.listView.clearQuery():this.openListScreen(),this.assertNoteStore.secondaryEditorView.setSelectedNote(null)}openMapScreen(){this.setScreen(h.oK.Map)}openNoteDailyScreen(){this.screen===h.oK.NoteDaily?this.assertNoteStore.dailyEditorView.selectToday():this.setScreen(h.oK.NoteDaily),this.assertNoteStore.secondaryEditorView.setSelectedNote(null),this.focusEditor("primary",{skipIfCapacitor:!0})}openTodaysNoteDailyScreen(){this.assertNoteStore.dailyEditorView.selectToday(),this.setScreen(h.oK.NoteDaily),this.focusEditor("primary",{skipIfCapacitor:!0})}ensureSelectedNote(){this.selectedNote||this.assertDailyEditorView.selectToday()}setSelectedNote(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(null==e?void 0:e.daily)?this.assertDailyEditorView.setSelectedDate(e.dailyOrCreatedDate,n):this.assertPrimaryEditorView.setSelectedNote(e,n)}get selectedNote(){let{noteStore:e}=this;return this.screen===h.oK.NoteDaily?null==e?void 0:e.dailyEditorView.selectedNote:null==e?void 0:e.primaryEditorView.selectedNote}isSelected(e){return this.selectedNote===e}handleBacklinkOpen(e,n){return this.editNoteId(e.id,n),!1}clearEditorSearch(){this.assertNoteStore.dailyEditorView.clearSearch(),this.assertNoteStore.primaryEditorView.clearSearch(),this.assertNoteStore.secondaryEditorView.clearSearch()}editNoteId(e){var n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=null===(n=this.noteStore)||void 0===n?void 0:n.findById(e);this.editNote(null!=o?o:null,r)}editNote(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.secondary?"secondary":"primary",o=this.noteStore;if(!o){console.error("editNote: Note store not initialized");return}this.updateFocusDebounce.cancel(),"secondary"==r&&this.canEditSecondary(e)?(o.secondaryEditorView.setSelectedNote(e,{searchQuery:n.searchQuery,searchNodeGuid:n.searchNodeGuid}),this.setActiveEditor("secondary")):((null==e?void 0:e.daily)?(o.dailyEditorView.setSelectedDate(e.dailyOrCreatedDate,{searchQuery:n.searchQuery,searchNodeGuid:n.searchNodeGuid}),this.setScreen(h.oK.NoteDaily)):(this.setSelectedNote(e,{searchQuery:n.searchQuery,searchNodeGuid:n.searchNodeGuid}),this.setScreen(h.oK.NoteEdit)),o.secondaryEditorView.setSelectedNote(null),this.focusEditor("primary",{skipIfCapacitor:!0}))}canEditSecondary(e){return this.screenIsEditOrDaily&&!(null==e?void 0:e.daily)&&this.selectedNote!==e}closeSecondary(){var e;null===(e=this.noteStore)||void 0===e||e.secondaryEditorView.setSelectedNote(null),this.setActiveEditor("primary")}editRandomNote(){let e=this.assertNoteStore.findRandomNote();e&&this.editNote(e)}createAndEditNote(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{secondary:!1},r=this.assertNoteStore.createNote(e);r&&this.editNote(r,n)}async mergeNotes(e){let{fromNote:n,toNoteId:r}=e,o=this.assertNoteStore.findById(r);o&&(this.setSelectedNote(o),await mergeNotes({noteStore:this.assertNoteStore,fromNote:n,toNote:o}))}openTaskView(){this.setScreen(h.oK.TaskList)}setAndOpenSearchQuery(e){this.assertNoteStore.listView.setQuery(e),this.setScreen(h.oK.NoteList)}openNotesListForTag(e){this.setAndOpenSearchQuery("#".concat(e))}handleDeepLink(e){let n=new URL(e),getParam=r=>{let o=n.searchParams.get(r);return(0,g.Ee)(o,"Missing param ".concat(r," in ").concat(e)),o},r=getParam("command");switch(r){case"append-to-daily-note":this.appendTextToDailyNote(getParam("text"));break;case"create-task":this.createTask(getParam("text"));break;case"create-note":this.createAndEditNote();break;default:console.error("Unknown command ".concat(r," in ").concat(e))}}appendTextToDailyNote(e){let n=this.todaysDailyNote;this.editNote(n),n.changeManager.modifyDocument(n=>(0,u.GQ)({node:n,text:e}))}createTask(e){this.openTaskView();let n=this.todaysDailyNote,r=f.i.build({text:e,note:n});r.syncToNote()}get todaysDailyNote(){return this.assertNoteStore.ensureTodaysDailyNote()}constructor(...e){super(...e),this.screen=h.oK.NoteDaily,this.activeEditor=null,this.lastActiveEditor=null,this.modal=null,this.semiScreenUser=!1,this.semiScreenMedia=!1,this.typingMeasurements=[],this.updateFocusDebounce=i()(this.updateFocus.bind(this),50)}};(0,o.gn)([c.observable],v.prototype,"screen",void 0),(0,o.gn)([c.observable],v.prototype,"activeEditor",void 0),(0,o.gn)([c.observable],v.prototype,"modal",void 0),(0,o.gn)([c.observable],v.prototype,"semiScreenUser",void 0),(0,o.gn)([c.observable],v.prototype,"semiScreenMedia",void 0),(0,o.gn)([c.observable],v.prototype,"typingMeasurements",void 0),(0,o.gn)([c.action],v.prototype,"setSemiScreenUser",null),(0,o.gn)([c.action],v.prototype,"setSemiScreenMedia",null),(0,o.gn)([c.action],v.prototype,"addTypingMeasurement",null),(0,o.gn)([c.action],v.prototype,"setActiveEditor",null),(0,o.gn)([c.action],v.prototype,"setFocused",null),(0,o.gn)([c.action],v.prototype,"setBlurred",null),(0,o.gn)([c.computed],v.prototype,"searchModalIsOpen",null),(0,o.gn)([c.computed],v.prototype,"shortcutsModalIsOpen",null),(0,o.gn)([c.computed],v.prototype,"tasksHasFocus",null),(0,o.gn)([c.computed],v.prototype,"noteHasFocus",null),(0,o.gn)([c.action],v.prototype,"closeModal",null),(0,o.gn)([c.action],v.prototype,"openModal",null),(0,o.gn)([c.action],v.prototype,"toggleSemiScreen",null),(0,o.gn)([c.action],v.prototype,"setScreen",null),(0,o.gn)([c.action],v.prototype,"openNoteDailyScreen",null),(0,o.gn)([c.action],v.prototype,"ensureSelectedNote",null),(0,o.gn)([c.computed],v.prototype,"selectedNote",null),(0,o.gn)([c.action],v.prototype,"editNote",null),(0,o.gn)([c.action],v.prototype,"closeSecondary",null),v=(0,o.gn)([(0,d.o4J)("MainView")],v)},24427:function(e,n,r){"use strict";r.d(n,{Jr:function(){return generateSubListsForValues},Mr:function(){return generateListForValues},V$:function(){return generateListFromContact},Xq:function(){return generateNoteFromSubject},_F:function(){return generateMeetingDocument},ct:function(){return generateContactDocument},d3:function(){return generateMeetingListItem},tk:function(){return generateEmptyNote}});var o=r(15965),a=r(85564),i=r.n(a),s=r(13861),l=r(11563);function generateNoteFromSubject(e){let{emptyList:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?n?o.K3.doc([o.K3.header(e),o.K3.list(o.K3.listItem(o.K3.paragraphText("")))]):generateEmptyNote(e):generateEmptyNote()}function generateEmptyNote(e){return o.K3.doc([o.K3.header(null!=e?e:""),o.K3.paragraph([])])}function generateListForValues(e,n){let r=[o.K3.paragraphText(e||" "),...generateSubListsForValues(n)];return o.K3.listItem(r)}function generateSubListsForValues(e){return e.map(generateListForValue).filter(s.Dw)}function generateListForValue(e){let n=(0,o.Y8)(e,{onTagAdd:void 0,onBacklinkAdd:void 0});if(0===n.size)return null;try{return o.K3.listItem(n)}catch(n){return o.K3.listItem(o.K3.paragraphText(e+" "))}}function generateListFromContact(e,n){var r,a;return o.K3.list([o.K3.listItem(o.K3.paragraphText("Title: ")),o.K3.listItem(o.K3.paragraphText("Company: ")),o.K3.listItem(o.K3.paragraph([o.K3.text("Type: "),o.K3.tag({id:l._H,label:l._H,graphId:n})])),generateListItemWithNestedItems("Email:",(null!==(r=null==e?void 0:e.emailValues)&&void 0!==r?r:[]).map(e=>o.K3.link(e,"mailto:"+e))),generateListItemWithNestedItems("Phone:",(null!==(a=null==e?void 0:e.phoneNumberValues)&&void 0!==a?a:[]).map(e=>o.K3.link(e,"tel:"+e))),o.K3.listItem(o.K3.paragraphText("Location: "))])}function generateListItemWithNestedItems(e,n){let r=[o.K3.paragraphText(e)];return n.length>0&&r.push(...n.map(e=>o.K3.listItem(o.K3.paragraph(e)))),o.K3.listItem(r)}function generateMeetingListItem(e){let{meeting:n,meetingNote:r,attendeeNotes:a}=e,s=[];if(n.startAt&&s.push(o.K3.text("".concat(n.startAtTimeFormatted," "))),a.length>0){n.startAt?s.push(o.K3.text("met with ")):s.push(o.K3.text("Met with "));let e=i()(a.map(e=>o.K3.backlink({id:e.id,label:e.title,graphId:e.graphId})));for(let[n,r]of e.entries())s.push(r),n!=e.length-1&&s.push(o.K3.text(", "));(r||n.name)&&s.push(o.K3.text(" for "))}return r?s.push(o.K3.backlink({id:r.id,label:r.subject,graphId:r.graphId})):n.name&&s.push(o.K3.text(n.name)),o.K3.listItem([o.K3.paragraph(s),o.K3.list([o.K3.listItem(o.K3.paragraphText(""))])])}function generateContactDocument(e,n){let r=o.K3.header(null==e?void 0:e.name),a=generateListFromContact(e,n);return o.K3.doc([r,a])}function generateMeetingDocument(e,n){return o.K3.doc([o.K3.header(e.name),o.K3.list([o.K3.listItem([o.K3.paragraph([o.K3.text("Type: "),o.K3.tag({id:l.O9,label:l.O9,graphId:n})])])])])}},59096:function(e,n,r){"use strict";r.d(n,{II:function(){return suggestedIncomingBacklinks},WK:function(){return nodeWithoutSubjectIsBlank}});var o=r(15965);function suggestedIncomingBacklinks(e){let{graphId:n,fromNoteId:r,fromNoteNode:a,toNoteId:i,queries:s}=e;if(0===s.length)return[];let l=[];for(let e of s){let s=(0,o.wn)(a,[e]);for(let o of s){let s=function(e,n){let r;return e.nodesBetween(n,n,e=>{r||"paragraph"!==e.type.name||(r=e)}),r}(a,o);if(!s)continue;let c=s.textContent;l.push({graphId:n,fromNoteId:r,toNoteId:i,label:e,contextHtml:"<p>".concat(c,"</p>")})}}return l}function nodeWithoutSubjectIsBlank(e){let n=(0,o.Jk)(e);return(0,o._F)(n)}},97867:function(e,n,r){"use strict";r.d(n,{GQ:function(){return appendTextToFirstList},M_:function(){return addSubjectToContent},Pm:function(){return ensureListToDocument},RN:function(){return addMeetingToDocument},U3:function(){return syncTaskToDocument},XG:function(){return toggleTaskCheckedToDocument},jd:function(){return addContactToDocument},p0:function(){return convertChecklistToDocument},vm:function(){return rewriteBacklinkGraph}});var o=r(15965),a=r(24427);function addContactToDocument(e){let{document:n,contact:r,graphId:i}=e,s=(0,a.V$)(r,i);return(0,o.Ne)(n,e=>{(0,o.rx)(e,s)})}function addMeetingToDocument(e){let{meeting:n,document:r,meetingNote:i,attendeeNotes:s}=e,l=(0,a.d3)({meeting:n,meetingNote:i,attendeeNotes:s}),c=(0,o.Ne)(r,e=>{(0,o.rx)(e,[l])});return c}function appendTextToFirstList(e){let{node:n,text:r,listName:a,onTagAdd:i,onBacklinkAdd:s}=e,l={onTagAdd:i,onBacklinkAdd:s},c=(0,o.Y8)(r,l),d=o.K3.listItem(c);if(!a)return(0,o.Ne)(n,e=>{(0,o.rx)(e,d)});{let e=(0,o.LX)(a,l);return(0,o.Ne)(n,n=>{(0,o.HT)(n,e,d)})}}function addSubjectToContent(e,n){return(0,o.Ne)(e,e=>{(0,o.M_)(e,n)})}function ensureListToDocument(e){return(0,o.Ne)(e,e=>{(0,o.fL)(e)})}function rewriteBacklinkGraph(e){let{node:n,graphId:r}=e,a=(0,o.Ne)(n,e=>{(0,o.Dx)(e,r)});return a}function syncTaskToDocument(e){let{doc:n,taskGuid:r,taskChecked:a,taskArchived:i,taskFragment:s,listName:l}=e;return(0,o.Ne)(n,e=>{(0,o.Qo)(e,o.K3.taskListItem(null!=s?s:o.K3.paragraphText(),{checked:a,archived:i,guid:r}),{listName:l})})}function toggleTaskCheckedToDocument(e){let{doc:n,taskGuid:r}=e;return(0,o.Ne)(n,e=>{(0,o.vh)(e,{guid:r})})}function convertChecklistToDocument(e){let{doc:n,taskGuid:r}=e;return(0,o.Ne)(n,e=>{(0,o.bo)(e,{guid:r,kind:"checklist"})})}},88829:function(e,n,r){"use strict";r.d(n,{DG:function(){return ensureDocumentAndSubject},KK:function(){return matchNoteBySubject},ZQ:function(){return isDateInRange},a1:function(){return enrichmentToString}});var o=r(15965),a=r(69119),i=r(90233),s=r(13861),l=r(24427),c=r(97867);function ensureDocumentAndSubject(e){let{documentNode:n,document:r,subject:a,...i}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n||(n=r?(0,o.hH)(r):(0,l.Xq)(a,s)),a?(0,o.kB)(n)!==a&&(n=(0,c.M_)(n,a)):a=(0,o.kB)(n);let d=n.toJSON();return{...i,document:d,subject:a}}function isDateInRange(e,n){let r=n.startAt.getTime(),o=n.endAt.getTime(),i=(0,a.Z)(e).getTime();return i>=r&&i<=o}function enrichmentToString(e){var n,r,o,a,i,l,c,d,u,p,h;if(!e||!(null==e?void 0:e.person)&&!(null==e?void 0:e.company))return"";let g=[null===(r=e.person)||void 0===r?void 0:null===(n=r.name)||void 0===n?void 0:n.fullName,null===(a=e.person)||void 0===a?void 0:null===(o=a.employment)||void 0===o?void 0:o.title,null===(l=e.person)||void 0===l?void 0:null===(i=l.employment)||void 0===i?void 0:i.role,null===(c=e.person)||void 0===c?void 0:c.bio,null===(u=e.person)||void 0===u?void 0:null===(d=u.twitter)||void 0===d?void 0:d.handle,null===(p=e.company)||void 0===p?void 0:p.name,null===(h=e.company)||void 0===h?void 0:h.description],m=g.filter(s.Dw);return m.join(" ").substring(0,300)}function matchNoteBySubject(e,n){return e.refine(e=>(0,i.matchSorter)(e,n,{keys:[getNoteRowSubject]}))}function getNoteRowSubject(e){return e.derived.normalizedSubject||e.snapshot.subject}},47944:function(e,n,r){"use strict";r.d(n,{o:function(){return NoteChange}});var o=r(64701);let NoteChange=class NoteChange{static fromDocChange(e,n){return new NoteChange({graph:e,doc:n.doc,type:n.type})}get id(){return this.doc.id}get data(){let e=this.doc.data();if(!e)throw Error("missing data");return e}get lastCommitId(){var e;return null!==(e=this.data.last_commit_id)&&void 0!==e?e:null}get docCommitId(){var e;return null!==(e=this.data.doc_commit_id)&&void 0!==e?e:null}get needsFetchCommits(){return null!==this.docCommitId&&this.lastCommitId!==this.docCommitId}get createdAt(){return this.data.created_at.toDate()}get updatedAt(){return this.data.updated_at.toDate()}async getSnapshot(){var e,n;let r=this.doc,o=await this.reader.valuesFromDoc(r),a="number"==typeof o.docCommitId?o.docCommitId:null!==(e=o.lastCommitId)&&void 0!==e?e:null;return{id:this.id,subject:o.subject,yDocAsUpdate:o.yDocAsUpdate,document:o.document?{$frozen:!0,data:o.document}:void 0,systemMetadata:{$frozen:!0,data:null!==(n=o.systemMetadata)&&void 0!==n?n:{}},ignoredBacklinkLabels:o.ignoredBacklinkLabels,ignoredBacklinkFromNoteIds:o.ignoredBacklinkFromNoteIds,ignoredContactNames:o.ignoredContactNames,backlinkedCount:o.backlinkedCount,acl:o.acl,pinnedIndex:o.pinnedIndex,daily:o.daily,createdAt:o.createdAt,updatedAt:o.updatedAt,deletedAt:o.deletedAt,editedAt:o.editedAt,lastCommitId:a,persisted:!0}}metadataChanged(e){return this.updatedAt.getTime()>e.snapshot.updatedAt}commitsChanged(e){return null!==this.lastCommitId&&this.lastCommitId!==e.snapshot.lastCommitId}get reader(){return new o.r({encryptionKey:this.graph.encryptionKey})}constructor(e){this.graph=e.graph,this.doc=e.doc,this.type=e.type}}},98596:function(e,n,r){"use strict";r.d(n,{f:function(){return NoteCommitBackup}});var o=r(15965);let NoteCommitBackup=class NoteCommitBackup{get documentNode(){return this.document?(0,o.hH)(this.document):null}constructor(e){this.id=e.id,this.document=e.document,this.createdAt=e.createdAt,this.platform=e.platform}}},37997:function(e,n,r){"use strict";r.d(n,{o:function(){return NoteCommit}});var o=r(15965),a=r(10928),i=r.n(a);let NoteCommit=class NoteCommit{get documentNode(){return this.document?(0,o.hH)(this.document):null}yjsEncodeStateVector(){var e;let n=i()(null!==(e=this.yjsUpdates)&&void 0!==e?e:[]);return n?o.pU.encodeStateVectorFromUpdate(n):null}constructor(e){this.id=e.id,this.yjsUpdates=e.yjsUpdates,this.yjsDocAsUpdate=e.yjsDocAsUpdate,this.document=e.document,this.createdAt=e.createdAt,this.platform=e.platform}}},12428:function(e,n,r){"use strict";r.d(n,{AZ:function(){return noteFromRow},C2:function(){return updateNoteFromRow},O8:function(){return rowFromSnapshot},Zd:function(){return nodeFromSnapshot},s4:function(){return rowFromNote},tE:function(){return nodeFromRowOrPool}});var o=r(15965),a=r(53699),i=r(70173),s=r(44717),l=r(59096),c=r(25271);function noteFromRow(e){return(0,a.atr)(c.j,e.snapshot)}function updateNoteFromRow(e,n){(0,a.Xx3)(e,n.snapshot)}function rowFromNote(e){let n=(0,a.vMv)(e);return rowFromSnapshot(n)}function rowFromSnapshot(e){return{id:e.id,snapshot:e,derived:function(e){let{node:n,document:r}=nodeFromSnapshot(e),a=e.daily?(0,i.cB)(e.id):void 0,c=n?(0,o.sd)(n):{},d=n?(0,o.H9)(n):[],u=d.map(e=>e[0].attrs.id);return{tags:n?(0,o.NJ)(n):[],hasTask:!!n&&(0,o.d5)(n),emails:n?(0,o.G5)(n):[],linkHrefs:n?(0,o.nv)(n):[],isBlank:!n||(0,l.WK)(r),contentMetadata:c,dailyDate:null==a?void 0:a.getTime(),normalizedSubject:(0,s.U)(e.subject),backlinkIds:u}}(e)}}function nodeFromSnapshot(e){var n;let r=null===(n=e.document)||void 0===n?void 0:n.data;if(!r)return{node:null,document:null};let a=(0,o.hH)(r);return{node:a,document:r}}function nodeFromRowOrPool(e,n){let r=n.pool.get(e.id),o=null==r?void 0:r.editedDocument,a=null==r?void 0:r.editedDocumentNode;return o&&a?{document:o,node:a}:nodeFromSnapshot(e.snapshot)}},25271:function(e,n,r){"use strict";r.d(n,{j:function(){return V}});var o=r(97582),a=r(15965),i=r(52300),s=r(23279),l=r.n(s),c=r(18446),d=r.n(c),u=r(10928),p=r.n(u),h=r(39138),g=r.n(h),m=r(68949),y=r(53699),f=r(60381),v=r(80339),b=r(29354),w=r(88498),k=r(70173),S=r(46551),x=r(14066),N=r(27661),D=r(88734),T=r(68236),I=r(44915),C=r(47638),A=r(44717),M=r(82058),_=r(71992);let IncomingCommitAlreadyApplied=class IncomingCommitAlreadyApplied extends Error{constructor({note:e,commits:n}){let r=e.lastCommitId,o=n.map(e=>e.id);super("Incoming commit has already been applied (trying to apply commits ".concat(o,"\n      to note ").concat(e.id," with last commit ").concat(r,")")),this.name="IncomingCommitAlreadyApplied"}};var E=r(39234);let SimpleLock=class SimpleLock{acquire(){this.isActive=!0}async run(e){let{execute:n,message:r}=e;if(this.isActive){console.warn(r);return}this.acquire();try{await n()}finally{this.release()}}release(){this.isActive=!1}constructor(){this.isActive=!1}};let TemporaryLock=class TemporaryLock{acquire(e){let{expireAfter:n}=e;this.clearTimeout(),this.isActive=!0,this.expireTimeout=setTimeout(()=>{this.isActive=!1},n)}release(){this.clearTimeout(),this.isActive=!1}clearTimeout(){this.expireTimeout&&(clearTimeout(this.expireTimeout),this.expireTimeout=null)}constructor(){this.isActive=!1,this.expireTimeout=null}};var F=r(69963),R=r(27809),U=r(11757),B=r(83856),j=r(6553),P=r(30503),K=r(91935);let StateMachine=class StateMachine{getState(){return this.state}setState(e){var n;let r=this.state,o=this.findTransition(r,e);if(!o)throw Error("No transition found from ".concat(r.type," to ").concat(e.type));o.block||(this.state=e,null===(n=o.after)||void 0===n||n.call(o,{state:e,prevState:r}))}findTransition(e,n){let r=this.transitions.find(r=>this.matchStateType(r.from,e.type)&&this.matchStateType(r.to,n.type));return r||null}matchStateType(e,n){return Array.isArray(e)?e.includes(n):e===n}constructor(e,n){this.state=e,this.transitions=n,(0,m.makeObservable)(this)}};function t(e,n,r){return{from:e,to:n,block:r.block,after:r.after}}(0,o.gn)([m.observable],StateMachine.prototype,"state",void 0),(0,o.gn)([m.action],StateMachine.prototype,"setState",null);let SavingManager=class SavingManager{get state(){return this.machine.getState()}requestSave(){let e=this.machine.getState();if("saving"===e.type){this.shouldSaveAgain=!0;return}this.machine.setState({type:"requestedSave"})}onRequestSave(){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.machine.setState({type:"saving",retryAttempts:4})},this.debounceInterval)}onWillRetry(e){let{state:n}=e;setTimeout(()=>{this.machine.setState({type:"saving",retryAttempts:n.retryAttempts})},this.retryTimeout)}onIdle(){this.shouldSaveAgain&&(this.shouldSaveAgain=!1,this.machine.setState({type:"requestedSave"}))}async onSave(e){let n,{state:r}=e;if(!this.note.isAttached){this.warn("Note is not attached, not saving"),this.machine.setState({type:"idle"});return}let o=this.changeStore.getPendingCommit(this.note);if(!o){this.warn("No pending commit, not saving"),this.machine.setState({type:"idle"});return}if(o.isEmpty&&!o.forceSave){this.warn("Pending commit is empty, not saving"),this.machine.setState({type:"idle"});return}if(this.noteStore.offline){this.warn("Offline, not saving"),this.machine.setState({type:"idle"}),this.updateFailure({failedAt:new Date,reason:"offline"});return}o.setForceSave(!1);let a=(0,K.U3)({graph:this.graph,note:this.note,commit:o,reason:""});try{n=await (0,P.G)(a,this.saveTimeout)}catch(e){if(e instanceof j.m){this.retrySaving(r.retryAttempts,"expired");return}throw e}let{success:i,error:s}=n;i?(this.machine.setState({type:"idle"}),this.note.setPersisted(!0),this.note.changeManager.applySavedUpdates({updates:n.yjsUpdates}),this.verifySavedCommit(n.commitId),this.clearFailure()):"tooLarge"===s?(this.machine.setState({type:"idle"}),this.updateFailure({failedAt:new Date,reason:"tooLarge"})):this.retrySaving(r.retryAttempts,"other")}verifySavedCommit(e){if(null===e)return;let n=this.graph.logger.child({noteId:this.note.id});setTimeout(()=>{var r;let o=null!==(r=this.note.lastCommitId)&&void 0!==r?r:-1,a=e-o;if(a>10){let r="Severely out of sync: Saved commit ".concat(e," is ahead by ").concat(a," (local commit: ").concat(o,")");n.error(r),(0,F.uT)(r,{level:"error"})}},1e4)}retrySaving(e,n){e>0?this.machine.setState({type:"willRetry",reason:n,retryAttempts:e-1}):(this.updateFailure({failedAt:new Date,reason:n}),this.machine.setState({type:"idle"}))}updateFailure(e){this.failure||(this.failure=e)}clearFailure(){this.failure=null}warn(e){console.warn("[saving-manager ".concat(this.note.graphId,"/").concat(this.note.id,"] ").concat(e))}get noteStore(){return this.note.assertNoteStore}get changeStore(){return this.noteStore.assertChangeStore}get graph(){return this.noteStore.assertGraph}constructor(e){this.debounceTimer=null,this.shouldSaveAgain=!1,this.debounceInterval=2e3,this.saveTimeout=15e3,this.retryTimeout=1e4,this.failure=null,this.note=e;let onRequestSave=()=>this.onRequestSave(),onSave=e=>this.onSave(e);this.machine=new StateMachine({type:"idle"},[t("idle","requestedSave",{after:onRequestSave}),t("requestedSave","requestedSave",{after:onRequestSave}),t("willRetry","requestedSave",{block:!0}),t("willRetry","saving",{after:onSave}),t("requestedSave","saving",{after:onSave}),t("saving","idle",{after:()=>this.onIdle()}),t("saving","willRetry",{after:e=>this.onWillRetry(e)})]),(0,m.makeObservable)(this)}};(0,o.gn)([m.observable],SavingManager.prototype,"failure",void 0),(0,o.gn)([m.action],SavingManager.prototype,"updateFailure",null),(0,o.gn)([m.action],SavingManager.prototype,"clearFailure",null);let ChangeManager=class ChangeManager{yjsHandleUpdate(e){let{update:n}=e;if(!this.note.yDoc)throw new v.KL(this.note);this.changeStore.addPendingUpdates({note:this.note,updates:[n]}),this.requestSave(),this.note.handleDocChangedDebounce()}modifyDocument(e){let{triggerChangedCallback:n=!0,requestSave:r=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.note.assertEditedYdoc,i=(0,a.x4)(o),s=e((0,a.hH)(i)),l=(0,S.Gn)({originalYDoc:o,updatedNode:s});this.changeStore.addPendingUpdates({note:this.note,updates:l}),this.note.requestRerender(),r&&this.requestSave(),n&&this.note.handleDocChangedDebounce()}requestSave(){this.savingManager.requestSave()}async saveMeta(){return this.note.touchUpdatedAt(),await (0,U.j)(this.graph,this.note)}async touch(){var e;null===(e=this.changeStore)||void 0===e||e.ensureCommit({note:this.note,forceSave:!0}),this.requestSave(),await this.saveMeta()}create(){this.changeStore.ensureCommit({note:this.note,forceSave:!0}),this.requestSave()}ensureExists(){this.note.persisted||this.create()}async handleIncomingChange(e){let{snapshot:n,flags:r}=e;r.metadata&&(0,B.Rs)(this.note,n),r.content&&await this.loadAndApplyCommits()}async loadAndApplyCommits(){await this.loadCommitsLock.run({execute:async()=>{let e=[];try{e=await (0,R.x3)({graph:this.note.assertGraph,noteId:this.note.id,afterCommitId:this.note.lastCommitId})}catch(e){throw new _.WA(e.message)}0!==e.length&&this.applyCommits(e)},message:"Tried loading and applying commits for note ".concat(this.note.id,", but another load was already in progress.")})}applyCommits(e){if(!this.note.noteStore){this.logger.warn("[applyCommits] Note has been destroyed");return}if(!this.note.isEveryCommitNewer(e))throw new IncomingCommitAlreadyApplied({note:this.note,commits:e});this.applyYjsCommits(e)}applyYjsCommits(e){let n=p()(e);if(!n)return;this.logger.info("[".concat(this.note.id,"] applying commits: ").concat((0,B.jQ)(e)));let r=e.filter(B.L7);if(r.length>0){var o,a;(0,F.uT)("Large commits: ".concat((0,B.jQ)(r)),{extra:{graphId:this.note.graphId,note:{id:this.note.id,createdAt:null===(o=this.note.createdAtDate)||void 0===o?void 0:o.toISOString(),updatedAt:null===(a=this.note.updatedAtDate)||void 0===a?void 0:a.toISOString()}}})}this.backupPending(n);let i=(0,E.a)(e);this.applyIncomingUpdates({updates:i,lastCommitId:n.id})}applyIncomingUpdates(e){let{updates:n,lastCommitId:r}=e,o=this.note.assertYDoc;for(let e of n)a.pU.applyUpdate(o,e);let i=(0,a.x4)(o);(0,m.runInAction)(()=>{this.note.setYDoc(o),this.note.setDocument(i),this.note.setLastCommitId(r),this.note.addIncomingUpdates(n),this.note.requestRerender(),this.consolidatePendingCommit({source:"incoming"})})}applySavedUpdates(e){let{updates:n}=e,r=this.note.assertYDoc;for(let e of n)a.pU.applyUpdate(r,e);let o=(0,a.x4)(r);(0,m.runInAction)(()=>{this.note.setYDoc(r),this.note.setDocument(o),this.consolidatePendingCommit({source:"saved"})})}consolidatePendingCommit(e){let{source:n}=e,r=this.changeStore.getPendingCommit(this.note);if(!r){this.logger.info("(".concat(n,") tried consolidating, no pending commit"));return}let o=r.yjsUpdates.length,a=r.consolidate(this.note);this.logger.info("(".concat(n,") consolidated pending commit from ").concat(o," to ").concat(a," updates"))}backupPending(e){let n=this.changeStore.getPendingCommit(this.note);if(!n)return;let r=null==n?void 0:n.encodeStateVector(),o=e.yjsEncodeStateVector();d()(r,o)||n.backup({note:this.note})}handleReconnect(){this.requestSave()}get graph(){return this.noteStore.assertGraph}get logger(){return this.graph.logger.child({noteId:this.note.id})}get noteStore(){return this.note.assertNoteStore}get changeStore(){return this.noteStore.assertChangeStore}get rootStore(){return this.note.rootStore}constructor(e){this.saveLock=new TemporaryLock,this.loadCommitsLock=new SimpleLock,this.note=e,this.savingManager=new SavingManager(e)}};var O=r(30842),L=r(87776),G=r(92784),Z=r(11563),q=r(40328),H=r(24427),Y=r(59096),z=r(97867),J=r(88829);let V=class extends(0,y.Hnr)({id:y.UB4,subject:(0,y.vgT)(()=>""),document:(0,y.vgT)().withTransform((0,C.N)()).withSetter(),yDocAsUpdate:(0,y.vgT)().withSetter(),systemMetadata:(0,y.vgT)().withTransform((0,C.N)()).withSetter(),ignoredBacklinkLabels:(0,y.vgT)(()=>[]),ignoredBacklinkFromNoteIds:(0,y.vgT)(()=>[]),ignoredContactNames:(0,y.vgT)(()=>[]),backlinkedCount:(0,y.vgT)(()=>0),acl:(0,y.vgT)(()=>[]),pinnedIndex:(0,y.vgT)(null),daily:(0,y.vgT)(!1),createdAt:(0,y.vgT)(()=>new Date().getTime()),updatedAt:(0,y.vgT)(()=>new Date().getTime()),deletedAt:(0,y.vgT)(()=>null),editedAt:(0,y.vgT)(),lastCommitId:(0,y.vgT)(()=>null).withSetter(),persisted:(0,y.vgT)().withSetter()}){static fromSnapshot(e){return(0,y.atr)(V,e)}static build(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.placeholder?this.buildPlaceholderYJS(e,n):this.buildYJS(e,n)}static buildYJS(e,n){let{document:r,...o}=(0,J.DG)(e,n),a=(0,S.kg)(r).ydoc;return this.buildModel({...o,document:r,yDocAsUpdate:(0,S.KT)(a),persisted:!1})}static buildPlaceholderYJS(e,n){let{document:r,...o}=(0,J.DG)(e,{...n,emptyList:!1}),{ydoc:i,node:s}=(0,S.kg)(r,{template:!0}),l=[a.pU.encodeStateAsUpdate(i)];if(n.emptyList){let e=(0,z.Pm)(s),n=(0,S.Gn)({originalYDoc:i,updatedNode:e});l.push(...n)}let c=a.pU.mergeUpdates(l);return this.buildModel({...o,document:r,yDocAsUpdate:(0,S.KT)(new a.pU.Doc),placeholderUpdate:c,persisted:!1})}static buildModel(e){let{placeholderUpdate:n,...r}=e,o=new this(r);if(n){let e=new L.i({yjsUpdates:[(0,i.kZ)(n)]});e.setIsPlaceholder(!0),o.setPlaceholderCommit(e)}return o}get key(){return[this.graphId,this.id,this.rerenderCounter].join("-")}get rerenderKey(){return[this.id,this.rerenderCounter].join("-")}get remountKey(){return[this.id,this.remountCounter].join("-")}get createdAtDate(){return new Date(this.createdAt)}get updatedAtDate(){return new Date(this.updatedAt)}get untrackedUpdatedAtDate(){return(0,m.untracked)(()=>this.updatedAtDate)}get updatedAtTime(){return this.updatedAtDate.getTime()}get untrackedUpdatedAtTime(){return(0,m.untracked)(()=>this.updatedAtTime)}get editedAtDate(){return this.editedAt?new Date(this.editedAt):null}get deletedAtDate(){return this.deletedAt?new Date(this.deletedAt):null}get pinned(){return null!==this.pinnedIndex}get untrackedBacklinkedCount(){return(0,m.untracked)(()=>this.backlinkedCount)}get public(){return this.acl.includes("public")}aclCanRead(e){return this.aclCanWrite(e)||this.acl.includes("public")||this.acl.includes("read.".concat(e))}aclCanWrite(e){return this.aclIsOwner(e)||this.acl.includes("write.".concat(e))}aclIsOwner(e){return this.acl.includes("owner.".concat(e))}get noteStore(){var e;return null===(e=this.graph)||void 0===e?void 0:e.noteStore}get assertNoteStore(){let e=this.noteStore;if(!e)throw console.log("[Note] parent:",(0,y.G_R)(this)),Error("missing note store (".concat(this.id,")"));return e}get isAttached(){return!!this.noteStore}get changeManager(){return new ChangeManager(this)}get changeStore(){var e;return null===(e=this.noteStore)||void 0===e?void 0:e.changeStore}get noteBacklinkStore(){var e;return null===(e=this.graph)||void 0===e?void 0:e.noteBacklinkStore}get graph(){return(0,G.H)(this)}get assertGraph(){return(0,I.wi)(this,"graph")}get graphId(){var e;return null===(e=this.graph)||void 0===e?void 0:e.id}get linkHrefs(){let e=this.documentNode;return e?(0,a.nv)(e):[]}get title(){return(0,b.bd)(this.debouncedSubject||"Untitled")}get subjectAliases(){return(0,b.gO)(this.subject)}get slug(){return this.subjectSlug?"".concat(this.subjectSlug,"-").concat(this.id):this.id}get subjectSlug(){return this.subject?this.subject.toLowerCase().trim().replace(/\s{2,}/g," ").replace(/\s/g,"-").replace(/[^\w-]/g,""):null}get normalizedSubject(){return(0,A.U)(this.subject)}get line(){try{return this.debouncedDocumentNode?(0,a.Oj)(this.debouncedDocumentNode):""}catch(e){return(0,F.Tb)(e),""}}get emails(){return this.debouncedDocumentNode?(0,a.G5)(this.debouncedDocumentNode):[]}get phoneNumbers(){return this.debouncedDocumentNode?(0,a.mD)(this.debouncedDocumentNode):[]}get domains(){return this.debouncedDocumentNode?(0,a.Nk)(this.debouncedDocumentNode):[]}get tags(){return this.debouncedDocumentNode?(0,a.NJ)(this.debouncedDocumentNode):[]}get tasks(){let e=this.debouncedDocumentNode?(0,a.Ak)(this.debouncedDocumentNode):[];return e.map(e=>new q.i({node:e,note:this}))}get hasPersonTag(){return this.tags.includes(Z._H)}get hasCompanyTag(){return this.tags.includes(Z.lw)}get contentMetadata(){return this.debouncedDocumentNode?(0,a.sd)(this.debouncedDocumentNode):{}}get asin(){var e;return null!==(e=this.contentMetadata.asin)&&void 0!==e?e:null}get mentions(){return{emails:this.emails,domains:this.domains,tags:this.tags}}get snippet(){return g()(this.line,{length:70})}get isBlank(){return!this.document||(0,Y.WK)(this.document)}get isDeleted(){return!!this.deletedAt}get editedOrUpdatedAt(){var e;return null!==(e=this.editedAt)&&void 0!==e?e:this.updatedAt}get editedOrUpdatedAtDate(){var e;return null!==(e=this.editedAtDate)&&void 0!==e?e:this.updatedAtDate}get editedOrUpdatedAtTime(){return this.editedOrUpdatedAtDate.getTime()}get editedAtFormatted(){var e,n,r,o;let a=null===(n=this.rootStore)||void 0===n?void 0:null===(e=n.preferenceStore)||void 0===e?void 0:e.dateFormat,i=null===(o=this.rootStore)||void 0===o?void 0:null===(r=o.preferenceStore)||void 0===r?void 0:r.timeFormat;return(0,w.zg)(this.editedOrUpdatedAtDate,a,i)}get dailyTense(){if(this.daily)return this.isTodaysDailyNote?"present":(0,D.CR)(this.dailyOrCreatedDate)?"past":"future"}get dailyDate(){if(this.daily){let e=(0,k.cB)(this.id);if(e)return e}}get dailyOrCreatedDate(){var e;return null!==(e=this.dailyDate)&&void 0!==e?e:this.createdAtDate}get dailyDateFormatted(){var e,n,r,o;let a=null===(n=this.rootStore)||void 0===n?void 0:null===(e=n.preferenceStore)||void 0===e?void 0:e.dateFormat,i=null===(o=this.rootStore)||void 0===o?void 0:null===(r=o.preferenceStore)||void 0===r?void 0:r.timeFormat;return(0,w.zg)(this.dailyOrCreatedDate,a,i)}get dailyAt(){return this.dailyOrCreatedDate.getTime()}get isTodaysDailyNote(){return this.daily&&(0,D.zk)(this.dailyOrCreatedDate)}get enrichment(){var e,n;return null!==(n=null===(e=this.systemMetadata)||void 0===e?void 0:e.enrichment)&&void 0!==n?n:null}get previewSrc(){var e,n,r,o;return(null===(n=this.enrichment)||void 0===n?void 0:null===(e=n.person)||void 0===e?void 0:e.avatar)||(null===(o=this.enrichment)||void 0===o?void 0:null===(r=o.company)||void 0===r?void 0:r.logo)||void 0}get untrackedPreviewSrc(){return(0,m.untracked)(()=>this.previewSrc)}get firstEmail(){return this.emails[0]}get enrichmentMatchText(){return(0,J.a1)(this.enrichment)}tagMatch(e){let n=e.replaceAll("#","");return this.tags.includes(n)}partialTagMatch(e){let n=e.replaceAll("#","");for(let e of this.tags)if(e.includes(n))return!0;return!1}get rootStore(){return(0,y.k0l)(this)}get uid(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.uid}get canRead(){var e;return!!(this.uid&&this.aclCanRead(this.uid))||null!==(e=this.graph)&&void 0!==e&&!!e.canRead}get canWrite(){var e;return!!(this.uid&&this.aclCanWrite(this.uid))||null!==(e=this.graph)&&void 0!==e&&!!e.canWrite||!this.graph}isEveryCommitNewer(e){let n=this.lastCommitId;return null===n||e.every(e=>e.id>n)}get hasHistory(){return null!==this.lastCommitId}get assertYDoc(){let e=this.yDoc;if(!e)throw new v.KL(this);return e}get pendingYDoc(){let e=this.pendingCommit;if(e instanceof L.i)return e.getPendingYDoc(this)}get pendingDocument(){var e;return null===(e=this.pendingCommit)||void 0===e?void 0:e.getPendingDoc(this)}get pendingCommit(){var e;let n=null===(e=this.changeStore)||void 0===e?void 0:e.getPendingCommit(this);return null!=n?n:this.placeholderCommit}get pendingChangesCount(){var e,n;let r=this.pendingCommit;return null!==(n=null==r?void 0:null===(e=r.yjsUpdates)||void 0===e?void 0:e.length)&&void 0!==n?n:0}get editedDocument(){var e;return null!==(e=this.pendingDocument)&&void 0!==e?e:this.document}get editedYDoc(){var e;return null!==(e=this.pendingYDoc)&&void 0!==e?e:this.yDoc}get assertEditedYdoc(){let e=this.editedYDoc;if(!e)throw new v.h3(this);return e}get hasEditedYDoc(){return!!this.editedYDoc}get editedDocumentNode(){return this.editedDocument?(0,a.hH)(this.editedDocument):void 0}get editedDocumentHtml(){return this.editedDocumentNode?(0,a.eJ)(this.editedDocumentNode):""}get debouncedDocument(){return this.key,this.getDebouncedDocument(),(0,m.untracked)(()=>this.editedDocument)}get debouncedDocumentNode(){return this.debouncedDocument?(0,a.hH)(this.debouncedDocument):void 0}get debouncedSubject(){return this.debouncedDocumentNode?(0,a.kB)(this.debouncedDocumentNode):""}get yDocAsUpdateArray(){return this.yDocAsUpdate?(0,i._f)(this.yDocAsUpdate):void 0}setYDocAsUpdateArray(e){this.setYDocAsUpdate((0,i.kZ)(e))}setPlaceholderCommit(e){this.placeholderCommit=e}removePlaceholderCommit(){let e=this.placeholderCommit;return this.placeholderCommit=null,e}get yDoc(){if(this.yDocAsUpdateArray)return(0,S.NR)(this.yDocAsUpdateArray)}setYDoc(e){let n=a.pU.encodeStateAsUpdate(e);this.setYDocAsUpdateArray(n)}addIncomingUpdates(e){let n=this.incomingUpdatesCounter++;this.incomingUpdates=[...this.incomingUpdates,{counter:n,updates:e}]}getIncomingUpdates(e){var n,r;let o=this.incomingUpdates;null!==e&&(o=o.filter(n=>n.counter>e));let a=null!==(r=null===(n=p()(o))||void 0===n?void 0:n.counter)&&void 0!==r?r:null,i=o.flatMap(e=>e.updates);return{incomingUpdates:i,counter:a}}clearIncomingUpdates(){this.incomingUpdates.length>0&&(this.incomingUpdates=[])}get assertDocument(){let e=this.document;if(!e)throw new v.h3(this);return e}get documentNode(){if(this.document)return(0,a.hH)(this.document)}get documentJson(){return(0,T.l)(this.document)}get documentHash(){return this.documentJson?(0,M.Cv)(this.documentJson):void 0}get documentHtml(){return this.documentNode?(0,a.eJ)(this.documentNode):""}get documentMarkdown(){return this.documentNode?(0,a.b8)(this.documentNode):""}ensureYDoc(){this.yDoc||this.setEmptyYDoc()}setEmptyYDoc(){console.log("%csetting empty document","background: red; color: #fff"),(0,x.hu)(!this.editedYDoc,"[setEmptyDocument] expected no editedYDoc");let e=(0,H.Xq)(this.subject),n=(0,S.kg)(e.toJSON(),{template:!0}).ydoc,r=a.pU.encodeStateAsUpdate(n),o=new L.i({yjsUpdates:[(0,i.kZ)(r)]});o.setIsPlaceholder(!0),this.setPlaceholderCommit(o),this.setYDoc(new a.pU.Doc)}get publishUrl(){return"https://reflect.site/g/".concat(this.graphId,"/").concat(this.subjectSlug,"/").concat(this.id)}get indexPathForTasks(){var e,n;return[null!==(e=this.pinnedIndex)&&void 0!==e?e:Number.POSITIVE_INFINITY,-1*(null!==(n=this.editedAt)&&void 0!==n?n:0)]}get incomingBacklinks(){let e=this.graph,n=null==e?void 0:e.noteBacklinkStore;return(null==n?void 0:n.getSortedIncomingBacklinks(this.id))||[]}get outgoingBacklinks(){let e=this.graph,n=null==e?void 0:e.noteBacklinkStore;return(null==n?void 0:n.getOutgoingBacklinks(this.id))||[]}requestRerender(){this.rerenderCounter+=1}requestRemount(){this.remountCounter+=1,this.rerenderCounter+=1}setCreatedAtDate(e){this.createdAt=e.getTime()}setUpdatedAtDate(e){this.updatedAt=e.getTime()}setDeletedAtDate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;this.deletedAt=e.getTime(),this.touchUpdatedAt()}touchViewedAt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;this.viewedAt=e}handleDocChanged(){this.checkEnrichment(),this.syncSubject()}syncSubject(){let e=this.editedDocumentNode?(0,a.kB)(this.editedDocumentNode):void 0;e&&this.prevSubject!==e&&((0,f.Px)(this,(0,b.bd)(e)),this.prevSubject=e)}get taskNodes(){return this.editedDocumentNode?(0,a.kE)(this.editedDocumentNode):[]}syncFromTask(e){this.changeManager.modifyDocument(n=>(0,z.U3)({doc:n,taskGuid:e.id,taskFragment:e.contentDocumentNode.content,taskChecked:e.checked,taskArchived:e.archived,listName:this.daily?"Tasks":void 0}),{triggerChangedCallback:!1})}toggleTaskChecked(e){var n;let{taskGuid:r}=e;this.changeManager.modifyDocument(e=>(0,z.XG)({doc:e,taskGuid:r}),{triggerChangedCallback:!1}),null===(n=this.noteBacklinkStore)||void 0===n||n.refreshForNote(this.id)}convertTaskIntoChecklist(e){let{taskGuid:n}=e;this.changeManager.modifyDocument(e=>(0,z.p0)({doc:e,taskGuid:n}),{triggerChangedCallback:!1})}enablePublic(){this.acl=[...this.acl,"public"]}disablePublic(){this.acl=this.acl.filter(e=>"public"!==e)}async togglePublic(){this.public?this.disablePublic():this.enablePublic(),await this.changeManager.touch()}updatePinned(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return this.updatePinnedIndex(e?-1:null)}async updatePinnedIndex(e){this.pinnedIndex=e,await this.changeManager.saveMeta()}async ignoreSuggestedContact(e){this.ignoredContactNames.push(e.name),await this.changeManager.saveMeta()}isContactIgnored(e){return this.ignoredContactNames.includes(e.name)}async ignoreSuggestedBacklink(e){this.ignoredBacklinkLabels.push(e.label),this.ignoredBacklinkFromNoteIds.push(e.fromNoteId),await this.changeManager.saveMeta()}async incrementBacklinkedCount(){this.backlinkedCount+=1,await this.changeManager.saveMeta()}mergeDocument(e){this.changeManager.modifyDocument(n=>n?(0,a.Ne)(n,n=>{(0,a.jU)(n,e)}):e)}async addSuggestedContact(e){let n=this.assertGraph.id;await this.ignoreSuggestedContact(e),this.changeManager.modifyDocument(r=>(0,z.jd)({document:r,contact:e,graphId:n}))}addMeeting(e){let{meeting:n,meetingNote:r,attendeeNotes:o}=e;this.changeManager.modifyDocument(e=>(0,z.RN)({meeting:n,document:e,meetingNote:r,attendeeNotes:o}))}setEnrichment(e){this.systemMetadata={...this.systemMetadata,enrichment:e}}async updateEnrichment(e){d()(e,this.enrichment)||(this.setEnrichment(e),await this.changeManager.touch())}async checkEnrichment(){var e,n,r,o,a,i,s,l;let[c]=this.emails,[d]=this.domains;if(!c&&!d){this.enrichment&&await this.updateEnrichment(null);return}let u=null===(n=this.enrichment)||void 0===n?void 0:null===(e=n.person)||void 0===e?void 0:e.email,p=[null===(o=this.enrichment)||void 0===o?void 0:null===(r=o.company)||void 0===r?void 0:r.domain,null===(a=this.enrichment)||void 0===a?void 0:a.lookedUpDomain,...null!==(l=null===(s=this.enrichment)||void 0===s?void 0:null===(i=s.company)||void 0===i?void 0:i.domainAliases)&&void 0!==l?l:[]],h=!u&&!p.includes(d);(c!==u||h)&&await this.updateEnrichment(null),this.enrichment||await this.fetchEnrichment()}async fetchEnrichment(){if(this.enrichmentRequest||!this.hasPersonTag&&!this.hasCompanyTag)return;let[e]=this.emails,[n]=this.domains;if(!e&&!n)return;this.enrichmentRequest=(0,O.I)({email:e,domain:n});let r=await this.enrichmentRequest,o={...null!=r?r:{},...n&&{lookedUpDomain:n}};this.enrichmentRequest=null,await this.updateEnrichment(o)}async restore(){this.deletedAt=null,await this.changeManager.saveMeta()}async deleteOrDestroy(){this.deletedAt?await this.destroy():await this.delete()}async delete(){var e;await (null===(e=this.noteStore)||void 0===e?void 0:e.deleteNote(this))}async destroy(){var e;await (null===(e=this.noteStore)||void 0===e?void 0:e.destroyNote(this))}touchUpdatedAt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;this.updatedAt=e.getTime()}touchEditedAt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;this.editedAt=e.getTime()}touchEditedAndUpdatedAt(){this.touchEditedAt(),this.touchUpdatedAt()}createSnapshot(){let e=(0,y.vMv)(this);return{...e,document:this.document,systemMetadata:this.systemMetadata}}constructor(...e){super(...e),this.prevSubject=this.subject,this.incomingUpdates=[],this.incomingUpdatesCounter=0,this.placeholderCommit=null,this.rerenderCounter=1,this.remountCounter=1,this.getDebouncedDocument=function(e,n){let r=(0,m.observable)({counter:0}),o=l()(()=>(0,m.runInAction)(()=>r.counter+=1),1e3);return(0,m.autorun)(()=>{e(),o()}),(0,N.Om)(()=>(r.counter,(0,m.untracked)(()=>e())))}(()=>this.editedDocument,0),this.handleDocChangedDebounce=l()(this.handleDocChanged.bind(this),3e3)}};(0,o.gn)([m.observable],V.prototype,"viewedAt",void 0),(0,o.gn)([m.observable],V.prototype,"incomingUpdates",void 0),(0,o.gn)([m.observable],V.prototype,"incomingUpdatesCounter",void 0),(0,o.gn)([m.observable],V.prototype,"placeholderCommit",void 0),(0,o.gn)([m.observable],V.prototype,"rerenderCounter",void 0),(0,o.gn)([m.observable],V.prototype,"remountCounter",void 0),(0,o.gn)([m.computed],V.prototype,"key",null),(0,o.gn)([m.computed],V.prototype,"rerenderKey",null),(0,o.gn)([m.computed],V.prototype,"remountKey",null),(0,o.gn)([m.computed],V.prototype,"createdAtDate",null),(0,o.gn)([m.computed],V.prototype,"updatedAtDate",null),(0,o.gn)([m.computed],V.prototype,"updatedAtTime",null),(0,o.gn)([m.computed],V.prototype,"editedAtDate",null),(0,o.gn)([m.computed],V.prototype,"deletedAtDate",null),(0,o.gn)([m.computed],V.prototype,"pinned",null),(0,o.gn)([m.computed],V.prototype,"public",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"changeManager",null),(0,o.gn)([m.computed],V.prototype,"graphId",null),(0,o.gn)([m.computed],V.prototype,"linkHrefs",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"title",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"slug",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"subjectSlug",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"normalizedSubject",null),(0,o.gn)([m.computed],V.prototype,"line",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"emails",null),(0,o.gn)([m.computed],V.prototype,"phoneNumbers",null),(0,o.gn)([m.computed],V.prototype,"domains",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"tags",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"tasks",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"hasPersonTag",null),(0,o.gn)([m.computed],V.prototype,"hasCompanyTag",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"contentMetadata",null),(0,o.gn)([m.computed],V.prototype,"asin",null),(0,o.gn)([m.computed],V.prototype,"mentions",null),(0,o.gn)([m.computed],V.prototype,"snippet",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"isBlank",null),(0,o.gn)([m.computed],V.prototype,"editedOrUpdatedAtTime",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"editedAtFormatted",null),(0,o.gn)([m.computed],V.prototype,"dailyTense",null),(0,o.gn)([m.computed],V.prototype,"dailyDate",null),(0,o.gn)([m.computed],V.prototype,"dailyDateFormatted",null),(0,o.gn)([m.computed],V.prototype,"dailyAt",null),(0,o.gn)([m.computed],V.prototype,"isTodaysDailyNote",null),(0,o.gn)([m.computed],V.prototype,"enrichment",null),(0,o.gn)([m.computed],V.prototype,"previewSrc",null),(0,o.gn)([m.computed],V.prototype,"firstEmail",null),(0,o.gn)([m.computed],V.prototype,"enrichmentMatchText",null),(0,o.gn)([m.computed],V.prototype,"uid",null),(0,o.gn)([m.computed],V.prototype,"canRead",null),(0,o.gn)([m.computed],V.prototype,"canWrite",null),(0,o.gn)([m.computed],V.prototype,"pendingYDoc",null),(0,o.gn)([m.computed],V.prototype,"pendingDocument",null),(0,o.gn)([m.computed],V.prototype,"pendingCommit",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"editedDocument",null),(0,o.gn)([m.computed],V.prototype,"editedYDoc",null),(0,o.gn)([m.computed],V.prototype,"hasEditedYDoc",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"editedDocumentNode",null),(0,o.gn)([m.computed],V.prototype,"editedDocumentHtml",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"debouncedDocument",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"debouncedDocumentNode",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"debouncedSubject",null),(0,o.gn)([m.computed],V.prototype,"yDocAsUpdateArray",null),(0,o.gn)([m.action],V.prototype,"setPlaceholderCommit",null),(0,o.gn)([m.action],V.prototype,"removePlaceholderCommit",null),(0,o.gn)([m.computed],V.prototype,"yDoc",null),(0,o.gn)([m.action],V.prototype,"addIncomingUpdates",null),(0,o.gn)([m.action],V.prototype,"clearIncomingUpdates",null),(0,o.gn)([(0,m.computed)({keepAlive:!0})],V.prototype,"documentNode",null),(0,o.gn)([m.computed],V.prototype,"documentJson",null),(0,o.gn)([m.computed],V.prototype,"documentHash",null),(0,o.gn)([m.computed],V.prototype,"documentHtml",null),(0,o.gn)([m.computed],V.prototype,"documentMarkdown",null),(0,o.gn)([m.computed],V.prototype,"publishUrl",null),(0,o.gn)([m.computed],V.prototype,"indexPathForTasks",null),(0,o.gn)([m.computed],V.prototype,"incomingBacklinks",null),(0,o.gn)([m.action],V.prototype,"requestRerender",null),(0,o.gn)([m.action],V.prototype,"requestRemount",null),(0,o.gn)([y.ZBq],V.prototype,"setCreatedAtDate",null),(0,o.gn)([y.ZBq],V.prototype,"setUpdatedAtDate",null),(0,o.gn)([y.ZBq],V.prototype,"setDeletedAtDate",null),(0,o.gn)([m.action],V.prototype,"touchViewedAt",null),(0,o.gn)([y.ZBq],V.prototype,"syncSubject",null),(0,o.gn)([m.computed],V.prototype,"taskNodes",null),(0,o.gn)([y.ZBq],V.prototype,"enablePublic",null),(0,o.gn)([y.ZBq],V.prototype,"disablePublic",null),(0,o.gn)([y.ZBq],V.prototype,"updatePinned",null),(0,o.gn)([y.ZBq],V.prototype,"updatePinnedIndex",null),(0,o.gn)([y.ZBq],V.prototype,"ignoreSuggestedContact",null),(0,o.gn)([y.ZBq],V.prototype,"ignoreSuggestedBacklink",null),(0,o.gn)([y.ZBq],V.prototype,"incrementBacklinkedCount",null),(0,o.gn)([y.ZBq],V.prototype,"setEnrichment",null),(0,o.gn)([y.ZBq],V.prototype,"restore",null),(0,o.gn)([y.ZBq],V.prototype,"touchUpdatedAt",null),(0,o.gn)([y.ZBq],V.prototype,"touchEditedAt",null),V=(0,o.gn)([(0,y.o4J)("Note")],V)},80394:function(e,n,r){"use strict";r.d(n,{l7:function(){return parseNoteRefId},qg:function(){return i}});var o=r(53699),a=r(25271);let i=(0,o.ZMl)("NoteRef",{getId(e){if(!(e instanceof a.j))throw TypeError("must be note");return function(e){let{graphId:n,noteId:r}=e;return JSON.stringify({graphId:n,noteId:r})}({graphId:e.assertGraph.id,noteId:e.id})},resolve(e){let{graphId:n,noteId:r}=parseNoteRefId(e.id),a=(0,o.k0l)(e);if(!a)return;let i=a.graphStore.findById(n);return null==i?void 0:i.noteStore.pool.get(r)},onResolvedValueChange(e,n,r){r&&!n&&(0,o.ogt)(e)}});function parseNoteRefId(e){let n=JSON.parse(e);if(!n.graphId||!n.noteId)throw Error("Invalid NoteRef ID: it must contain both a graphId and a noteId");return n}},22255:function(e,n,r){"use strict";r.d(n,{M:function(){return y}});var o=r(97582),a=r(68949),i=r(53699),s=r(28418),l=r(48480),c=r(90783);let d=class extends(0,i.Hnr)({leftSidebarSize:(0,i.vgT)(300).withSetter(),rightSidebarSize:(0,i.vgT)(300).withSetter(),secondaryEditorRatio:(0,i.vgT)(.5).withSetter(),preferencesSidebarSize:(0,i.vgT)(300).withSetter()}){};d=(0,o.gn)([(0,i.o4J)("UiStateStore")],d);var u=r(540),p=r(20740),h=r(88766),g=r(44915),m=r(70586);let y=class extends(0,i.Hnr)({changeStore:(0,i.vgT)(()=>new l.Me({})),contactStore:(0,i.vgT)(()=>new s.fc({syncEnabled:!(0,h.W)()})),credentialStore:(0,i.vgT)(()=>new s.lT({})),graphStore:(0,i.vgT)(()=>new s.gH({})),mainView:(0,i.vgT)(()=>new c.v({})),meetingStore:(0,i.vgT)(()=>new s.BE({})),preferenceStore:(0,i.vgT)(()=>new s.Vi({})),promptTemplateStore:(0,i.vgT)(()=>new s.Ob({})),uiStateStore:(0,i.vgT)(()=>new d({})),userStore:(0,i.vgT)(()=>new s.U6({}))}){get noteStore(){var e;return null===(e=this.graphStore.currentGraph)||void 0===e?void 0:e.noteStore}get assertNoteStore(){return(0,g.wi)(this,"noteStore")}get bookStore(){var e;return null===(e=this.graphStore.currentGraph)||void 0===e?void 0:e.bookStore}get currentGraph(){return this.graphStore.currentGraph}get assertCurrentGraph(){return(0,g.wi)(this,"currentGraph")}get currentUser(){return this.userStore.currentUser}get assertCurrentUser(){let e=this.currentUser;if(!e)throw Error("user blank");return e}get credentials(){return this.credentialStore.credentials}get uid(){var e;return null===(e=this.userStore.currentUser)||void 0===e?void 0:e.id}get logger(){return m.k.child({userId:this.uid})}get currentUserIsGraphOwner(){var e;return null===(e=this.currentGraph)||void 0===e?void 0:e.isOwner}get needsGraphSetup(){let e=this.currentUser;return!!e&&!!e.ready&&0===e.graphIds.length}get userNeedsAuth(){return this.userStore.needsAuth}get currentUserAssociatedEmails(){var e,n;let r=this.currentUser,o=null!==(e=this.credentials)&&void 0!==e?e:[],a=null!==(n=null==o?void 0:o.map(e=>{let{email:n}=e;return n}))&&void 0!==n?n:[];return(null==r?void 0:r.email)&&a.push(r.email),a}setScreen(e){this.screen=e}openDefaultScreen(){this.screen=u.z2.Main}openPreferencesScreen(){this.screen=u.z2.Preferences}togglePreferencesScreen(){this.screen===u.z2.Preferences?this.openDefaultScreen():this.openPreferencesScreen()}get loadingState(){var e,n,r;let o=this.currentGraph,a=[[this.userNeedsAuth,u.Gu.Auth],[this.needsGraphSetup,u.Gu.GraphSetup],[!(null==o?void 0:o.ready),u.Gu.Loading],[!!(null==o?void 0:o.needsEncryptionSetup),u.Gu.GraphEncryptionSetup],[!!(null==o?void 0:null===(e=o.migrationManager)||void 0===e?void 0:e.migrating),u.Gu.Migrating],[!!(null==o?void 0:null===(n=o.migrationManager)||void 0===n?void 0:n.migrationFailed),u.Gu.MigrationFailed],[!!(null==o?void 0:null===(r=o.migrationManager)||void 0===r?void 0:r.migrationOffline),u.Gu.MigrationOffline],[!!(null==o?void 0:o.migratingElsewhere),u.Gu.Migrating],[!!(null==o?void 0:o.versionUnsupported),u.Gu.VersionUnsupported],[!(null==o?void 0:o.noteStore.persistenceReady),u.Gu.Loading],[!!(null==o?void 0:o.noteStore),u.Gu.MainScreen]];for(let[e,n]of a)if(e)return n;return u.Gu.Loading}setOnline(e){this.online=e}onAttachedToRootStore(){return this.logger.info("RootStore attached"),this.listeners.push(function(e){e(navigator.onLine);let handleOnline=()=>e(!0),handleOffline=()=>e(!1);return window.addEventListener("offline",handleOffline),window.addEventListener("online",handleOnline),()=>{window.removeEventListener("offline",handleOffline),window.removeEventListener("online",handleOnline)}}(e=>this.setOnline(e))),this.markLoadingState(),()=>this.beforeDetach()}async markLoadingState(){console.time("Loading all"),await (0,a.when)(()=>this.loadingState!==u.Gu.Loading),console.timeEnd("Loading all")}async beforeDetach(){return m.k.info("Detaching root-store"),(0,p.$)(this.listeners)}constructor(...e){super(...e),this.screen=u.z2.Main,this.online=!0,this.listeners=[]}};(0,o.gn)([a.observable],y.prototype,"screen",void 0),(0,o.gn)([a.observable],y.prototype,"online",void 0),(0,o.gn)([a.computed],y.prototype,"needsGraphSetup",null),(0,o.gn)([(0,a.computed)({keepAlive:!0})],y.prototype,"currentUserAssociatedEmails",null),(0,o.gn)([a.action],y.prototype,"setScreen",null),(0,o.gn)([a.action],y.prototype,"openDefaultScreen",null),(0,o.gn)([a.action],y.prototype,"openPreferencesScreen",null),(0,o.gn)([a.computed],y.prototype,"loadingState",null),(0,o.gn)([a.action],y.prototype,"setOnline",null),y=(0,o.gn)([(0,i.o4J)("root")],y)},11563:function(e,n,r){"use strict";r.d(n,{A3:function(){return i},O9:function(){return s},R0:function(){return u},UC:function(){return p},_H:function(){return o},c4:function(){return d},lw:function(){return a},mt:function(){return c},ps:function(){return l}});let o="person",a="company",i="author",s="meeting",l="book",c="link",d="article",u="tweet",p="podcast"},40328:function(e,n,r){"use strict";r.d(n,{i:function(){return Task}});var o=r(97582),a=r(15965),i=r(82644),s=r(33913),l=r(51085),c=r(23279),d=r.n(c),u=r(68949),p=r(88498),h=r(70173),g=r(13861),m=r(44717);let Task=class Task{static build(e){let{text:n,note:r}=e,o=n?[a.K3.paragraphText(n)]:[],i=a.K3.taskListItem(o,{checked:!1,archived:!1});return new Task({note:r,node:i})}get noteId(){return this.note.id}get checked(){var e;return null!==(e=this.checkedPending)&&void 0!==e?e:this.node.attrs.checked}setChecked(e){this.checkedPending=e}updateChecked(e){this.setChecked(e),this.setArchived(!1),this.syncToNote()}get archived(){var e;return!!this.checked&&(null!==(e=this.archivedPending)&&void 0!==e?e:this.node.attrs.archived)}setArchived(e){this.archivedPending=e}updateArchived(e){this.setArchived(e),this.syncToNote()}get overdue(){let e=this.dueOrDailyDate;return!!e&&!(0,l.Z)(e)&&(0,s.Z)(e)}get upcoming(){let e=this.dueOrDailyDate;return!!e&&!(0,l.Z)(e)&&(0,i.Z)(e)}get current(){let e=this.dueOrDailyDate;return!!e&&(0,l.Z)(e)}get contentDocument(){var e,n;return null!==(n=this.contentDocumentPending)&&void 0!==n?n:(0,a.cO)(this.node,null===(e=this.note.document)||void 0===e?void 0:e.attrs)}setContentDocument(e){this.contentDocumentPending=e}get contentDocumentNode(){return(0,a.hH)(this.contentDocument)}get inlineDocument(){return(0,a.MQ)(this.contentDocument)}get inlineDocumentNode(){return(0,a.hH)(this.inlineDocument)}get inlineDocumentHtml(){return(0,a.eJ)(this.inlineDocumentNode)}updateInlineDocument(e){let{debounce:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(0,a.wk)({doc:this.contentDocument,inlineDoc:e});return this.setContentDocument(r),this.syncToNote({debounce:n})}syncToNote(){let{debounce:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e){this.syncToNoteDebounce();return}this.note.syncFromTask(this)}convertChecklist(){this.note.convertTaskIntoChecklist({taskGuid:this.id})}async schedule(e){var n,r;let o=e.dailyDate;if(!o)return;await e.incrementBacklinkedCount();let i=this.contentDocumentNode,s=(0,a.S3)(i,{id:e.id,label:(0,p.l6)(o,null===(r=this.rootStore)||void 0===r?void 0:null===(n=r.preferenceStore)||void 0===n?void 0:n.dateFormat),graphId:e.graphId},e=>(0,h.$4)(e.id));this.setContentDocument((0,a.FT)(s)),this.syncToNote()}syncToNoteFlush(){this.syncToNoteDebounce.flush()}matches(e){return!!this.matchText&&this.matchText.includes(e)}get dueDate(){let e=(0,a.QA)(this.node,e=>(0,h.$4)(e.id));return(0,h.cB)(null==e?void 0:e.id)||null}get dueOrDailyDate(){var e,n;return null!==(n=null!==(e=this.dueDate)&&void 0!==e?e:this.note.dailyDate)&&void 0!==n?n:null}get groupKey(){let e=this.dueOrDailyDate;return e?(0,l.Z)(e)?"current":(0,i.Z)(e)?"upcoming":"overdue":this.note}get rootStore(){return this.note.rootStore}get contentNodeText(){var e,n;return null!==(n=null===(e=this.node)||void 0===e?void 0:e.textContent)&&void 0!==n?n:""}get matchText(){var e;let n=[this.contentNodeText,null===(e=this.note)||void 0===e?void 0:e.subject].filter(g.Dw);return(0,m.U)(n.join(" "))}constructor({node:e,note:n}){this.group=null,this.contentDocumentPending=null,this.checkedPending=null,this.archivedPending=null,this.syncToNoteDebounce=d()(this.syncToNote.bind(this),3e3),this.id=e.attrs.guid,this.node=null!=e?e:null,this.note=n,(0,u.makeObservable)(this)}};(0,o.gn)([u.observable],Task.prototype,"contentDocumentPending",void 0),(0,o.gn)([u.observable],Task.prototype,"checkedPending",void 0),(0,o.gn)([u.observable],Task.prototype,"archivedPending",void 0),(0,o.gn)([u.computed],Task.prototype,"checked",null),(0,o.gn)([u.action],Task.prototype,"setChecked",null),(0,o.gn)([u.computed],Task.prototype,"archived",null),(0,o.gn)([u.action],Task.prototype,"setArchived",null),(0,o.gn)([u.computed],Task.prototype,"overdue",null),(0,o.gn)([u.computed],Task.prototype,"upcoming",null),(0,o.gn)([u.computed],Task.prototype,"current",null),(0,o.gn)([u.computed],Task.prototype,"contentDocument",null),(0,o.gn)([u.action],Task.prototype,"setContentDocument",null),(0,o.gn)([u.computed],Task.prototype,"contentDocumentNode",null),(0,o.gn)([u.computed],Task.prototype,"inlineDocument",null),(0,o.gn)([u.computed],Task.prototype,"inlineDocumentNode",null),(0,o.gn)([u.computed],Task.prototype,"inlineDocumentHtml",null),(0,o.gn)([u.computed],Task.prototype,"dueDate",null),(0,o.gn)([u.computed],Task.prototype,"groupKey",null),(0,o.gn)([u.computed],Task.prototype,"contentNodeText",null),(0,o.gn)([(0,u.computed)({keepAlive:!0})],Task.prototype,"matchText",null)},15562:function(e,n,r){"use strict";var o,a;r.d(n,{u:function(){return o}}),(a=o||(o={})).Active="active",a.Canceled="canceled",a.Incomplete="incomplete",a.IncompleteExpired="incomplete_expired",a.PastDue="past_due",a.Trialing="trialing",a.Unpaid="unpaid"},540:function(e,n,r){"use strict";var o,a,i,s,l,c,d,u,p,h;r.d(n,{Gu:function(){return o},JY:function(){return l},oK:function(){return i},q4:function(){return g},xr:function(){return s},z2:function(){return a}});let g="0.2.5";(c=o||(o={})).Auth="Auth",c.GraphSetup="GraphSetup",c.GraphEncryptionSetup="GraphEncryptionSetup",c.Migrating="Migrating",c.MigrationFailed="MigrationFailed",c.MigrationOffline="MigrationOffline",c.MigrationRequired="MigrationRequired",c.VersionUnsupported="VersionUnsupported",c.MainScreen="MainScreen",c.Loading="Loading",(d=a||(a={})).Main="main",d.Preferences="preferences",(u=i||(i={})).NoteDaily="note-daily",u.NoteList="note-list",u.NoteEdit="note-edit",u.Map="map",u.TaskList="task-list",(p=s||(s={})).Shortcuts="shortcuts",p.Search="search",(h=l||(l={})).Profile="profile",h.Credentials="credentials",h.Templates="templates",h.Billing="billing",h.Graph="graph",h.NewGraph="new-graph"},54892:function(e,n,r){"use strict";r.d(n,{b:function(){return l},W:function(){return TailwindColorPicker}});var o=r(85893),a=r(30471),i=r(44080),s=r(67294);let ColorMenuItem=e=>{let{hex:n,onClick:r}=e;return(0,o.jsx)(a.v.Item,{children:(0,o.jsx)("button",{className:"h-5 w-5 rounded-md",style:{backgroundColor:n},onClick:r})})},l=["#737373","#f97316","#f59e0b","#eab308","#84cc16","#22c55e","#10b981","#14b8a6","#06b6d4","#0ea5e9","#3b82f6","#6366f1","#8b5cf6","#a855f7","#d946ef","#ec4899","#f43f5e","#ef4444"],TailwindColorPicker=e=>{let{value:n,onChange:r}=e,setValue=e=>{null==r||r(e)};return(0,o.jsxs)(a.v,{as:"div",className:"relative",children:[(0,o.jsx)(a.v.Button,{className:"block",children:(0,o.jsx)("div",{className:"h-5 w-5 rounded-md bg-gray-100",style:n?{backgroundColor:n}:{}})}),(0,o.jsx)(i.u,{as:s.Fragment,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",children:(0,o.jsx)(a.v.Items,{className:"absolute left-0 top-7 origin-top-left rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-bluegray-600",children:(0,o.jsx)("div",{className:"grid grid-cols-6 gap-2 p-2",children:l.map(e=>(0,o.jsx)(ColorMenuItem,{hex:e,onClick:()=>setValue(e)},e))})})})]})}},88498:function(e,n,r){"use strict";r.d(n,{$X:function(){return addWeekdayToFormat},l6:function(){return shorthandFormatDate},mr:function(){return formatTime},p6:function(){return formatDate},sG:function(){return parseDate},zg:function(){return formatRelativeDate}});var o=r(42298),a=r(98995),i=r(51085),s=r(12274),l=r(80567);function formatDate(e,n){switch(n){case"dayMonthYear":return(0,o.Z)(e,"do MMMM, yyyy");case"monthDayYear":return(0,o.Z)(e,"MMMM do, yyyy");case"weekDayMonthYear":return(0,o.Z)(e,"EEE, do MMMM, yyyy");case"weekMonthDayYear":return(0,o.Z)(e,"EEE, MMMM do, yyyy")}}function shorthandFormatDate(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"weekDayMonthYear";switch(n){case"dayMonthYear":return(0,o.Z)(e,"d/M/yyyy");case"monthDayYear":return(0,o.Z)(e,"M/d/yyyy");case"weekDayMonthYear":return(0,o.Z)(e,"EEE, d/M/yyyy");case"weekMonthDayYear":return(0,o.Z)(e,"EEE, M/d/yyyy")}}function addWeekdayToFormat(e){return"dayMonthYear"===e?"weekDayMonthYear":"weekMonthDayYear"}function formatTime(e,n){return(0,o.Z)(e,"24"===n?"HH:mm":"h:mmaaa")}function formatRelativeDate(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"monthDayYear",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"12";return(0,i.Z)(e)?formatTime(e,r):(0,a.Z)(e)?(0,o.Z)(e,"eee"):shorthandFormatDate(e,n)}function fnsParseValid(e,n,r){let o=(0,l.Z)(e,n,r);return(0,s.Z)(o)?o:void 0}function parseDate(e,n){var r,o,a,i;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Date;switch(n){case"dayMonthYear":return null!==(o=null!==(r=fnsParseValid(e,"dd/MM/yyyy",s))&&void 0!==r?r:fnsParseValid(e,"d/M/yyyy",s))&&void 0!==o?o:fnsParseValid(e,"d/M",s);case"monthDayYear":return null!==(i=null!==(a=fnsParseValid(e,"MM/dd/yyyy",s))&&void 0!==a?a:fnsParseValid(e,"M/d/yyyy",s))&&void 0!==i?i:fnsParseValid(e,"M/d",s)}}},70173:function(e,n,r){"use strict";function slugToId(e){return e.toLowerCase().trim().replace(/^.+-/g,"").replace(/[\W_]/g,"")}function toDailyNoteId(e){if(e instanceof Date||(e=new Date(e)),Number.isNaN(e.getTime()))throw TypeError("Invalid date");let n=e.getDate(),r=e.getMonth()+1,o=e.getFullYear(),a=n<10?"0"+n.toString():n,i=r<10?"0"+r.toString():r;return"".concat(a).concat(i).concat(o)}function isDailyNoteId(e){return/^\d{8}$/.test(e)}function parseDailyNoteId(e){if(!e)return;let n=e.match(/^(\d{2})(\d{2})(\d{4})$/);if(!n)return;let r=Number.parseInt(n[1]),o=Number.parseInt(n[2]),a=Number.parseInt(n[3]);if(r<1||r>31||o<1||o>12)return;let i=new Date(a,o-1,r);return Number.isNaN(i.getTime())?void 0:i}r.d(n,{$4:function(){return isDailyNoteId},SG:function(){return slugToId},cB:function(){return parseDailyNoteId},l5:function(){return toDailyNoteId}})},20740:function(e,n,r){"use strict";function unsubscriberListeners(e){return Promise.all(e.map(unsubscriberListener))}async function unsubscriberListener(e){if("function"==typeof e)e();else if("function"==typeof e.cancel)e.cancel();else{var n;null===(n=await e)||void 0===n||n()}}r.d(n,{$:function(){return unsubscriberListeners}})},46551:function(e,n,r){"use strict";r.d(n,{Bu:function(){return applyUpdates},CI:function(){return htmlFromYDoc},Gn:function(){return yjsDiff},KT:function(){return yDocToBase64},NR:function(){return yDocFromUpdate},Q:function(){return yjsUpdateHasChanges},gc:function(){return nodeFromYDoc},kg:function(){return createYjsDocFromDocument}});var o=r(15965),a=r(52300);r(8804),r(44908);var i=r(82058);function yjsUpdateHasChanges(e,n){let r=o.pU.encodeStateVector(n);e=o.pU.diffUpdate(e,r);let a=function(e,n){let r=o.pU.snapshot(n).ds,a=o.pU.decodeUpdate(e).ds;for(let[e,n]of a.clients)for(let a of n){let n=new o.pU.ID(e,a.clock);if(!o.pU.isDeleted(r,n))return!0}return!1}(e,n);return a||function(e){let n=o.pU.parseUpdateMeta(e);return n.from.size>0||n.to.size>0}(e)}function yjsDiff(e){let{originalYDoc:n,updatedNode:r}=e,a=new o.pU.Doc;o.pU.applyUpdate(a,o.pU.encodeStateAsUpdate(n));let i=[];return a.on("update",e=>i.push(e)),function(e,n){let r=n.get("prosemirror",o.pU.XmlFragment);(0,o.e$)(e,r)}(r,a),i}function createYjsDocFromDocument(e,n){let r=(0,o.hH)(e);if(null==n?void 0:n.template){let n=(0,i.j6)(e),a=(0,o.VN)(r,{clientID:n});return{ydoc:a,node:r,clientId:n}}{let e=(0,o.VN)(r);return{ydoc:e,node:r}}}function applyUpdates(e,n){for(let r of n)o.pU.applyUpdate(e,r)}function yDocToBase64(e){let n=o.pU.encodeStateAsUpdate(e);return(0,a.kZ)(n)}function htmlFromYDoc(e){let n=nodeFromYDoc(e);return(0,o.eJ)(n)}function nodeFromYDoc(e){return(0,o._w)(o.fK,e)}function yDocFromUpdate(e){let n=new o.pU.Doc;return o.pU.applyUpdate(n,e),n}},13861:function(e,n,r){"use strict";function notEmpty(e){return null!=e}function swap(e,n,r){let o=e[n],a=e.length,i=n-r;if(i>0)return[...e.slice(0,r),o,...e.slice(r,n),...e.slice(n+1,a)];if(i<0){let i=r+1;return[...e.slice(0,n),...e.slice(n+1,i),o,...e.slice(i,a)]}return e}r.d(n,{Dw:function(){return notEmpty},LF:function(){return swap}})},14066:function(e,n,r){"use strict";r.d(n,{Ee:function(){return assertString},Rn:function(){return assertPositiveNumber},hu:function(){return assert}}),r(48764).Buffer;let AssertError=class AssertError extends Error{constructor(e){super(e),this.name="AssertError"}};function assert(e,n){if(!e)throw new AssertError(n)}function assertString(e,n){if("string"!=typeof e||0===e.length)throw new AssertError(n)}function assertPositiveNumber(e,n){if(!function(e,n){if("number"!=typeof e||Number.isNaN(e))throw new AssertError(n)}(e,n),e<=0)throw new AssertError(n)}},88766:function(e,n,r){"use strict";r.d(n,{W:function(){return isCapacitor}});var o=r(29895);function isCapacitor(){return o.dV.isNativePlatform()}},76661:function(e,n,r){"use strict";r.d(n,{R4:function(){return createCsvBlob},yr:function(){return createAndDownloadCsv}});var o=r(57460),a=r(92593);function createCsvBlob(e){let n=(0,o.unparse)(e);return new Blob([n],{type:"text/csv"})}function createAndDownloadCsv(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export.csv",r=(0,o.unparse)(e);!function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"export.csv",r=new Blob([e],{type:"text/csv"});(0,a.l)(r,n)}(r,n)}},91425:function(e,n,r){"use strict";r.d(n,{KF:function(){return currentEnvironment},Y8:function(){return isTest},yG:function(){return isDevelopment}});var o=r(34155);function currentEnvironment(){let e=null==o?void 0:"production";return"development"===e?"development":"production"===e?"production":"test"===e?"test":void 0}function isDevelopment(){return"development"===currentEnvironment()}function isTest(){return"test"===currentEnvironment()}},88734:function(e,n,r){"use strict";r.d(n,{CR:function(){return c},zO:function(){return now},zk:function(){return l}});var o=r(3151),a=r(83725),i=r(19013),s=r(27661);function now(){return(0,s.zO)(18e5)}let l=(0,s.Om)(e=>(0,o.Z)(e,now())),c=(0,s.Om)(e=>(0,i.Z)(e).getTime()<now());(0,s.Om)(e=>(0,a.Z)(e,now()))},92593:function(e,n,r){"use strict";function downloadBlob(e,n){let r=URL.createObjectURL(e),o=window.document.createElement("a");o.download=n,o.href=r,o.click()}r.d(n,{l:function(){return downloadBlob}})},68825:function(e,n,r){"use strict";r.d(n,{O:function(){return generateId}});var o=r(25934);let generateId=()=>(0,o.Z)().replace(/-/g,"")},6890:function(e,n,r){"use strict";r.d(n,{AC:function(){return jsonFetch},C8:function(){return jsonPost},Cy:function(){return catchNetworkError}});let JsonFetchError=class JsonFetchError extends Error{constructor(e,n){super(e),this.name="JsonFetchError",this.status=n}};async function jsonFetch(e){let{url:n,method:r,body:o,headers:a,searchParams:i,bearerAuth:s,tokenAuth:l,throwOnHttpError:c=!0}=e,d={method:r||(o?"POST":"GET"),headers:{...o?{"Content-Type":"application/json"}:{},...s?{Authorization:"Bearer ".concat(s)}:{},...l?{Authorization:"Token ".concat(l)}:{},...null!=a?a:{}},body:o?JSON.stringify(o):void 0};if(i){let e=new URL(n);for(let[n,r]of Object.entries(i))e.searchParams.append(n,String(r));n=e.toString()}let u=await fetch(n,d);if(500===u.status||c&&!u.ok){let e=n.replace(/\?.*$/,"?hidden_for_logging");throw new JsonFetchError("Request failed for ".concat(d.method," ").concat(e,": ").concat(u.status," ").concat(u.statusText,": ").concat(await u.text()),u.status)}return u.json()}async function jsonPost(e,n){return await jsonFetch({url:e,body:n,method:"POST"})}function catchNetworkError(e,n){if(e instanceof JsonFetchError)console.warn(n);else throw e}},68236:function(e,n,r){"use strict";function jsonStringify(e){return JSON.stringify(e)}r.d(n,{l:function(){return jsonStringify}})},44915:function(e,n,r){"use strict";r.d(n,{w0:function(){return assertParent},wi:function(){return assertProp},pE:function(){return assertRootStore}});var o=r(53699);let MissingRootStoreError=class MissingRootStoreError extends Error{constructor(e){super("Missing root store for ".concat(e.$modelType," [").concat(e.getRefId(),"]")),this.name="MissingRootStoreError"}};let MissingPropError=class MissingPropError extends Error{constructor(e,n){super("Missing prop ".concat(e," in ").concat(n.$modelType)),this.name="MissingPropError"}};let MissingParentError=class MissingParentError extends Error{constructor(e){super("Missing parent in ".concat(e)),this.name="MissingParentError"}};function assertParent(e){let n=(0,o.G_R)(e);if(!n){if((0,o.uNj)(e))throw new MissingPropError("parent",e);throw new MissingParentError(e)}return n}function assertRootStore(e){let n=(0,o.k0l)(e);if(!n)throw new MissingRootStoreError(e);return n}function assertProp(e,n){let r=e[n];if(!r)throw new MissingPropError(n,e);return r}},47638:function(e,n,r){"use strict";r.d(n,{N:function(){return frozenTransform}});var o=r(53699);function frozenTransform(){return{transform(e){let{originalValue:n}=e;return n.data},untransform(e){let{transformedValue:n}=e;return(0,o.jps)(n)}}}},44717:function(e,n,r){"use strict";r.d(n,{U:function(){return normalizeQuery}});var o=r(16404);function normalizeQuery(e){return(0,o.l)(e).trim().toLowerCase().replace(/^"(.*)"$/,"$1")}},95440:function(e,n,r){"use strict";r.d(n,{j:function(){return PlatformStorage}});let PlatformStorage=class PlatformStorage{static setup(e){PlatformStorage.adapter=e}static get current(){if(!this.adapter)throw Error("Storage not initialized, call PlatformStorage.setup() first");return this.adapter}static keys(){return PlatformStorage.current.keys()}static setItem(e,n){return PlatformStorage.current.setItem(e,n)}static getItem(e){return PlatformStorage.current.getItem(e)}static removeItem(e){return PlatformStorage.current.removeItem(e)}static clear(){return PlatformStorage.current.clear()}};PlatformStorage.adapter=null},16404:function(e,n,r){"use strict";function purgeAccents(e){return e?e.normalize("NFD").replace(RegExp("\\p{Diacritic}","gu"),"").normalize("NFC"):""}r.d(n,{l:function(){return purgeAccents}})},33002:function(e,n,r){"use strict";function requestIdleCallback(e){return"function"==typeof window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e)}r.d(n,{Kk:function(){return requestIdleCallback}}),n.ZP=requestIdleCallback},10256:function(e,n){"use strict";n.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(n=>{setTimeout(n,e)})}},82058:function(e,n,r){"use strict";r.d(n,{Cv:function(){return a},j6:function(){return unsignedObjectHash}});var o=r(85393);let a=o.Z;function unsignedObjectHash(e){return Math.abs(a(JSON.stringify(e)))}},30503:function(e,n,r){"use strict";r.d(n,{G:function(){return timeoutPromise}});var o=r(6553),a=r(10256);async function errorAfterTimeout(e){throw await (0,a.Z)(e),new o.m}function timeoutPromise(e,n){return Promise.race([e,errorAfterTimeout(n)])}},25038:function(e,n,r){"use strict";r.d(n,{yV:function(){return identify},Md:function(){return page},j:function(){return track}});var o=r(25934);let a="anonymous-id";var i=r(40127);async function buildAnalyticsBeacon(e){let n,{properties:r={},context:s={},event:l}=e,c=await (0,i.nX)(),d=null==c?void 0:c.uid,u=null==c?void 0:c.email,p=((n=function(e){var n;let r=window.document.cookie.match("(^|;)\\s*"+e+"\\s*=\\s*([^;]+)");return r&&null!==(n=r.pop())&&void 0!==n?n:null}(a)||window.localStorage.getItem(a))||(n=(0,o.Z)()),function(e){try{!function(e){var n,r,o,i;let s=null!==(n=null!==(i=null===(o=window.location)||void 0===o?void 0:null===(r=o.hostname)||void 0===r?void 0:r.replace(/^(?:[^.]+\.)*(\w+\.\w+)$/,"$1"))&&void 0!==i?i:null)&&void 0!==n?n:void 0;(function(e){let{name:n,value:r,domain:o,daysToLive:a}=e,i=n+"="+encodeURIComponent(r);if("number"==typeof a){let e=new Date;e.setTime(e.getTime()+864e5*a),i+="; expires="+e.toUTCString()}"string"==typeof o&&(i+="; domain=.".concat(o)),i+="; path=/",window.document.cookie=i})({name:a,value:e,domain:s,daysToLive:365}),window.localStorage.setItem(a,e)}(e)}catch(e){console.error("Error setting anonymous ID",e)}}(n),n),h={...r,email:u},g={...s,...function(){let e={path:window.location.pathname,title:window.document.title,search:window.location.search,url:window.location.href,referrer:window.document.referrer},n={width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio},r={name:window.navigator.platform,version:window.navigator.appVersion},o=window.navigator.language,a=function(){var e,n,r,o,a;let i=new URL(window.location.href).searchParams;return{source:null!==(e=null==i?void 0:i.get("utm_source"))&&void 0!==e?e:void 0,medium:null!==(n=null==i?void 0:i.get("utm_medium"))&&void 0!==n?n:void 0,name:null!==(r=null==i?void 0:i.get("utm_campaign"))&&void 0!==r?r:void 0,term:null!==(o=null==i?void 0:i.get("utm_term"))&&void 0!==o?o:void 0,content:null!==(a=null==i?void 0:i.get("utm_content"))&&void 0!==a?a:void 0}}(),i=window.navigator.userAgent;return{page:e,screen:n,os:r,locale:o,campaign:a,userAgent:i}}()};return{userId:d,anonymousId:p,properties:h,context:g,event:l}}let s="undefined"!=typeof Blob&&"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon;var l=r(62286),c=r(35339);function identify(e){(0,c.V5)(e)}function track(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};buildAnalyticsBeacon({event:e,properties:n}).then(e=>{!function(e,n){if(!s)return;let r=new Blob([JSON.stringify({beacon:n})],{type:"application/json; charset=UTF-8"});try{navigator.sendBeacon(e,r)}catch(e){return!1}}("/api/beacon/event",e)})}function page(){let e=window.location.href,n=window.location.pathname,r=window.document.title,o=window.location.search,a=window.document.referrer,i=function(){let e,n;let r=(0,l.parseCookies)(),{_fbc:o,_fbp:a}=r,i=new URL(window.location.href),s=i.searchParams.get("fbclid"),c=new Date().getTime();return s?e="fb.1.".concat(c,".").concat(s):o&&(e=o),a&&(n=a),{fbp:n,fbc:e}}(),s={url:e,path:n,title:r,search:o,referrer:a,...i};return track("page",s)}},7935:function(e,n,r){"use strict";r.d(n,{mq:function(){return onCalendarsSnapshot},ZU:function(){return saveCalendars}});var o=r(65422),a=r(29823),i=r(26655),s=r(98930),l=r(91871);async function onCalendarsSnapshot(e,n){let r=await (0,l.b)(),a=(0,o.N6)({db:i.db,userId:r,credentialId:e});return s.RZ.onSnapshot(a,e=>{n(e.docs.map(calendarFromDoc))})}async function saveCalendars(e,n){let r=await (0,l.b)(),a=(0,o.N6)({db:i.db,userId:r,credentialId:e}),c=s.RZ.writeBatch(i.db);n.forEach(e=>{let n=s.RZ.doc(a,e.id);c.set(n,{enabled:e.enabled},{merge:!0})}),await c.commit()}function calendarFromDoc(e){var n,r,o;let i=e.data();return new a.f({id:e.id,name:null!==(r=null!==(n=i.name)&&void 0!==n?n:i.summary)&&void 0!==r?r:"",primary:i.primary,enabled:i.enabled,priority:null!==(o=i.priority)&&void 0!==o?o:0})}},83856:function(e,n,r){"use strict";r.d(n,{L7:function(){return isCommitLarge},Rs:function(){return applyMergedSnapshot},jQ:function(){return debugCommits},wk:function(){return obfuscateDoc}});var o=r(15965),a=r(53699);function applyMergedSnapshot(e,n){let r=(0,a.vMv)(e),o={...n,document:r.document,lastCommitId:r.lastCommitId,yDocAsUpdate:r.yDocAsUpdate,id:e.id,$modelType:e.$modelType};(0,a.Xx3)(e,o)}function obfuscateDoc(e){try{return e?(0,o.HU)(e):null}catch(e){return{error:"Couldn't obfuscate document"}}}function debugCommit(e){var n;return"<".concat(e.id,"/").concat(null===(n=e.yjsUpdates)||void 0===n?void 0:n.length,">")}function debugCommits(e){return e.map(debugCommit).join(", ")}function isCommitLarge(e){var n,r;return(null!==(r=null===(n=e.yjsUpdates)||void 0===n?void 0:n.length)&&void 0!==r?r:0)>1e3}},34102:function(e,n,r){"use strict";r.d(n,{_j:function(){return backupPendingCommit},t9:function(){return getBackupsForNote}});var o=r(65422),a=r(39828),i=r(98596),s=r(13861),l=r(26655),c=r(98930),d=r(25152),u=r(69963),p=r(55714),h=r(9069);async function backupPendingCommit(e){let{note:n,commit:r}=e,a=n.assertGraph,i=(0,o.yK)({db:l.db,graphId:a.id,noteId:n.id,backupId:r.id}),s=await pendingCommitToBackupDoc({graph:a,note:n,commit:r});await c.RZ.setDoc(i,s)}async function pendingCommitToBackupDoc(e){let{graph:n,note:r,commit:o}=e,i=(0,h.Ii)({graph:n,note:r}),s=o.getPendingDoc(r),l=await (0,h.ec)(s,i);return{id:o.id,created_at:a.Timestamp.now(),document_json:l,platform:(0,d.ob)()}}async function getBackupsForNote(e){let{graph:n,noteId:r,encryptionKey:a=n.assertEncryptionKey,skipErrors:i=!1}=e,d=(0,o.rk)({db:l.db,graphId:n.id,noteId:r}),u=await c.RZ.getDocs(d),p=u.docs.map(e=>{let n={snapshot:e,noteId:r,encryptionKey:a};return i?silentConvertSnapshotToBackup(n):convertSnapshotToBackup(n)}),h=await Promise.all(p);return h.filter(s.Dw)}async function silentConvertSnapshotToBackup(e){try{return await convertSnapshotToBackup(e)}catch(n){return console.warn("skipping backup",e.noteId,e.snapshot.id),(0,u.Tb)(n),null}}async function convertSnapshotToBackup(e){var n;let{encryptionKey:r,noteId:o,snapshot:a}=e,s=a.data(),l=a.id;if(!s)return;let c=await (0,p.MJ)({type:"CommitBackup",value:s.document_json,key:r,itemId:o}),d=c?JSON.parse(c):void 0;if(d)return new i.f({id:l,document:d,createdAt:null===(n=s.created_at)||void 0===n?void 0:n.toMillis(),platform:s.platform})}},27809:function(e,n,r){"use strict";r.d(n,{PJ:function(){return convertSnapshotToCommit},mP:function(){return decryptYjsUpdates},x3:function(){return getCommitsForNote}});var o=r(65422),a=r(89734),i=r.n(a),s=r(37997),l=r(13861),c=r(26655),d=r(98930),u=r(69963),p=r(55714),h=r(39541);async function getCommitsForNote(e){let{graph:n,noteId:r,afterCommitId:a,encryptionKey:s=n.assertEncryptionKey,skipErrors:u=!1}=e,p=(0,o.Ul)({db:c.db,graphId:n.id,noteId:r}),h=null!==a?d.RZ.query(p,d.RZ.where("id",">",a)):p,g=await d.RZ.getDocs(h),m=g.docs.map(e=>{let n={noteId:r,encryptionKey:s,snapshot:e};return u?silentConvertSnapshotToCommit(n):convertSnapshotToCommit(n)}),y=await Promise.all(m);return i()(y.filter(l.Dw),e=>e.id)}async function silentConvertSnapshotToCommit(e){try{return await convertSnapshotToCommit(e)}catch(n){return console.warn("skipping commit",e.noteId,e.snapshot.id),(0,u.Tb)(n),null}}async function convertSnapshotToCommit(e){var n,r,o;let{encryptionKey:a,noteId:i,snapshot:l}=e,c=l.data();if(!c)throw Error("missing data");let d={itemId:i,key:a},u=await decryptYjsUpdates(null!==(r=c.yjs_updates)&&void 0!==r?r:null,d),p=await (0,h.V)(c.yjs_doc,d),g=c.document_json?await decryptDocument(c.document_json,d):null;return new s.o({id:c.id,yjsUpdates:u,yjsDocAsUpdate:p,document:g,createdAt:null!==(o=null===(n=c.created_at)||void 0===n?void 0:n.toMillis())&&void 0!==o?o:void 0,platform:c.platform})}async function decryptDocument(e,n){let r=await (0,p.MJ)({type:"Commit",value:e,...n}),o=r?JSON.parse(r):null;return o}async function decryptYjsUpdates(e,n){return e?await Promise.all(e.map(e=>(0,p.gq)({type:"Commit",value:e,...n}))):[]}},36650:function(e,n,r){"use strict";r.d(n,{Ms:function(){return setContactCustomName},YO:function(){return getAuthUserContactsRef}});var o=r(65422),a=r(26655),i=r(91871);async function getAuthUserContactsRef(){let e=await (0,i.b)();return(0,o.pN)({db:a.db,userId:e})}async function setContactCustomName(e){let{email:n,contactId:r,customName:s}=e,l=await (0,i.b)();if(r){let e=(0,o.ll)({db:a.db,userId:l,contactId:r});if((0,o.Gg)(await (0,o.QT)(e))){await (0,o.r7)(e,{custom_name:s});return}}let c=(0,o.pN)({db:a.db,userId:l}),d=await findContactsByEmail(n);if(d.length>0){for(let e of d){let n=(0,o.JU)(c,e.id);await (0,o.r7)(n,{custom_name:s})}return}{let e=(0,o.JU)(c);return(0,o.pl)(e,{custom_name:s,email_values:[n],emails:[{value:n,primary:!0}]},{merge:!0})}}async function findContactsByEmail(e){let n=await (0,i.b)(),r=(0,o.pN)({db:a.db,userId:n}),s=(0,o.IO)(r,(0,o.ZB)("email_values","array-contains-any",[e])),l=await (0,o.PL)(s);return l.docs}},68070:function(e,n,r){"use strict";r.d(n,{CL:function(){return getAuthCredentialsUrl},bL:function(){return revokeCredential},p2:function(){return onCredentialsSnapshot}});var o=r(65422),a=r(28418),i=r(26655),s=r(98930),l=r(40127),c=r(91871);async function getAuthCredentialsUrl(e){let n=await (0,l.i1)();return location.origin+"/api/credentials/auth/".concat(e,"?uid=").concat(n.uid)}async function revokeCredential(e){return await (0,l.lN)("/api/credentials/".concat(e))}function convertCredential(e){let n=e.data();return new a.hJ({id:e.id,provider:n.provider,email:n.email,contactsCount:n.contacts_count,status:n.status,errors:n.errors})}async function onCredentialsSnapshot(e){let n=await (0,c.b)(),r=(0,o.Ay)({db:i.db,userId:n});return s.RZ.onSnapshot(r,n=>{e(n.docs.map(convertCredential))})}},55714:function(e,n,r){"use strict";r.d(n,{gq:function(){return decryptBlobField},MJ:function(){return decryptField},pM:function(){return decryptFieldPair},O6:function(){return decryptItem},$N:function(){return decryptStringField},RY:function(){return encryptBlobField},UF:function(){return encryptField},lb:function(){return encryptStringField}});var o=r(39828),a=r(98476);let DecryptionFailedError=class DecryptionFailedError extends Error{constructor({type:e,itemId:n,message:r}){super("Failed decrypting ".concat(e,"/").concat(n,": ").concat(r)),this.name="DecryptionFailedError"}};var i=r(14066);async function encryptBlobField(e){let{plain:n,encrypt:r,key:a,itemId:i}=e;if(!r)return{eb:null,pb:o.Bytes.fromUint8Array(n)};{if(!a)throw Error("No key provided");let e=await encryptBlobItem({plainblob:n,key:a,itemId:i});return{eb:o.Bytes.fromUint8Array(e),pb:null}}}async function encryptStringField(e){let{plain:n,encrypt:r,key:o,itemId:a}=e,i=new TextEncoder().encode(n);return encryptBlobField({plain:i,encrypt:r,key:o,itemId:a})}async function encryptField(e){let{plain:n,encrypt:r,key:o,itemId:a}=e;if(null==n)return null;if(!r)return{encrypted:null,plain:n};{if(!o)throw Error("No key provided");let e=await encryptItem({plain:n,key:o,itemId:a});return{encrypted:e,plain:null}}}async function encryptItem(e){let{plain:n,key:r,itemId:o}=e,i=await deriveEncryptionKey({key:r,itemId:o});return(0,a.HI)({key:i,plaintext:n})}async function encryptBlobItem(e){let{plainblob:n,key:r,itemId:o}=e,i=await deriveEncryptionKey({key:r,itemId:o});return(0,a.jK)({key:i,plainblob:n})}async function decryptField(e){let{type:n,value:r,key:o,itemId:a}=e;if(!r)return null;if(r.encrypted){if(!o)throw Error("No key provided");return await decryptItem({type:n,encrypted:r.encrypted,key:o,itemId:a})}return void 0!==r.plain&&null!==r.plain?r.plain:(console.warn("Decrypting field with no value",r),null)}async function decryptFieldPair(e){let{type:n,encrypted:r,plain:o,key:a,itemId:i}=e;if(r){if(!a)throw Error("No key provided");return await decryptItem({type:n,encrypted:r,key:a,itemId:i})}if(o)return o}async function decryptBlobField(e){let{type:n,value:r,key:o,itemId:a}=e;if(!r)return null;if(r.eb){(0,i.Ee)(o,"No key provided");let e=r.eb.toUint8Array();return await decryptBlobItem({type:n,encrypted:e,key:o,itemId:a})}if(r.pb)return r.pb.toUint8Array();throw Error("Invalid blob field")}async function decryptStringField(e){let{type:n,value:r,key:o,itemId:a}=e,i=await decryptBlobField({type:n,value:r,key:o,itemId:a});return i?new TextDecoder().decode(i):null}async function decryptItem(e){let{type:n,encrypted:r,key:o,itemId:i}=e,s=await deriveEncryptionKey({key:o,itemId:i});try{let e=(0,a.pe)({key:s,ciphertext:r});return e}catch(e){throw new DecryptionFailedError({type:n,itemId:i,message:e.message})}}async function decryptBlobItem(e){let{type:n,encrypted:r,key:o,itemId:i}=e,s=await deriveEncryptionKey({key:o,itemId:i});try{return(0,a.KL)({key:s,cipherblob:r})}catch(e){throw new DecryptionFailedError({type:n,itemId:i,message:e.message})}}async function deriveEncryptionKey(e){let{itemId:n,key:r}=e;return(0,i.Ee)(n,"No item id provided"),(0,i.Ee)(r,"No key provided"),(0,a.vp)({key:r,salt:n})}},69525:function(e,n,r){"use strict";r.d(n,{Ds:function(){return getMasterKey},ES:function(){return getMasterKeyFromRecoveryKit},NJ:function(){return getEncryptionKeysForType},fL:function(){return createRecoveryKit},rz:function(){return reEncryptMasterKey}});var o=r(65422),a=r(39828),i=r(98476),s=r(14066),l=r(68825),c=r(26655),d=r(98930),u=r(55714);async function reEncryptMasterKey(e){let{newHashedPassword:n,graphId:r,masterKey:i,type:s}=e,d=(0,o.OO)({db:c.db,graphId:r}),u=(0,l.O)(),p=await encryptMasterKeyField({itemId:u,masterKey:i,hashedPassword:n}),h=await getEncryptionKeysForType({graphId:r,type:s});await (0,o.i3)(c.db,async e=>{for(let n of h)e.delete(n.ref);e.set((0,o.JU)(d,u),{type:s,master_key:p,created_at:a.Timestamp.now()})})}async function getMasterKey(e){let{hashedPassword:n,graphId:r,type:o}=e,a=await getEncryptionKeysForType({graphId:r,type:o});for(let e of a){let r=e.data().master_key,o=await decryptMasterKeyField({itemField:r,itemId:e.id,hashedPassword:n});if(o)return o}return null}async function createRecoveryKit(e){let{graphId:n,masterKey:r}=e,s=(0,i.Ty)(),d=(0,l.O)(),u=(0,o.Tt)({db:c.db,graphId:n,encryptionKeyId:d}),p=await encryptMasterKeyField({itemId:d,masterKey:r,hashedPassword:s});return await (0,o.pl)(u,{type:"recovery",master_key:p,created_at:a.Timestamp.now()}),{graphId:n,recoveryKey:s,recoveryId:d}}async function getMasterKeyFromRecoveryKit(e){let n=e.graphId,r=e.recoveryId,a=e.recoveryKey;(0,s.Ee)(n),(0,s.Ee)(r),(0,s.Ee)(a);let i=(0,o.Tt)({db:c.db,graphId:n,encryptionKeyId:r}),l=await d.RZ.getDoc(i);if(!l.exists())return null;let u=l.data().master_key,p=await decryptMasterKeyField({itemField:u,itemId:r,hashedPassword:a});return p}async function getEncryptionKeysForType(e){let{graphId:n,type:r}=e,a=(0,o.OO)({db:c.db,graphId:n}),i=(0,o.IO)(a,(0,o.ZB)("type","==",r)),{docs:s}=await (0,o.PL)(i);return s}async function decryptMasterKeyField(e){let{itemId:n,itemField:r,hashedPassword:o}=e;try{return await (0,u.$N)({type:"EncryptionKey",itemId:n,value:r,key:o})}catch(e){return null}}async function encryptMasterKeyField(e){let{itemId:n,masterKey:r,hashedPassword:o}=e;return await (0,u.lb)({key:o,itemId:n,encrypt:!0,plain:r})}},30842:function(e,n,r){"use strict";r.d(n,{I:function(){return l}});var o=r(88306),a=r.n(o),i=r(6890),s=r(40127);async function enrich(e){let{email:n,domain:r}=e,o=new URL("/api/enrich",location.href);n&&o.searchParams.append("email",n),r&&o.searchParams.append("domain",r);try{return await (0,s.AZ)({url:o.href})}catch(e){(0,i.Cy)(e,"[enrich] network error")}}let l=a()(enrich,e=>"".concat(e.email,"#").concat(e.domain))},75606:function(e,n,r){"use strict";r.d(n,{eP:function(){return createGraph},_3:function(){return deleteGraph},Vz:function(){return setupGraph}});var o=r(65422),a=r(98476),i=r(28418),s=r(88498),l=r(70173);let c="reflect";var d=r(25934);let u="the-power-of-backlinks";var p=r(68825);let h="journal";var g=r(14066),m=r(98930),y=r(26655),f=r(69525),v=r(40127),b=r(5308);async function createGraph(e){let{graphId:n,graphName:r,graphPassword:o}=e,i=await (0,v.AZ)({url:"/api/graphs",method:"POST",body:{graph_name:r,graph_id:n},throwOnHttpError:!1}),s=null==i?void 0:i.error;if(s)return{error:s,graphId:null,recoveryKey:null};n=i.graph_id;let l=(0,a.Ty)();await (0,b.e)({graphId:n,masterKey:l,newPassword:o});let c=await (0,f.fL)({graphId:n,masterKey:l});return{error:null,graphId:n,recoveryKit:c}}async function deleteGraph(e){return(0,v.lN)("/api/graphs/".concat(e))}async function setupGraph(e){(0,g.hu)(e.noteStore,"Missing note store"),(0,g.Ee)(e.encryptionKey,"Missing encryption key");try{!function(e){let n=(0,o.jC)({db:y.db,graphId:e.id});m.RZ.runTransaction(y.db,async e=>{let r=await e.get(n);if(r.exists())return r.data().has_setup?Promise.reject("already has setup"):e.set(n,{has_setup:!0},{merge:!0});throw Error("unknown graph")})}(e)}catch(e){console.error(e);return}console.log("[reflect-setup] setting up tags..."),e.findOrCreateTag(i._H),e.findOrCreateTag(i.ps),setupTemplates(e),function(e){console.log("[reflect-setup] setting up notes...");let n=Object.values(function(e){let n=e.assertRootStore.preferenceStore,r=new Date,o=(0,l.l5)(r),a=(0,s.p6)(r,n.noteDateFormat),p=e.id;return{alexMaccaw:i.jC.build({id:"alexmaccaw",subject:"Alex MacCaw",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"Alex MacCaw"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Title: CEO"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Company: "},{type:"backlink",attrs:{id:c,label:"Reflect",graphId:n}}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Type: "},{type:"tag",attrs:{id:"person",label:"person",graphId:n}}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Emails"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"alex@reflect.app",marks:[{type:"link",attrs:{href:"mailto:alex@reflect.app",target:null,auto:!1}}]},{type:"text",text:" "}]}]}]}]}]}],attrs:{version:5}}}({graphId:p})}),dailyNote:i.jC.build({id:o,subject:a,document:function(e){let{subject:n,graphId:r}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:n}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Today I started using "},{type:"backlink",attrs:{id:c,label:"Reflect",graphId:r}},{type:"text",text:"!"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"What is Reflect?"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"A note-taking tool designed to mirror the way we think"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Our brains remember things through associations. Reflect mimics this by backlinking notes to each other (read more on backlinking "},{type:"text",text:"here",marks:[{type:"link",attrs:{href:"https://reflect.academy/using-backlinks-and-tags",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:")."}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Over time, this gives you superhuman recall skills. Reflect becomes an extension of your brain."}]}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"What should I record within Reflect?"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"What happens in your day",marks:[{type:"link",attrs:{href:"https://www.youtube.com/watch?v=lJLcPesUkmw&ab_channel=Reflect",target:null,auto:!1}},{type:"underline",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Meeting notes",marks:[{type:"link",attrs:{href:"https://www.youtube.com/watch?v=rOMkkYKa-lA&ab_channel=Reflect",target:null,auto:!1}},{type:"underline",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"To-do",marks:[{type:"link",attrs:{href:"https://youtu.be/Ew9QEKnyvp0",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" and "},{type:"text",text:"Top of Mind",marks:[{type:"link",attrs:{href:"https://www.youtube.com/watch?v=GIMVaQHFd_k",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" lists"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"People you encounter (CRM)",marks:[{type:"link",attrs:{href:"https://www.youtube.com/watch?v=2cMRkfl6Hng&t=2s&ab_channel=Reflect",target:null,auto:!1}},{type:"underline",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Daily reflections",marks:[{type:"link",attrs:{href:"https://www.youtube.com/watch?v=yLZMwQw2ETs&ab_channel=Reflect",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" (like gratitude journaling)"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Save clips from the "},{type:"text",text:"web",marks:[{type:"link",attrs:{href:"https://reflect.academy/bookmarking-websites",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" or your "},{type:"text",text:"Kindle",marks:[{type:"link",attrs:{href:"https://reflect.academy/kindle-sync",target:null,auto:!1}},{type:"underline",attrs:{}}]}]}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Some tips for using Reflect"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"We recommend not splitting your personal and work notes. Use just one graph. Take it between jobs as it becomes more useful over time.\xa0\xa0"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Reflect is end-to-end encrypted, so only you can see your notes."}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Reflect is keyboard shortcut heavy. List them with: cmd /"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Access the editing menu with /"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Create a backlink using [[ for all people, places, things and companies you encounter."}]}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Today’s To-Do List"}]},{type:"taskList",content:[{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Sync your "},{type:"text",text:"calendar and contacts",marks:[{type:"link",attrs:{href:"https://reflect.app/preferences/credentials",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" (for easy meeting imports)"}]}]},{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Install the"},{type:"text",text:" Desktop and iOS apps",marks:[{type:"link",attrs:{href:"https://reflect.app/download",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" (better experience)"}]}]},{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Download our "},{type:"text",text:"Chrome and Safari extensions",marks:[{type:"link",attrs:{href:"https://reflect.app/download",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" (to save things from the web)"}]}]},{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Import any existing notes",marks:[{type:"link",attrs:{href:"https://reflect.academy/import-export-backups",target:null,auto:!1}},{type:"underline",attrs:{}}]},{type:"text",text:" you have (from tools like Roam, Evernote, Apple Notes, etc.)"}]}]},{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Join our "},{type:"text",text:"Discord community",marks:[{type:"link",attrs:{href:"https://reflect.app/discord",target:null,auto:!1}},{type:"underline",attrs:{}}]}]}]},{type:"taskListItem",attrs:{guid:(0,d.Z)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Write down the rest of your to-do items for the day in this list"}]}]}]}]}]}]}]},{type:"paragraph"}],attrs:{version:5}}}({subject:a,graphId:p}),daily:!0,createdAt:r.getTime(),updatedAt:r.getTime()},{placeholder:!0}),howToUseReflect:i.jC.build({id:"how-to-use-reflect",subject:"How to use Reflect",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"How to use Reflect"}]},{type:"paragraph",content:[{type:"text",text:"First, let's make sure you've set up Reflect properly. We recommend syncing "},{type:"text",text:"your calendar",marks:[{type:"link",attrs:{href:"https://reflect.app/preferences/credentials",target:null,auto:!1}}]},{type:"text",text:", installing our "},{type:"text",text:"Chrome extension",marks:[{type:"link",attrs:{href:"https://reflect.app/chrome-extension",target:null,auto:!1}}]},{type:"text",text:", and download our "},{type:"text",text:"iOS and desktop apps",marks:[{type:"link",attrs:{href:"https://reflect.app/download",target:null,auto:!1}}]},{type:"text",text:"."}]},{type:"paragraph",content:[{type:"text",text:"The first thing you'll notice when you open up Reflect are the daily notes stretching forwards and backwards through infinity. Your memory works through time and space so we've mirrored that inside the product. "}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Journaling"}]},{type:"paragraph",content:[{type:"text",text:"By default, everything should go inside today's daily note. Your journal, your meeting notes, your bookmarks... all of it."}]},{type:"paragraph",content:[{type:"text",text:"Start with a fresh day and type "},{type:"text",text:"/journal",marks:[{type:"code",attrs:{}}]},{type:"text",text:" and then hit "},{type:"text",text:"return",marks:[{type:"code",attrs:{}}]},{type:"text",text:". You'll see the following:"}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:134,width:155,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2Fee15ebd463534a49b2b26201b43aeb33?alt=media&token=6365e4df-edf3-43ac-b440-b749cd2314db",title:"",fileName:"CleanShot 2022-09-29 at 15.19.40@2x.png",resizable:!1}}]},{type:"paragraph",content:[{type:"text",text:"This is a default template we've created for you (you can edit it under the apps preferences). "}]},{type:"paragraph",content:[{type:"text",text:"Notice you can use both bullets or plain text for your notes, but we recommend the former (especially for your daily notes)."}]},{type:"paragraph",content:[{type:"text",text:"Now let's create a backlink."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Organizing your notes"}]},{type:"paragraph",content:[{type:"text",text:"In Reflect there is no hierarchy, only association. We've designed it like this because it more accurately represents the way memory works. "}]},{type:"paragraph",content:[{type:"text",text:"What is a backlink? Simple - it's a link between two of your notes. Think of it like a link on the web, but between concepts in your notes."}]},{type:"paragraph",content:[{type:"text",text:"In Reflect you create a backlink by typing "},{type:"text",text:"[[",marks:[{type:"code",attrs:{}}]},{type:"text",text:" (that's two left brackets). You should pepper your notes with backlinks whenever you mention an entity (like a person). For example:"}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:106,width:468,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F16d8aab55e5a4f8e9c2acf1195fe321c?alt=media&token=95afd575-8689-4244-b088-8f427202bafc",title:"",fileName:"CleanShot 2022-09-29 at 15.35.01.gif",resizable:!1}}]},{type:"paragraph",content:[{type:"text",text:"These backlinks automatically start organizing your notes. We delve further into this in "},{type:"backlink",attrs:{id:u,label:"The power of Backlinks",graphId:n}},{type:"text",text:"."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Command K (aka Search)"}]},{type:"paragraph",content:[{type:"text",text:"Press "},{type:"text",text:"cmd k",marks:[{type:"code",attrs:{}}]},{type:"text",text:" or ("},{type:"text",text:"control k",marks:[{type:"code",attrs:{}}]},{type:"text",text:" if you're on windows) and you'll see our quick search. Whenever you've forgotten something this is the place to come to find it."}]},{type:"paragraph",content:[{type:"text",text:"We also support some basic commands in here like: "},{type:"text",text:"go to daily note",marks:[{type:"code",attrs:{}}]},{type:"text",text:" or "},{type:"text",text:"5 days from now",marks:[{type:"code",attrs:{}}]},{type:"text",text:" ."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:306,width:559,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F1499ac5888314de9b766f105b37cb0c3?alt=media&token=af31a6fb-b34a-45e1-a241-bf84ef8eae5a",title:"",resizable:!1,fileName:"CleanShot 2022-09-29 at 15.45.02@2x.png"}}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Publishing notes"}]},{type:"paragraph",content:[{type:"text",text:"Hit the little publish button under "},{type:"text",text:"note actions",marks:[{type:"italic",attrs:{}}]},{type:"text",text:". That'll publish the note behind a secret url (which will be copied to your clipboard). "}]},{type:"paragraph",content:[{type:"text",text:" "},{type:"image",attrs:{alt:"",height:122,width:376,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F77c517a40a88445b96b92884f2fd8bff?alt=media&token=ac3a74ed-dc14-4eea-9bc9-1445ff929e7c",title:"",resizable:!1,fileName:"CleanShot 2022-09-28 at 18.13.00@2x.png"}}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Note history"}]},{type:"paragraph",content:[{type:"text",text:"We save every key-stroke so you can always go forwards and backwards in time. You can find a note's history by clicking the clock icon under "},{type:"text",text:"note actions",marks:[{type:"italic",attrs:{}}]},{type:"text",text:"."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:130,width:293,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F9c353ca1dab842bbbc542054d50a216b?alt=media&token=a902f86c-b490-425d-b59e-f33c4e6c8893",title:"",resizable:!1,fileName:"CleanShot 2022-09-29 at 15.47.01@2x.png"}}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:'"Key" keyboard-shortcuts'}]},{type:"paragraph",content:[{type:"text",text:"You can always see all the keyboard shortcuts by pressing "},{type:"text",text:"cmd /",marks:[{type:"code",attrs:{}}]},{type:"text",text:" (or control if you're on windows). So if there's only one shortcut you remember it's that one."}]},{type:"paragraph",content:[{type:"text",text:"Here are the shortcuts you're most likely to use on a day-by-day basis:"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Backlink: "},{type:"text",text:"[[",marks:[{type:"code",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Bullet list: "},{type:"text",text:"- space",marks:[{type:"code",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Todo list: "},{type:"text",text:"cmd return",marks:[{type:"code",attrs:{}}]},{type:"text",text:" (from inside of a bullet-list)"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"New note: "},{type:"text",text:"cmd n",marks:[{type:"code",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Search notes: "},{type:"text",text:"cmd k",marks:[{type:"code",attrs:{}}]}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Go to daily note: "},{type:"text",text:"cmd d",marks:[{type:"code",attrs:{}}]}]}]}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Learn more"}]},{type:"paragraph",content:[{type:"text",text:"We've only scratched the surface of Reflect here. Don't let our minimalistic interface fool you \uD83D\uDE42 "}]},{type:"paragraph",content:[{type:"text",text:"There's a whole "},{type:"text",text:"academy of note-taking",marks:[{type:"link",attrs:{href:"https://reflect.academy",target:null,auto:!1}}]},{type:"text",text:" you can check-out with some examples of how best to use Reflect (like as a personal CRM)."}]}],attrs:{version:5}}}({graphId:p}),pinnedIndex:0}),refect:i.jC.build({id:c,subject:"Reflect",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"Reflect"}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"type: "},{type:"tag",attrs:{id:"company",label:"company",graphId:n}},{type:"text",text:" "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"domain: "},{type:"text",text:"reflect.app",marks:[{type:"link",attrs:{href:"http://reflect.app",target:null,auto:!1}}]},{type:"text",text:" "}]}]}]},{type:"paragraph",content:[]}],attrs:{version:5}}}({graphId:p})}),savingWebsites:i.jC.build({id:"saving-websites",subject:"Saving websites",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"Saving websites"}]},{type:"paragraph",content:[{type:"backlink",attrs:{id:c,label:"Reflect",graphId:n}},{type:"text",text:" lets you quickly bookmark websites and capture snippets from across the web using "},{type:"text",text:"our Chrome and Safari extensions",marks:[{type:"link",attrs:{href:"https://reflect.app/downloads",target:null,auto:!1}}]},{type:"text",text:"."}]},{type:"paragraph",content:[{type:"text",text:"For capturing on the go we have also integrated with iOS’s share menu."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Capturing with Chrome"}]},{type:"orderedList",attrs:{order:1},content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Browse to a website"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Select some text that you want to capture"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Press "},{type:"text",text:"cmd shift p",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to open Reflect’s link capture menu. And then "},{type:"text",text:"return",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to save the link."}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"The link will automatically be added to your daily note."}]}]}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:261,width:268,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F34b571f254fa43bcb3b63e94ae10bf55?alt=media&token=ca9cee7f-9748-45f2-be7a-3522d76aad59",title:"",resizable:!1,fileName:"Saving websites"}}]},{type:"paragraph",content:[{type:"text",text:"You can also activate the Reflect menu by clicking the purple icon, or right clicking on the page."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Capturing on mobile"}]},{type:"paragraph",content:[{type:"text",text:"If you have our "},{type:"text",text:"iOS app installed",marks:[{type:"link",attrs:{href:"https://reflect.app/testflight",target:null,auto:!1}}]},{type:"text",text:" then we’ll add a Reflect icon to iOS’s share menu. Just tap that to save the website to Reflect. Any text highlighted will also be saved."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:517,width:239,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F6f950d9679d84333bb6d0d1a4ce7100f?alt=media&token=97493b91-8ce8-4d3d-b330-5d316579dba1",title:"",fileName:"IMG_1B48225F5814-1.jpeg",resizable:!1}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Where do links go?"}]},{type:"paragraph",content:[{type:"text",text:"Incoming links will go under a "},{type:"text",text:"Links",marks:[{type:"code",attrs:{}}]},{type:"text",text:" bullet inside your daily notes. We backlink this to a dedicated note for that webpage which will contain any text you've captured."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:80,width:405,src:"https://firebasestorage.googleapis.com/v0/b/reflect-development-253f5.appspot.com/o/users%2FwUJk2IGa7vNfQvaRDiZ19WxcQ1x1%2F66585d0dfdff487ba8bd562c81dcf76d?alt=media&token=e14997a2-90d6-4611-946a-038311ac1547",title:"",resizable:!1,fileName:"CleanShot 2022-09-29 at 15.49.08@2x.png"}}]}],attrs:{version:5}}}({graphId:p}),pinnedIndex:2}),thePowerOfBacklinks:i.jC.build({id:u,subject:"The power of backlinks",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"The power of backlinks"}]},{type:"paragraph",content:[{type:"text",text:"In "},{type:"backlink",attrs:{id:c,label:"Reflect",graphId:n}},{type:"text",text:" there are two ways of organizing your notes: backlinks and tags."}]},{type:"list",attrs:{guid:(0,d.Z)(),kind:"bullet",checked:!1,collapsed:!1},content:[{type:"paragraph",content:[{type:"text",text:"Backlinks are a way of "},{type:"text",text:"linking notes",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" to each other, associating the two."}]}]},{type:"list",attrs:{guid:(0,d.Z)(),kind:"bullet",checked:!1,collapsed:!1},content:[{type:"paragraph",content:[{type:"text",text:"Tags are a way of "},{type:"text",text:"categorizing notes",marks:[{type:"italic",attrs:{}}]},{type:"text",text:"."}]}]},{type:"paragraph",content:[{type:"text",text:"Let's dive into each."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Using Backlinks",marks:[{type:"bold",attrs:{}}]}]},{type:"paragraph",content:[{type:"text",text:"A backlink is just a link between two notes. You should be back-linking any entities you reference in your notes. (For example, an entity might be a particular person, company, or location.)"}]},{type:"paragraph",content:[{type:"text",text:"Generally you'll be working in today's daily note, and creating back-links from there. In this example we're going to backlink "},{type:"text",text:"Ankit Pansari",marks:[{type:"italic",attrs:{}}]},{type:"text",text:", a person we just met with."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:636,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F16f80aa26aaa4af39813e354a8ae65cf?alt=media&token=3718e2c8-bae0-4f9a-8d86-c1043a469f68",title:"",resizable:!1,fileName:"CleanShot_2021-10-07_at_14.08.45.gif"}}]},{type:"paragraph",content:[{type:"text",text:"Let's try it. To create a backlink, type "},{type:"text",text:"[[",marks:[{type:"code",attrs:{}}]},{type:"text",text:" and then the entity name."}]},{type:"paragraph",content:[{type:"text",text:"You'll then either select an existing note (use the arrow keys) or create a new blank note. Hit "},{type:"text",text:"enter",marks:[{type:"code",attrs:{}}]},{type:"text",text:" or "},{type:"text",text:"tab",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to create the backlink."}]},{type:"paragraph",content:[{type:"text",text:"Backlinks are case-sensitive and should be the full entity name (use New York City rather than NYC)."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Incoming backlinks"}]},{type:"paragraph",content:[{type:"text",text:"Clicking on the purple backlink will show you the linked note. In this example, notice that the "},{type:"text",text:"incoming backlinks",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" panel at the bottom of the note titled "},{type:"text",text:"Ankit Pansari",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" has a reference back to the daily note linking to it."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:636,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Fd0139d51dc1642be84cdcbd77a200273?alt=media&token=80a1672d-2432-4b4c-ab96-f907c613193e",title:"",resizable:!1,fileName:"CleanShot_2021-10-07_at_14.10.30.gif"}}]},{type:"paragraph",content:[{type:"text",text:"You can start to see how this would start to build up an activity feed of your meetings with "},{type:"text",text:"Ankit",marks:[{type:"italic",attrs:{}}]},{type:"text",text:"."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Forming a graph"}]},{type:"paragraph",content:[{type:"text",text:"Over time these back-linked associations form a graph, in a similar fashion to the way neurons work in your brain."}]},{type:"paragraph",content:[{type:"text",text:"You can see this graph forming under the "},{type:"text",text:"Map ",marks:[{type:"italic",attrs:{}}]},{type:"text",text:"tab. Here's mine:"}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:738,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F9cdf86dc78944abc8e71e5840acbd8b7?alt=media&token=c90d1160-f69f-4db1-9eeb-280365aed889",title:"",resizable:!1,fileName:"CleanShot_2021-10-07_at_13.52.31.gif"}}]},{type:"paragraph",content:[{type:"text",text:"So what’s the point of all this backlinking (other than creating pretty visualizations)? The answer is to do with recall."}]},{type:"paragraph",content:[{type:"text",text:"Let’s just say you backlink Ankit to the company he works for, OSlash."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:217,width:277,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F18373ea4a927498e871b44df4889094f?alt=media&token=22c60e5d-d32a-4b91-9e9c-99be5b74e9fa",title:"",resizable:!1,fileName:"CleanShot_2022-09-28_at_17.36.59.gif"}}]},{type:"paragraph",content:[{type:"text",text:"Now you can pull up the company note quickly ("},{type:"text",text:"cmd k",marks:[{type:"code",attrs:{}}]},{type:"text",text:"). And then see anyone working at that company."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:279,width:597,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F094f2c33d64d4e0ea46e3ad42cdadc40?alt=media&token=d18389f0-22a8-497b-953b-74def1ef62eb",title:"",resizable:!1,fileName:"CleanShot_2022-09-29_at_15.58.19.gif"}}]},{type:"paragraph",content:[{type:"text",text:"You can also go in the opposite direction, pulling up employees and seeing where they work."}]},{type:"paragraph",content:[{type:"text",text:"You can extend this to all sorts of things, like backlinking specific locations, or projects that you’re working on."}]},{type:"paragraph",content:[{type:"text",text:"When you forget something, say a name, type what you do remember into Reflect. And you’ll be able to follow the associations to whatever you’ve forgotten."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Categorizing with tags",marks:[{type:"bold",attrs:{}}]}]},{type:"paragraph",content:[{type:"text",text:"So now we've seen how backlinks work, let's move onto tags. In this example "},{type:"text",text:"OSlash",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" is Ankit's company. Let's navigate to that company's dedicated note and decorate it with the company website and "},{type:"text",text:"#company",marks:[{type:"code",attrs:{}}]},{type:"text",text:" hashtag."}]},{type:"paragraph",content:[{type:"text",text:"Tags can be created by typing the hash symbol ("},{type:"text",text:"#",marks:[{type:"code",attrs:{}}]},{type:"text",text:") and then the tag-name. Our convention for tag names is lowercase singular without spaces. Hit enter or tab to insert the tag."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:656,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F29225073939e4a2486a6efb9c89d45c5?alt=media&token=6d0fa6c3-a364-463a-8836-0697af28e6e8",title:"",resizable:!1,fileName:"CleanShot_2021-10-07_at_14.19.27.gif"}}]},{type:"paragraph",content:[{type:"text",text:"We pre-create some system level tags (like "},{type:"text",text:"#person",marks:[{type:"code",attrs:{}}]},{type:"text",text:"), but in the example above we're creating a custom "},{type:"text",text:"#company",marks:[{type:"code",attrs:{}}]},{type:"text",text:" tag."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Listing notes by tag"}]},{type:"paragraph",content:[{type:"text",text:"Now that the note has a custom "},{type:"text",text:"#company",marks:[{type:"code",attrs:{}}]},{type:"text",text:" hashtag we can navigate to it easily under "},{type:"text",text:"All notes",marks:[{type:"italic",attrs:{}}]},{type:"text",text:"."}]},{type:"paragraph",content:[{type:"text",text:"While some system tags are elevated (people/books/etc), custom tags are available under the far right context menu."}]},{type:"paragraph"},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:554,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Ff447bdd11a154a0abb1afa2c7269ed43?alt=media&token=07ea48d1-70cb-4a9c-a439-8f5807755093",title:"",resizable:!1,fileName:"CleanShot_2021-10-07_at_14.23.50.gif"}}]},{type:"paragraph"},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Backlinks vs Tags",marks:[{type:"bold",attrs:{}}]}]},{type:"paragraph",content:[{type:"text",text:"We often get asked, when do I use a backlink and when do I use a tag? The answer is simple:"}]},{type:"list",attrs:{kind:"bullet",checked:!1,collapsed:!1,guid:(0,d.Z)()},content:[{type:"paragraph",content:[{type:"text",text:"For entities use backlinks"}]}]},{type:"list",attrs:{guid:(0,d.Z)(),kind:"bullet",checked:!1,collapsed:!1},content:[{type:"paragraph",content:[{type:"text",text:"For categories use tags"}]}]},{type:"paragraph",content:[{type:"text",text:"If something doesn't fit neatly into one of these buckets, default to using a backlink."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Examples of backlinks and tags:"}]},{type:"paragraph",content:[{type:"text",text:"For example, these entities would be backlinks: Alex MacCaw, Google, New York."}]},{type:"paragraph",content:[{type:"text",text:"And these categories would be tags: #book, #company, #person"}]},{type:"paragraph",content:[{type:"text",text:"Notice we use the convention of singular lower-case for tags."}]},{type:"heading",attrs:{level:3},content:[{type:"text",text:"Why this distinction?"}]},{type:"paragraph",content:[{type:"text",text:"The reason lies behind the different behavior when clicking on a backlink vs a tag."}]},{type:"paragraph",content:[{type:"text",text:"Clicking on a "},{type:"text",text:"backlink",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" takes you to a dedicated note, which is what you'd want to see for an entity (like a particular person)."}]},{type:"paragraph",content:[{type:"text",text:"Every time that dedicated note is back-linked (say from your daily notes), a reference will appear in "},{type:"text",text:"incoming backlinks",marks:[{type:"italic",attrs:{}}]},{type:"text",text:". This is super handy when pulling up call notes on a person, for example."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:178,width:407,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Ff8256614312547b1a57de5d9483398b1?alt=media&token=ae63093f-14e2-4316-a014-fc525517f233",title:"",resizable:!1,fileName:"CleanShot 2021-10-07 at 17.47.29@2x.png"}}]},{type:"paragraph",content:[{type:"text",text:"On other other hand, clicking on a "},{type:"text",text:"tag",marks:[{type:"italic",attrs:{}}]},{type:"text",text:" takes you to a list of notes containing that tag. For example, clicking on the "},{type:"text",text:"#person",marks:[{type:"code",attrs:{}}]},{type:"text",text:" tag shows you a list of all notes with that tag (i.e. all the people you've tagged in Reflect)."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:636,width:2016,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F119880e2bd754b3294d16f8ecdd85854?alt=media&token=9a6eaf54-ae26-4538-811c-506040ce99ee",title:"",resizable:!1,fileName:"CleanShot 2023-05-17 at 20.58.53@2x.png"}}]}],attrs:{version:6}}}({graphId:p}),pinnedIndex:1}),tipsAndTricks:i.jC.build({id:"tips-and-tricks",subject:"Tips and tricks",document:function(e){let{graphId:n}=e;return{type:"doc",content:[{type:"heading",attrs:{level:1},content:[{type:"text",text:"Tips and tricks"}]},{type:"paragraph",content:[{type:"text",text:"Here are a few of our favorite ways of using "},{type:"backlink",attrs:{id:c,label:"Reflect",graphId:n}},{type:"text",text:"."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Toggle between lists and tasks"}]},{type:"paragraph",content:[{type:"text",text:"When in a list, hit "},{type:"text",text:"cmd return",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to toggle between a list-item, task, checked-task, and back to list-item again (or "},{type:"text",text:"control",marks:[{type:"code",attrs:{}}]},{type:"text",text:" if you're on a PC)."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:193,width:291,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F607eec1057e14c6cbe9883ef2c99f9c4?alt=media&token=ee04d23d-d220-41a2-8bab-87389540ddd6",title:"",resizable:!1,fileName:"CleanShot_2021-10-25_at_12.51.08.gif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Creating links"}]},{type:"paragraph",content:[{type:"text",text:"Press "},{type:"text",text:"cmd k",marks:[{type:"code",attrs:{}}]},{type:"text",text:" when some text is selected to link it. Or alternatively simply paste the url over the current selection."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:88,width:332,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F1cf1d81b1399467aa9f65e9449666cb6?alt=media&token=cfb8555b-5c64-463d-9b80-e1bcc1372853",title:"",resizable:!1,fileName:"CleanShot_2022-09-28_at_18.avif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Moving bullet points"}]},{type:"paragraph",content:[{type:"text",text:"You can move bullet points up or down using "},{type:"text",text:"option up",marks:[{type:"code",attrs:{}}]},{type:"text",text:" and "},{type:"text",text:"option down",marks:[{type:"code",attrs:{}}]},{type:"text",text:"."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"No distract mode"}]},{type:"paragraph",content:[{type:"text",text:"If you either resize Reflect to a smaller window, or hit "},{type:"text",text:"cmd shift f",marks:[{type:"code",attrs:{}}]},{type:"text",text:", you go into 'no-distract-mode' which removes everything except the text you're working on."}]},{type:"paragraph",content:[{type:"text",text:"Our command palette ("},{type:"text",text:"cmd k",marks:[{type:"code",attrs:{}}]},{type:"text",text:") still works in this mode, so it's possible to navigate around the app without touching your mouse."}]},{type:"paragraph",content:[{type:"text",text:"Bonus points, hit "},{type:"text",text:"cmd control f",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to go full-screen, and then "},{type:"text",text:"cmd shift f",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to enable no-distract mode for the ultimate writing experience."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:288,width:416,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Ff9d30ea0b329475faa6070e8c430b7ef?alt=media&token=5386cfed-6002-4e3b-8719-28d66d984afa",title:"",resizable:!1,fileName:"CleanShot 2021-10-07 at 17.52.00@2x.png"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Back to the future"}]},{type:"paragraph",content:[{type:"text",text:"It can be useful to write yourself notes in the future. For example, some people like prepping for the week ahead by writing in each daily note."}]},{type:"paragraph",content:[{type:"text",text:"Both the command palette and backlink support relative dates. This means you can type dates like: "},{type:"text",text:"3 days from now",marks:[{type:"code",attrs:{}}]},{type:"text",text:", "},{type:"text",text:"one year ago",marks:[{type:"code",attrs:{}}]},{type:"text",text:", "},{type:"text",text:"next thursday",marks:[{type:"code",attrs:{}}]},{type:"text",text:", and you'll be sent to the right place."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:1423,width:2517,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F59182cde8660466098a0a7a1fd2626a5?alt=media&token=20dbcb00-8e31-43a5-b3fb-d1fdb4e9f97a",title:"",resizable:!1,fileName:"CleanShot 2021-10-07 at 18.01.41@2x.png"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Navigate to selected backlink"}]},{type:"paragraph",content:[{type:"text",text:"Use the arrow keys to select a backlink in a note. Then hit "},{type:"text",text:"cmd enter",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to navigate to that backlink."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:578,width:1200,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F1a9cfa3ed95f49f8a6ad51cdbd27cf75?alt=media&token=5b7c38d8-fa0b-44dc-9109-a9829eae72d2",title:"",resizable:!1,fileName:"CleanShot 2021-10-07 at 18.10.47.gif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Pasting hyperlinks"}]},{type:"paragraph",content:[{type:"text",text:"To link some text, simply copy a link, and then paste it over the selected text."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:302,width:541,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Fceb46cec712848c6aa6768929ce9b8c8?alt=media&token=6a485107-7339-43a2-ad8c-62c9cab955fe",title:"",resizable:!1,fileName:"CleanShot 2021-10-07 at 18.07.47.gif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Navigate back/forward"}]},{type:"paragraph",content:[{type:"text",text:"Use the keyboard commands "},{type:"text",text:"cmd [",marks:[{type:"code",attrs:{}}]},{type:"text",text:" and "},{type:"text",text:"cmd ]",marks:[{type:"code",attrs:{}}]},{type:"text",text:" to navigate back and forward. We've stolen this behavior from your browser, so you should feel right at home."}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Select and backlink"}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:170,width:314,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F43cf366c83e948549741e6306208037d?alt=media&token=749514da-86c6-4193-a57a-340b8f5e19be",title:"",resizable:!1,fileName:"CleanShot 2021-10-11 at 13.31.45.gif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Note aliases"}]},{type:"paragraph",content:[{type:"text",text:"Sometimes you'll want to alias notes. For example, it's easier to type "},{type:"text",text:"Mum",marks:[{type:"code",attrs:{}}]},{type:"text",text:" than "},{type:"text",text:"Charlotte MacCaw",marks:[{type:"code",attrs:{}}]},{type:"text",text:". We've made this simple in Reflect, just use a double forward-slash ("},{type:"text",text:"//",marks:[{type:"code",attrs:{}}]},{type:"text",text:") in the subject line of notes to automatically alias each part."}]},{type:"paragraph",content:[{type:"text",text:"For example, here our note is called "},{type:"text",text:"Charlotte MacCaw // Mum",marks:[{type:"code",attrs:{}}]},{type:"text",text:" :"}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"image",height:96,width:232,src:"https://reflect.academy/_next/image?url=https%3A%2F%2Fsuper-static-assets.s3.amazonaws.com%2F857246af-702d-4831-8a78-16e603d787fe%2Fimages%2F3c717711-1cc9-4412-8d95-8b591a4ad9bb.png&w=750&q=80",title:"",resizable:!1}}]},{type:"paragraph",content:[{type:"text",text:"And if we type "},{type:"text",text:"Mum",marks:[{type:"code",attrs:{}}]},{type:"text",text:" into the backlink auto-completer, we'll see the aliased notes."}]},{type:"heading",attrs:{level:2},content:[{type:"image",attrs:{alt:"",height:179,width:438,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fseed-notes%2Fnote-aliases.png?alt=media&token=66303c6c-674c-4cb0-a74c-093a0db15159&_gl=1*1acev2c*_ga*MjEwMzkxMzY5Mi4xNjQzOTI5MDY2*_ga_CW55HF8NVT*MTY4NjM1MTA4NC45MC4xLjE2ODYzNTI3MDUuMC4wLjA.",title:"",resizable:!1,fileName:"Backlink aliases.png"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"De-duplicate notes"}]},{type:"paragraph",content:[{type:"text",text:"Notes with the same subject at the top will automatically prompt you to de-duplicate and merge them."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:290,width:1212,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2F07ffea87dbed447dbc23f9738b2ce8f8?alt=media&token=3693341d-a384-4359-b78e-345eff5cb424",title:"",resizable:!1,fileName:"CleanShot 2021-10-11 at 17.58.11@2x.png"}}]},{type:"paragraph"},{type:"heading",attrs:{level:2},content:[{type:"text",text:"Indenting and un-indenting lists"}]},{type:"paragraph",content:[{type:"text",text:"To indent a list-item press "},{type:"text",text:"tab",marks:[{type:"code",attrs:{}}]},{type:"text",text:", to un-indent a list-item, press "},{type:"text",text:"shift tab",marks:[{type:"code",attrs:{}}]}]},{type:"paragraph",content:[{type:"text",text:"On mobile, swipe to indent and un-indent."}]},{type:"paragraph",content:[{type:"image",attrs:{alt:"",height:188,width:348,src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/users%2FgjzQZB390LOY9DmlguxzrU6xaHw2%2Fa5af80c629eb4aa4accfe96b736dba0a?alt=media&token=7d8898ed-772c-4a98-a736-88d9474fd245",title:"",resizable:!1,fileName:"CleanShot 2021-10-20 at 14.33.38.gif"}}]},{type:"heading",attrs:{level:2},content:[{type:"text",text:"And there's more!"}]},{type:"paragraph",content:[{type:"text",text:"For more tips and tricks, please see our "},{type:"text",text:"note-taking Academy",marks:[{type:"link",attrs:{href:"https://reflect.academy/",target:null,auto:!1}}]},{type:"text",text:". "}]}],attrs:{version:6}}}({graphId:p}),pinnedIndex:3}),journal:i.jC.build({id:h,subject:"Journal"})}}(e));for(let r of n)e.noteStore.assertAdapter.addModel(r),r.requestRemount();for(let e of n)e.changeManager.create()}(e)}async function setupTemplates(e){console.log("[reflect-setup] setting up templates...");let n=[new i.YS({name:"journal",document:function(e){let{graphId:n}=e;return{type:"doc",attrs:{version:5},content:[{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"backlink",attrs:{id:h,label:"Journal",graphId:n}}]},{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Grateful for"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"On my mind"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Working on"}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Daily habits"}]},{type:"taskList",content:[{type:"taskListItem",attrs:{guid:(0,p.O)(),checked:!1},content:[{type:"paragraph",content:[{type:"text",text:"Exercise"}]}]}]}]}]}]}]}]}}({graphId:e.id})}),new i.YS({name:"person",document:function(e){let{graphId:n}=e;return{type:"doc",attrs:{version:5},content:[{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Title: "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Company: "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Type: "},{type:"tag",attrs:{id:"person",label:"person",graphId:n}},{type:"text",text:" "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Email: "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Phone: "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"Location: "}]}]}]}]}}({graphId:e.id})}),new i.YS({name:"company",document:function(e){let{graphId:n}=e;return{type:"doc",attrs:{version:5},content:[{type:"bulletList",content:[{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"type: "},{type:"tag",attrs:{id:"company",label:"company",graphId:n}},{type:"text",text:" "}]}]},{type:"listItem",attrs:{closed:!1,nested:!1},content:[{type:"paragraph",content:[{type:"text",text:"domain: "}]}]}]}]}}({graphId:e.id})})];for(let r of n)e.templateStore.addTemplate(r),await r.setRemote()}},58997:function(e,n,r){"use strict";r.d(n,{A9:function(){return updateGraph},B6:function(){return onGraphSnapshot},E:function(){return getGraphVersion},Il:function(){return addFlagToGraph},h4:function(){return setCurrentMigration},w$:function(){return setMigrationFinished},yh:function(){return graphTransaction}});var o=r(65422),a=r(39828),i=r(68949),s=r(39411),l=r(10256),c=r(98930),d=r(69963),u=r(26655),p=r(40127);async function onGraphSnapshot(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,a=(0,o.jC)({db:u.db,graphId:e});return await (0,p.i1)(),c.RZ.onSnapshot(a,e=>{n(function(e){var n,r,o,a,i,s;let l=e.data(),c="string"==typeof(null==l?void 0:l.id);return{id:e.id,ready:c,name:null!==(n=null==l?void 0:l.name)&&void 0!==n?n:"",acl:(null==l?void 0:l.acl)||[],hasSetup:null!==(r=null==l?void 0:l.has_setup)&&void 0!==r&&r,version:null!==(o=null==l?void 0:l.version)&&void 0!==o?o:0,migratingVersion:null!==(a=null==l?void 0:l.migrating_version)&&void 0!==a?a:null,flags:null!==(i=null==l?void 0:l.flags)&&void 0!==i?i:[],colorHex:null!==(s=null==l?void 0:l.color_hex)&&void 0!==s?s:null}}(e))},async o=>{console.error("[onGraphSnapshot] Error:",o),(0,d.Tb)(o),r>0&&(await (0,l.Z)(1e3),console.log("[onGraphSnapshot] Trying again..."),onGraphSnapshot(e,n,r-1))})}function updateGraph(e){let n=(0,o.jC)({db:u.db,graphId:e.id});return c.RZ.setDoc(n,{name:e.name,color_hex:e.colorHex},{merge:!0})}async function getGraphVersion(e){let n;let r=(0,o.jC)({db:u.db,graphId:e});try{n=await c.RZ.getDocFromServer(r)}catch(e){throw new s.fD}if(!n.exists())throw new s.Kg(e);let{version:a}=n.data();return"number"==typeof a?a:0}async function setCurrentMigration(e,n){let r=(0,o.jC)({db:u.db,graphId:e.id});await c.RZ.runTransaction(u.db,async o=>{var a;let i=await o.get(r);if(!i.exists())throw new s.Kg(e.id);let l=i.data(),c=null!==(a=l.migrating_version)&&void 0!==a?a:null;if(null!==c&&c!==n)throw new s.AA({graph:e,migratingVersion:c});o.set(r,{migrating_version:n},{merge:!0})})}async function setMigrationFinished(e){let{graph:n,version:r}=e,a=(0,o.jC)({db:u.db,graphId:n.id});await c.RZ.runTransaction(u.db,async e=>{let o=await e.get(a);if(!o.exists())throw new s.Kg(n.id);e.set(a,{migrating_version:null,version:r},{merge:!0})}),await (0,i.when)(()=>n.version===r)}async function graphTransaction(e,n){let r=(0,o.jC)({db:u.db,graphId:e.id});await (0,a.runTransaction)(u.db,async o=>{let a=await o.get(r);if(!function(e,n){var r,o;let a=e.data(),i=null!==(r=null==a?void 0:a.migrating_version)&&void 0!==r?r:null,s=null!==(o=null==a?void 0:a.version)&&void 0!==o?o:null;return null===i&&(null===s||null===n||!(s>n))}(a,e.version))throw new s.bZ;return await n(o)})}function addFlagToGraph(e,n){let r=(0,o.jC)({db:u.db,graphId:e});return c.RZ.updateDoc(r,{flags:(0,a.arrayUnion)(n)})}},40127:function(e,n,r){"use strict";r.d(n,{$Q:function(){return authedJsonGet},AZ:function(){return authedJsonFetch},Aj:function(){return onAuthStateChanged},g0:function(){return getAuthHeaders},i1:function(){return waitForAuthUser},lI:function(){return getIdToken},lN:function(){return authedJsonDelete},nX:function(){return getAuthUser},tC:function(){return authedJsonPost}});var o=r(6890),a=r(26655);function onAuthStateChanged(e){return a.I8.onAuthStateChanged(e)}function getAuthUser(){return new Promise(e=>{a.I8.currentUser?e(a.I8.currentUser):new Promise(e=>{let n=a.I8.onAuthStateChanged(r=>{n(),e(r)})}).then(e)})}function waitForAuthUser(){return new Promise(e=>{a.I8.currentUser?e(a.I8.currentUser):new Promise(e=>{let n=a.I8.onAuthStateChanged(r=>{r&&(n(),e(r))})}).then(e)})}async function getIdToken(){let e=await waitForAuthUser();return e.getIdToken()}async function getAuthHeaders(){let e=await getIdToken();return{Authorization:"Firebase ".concat(e)}}async function authedJsonPost(e,n){return authedJsonFetch({url:e,body:n,method:"POST"})}async function authedJsonGet(e){return authedJsonFetch({url:e,method:"GET"})}async function authedJsonDelete(e){return authedJsonFetch({url:e,method:"DELETE"})}async function authedJsonFetch(e){let n=await getAuthHeaders();return await (0,o.AC)({...e,headers:{...n,...e.headers}})}},89992:function(e,n,r){"use strict";r.d(n,{C:function(){return o}});let o=4},13607:function(e,n,r){"use strict";r.d(n,{H:function(){return buildCommitDoc},R:function(){return buildContentPartial}});var o=r(15965),a=r(39828),i=r(46551),s=r(25152),l=r(9069);async function buildContentPartial(e){let{context:n,docCommitId:r}=e,a=(0,l.Ii)(n),s=await (0,l.UF)(e.yDoc,a),c=(0,i.gc)(e.yDoc),d=(0,o.kB)(c),u=await (0,l.Wu)(d,a);return{subject:u,yjs_doc:s,doc_commit_id:r,document_json:null}}async function buildCommitDoc(e){let{context:n,commitId:r}=e,{graph:o}=n,i=a.Timestamp.now(),c=o.version,d=(0,l.Ii)(n),u=await (0,l.cu)(e.yjsUpdates,d);return{id:r,platform:(0,s.ob)(),created_at:i,graph_version:c,yjs_updates:u}}},1200:function(e,n,r){"use strict";r.d(n,{u:function(){return buildMetaPartial}});var o=r(39828),a=r(68949),i=r(89992),s=r(9069);async function buildMetaPartial(e){var n,r,l,c;let{note:d}=e,u=(0,s.Ii)(e),p=await (0,s.FS)(null!==(n=d.ignoredBacklinkLabels)&&void 0!==n?n:[],u),h=await (0,s.FS)(null!==(r=d.ignoredContactNames)&&void 0!==r?r:[],u);return{id:d.id,version:i.C,acl:d.acl,created_at:o.Timestamp.fromDate(d.createdAtDate),updated_at:o.Timestamp.fromDate(d.updatedAtDate),edited_at:d.editedAtDate?o.Timestamp.fromDate(d.editedAtDate):null,deleted_at:d.deletedAtDate?o.Timestamp.fromDate(d.deletedAtDate):null,backlinked_count:d.backlinkedCount,daily:d.daily,ignored_backlink_from_note_ids:(0,a.toJS)(d.ignoredBacklinkFromNoteIds),ignored_backlink_labels:p,ignored_contact_names:h,pinned_index:null!==(l=d.pinnedIndex)&&void 0!==l?l:null,system_metadata:null!==(c=d.systemMetadata)&&void 0!==c?c:null}}},89738:function(e,n,r){"use strict";r.d(n,{_:function(){return noteToInitialDocs}});var o=r(15965),a=r(13607),i=r(1200);async function noteToInitialDocs(e){let{note:n}=e,r=n.assertYDoc,s=[o.pU.encodeStateAsUpdate(r)],l=await (0,i.u)(e),c=await (0,a.R)({yDoc:n.assertYDoc,docCommitId:0,context:e}),d={...l,...c,last_commit_id:0},u=await (0,a.H)({commitId:0,yjsUpdates:s,context:e});return{note:d,commit:u}}},9069:function(e,n,r){"use strict";r.d(n,{FS:function(){return encryptStringArray},Ii:function(){return getEncryptionOptions},UF:function(){return encryptYDoc},Wu:function(){return encryptString},cu:function(){return encryptYjsUpdates},ec:function(){return encryptDocument}});var o=r(15965),a=r(68236),i=r(55714);function encryptYDoc(e,n){let r=o.pU.encodeStateAsUpdate(e);return(0,i.RY)({plain:r,...n})}function encryptDocument(e,n){var r;return e?(0,i.UF)({plain:null!==(r=(0,a.l)(e))&&void 0!==r?r:null,...n}):null}async function encryptYjsUpdates(e,n){return await Promise.all(e.map(e=>(0,i.RY)({plain:e,...n})))}function encryptString(e,n){return(0,i.UF)({plain:e,...n})}function encryptStringArray(e,n){return(0,i.UF)({plain:(0,a.l)(e),...n})}function getEncryptionOptions(e){let{graph:n,note:r}=e;return{encrypt:!r.public,key:n.assertEncryptionKey,itemId:r.id}}},91935:function(e,n,r){"use strict";r.d(n,{Fx:function(){return batchDeleteNotes},f_:function(){return deleteNote},VP:function(){return k.VP},c:function(){return listNoteValues},CZ:function(){return onNotesSnapshot},U3:function(){return setNote},qC:function(){return k.qC},gw:function(){return S.g}}),r(89738);var o=r(65422),a=r(39828),i=r(8400),s=r.n(i),l=r(26655),c=r(98930);async function batchDeleteNotes(e,n){let r=n.map(n=>(0,o.lB)({db:l.db,graphId:e.id,noteId:n}));await batchDelete(r)}async function deleteNote(e,n){let r=(0,o.lB)({db:l.db,graphId:e.id,noteId:n});await c.RZ.deleteDoc(r),await deleteNoteCommits(e,n)}async function deleteNoteCommits(e,n){let r=(0,o.Ul)({db:l.db,graphId:e.id,noteId:n}),i=await (0,a.getDocs)(r);await batchDelete(i.docs.map(e=>e.ref))}async function batchDelete(e){for(let n of s()(e,500)){let e=c.RZ.writeBatch(l.db);for(let r of n)e.delete(r);await e.commit()}}var d=r(47944),u=r(69963),p=r(64701);async function onNotesSnapshot(e){let{graph:n,syncedAt:r,onSnapshot:a,onError:i}=e,s=(0,o.J4)({db:l.db,graphId:n.id}),p=r?c.RZ.query(s,c.RZ.where("updated_at",">=",r)):s;return c.RZ.onSnapshot(p,{includeMetadataChanges:!0},e=>{let r=e.docChanges(),o=r.map(e=>d.o.fromDocChange(n,e));a(o,e.metadata.fromCache)},e=>{(0,u.Tb)(e),n.logger.error("Error in notes snapshot listener: ".concat(e.message)),i(e)})}async function listNoteValues(e){let n=(0,o.J4)({db:l.db,graphId:e.id}),r=new p.r({encryptionKey:e.encryptionKey}),{docs:a}=await c.RZ.getDocsFromServer(n),i=a.map(e=>r.valuesFromDoc(e));return Promise.all(i)}var h=r(15965),g=r(71992),m=r(58997),y=r(13607),f=r(1200),v=r(39138),b=r.n(v),w=r(46551);async function setNote(e){let n=function(e){let{note:n}=e,r=function(e){let{graph:n,note:r}=e;return n.logger.child({noteId:r.id})}(e),o=n.lastCommitId;return{...e,logger:r,lastCommitId:o}}(e),{logger:r}=n,o=null,a=[];try{await (0,m.yh)(n.graph,async e=>{let i=await transactSetNote({tx:e,context:n,logger:r});o=i.commitId,a=i.yjsUpdates}),r.info("\uD83D\uDCBE saved commit ".concat(o," reason: ").concat(e.reason))}catch(e){return function(e){let{error:n,context:r,commitId:o}=e,{logger:a,note:i}=r,s=n instanceof Error?n:Error("Unknown error: ".concat(n));if(s instanceof g.Cn)return a.warn("[NoteRemoteStorage] commit ".concat(o," exists, save failed")),{success:!1,error:"commitExists"};if(s.message.startsWith("Document already exists:"))return a.warn("[NoteRemoteStorage] concurrent edit commit ".concat(o," ").concat(s.message)),{success:!1,error:"commitExists"};if(!s.message.includes("exceeds the maximum allowed size"))return a.error("[NoteRemoteStorage] failed saving commit ".concat(o," ").concat(s.message)),(0,u.Tb)(s,{tags:{noteId:i.id}}),{success:!1,error:"other"};{a.error("[".concat(i.id,"] failed saving commit ").concat(o,", commit is too large"));let e=new g.Xn;return(0,u.Tb)(e,{tags:{noteId:i.id},extra:{commitId:o}}),{success:!1,error:"tooLarge"}}}({error:e,context:n,commitId:o})}return{success:!0,error:null,commitId:o,yjsUpdates:a}}async function transactSetNote(e){let n=await transactSetContent(e);return function(e){let{tx:n,context:r}=e,{note:o,commit:i}=r,s=getRefs(r).publishedNoteRef;if(!o.public){n.delete(s);return}let l=i.getPendingYDoc(o),c=function(e){let{yDoc:n}=e,r=(0,w.gc)(n),o=(0,h.kB)(r);return{subject:o,document_html:(0,h.eJ)(r),snippet:b()((0,h.Oj)(r),{length:200}),updated_at:a.Timestamp.now()}}({yDoc:l});n.set(s,c,{merge:!0})}(e),n}async function transactSetContent(e){let{tx:n,context:r,logger:o}=e,{noteRef:a}=getRefs(r),i=await n.get(a),s=i.exists();return s?await transactUpdateNote({tx:n,context:r,noteSnapshot:i,logger:o}):await transactCreateNote({tx:n,context:r,logger:o})}async function transactUpdateNote(e){var n;let{tx:r,context:o,noteSnapshot:i,logger:s}=e,{note:l,commit:c}=o,d=i.data(),u=null!==(n=null==d?void 0:d.last_commit_id)&&void 0!==n?n:null,p=null===u?0:u+1,h=getCommitRef(o,p),{noteRef:g}=getRefs(o),m=a.Timestamp.now(),f=c.getPendingYDoc(l),v=c.yjsUpdatesArrays,b=o.lastCommitId===u;d.yjs_doc||s.warn("yjs_doc is missing for note ".concat(l.id,", last_commit_id: ").concat(u,", lastCommitId: ").concat(o.lastCommitId,".")),b||s.warn("Saving commit ".concat(p,", found existing commit in db ").concat(u," while locally we have ").concat(o.note.lastCommitId,". Skipping content update."));let w=await (0,y.R)({yDoc:f,context:o,docCommitId:p}),k={...b?w:{},last_commit_id:p,updated_at:m,edited_at:m},S=await (0,y.H)({context:o,commitId:p,yjsUpdates:v});return!function(e){var n;let{shouldSetNoteContent:r,dbNote:o,commitDoc:a,notePartial:i,commitId:s}=e;if(!r)return;let l=null!==(n=o.commit_with_ydoc_id)&&void 0!==n?n:null;"number"!=typeof l&&(a.yjs_doc=i.yjs_doc,i.commit_with_ydoc_id=s)}({shouldSetNoteContent:b,dbNote:d,commitDoc:S,notePartial:k,commitId:p}),r.set(g,k,{merge:!0}),r.set(h,S),{commitId:p,yjsUpdates:v}}async function transactCreateNote(e){let{tx:n,context:r,logger:o}=e,{note:i,commit:s}=r,{noteRef:l}=getRefs(r),c=a.Timestamp.now(),d=s.getPendingYDoc(i),u=[h.pU.encodeStateAsUpdate(d)],p=getCommitRef(r,0),g=await (0,f.u)(r),m=await (0,y.R)({yDoc:d,context:r,docCommitId:0}),v={...g,...m,last_commit_id:0,updated_at:c,edited_at:c};v.yjs_doc||o.warn("yjs_doc is missing for note ".concat(i.id,", during creation."));let b=await (0,y.H)({context:r,commitId:0,yjsUpdates:u});return n.set(l,v,{merge:!1}),n.set(p,b),{commitId:0,yjsUpdates:u}}function getRefs(e){let{graph:n,note:r}=e,a=(0,o.lB)({db:l.db,graphId:n.id,noteId:r.id}),i=(0,o.dX)({db:l.db,graphId:n.id,publishedNoteId:r.id});return{noteRef:a,publishedNoteRef:i}}function getCommitRef(e,n){let{graph:r,note:a}=e;return(0,o.t2)({db:l.db,graphId:r.id,noteId:a.id,commitId:String(n)})}r(11757);var k=r(81486),S=r(7165)},11757:function(e,n,r){"use strict";r.d(n,{j:function(){return setNoteMeta}});var o=r(65422),a=r(26655),i=r(98930),s=r(1200);async function setNoteMeta(e,n){let r=e.logger.child({noteId:n.id});if(!n.persisted){r.warn("[NoteRemoteStorage] cannot updateMeta, note not persisted yet");return}let l=(0,o.lB)({db:a.db,graphId:e.id,noteId:n.id}),c=await (0,s.u)({graph:e,note:n});r.info("[NoteRemoteStorage] updating meta"),await i.RZ.setDoc(l,c,{merge:!0}),r.info("[NoteRemoteStorage] updated meta")}},81486:function(e,n,r){"use strict";r.d(n,{VP:function(){return handleChanges},qC:function(){return setupSnapshotsListener}});var o=r(81289),a=r(84753),i=r.n(a),s=r(68949),l=r(91935),c=r(69963),d=r(12428),u=r(10256);function isCreateModification(e){return"create"===e.type}function isUpdateModification(e){return"update"===e.type}function isDeleteModification(e){return"delete"===e.type}async function applyModifications(e){let{modifications:n,store:r}=e;console.log("applying ".concat(n.length," modifications to the local database"));let o=n.filter(isCreateModification),a=n.filter(isUpdateModification),i=n.filter(isDeleteModification);return await Promise.all([function(e){let{store:n,deletes:r}=e,o=n.assertTable,a=r.map(e=>e.id);o.deleteMany(a)}({store:r,deletes:i}),applyInsertions({store:r,insertions:o}),applyUpdates({store:r,updates:a})]),n.length}async function applyInsertions(e){let{store:n,insertions:r}=e,o=n.assertAdapter,a=n.assertTable,i=r.map(e=>{let{snapshot:n}=e;return n}).map(d.O8);for(let e of(a.createMany(i),await (0,u.Z)(100),r)){let n=o.pool.get(e.snapshot.id);null==n||n.requestRemount()}let s=r.filter(e=>{let{flags:n}=e;return n.fetchCommits}).map(e=>{let r=n.assertAdapter.ensureModel(e.snapshot.id);return null==r?void 0:r.changeManager.loadAndApplyCommits()});await Promise.all(s)}async function applyUpdates(e){let{store:n,updates:r}=e,o=n.assertAdapter,a=r.map(async e=>{let n=o.ensureModel(e.snapshot.id);await (null==n?void 0:n.changeManager.handleIncomingChange(e))});await Promise.all(a)}async function setupSnapshotsListener(e){let{store:n,onError:r}=e;await (0,s.when)(()=>n.persistenceReady);let a=n.syncedAt,i=n.assertGraph,d=a?(0,o.Z)(a,1):null;return d&&0===n.assertTable.count&&((0,c.uT)("Last sync at ".concat(a,", but table is empty. Resetting syncedAt.")),n.setSyncedAt(null),d=null),(0,l.CZ)({graph:i,syncedAt:d,onSnapshot:(e,r)=>{handleChanges({store:n,changes:e,fromCache:r})},onError:r})}async function handleChanges(e){var n;let{store:r,changes:o,fromCache:a}=e;console.log("[note/snapshot] Loading in ".concat(o.length," changes"),{fromCache:a}),await (0,s.when)(()=>r.persistenceReady),r.setMode(a?"cache":"live");let l=await mapChangesToModifications(r,o),c=l.length===o.length;await applyModifications({store:r,modifications:l});let d=r.assertGraph.logger;if(d.info("Received ".concat(o.length," changes, applied ").concat(l.length," modifications. Number of notes now: ").concat(null===(n=r.table)||void 0===n?void 0:n.count)),!a&&c){let e=function(e){let n=e.map(e=>e.updatedAt);return i()(n,e=>e.getTime())}(o);r.setSyncedChanges(e)}}async function mapChangesToModifications(e,n){let r=[];for(let o of n)try{let n=await buildModification({store:e,change:o});r.push(n)}catch(e){(0,c.Tb)(e)}return r}async function buildModification(e){let{store:n,change:r}=e,o=n.assertTable,a=o.get(r.id);switch(r.type){case"added":case"modified":return buildUpdateModification(a,r);case"removed":return{type:"delete",id:r.id}}}async function buildUpdateModification(e,n){if(!e){let e=await n.getSnapshot(),r=n.needsFetchCommits;return{type:"create",snapshot:e,flags:{fetchCommits:r}}}let r={metadata:n.metadataChanged(e),content:n.commitsChanged(e)};if(!r.metadata&&!r.content)return{type:"noop"};{let e=await n.getSnapshot();return{type:"update",snapshot:e,flags:r}}}},7165:function(e,n,r){"use strict";r.d(n,{g:function(){return unsafeBatchSetNotes},h:function(){return unsafeSetNote}});var o=r(65422),a=r(8400),i=r.n(a),s=r(26655),l=r(98930),c=r(58997),d=r(89738);async function unsafeSetNote(e,n){await deleteNoteAndCommits(e,n);let r=getRefs({graph:e,note:n,commitId:"0"}),o=await (0,d._)({graph:e,note:n});await (0,c.yh)(e,async e=>{e.set(r.note,o.note),e.set(r.commit,o.commit)})}async function unsafeBatchSetNotes(e){let{graph:n,notes:r,batchSize:o=250,progress:a,createInitialCommit:s}=e;for(let e of(null==a||a.setTotal(r.length),i()(r,o)))await saveChunk({graph:n,notesChunk:e,createInitialCommit:s}),null==a||a.increment(e.length)}async function saveChunk(e){let{graph:n,notesChunk:r,createInitialCommit:o}=e,a=n.logger,i=l.RZ.writeBatch(s.db);for(let e of r){let r=await (0,d._)({graph:n,note:e}),s=getRefs({graph:n,note:e,commitId:"0"});r.note.yjs_doc||a.warn("yjs_doc is missing for note ".concat(e.id,", during unsafe batch saving.")),i.set(s.note,r.note),o&&i.set(s.commit,r.commit)}await i.commit()}function getRefs(e){let{graph:n,note:r,commitId:a}=e,i={db:s.db,graphId:n.id,noteId:r.id,commitId:a};return{note:(0,o.lB)(i),commit:(0,o.t2)({...i,commitId:a})}}async function deleteNoteAndCommits(e,n){let r=(0,o.lB)({db:s.db,graphId:e.id,noteId:n.id}),a=(0,o.Ul)({db:s.db,graphId:e.id,noteId:n.id}),i=await l.RZ.getDocs(a),c=l.RZ.writeBatch(s.db);for(let e of i.docs)c.delete(e.ref);c.delete(r),await c.commit()}},54851:function(e,n,r){"use strict";r.d(n,{Lz:function(){return deletePromptTemplate},Yu:function(){return setPromptTemplate},ln:function(){return onPromptTemplatesSnapshot}});var o=r(65422),a=r(39828),i=r(68825),s=r(26655),l=r(40127);async function onPromptTemplatesSnapshot(e){let n=await (0,l.i1)(),r=(0,o.lG)({db:s.db,userId:n.uid});return(0,a.onSnapshot)(r,n=>{let r=n.docs.map(e=>({id:e.id,label:e.data().label,template:e.data().template}));e(r)})}async function setPromptTemplate(e){let{id:n,label:r,template:c}=e,d=await (0,l.i1)(),u=null!=n?n:(0,i.O)(),p=(0,o.$p)({db:s.db,userId:d.uid,promptTemplateId:u});return await (0,a.setDoc)(p,{label:r,template:c},{merge:!0}),{id:u}}async function deletePromptTemplate(e){let n=await (0,l.i1)(),r=(0,o.$p)({db:s.db,userId:n.uid,promptTemplateId:e});await (0,a.deleteDoc)(r)}},91871:function(e,n,r){"use strict";r.d(n,{b:function(){return getAuthUserId}});var o=r(40127);async function getAuthUserId(){let e=await (0,o.i1)();return e.uid}},39541:function(e,n,r){"use strict";r.d(n,{M:function(){return timestampFromNumber},V:function(){return deserializeYjsDoc}});var o=r(39828),a=r(55714);function timestampFromNumber(e){let n=null!=e?new Date(e):null;return n?o.Timestamp.fromDate(n):null}async function deserializeYjsDoc(e,n){if(e)return await (0,a.gq)({type:"Note",value:e,...n})}},64701:function(e,n,r){"use strict";r.d(n,{r:function(){return NoteReader}});var o=r(15965),a=r(52300),i=r(68949),s=r(80339),l=r(28418),c=r(46551),d=r(55714),u=r(39541);let NoteReader=class NoteReader{static async noteFromDoc(e,n){let r=new NoteReader({encryptionKey:n});return await r.noteFromDoc(e)}async noteFromDoc(e){try{let n=await this.valuesFromDoc(e);return new l.jC(n)}catch(n){throw new s.UG({id:e.id,error:n.message})}}async valuesFromDoc(e){let n=e.id,r=e.data(),o=this.dataWithAllEncrypted(e),a=this.dataWithFieldsEncrypted(e);if(a)return await this.readDocWithFieldsEncrypted(n,a);let i=this.formatFromVersion(null==r?void 0:r.version);if("allEncrypted"===i&&o)return await this.readDocWithAllEncrypted(n,o);if("fieldsEncrypted"===i&&a)return await this.readDocWithFieldsEncrypted(n,a);throw console.error("[NoteReader] Unable to read the note id: ".concat(n),r),Error("[NoteReader] Unable to read the note id: ".concat(n))}dataWithAllEncrypted(e){let n=e.data();if(n&&("encrypted_note_json"in n||"note_json"in n))return n}dataWithFieldsEncrypted(e){let n=e.data();if(n&&("yjs_doc"in n||"document_json"in n))return n}async readDocWithAllEncrypted(e,n){let r=await (0,d.pM)({type:"Note",encrypted:n.encrypted_note_json,plain:n.note_json,key:this.encryptionKey,itemId:e});if(!r)throw console.error("Malformed note",n),Error("Malformed note");return JSON.parse(r)}async readDocWithFieldsEncrypted(e,n){var r,s,l,p,h,g;let m;let y={key:this.encryptionKey,itemId:e},f=await (0,u.V)(n.yjs_doc,y);if(f){let e=(0,c.NR)(f);m=(0,o.x4)(e)}else{let e=await (0,d.MJ)({type:"Note",value:n.document_json,...y});m=e?JSON.parse(e):void 0}let v=await (0,d.MJ)({type:"Note",value:n.ignored_contact_names,key:this.encryptionKey,itemId:e}),b=v?JSON.parse(v):[],w=await (0,d.MJ)({type:"Note",value:n.ignored_backlink_labels,key:this.encryptionKey,itemId:e}),k=w?JSON.parse(w):[];return{id:n.id,acl:(0,i.toJS)(n.acl),createdAt:n.created_at.toDate().getTime(),updatedAt:n.updated_at.toDate().getTime(),editedAt:null===(r=n.edited_at)||void 0===r?void 0:r.toDate().getTime(),deletedAt:null!==(l=null===(s=n.deleted_at)||void 0===s?void 0:s.toDate().getTime())&&void 0!==l?l:null,backlinkedCount:n.backlinked_count,daily:n.daily,ignoredBacklinkFromNoteIds:null!==(p=(0,i.toJS)(n.ignored_backlink_from_note_ids))&&void 0!==p?p:[],ignoredBacklinkLabels:k,ignoredContactNames:b,pinnedIndex:n.pinned_index,systemMetadata:null!==(h=n.system_metadata)&&void 0!==h?h:void 0,subject:null!==(g=await (0,d.MJ)({type:"Note",value:n.subject,key:this.encryptionKey,itemId:e}))&&void 0!==g?g:"",document:m,yDocAsUpdate:f?(0,a.kZ)(f):void 0,lastCommitId:n.last_commit_id,docCommitId:n.doc_commit_id}}formatFromVersion(e){return void 0===e||e<=3?"allEncrypted":e>=4?"fieldsEncrypted":void 0}constructor({encryptionKey:e}){this.encryptionKey=e}}},5308:function(e,n,r){"use strict";r.d(n,{e:function(){return changePasswordForSignIn},u:function(){return getMasterKeyForSignIn}});var o=r(65422),a=r(39828),i=r(98476),s=r(26655),l=r(69525),c=r(8111);function passwordToHashedPassword(e){return(0,c.c)({password:e,salt:"7ac05285256da683c4aa863deae95fd3"})}async function changePasswordForSignIn(e){let{newPassword:n,graphId:r,masterKey:o}=e,a=await passwordToHashedPassword(n);await (0,l.rz)({newHashedPassword:a,graphId:r,masterKey:o,type:"sign-in"})}async function getMasterKeyForSignIn(e){let{password:n,graphId:r}=e,o=await passwordToHashedPassword(n),a=await (0,l.Ds)({hashedPassword:o,graphId:r,type:"sign-in"});return a||getFallbackMasterKey({hashedPassword:o,graphId:r})}async function getFallbackMasterKey(e){var n;let{hashedPassword:r,graphId:c}=e,d=await (0,l.NJ)({graphId:c,type:"sign-in"});if(d.length>0)return null;let u=(0,o.jC)({db:s.db,graphId:c}),p=await (0,a.getDoc)(u),h=null===(n=p.data())||void 0===n?void 0:n.encryption_check;if(!h)return null;try{return(0,i.pe)({key:r,ciphertext:h}),r}catch(e){return null}}},622:function(e,n,r){"use strict";r.d(n,{OG:function(){return batchSetTemplates},Xc:function(){return deleteTemplate},ij:function(){return onTemplatesSnapshot},zX:function(){return setTemplate}});var o=r(65422),a=r(39828),i=r(8400),s=r.n(i),l=r(28418),c=r(13861),d=r(26655),u=r(98930),p=r(69963),h=r(55714);function onTemplatesSnapshot(e,n){let r=(0,o.Eb)({db:d.db,graphId:e.id});return u.RZ.onSnapshot(r,async r=>{let o=r.docs.map(async n=>{try{return await convertSnapshotToTemplate(e,n)}catch(e){console.error("Error converting template snapshot",e),(0,p.Tb)(e)}}),a=await Promise.all(o);n(a.filter(c.Dw))})}async function setTemplate(e,n){let r=(0,o.RE)({db:d.db,graphId:e.id,templateId:n.id}),a=await templateToDoc(e,n);return u.RZ.setDoc(r,a,{merge:!0})}async function batchSetTemplates(e,n){for(let r of s()(n,500)){let n=u.RZ.writeBatch(d.db);for(let a of r){let r=(0,o.RE)({db:d.db,graphId:e.id,templateId:a.id}),i=await templateToDoc(e,a);n.set(r,i,{merge:!0})}await n.commit()}}async function deleteTemplate(e,n){let r=(0,o.RE)({db:d.db,graphId:e.id,templateId:n});return await u.RZ.deleteDoc(r)}async function convertSnapshotToTemplate(e,n){var r,o,a;let i=n.data(),s=await (0,h.MJ)({type:"Template",key:e.assertEncryptionKey,itemId:n.id,value:null!==(o=null==i?void 0:i.name)&&void 0!==o?o:null}),c=await (0,h.MJ)({type:"Template",key:e.assertEncryptionKey,itemId:n.id,value:null!==(a=null==i?void 0:i.document_json)&&void 0!==a?a:null});return new l.YS({id:n.id,name:s,document:c?JSON.parse(c):void 0,createdAt:null==i?void 0:null===(r=i.created_at)||void 0===r?void 0:r.toMillis()})}async function templateToDoc(e,n){let r=await (0,h.UF)({key:e.assertEncryptionKey,itemId:n.id,plain:n.name,encrypt:!0}),o=await (0,h.UF)({key:e.assertEncryptionKey,itemId:n.id,plain:n.document?JSON.stringify(n.document):null,encrypt:!0}),i=a.Timestamp.fromMillis(n.createdAt);return{name:r,document_json:o,created_at:i}}},35339:function(e,n,r){"use strict";r.d(n,{PR:function(){return getUser},Mo:function(){return onUserSnapshot},V5:function(){return setAuthUserTraits},mD:function(){return setInternalPreferences},Oh:function(){return setPreferences},CG:function(){return setTraits},gh:function(){return updateAuthUserName},tU:function(){return updatePhoto}});var o=r(65422),a=r(21804),i=r.n(a),s=r(67523),l=r.n(s),c=r(14176),d=r.n(c),u=r(28418),p=r(15562);function enumFromString(e,n){if(!n)return;let r=Object.values(e),o=r.includes(n);return o?n:void 0}var h=r(10256),g=r(98930),m=r(69963),y=r(26655),f=r(40127);function getUser(e){let n=(0,o.DU)({db:y.db,userId:e});return g.RZ.getDoc(n)}async function onUserSnapshot(e){let n=await (0,f.i1)(),r=(0,o.DU)({db:y.db,userId:n.uid});return g.RZ.onSnapshot(r,r=>{let o=function(e,n){var r,o,a,i,s,l,c,d,h,g,m,y;let f=e.data(),v="string"==typeof(null==f?void 0:f.id);return new u.n5({id:n?n.uid:e.id,ready:v,graphIds:null!==(o=null==f?void 0:f.graph_ids)&&void 0!==o?o:[],name:null!==(a=n.displayName)&&void 0!==a?a:void 0,email:null!==(i=n.email)&&void 0!==i?i:void 0,photoUrl:null!==(s=n.photoURL)&&void 0!==s?s:void 0,traits:{backlink_created:(m=null!==(l=null==f?void 0:f.traits)&&void 0!==l?l:{}).backlink_created,book_synced:m.book_synced,chrome_extension_installed:m.chrome_extension_installed,credential_auth:m.credential_auth,graph_created:m.graph_created,link_created:m.link_created,meeting_added:m.meeting_added,onboarded:m.onboarded,onboarding_add_meeting_ignored:m.onboarding_add_meeting_ignored,onboarding_backlink_ignored:m.onboarding_backlink_ignored,onboarding_links_ignored:m.onboarding_links_ignored,shortcuts_opened:m.shortcuts_opened,tag_created:m.tag_created},preferences:(y=null!==(c=null==f?void 0:f.preferences)&&void 0!==c?c:{},{dateFormat:enumFromString(u.t6,null==y?void 0:y.date_format),timeFormat:enumFromString(u.zt,null==y?void 0:y.time_format),weekStart:enumFromString(u.L8,null==y?void 0:y.week_start),spellCheck:null==y?void 0:y.spell_check,labs:null==y?void 0:y.labs,transcriptionPrompt:null==y?void 0:y.transcription_prompt,transcriptionLanguage:null==y?void 0:y.transcription_language,openaiApiKeyExcerpt:null==y?void 0:y.openai_api_key_excerpt}),stripeSubscriptionId:null!==(d=null==f?void 0:f.stripe_subscription_id)&&void 0!==d?d:void 0,stripeSubscriptionProductId:null!==(h=null==f?void 0:f.stripe_subscription_product_id)&&void 0!==h?h:void 0,stripeSubscriptionStatus:enumFromString(p.u,null==f?void 0:f.stripe_subscription_status),trialStartedAt:null==f?void 0:null===(r=f.trial_started_at)||void 0===r?void 0:r.toMillis(),trialLengthDays:null!==(g=null==f?void 0:f.trial_length_days)&&void 0!==g?g:void 0})}(r,n);e(o)},async n=>{console.error("[onUserSnapshot] Error:",n),(0,m.Tb)(n),await (0,h.Z)(1e3),console.log("[onUserSnapshot] Trying again..."),onUserSnapshot(e)})}async function setAuthUserTraits(e){let n=await (0,f.i1)();return setTraits(n.uid,e)}async function setTraits(e,n){let r=(0,o.DU)({db:y.db,userId:e});await g.RZ.setDoc(r,{traits:l()(n,(e,n)=>i()(n).replace(/-/g,"_"))},{merge:!0})}async function setPreferences(e){let n=await (0,f.i1)(),r=n.uid,a=(0,o.DU)({db:y.db,userId:r}),i={date_format:e.dateFormat,time_format:e.timeFormat,week_start:e.weekStart,spell_check:e.spellCheck,labs:e.labs,transcription_prompt:e.transcriptionPrompt,transcription_language:e.transcriptionLanguage},s=d()(i,e=>void 0===e);await g.RZ.setDoc(a,{preferences:s},{merge:!0})}async function setInternalPreferences(e){let{openaiApiKey:n}=e;return await (0,f.AZ)({url:"/api/users/me/internal-preferences",method:"PUT",body:{openai_api_key:n}})}async function updatePhoto(e,n){let r=g.IG.ref(y.tO,"users/".concat(e,"/photo"));await g.IG.uploadBytes(r,n,{contentType:n.type});let o=await g.IG.getDownloadURL(r);return y.I8.currentUser&&await g.lX.updateProfile(y.I8.currentUser,{photoURL:o}),o}async function updateAuthUserName(e){y.I8.currentUser&&await g.lX.updateProfile(y.I8.currentUser,{displayName:e})}},41179:function(e,n,r){"use strict";r.d(n,{_H:function(){return getBackups},hp:function(){return safelyBackupGraph},w4:function(){return downloadBackup}});var o=r(42298),a=r(43624),i=r.n(a),s=r(89734),l=r.n(s),c=r(92593),d=r(62601),u=r(48135),p=r(69963);async function backupGraph(e){let n=e.logger,r=await getBackupsDirectory(e);if(!r)return n.warn("[backup] Backup failed - no storage available"),!1;let a=(0,u.e)(e),i=function(e){let n=(0,o.Z)(new Date,"yyyyMMdd-HHmm");return"reflect-".concat(e.id,"-").concat(n,"-v").concat(d.Rh,".json")}(e),s=await r.getFileHandle(i,{create:!0});if("function"!=typeof s.createWritable)return n.warn("[backup] Backup failed - createWritable not supported"),!1;let l=await s.createWritable();return await l.write(a),await l.close(),n.warn("[backup] Saved backup: ".concat(i)),await cleanOldBackups(r),!0}async function safelyBackupGraph(e){let n=e.logger;try{return await backupGraph(e)}catch(e){return n.warn("[backup] Backup failed: ".concat(e)),(0,p.Tb)(e),!1}}async function cleanOldBackups(e){let n=await getFiles(e),r=l()(n),o=i()(r,10);for(let n of o){console.log("[backup]","deleting backup",n);try{await e.removeEntry(n)}catch(e){console.warn("failed to delete backup",{backup:n,backups:JSON.stringify(r),toDelete:JSON.stringify(o)}),(0,p.Tb)(e)}}}async function getBackups(e){let n=await getBackupsDirectory(e);return n?await getFiles(n):[]}async function downloadBackup(e,n){let r=await getBackupsDirectory(e);if(!r)return;let o=await r.getFileHandle(n),a=await o.getFile();(0,c.l)(a,n)}async function getFiles(e){let n=[];for await(let[r]of e.entries())n.push(r);return n}async function getBackupsDirectory(e){if(!("storage"in window.navigator))return null;let n=navigator.storage;if("function"!=typeof n.getDirectory)return null;let r=await n.getDirectory(),o=await r.getDirectoryHandle("backups",{create:!0});return await o.getDirectoryHandle(e.id,{create:!0})}},85760:function(e,n,r){"use strict";r.d(n,{P:function(){return TableObserver}});var o=r(23279),a=r.n(o),i=r(13861);let TableObserver=class TableObserver{dispose(){this.listeners.forEach(e=>e()),this.flushDebounced.flush()}async prepare(){await this.table.waitUntilLoaded();let e=this.table.on("change",e=>{let{ids:n}=e;for(let e of n)this.pendingRowIds.add(e);this.flushDebounced()});this.listeners.push(e)}flush(){if(0===this.pendingRowIds.size)return;let e=function(e,n){let r=Array.from(e),o=r.filter(e=>n.has(e)),a=r.filter(e=>!n.has(e)),s=o.map(e=>n.get(e)).filter(i.Dw);return{updatedRows:s,deletedRowIds:a}}(this.pendingRowIds,this.table);this.pendingRowIds.clear(),this.onChange(e)}constructor(e){this.pendingRowIds=new Set,this.listeners=[],this.table=e.table,this.onChange=e.onChange,this.flushDebounced=a()(this.flush.bind(this),e.debounce),this.prepare()}}},39288:function(e,n,r){"use strict";r.d(n,{Z:function(){return TablePersistMixin}});var o=r(23279),a=r.n(o),i=r(95440),s=r(10256),l=r(20841);function TablePersistMixin(e){return class extends e{async attach(){super.attach(),await this.attachPersistence()}detach(){super.detach(),this.detachPersistence()}detachPersistence(){this.persistEnabled&&(this.saveDebounced.cancel(),this.off("change",this.boundSaveDebounced))}async attachPersistence(){this.persistEnabled&&(this.on("change",this.boundSaveDebounced,{name:"TablePersist onChange",priority:l.g.Low}),await this.load())}async load(){await (0,s.Z)(1),console.time("Loading table ".concat(this.name));let e=await i.j.getItem(this.storageKey);if(e){let n=JSON.parse(e);this.rows=new Map(n)}console.timeEnd("Loading table ".concat(this.name)),this.hasLoaded=!0,this.trigger("change",{ids:Array.from(this.rows.keys()),options:{fromLoad:!0}}),this.trigger("load")}toJSON(){return Array.from(this.rows.entries())}async save(){await this.waitUntilLoaded();let e=JSON.stringify(this);await i.j.setItem(this.storageKey,e)}get storageKey(){return"db-".concat(this.name,"-").concat(this.version)}async waitUntilLoaded(){this.hasLoaded||await this.waitForEvent("load")}constructor(e){var n,r;super(e),this.hasLoaded=!1,this.saveDebounced=a()(this.save.bind(this),1e3),this.boundSaveDebounced=this.saveDebounced.bind(this),this.version=null!==(n=e.version)&&void 0!==n?n:0,this.persistEnabled=null===(r=e.persistEnabled)||void 0===r||r}}}},47927:function(e,n,r){"use strict";r.d(n,{i:function(){return Table}});var o=r(44908),a=r.n(o),i=r(68825),s=r(97582),l=r(95534),c=r.n(l),d=r(89734),u=r.n(d),p=r(45578),h=r.n(p),g=r(68949);let TableQuery=class TableQuery{subscribe(){this.table.on("change",this.boundRefresh)}unsubscribe(){this.table.off("change",this.boundRefresh)}get results(){var e;return null===(e=this.parent)||void 0===e||e.results,this.internalResults}get count(){return this.results.length}get resultsByIds(){let e=new Map;for(let n of this.results)e.set(n.id,n);return e}refresh(){let e=Array.from(this.table.rows).map(e=>{let[n,r]=e;return{id:n,...r}});for(let n of this.selectors)e=n(e);this.setInternalResults(e)}refine(e){return new TableQuery({table:this.table,parent:this,selector:e})}build(e){return this.results.map(e)}sort(e){return this.refine(n=>n.slice().sort(e))}sortBy(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{order:"asc"};return this.refine(r=>{let o=u()(r,e);return"desc"===n.order&&(o=o.reverse()),o})}limit(e){return this.refine(n=>n.slice(0,e))}filter(e){return this.refine(n=>n.filter(e))}filterWithLimit(e,n){return this.refine(r=>{let o=[];for(let a of r)if(e(a)&&(o.push(a),o.length===n))break;return o})}uniqBy(e){return this.refine(n=>h()(n,e))}findById(e){var n;return null!==(n=this.resultsByIds.get(e))&&void 0!==n?n:null}find(e){var n;return null!==(n=this.results.find(e))&&void 0!==n?n:null}sample(){var e;return null!==(e=c()(this.results))&&void 0!==e?e:null}setInternalResults(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.internalResults=e}get selectors(){let e=[],n=this;do e.push(n.selector);while(n=n.parent);return e.reverse(),e}log(e){if(this.loggingName){var n;console.log("%c[".concat(null!==(n=this.loggingName)&&void 0!==n?n:"???","] ").concat(e),"background: lightskyblue; padding: 2px;")}}constructor(e){var n;this.internalResults=[],this.boundRefresh=()=>{this.refresh()},this.table=e.table,this.selector=null!==(n=e.selector)&&void 0!==n?n:e=>e,this.parent=e.parent,this.loggingName=e.loggingName,(0,g.makeObservable)(this),(0,g.onBecomeObserved)(this,"results",()=>{this.subscribe()}),(0,g.onBecomeUnobserved)(this,"results",()=>{this.unsubscribe()}),this.refresh()}};(0,s.gn)([g.observable.shallow],TableQuery.prototype,"internalResults",void 0),(0,s.gn)([g.computed],TableQuery.prototype,"results",null),(0,s.gn)([g.computed],TableQuery.prototype,"count",null),(0,s.gn)([(0,g.computed)({keepAlive:!0})],TableQuery.prototype,"resultsByIds",null),(0,s.gn)([g.action],TableQuery.prototype,"setInternalResults",null);var m=r(20841);let Table=class Table{get allIds(){return Array.from(this.rows.keys())}get values(){return Array.from(this.rows,e=>{let[n,r]=e;return{id:n,...r}})}get entries(){return this.rows.entries()}get count(){return this.rows.size}attach(){this.trigger("attach")}detach(){this.trigger("detach"),this.listeners.clear()}has(e){return this.rows.has(e)}get(e){let n=this.rows.get(e);return n?{id:e,...n}:null}filter(e){return this.values.filter(e)}query(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new TableQuery({table:this,...e})}update(e,n,r){this.rows.set(e,n),this.trigger("change",{ids:[e],options:r})}updateMany(e,n){for(let[n,r]of e)this.rows.set(n,r);let r=Array.from(e.keys());this.trigger("change",{ids:r,options:n})}delete(e,n){this.rows.delete(e),this.trigger("change",{ids:[e],options:n})}deleteMany(e,n){if(0!==e.length){for(let n of e)this.rows.delete(n);this.trigger("change",{ids:e,options:n})}}deleteAll(e){let n=this.allIds;this.rows.clear(),this.trigger("change",{ids:n,options:e})}create(e,n){let r=(0,i.O)();return this.rows.set(r,e),this.trigger("change",{ids:[r],options:n}),r}createMany(e,n){if(0===e.length)return;let r=this.addRows(e);this.trigger("change",{ids:r,options:n})}replaceAll(e,n){let r=this.allIds;this.rows.clear();let o=this.addRows(e),i=a()([...r,...o]);this.trigger("change",{ids:i,options:n})}replaceMany(e,n,r){this.deleteRows(e);let o=this.addRows(n),i=a()([...e,...o]);this.trigger("change",{ids:i,options:r})}deleteRows(e){for(let n of e)this.rows.delete(n)}addRows(e){let n=[];for(let r of e){if(!r.id)throw Error("Missing id");if(this.rows.has(r.id))throw Error("Row with id ".concat(r.id," already exists"));this.rows.set(r.id,r),n.push(r.id)}return n}on(e,n){let{name:r,priority:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={handler:n,name:r,priority:null!=o?o:m.g.Normal};return this.addListener(e,a),()=>{this.removeListener(e,a)}}off(e,n){let r=this.listeners.get(e)||[],o=r.find(e=>e.handler===n);o&&this.removeListener(e,o)}addListener(e,n){let r=this.listeners.get(e)||[];this.listeners.set(e,[...r,n])}removeListener(e,n){let r=this.listeners.get(e)||[],o=r.filter(e=>e!==n);this.listeners.set(e,o)}trigger(e,n){let r=this.listeners.get(e)||[];for(let e of(r.sort((e,n)=>n.priority-e.priority),r))e.handler(n)}waitForEvent(e){return new Promise(n=>{this.on(e,()=>{n()},{name:"waitForEvent"})})}log(e){this.loggingEnabled&&console.log("%c[".concat(this.name,"] ").concat(e),"color: blue")}constructor(e){var n;this.rows=new Map,this.listeners=new Map,this.loggingEnabled=!1,this.name=e.name,this.loggingEnabled=null!==(n=e.loggingEnabled)&&void 0!==n&&n}}},20841:function(e,n,r){"use strict";var o,a;r.d(n,{g:function(){return o}}),(a=o||(o={}))[a.High=3]="High",a[a.Normal=2]="Normal",a[a.Low=1]="Low"},48135:function(e,n,r){"use strict";r.d(n,{e:function(){return generateJsonBlob}});var o=r(42298),a=r(12428),i=r(68053),s=r(16005);function generateJsonBlob(e){let n=e.noteStore.assertAdapter,r=e.noteStore.undeletedNotes.results,l=e.tags,c=performance.now(),d={export_version:i.Rh,graph_version:e.version,notes:r.map(e=>(function(e,n){var r,i,l;let{document:c}=(0,a.tE)(e,n),{createdAt:d,updatedAt:u,editedAt:p}=e.snapshot,{dailyDate:h}=e.derived;return{id:e.id,subject:e.snapshot.subject,document_json:null!==(i=JSON.stringify(c))&&void 0!==i?i:null,created_at:(0,s.F)(d).toJSON(),updated_at:(0,s.F)(u).toJSON(),edited_at:null!==(l=null===(r=(0,s.F)(p))||void 0===r?void 0:r.toJSON())&&void 0!==l?l:null,daily_at:h?(0,o.Z)(h,"yyyy-MM-dd"):null,backlinked_count:e.snapshot.backlinkedCount}})(e,n)),tags:l},u=performance.now();console.log("Preparing notes export "+(u-c)+" milliseconds.");let p=JSON.stringify(d,null,2);return new Blob([p],{type:i.rt.json})}},62601:function(e,n,r){"use strict";r.d(n,{xH:function(){return h.xH},Rh:function(){return h.Rh},aT:function(){return exportNotes}});var o=r(42298),a=r(92593),i=r(15965),s=r(12428),l=r(76661),c=r(16005),d=r(55733),u=r.n(d),p=r(48135),h=r(68053);async function exportNotes(e,n){let r=await generateExportBlob(e,n),i=function(e,n){let r=h.yf[n],a=(0,o.Z)(new Date,"yyyyMMdd-HHmm");return"reflect-".concat(e.id,"-").concat(a,"-v").concat(h.Rh,".").concat(r)}(e,n);(0,a.l)(r,i)}async function generateExportBlob(e,n){switch(n){case"json":return(0,p.e)(e);case"csv":return function(e){let n=e.noteStore.assertAdapter,r=e.noteStore.undeletedNotes.results,o=[];for(let e of r){let{node:r}=(0,s.tE)(e,n);if(!r)continue;let a=(0,i.eJ)(r);o.push({id:e.id,subject:e.snapshot.subject,document_html:a,daily_at:(0,c.F)(e.derived.dailyDate),created_at:(0,c.F)(e.snapshot.createdAt),updated_at:(0,c.F)(e.snapshot.updatedAt),edited_at:(0,c.F)(e.snapshot.editedAt)})}return(0,l.R4)(o)}(e);case"markdown_zip":return function(e){let n=e.noteStore.assertAdapter,r=e.noteStore.undeletedNotes.results,a=new(u());for(let e of r){let r=e.derived.dailyDate,l=(0,c.B)(e.snapshot.subject),d=r?"daily-notes/".concat((0,o.Z)(r,"yyyy-MM-dd"),".md"):"".concat(l,"-").concat(e.id,".md"),{node:u}=(0,s.tE)(e,n);if(!u)continue;let p=(0,i.b8)(u);a.file(d,p)}return a.generateAsync({type:"blob"})}(e);case"html_zip":return function(e){let n=e.noteStore.assertAdapter,r=e.noteStore.undeletedNotes.results,o=new(u());for(let e of r){let r=(0,c.B)(e.snapshot.subject),a="".concat(r,"-").concat(e.id,".html"),{node:l}=(0,s.tE)(e,n);if(!l)continue;let d=(0,i.eJ)(l);o.file(a,d)}return o.generateAsync({type:"blob"})}(e)}}},68053:function(e,n,r){"use strict";r.d(n,{Rh:function(){return s},rt:function(){return o},xH:function(){return i},yf:function(){return a}});let o={json:"application/json",csv:"text/csv",markdown_zip:"application/zip",html_zip:"application/zip"},a={json:"json",csv:"csv",markdown_zip:"zip",html_zip:"zip"},i={json:"Reflect JSON",csv:"CSV",markdown_zip:"Markdown ZIP",html_zip:"HTML ZIP"},s="1.0"},16005:function(e,n,r){"use strict";function sanitizeFilename(e){return e.replace(/[/\\]/g,"").replace(/\s+/g," ")}function timestampToDate(e){return"number"==typeof e?new Date(e):void 0}r.d(n,{B:function(){return sanitizeFilename},F:function(){return timestampToDate}})},98930:function(e,n,r){"use strict";r.d(n,{IG:function(){return i},RZ:function(){return o},lX:function(){return a}}),r(83977);var o=r(39828),a=r(91259),i=r(86650)},26655:function(e,n,r){"use strict";r.d(n,{I8:function(){return y},vc:function(){return d},db:function(){return m},tO:function(){return f}});var o=r(83977),a=r(34155);let i='{"apiKey":"AIzaSyD5tmpwG6ZbTQcMznYMf4_YQgVBqPtfc2w","databaseURL":"https://reflect-prod.firebaseio.com","projectId":"reflect-prod","storageBucket":"reflect-prod.appspot.com","messagingSenderId":"188725225641","appId":"1:188725225641:web:93e4f14c15713f2372a1b8","measurementId":"G-TDJCZM4HVX"}',s=a.env.NEXT_PUBLIC_FIREBASE_AUTH_EMULATOR_HOST,l=a.env.NEXT_PUBLIC_FIRESTORE_EMULATOR_HOST;if(!i)throw Error("missing NEXT_PUBLIC_FIREBASE_AUTH_JSON env var");let c=JSON.parse(i),d={authDomain:window.location.host,...c,clientID:"188725225641-n0tkosc6bsjc5lponcr9sjec1ifn38b2.apps.googleusercontent.com",appleScopes:["email","name"],googleScopes:["email","profile"]};var u=r(91259),p=r(39828),h=r(86650);let g=function(){var e;let n=(0,o.C6)();return null!==(e=n[0])&&void 0!==e?e:(0,o.ZF)(d,void 0)}(),m=function(e){let n=!!window.indexedDB,r=(0,p.initializeFirestore)(e,{...n?{localCache:(0,p.persistentLocalCache)({tabManager:(0,p.persistentMultipleTabManager)(),cacheSizeBytes:p.CACHE_SIZE_UNLIMITED})}:{}});if(l){let[e,n]=l.split(":");(0,p.connectFirestoreEmulator)(r,e,Number(n))}return r}(g),y=function(e){let n=(0,u.getAuth)(e);return s&&!n.emulatorConfig&&(0,u.connectAuthEmulator)(n,"http://".concat(s),{disableWarnings:!0}),n}(g),f=function(e){let n=(0,h.getStorage)(e);return n.maxUploadRetryTime=0,n}(g)},70586:function(e,n,r){"use strict";r.d(n,{k:function(){return d}});var o=r(54375),a=r(25934),i=r(91425),s=r(25152);let Logger=class Logger{addMeta(e){this.meta={...this.meta,...e}}child(e){return new Logger(this.ipc,{...this.meta,...e})}info(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ipc.log(e,{level:"info",meta:this.meta,object:n})}warn(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ipc.log(e,{level:"warn",meta:this.meta,object:n})}error(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ipc.log(e,{level:"error",meta:this.meta,object:n})}fatal(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ipc.log(e,{level:"fatal",meta:this.meta,object:n})}constructor(e,n={}){this.ipc=e,this.meta=n}};let l="undefined"!=typeof Worker?new Worker(r.tu(new URL(r.p+r.u(7261),r.b))):null,c=l?o.Ud(l):{log:function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{level:r="info",meta:o={},object:a={}}=n;switch(r){case"info":console.info(e,{...a,...o});break;case"warn":console.warn(e,{...a,...o});break;case"error":case"fatal":console.error(e,{...a,...o})}}},d=new Logger(c,{platform:(0,s.ob)(),env:(0,i.KF)(),sessionId:(0,a.Z)(),sessionStart:new Date().toISOString()})},24828:function(e,n,r){"use strict";r.d(n,{Z:function(){return __WEBPACK_DEFAULT_EXPORT__}});var o=r(65422),a=r(15965),i=r(52300),s=r(46551),l=r(14066),c=r(25038),d=r(55714),u=r(89992),p=r(9069),h=r(39541),g=r(26655),m=r(98930),y=r(69963);async function __WEBPACK_DEFAULT_EXPORT__(e){let{graph:n}=e,r=n.logger.child({migration:15}),a=(0,o.J4)({db:g.db,graphId:n.id}),i=await m.RZ.getDocsFromServer(a),s=i.docs,l=0;for(let e of s){let o=e.id,a=e.data();!a.yjs_doc&&(l+=1,a.document_json?await fixNoteWithDocumentJson({noteId:o,data:a,graph:n,logger:r}):(a.encrypted_note_json||a.note_json)&&await fixNoteWithOldFormat({noteId:o,data:a,graph:n,logger:r}))}l>0&&(n.noteStore.detachAllNotes(),n.noteStore.setSyncedAt(null),(0,c.j)("migration_15_applied",{graphId:n.id,notesCount:l}))}async function fixNoteWithDocumentJson(e){let{noteId:n,data:r,graph:o,logger:a}=e;if(!r.document_json)return;a.info("Note ".concat(n," has document_json, fixing..."));let i=await readDocument({noteId:n,dbDocumentJson:r.document_json,graph:o});if(!i){a.error("Failed to read document from note ".concat(n));return}let s=await createEncryptedYjsDoc(n,i,o);if(!s){a.error("Failed to create YJS document from note ".concat(n));return}await updateNote({noteId:n,changes:{yjs_doc:s},graph:o})}async function fixNoteWithOldFormat(e){let{noteId:n,data:r,graph:o,logger:a}=e;a.info("Note ".concat(n," has encrypted_note_json or note_json, fixing..."));let i=await readDocWithAllEncrypted({graph:o,noteId:n,data:r});if(!i){a.error("Failed to decrypt encrypted_note_json in note ".concat(n));return}let s=i.document;if(!s){a.error("Document not found in encrypted_note_json");return}let l=await createYjsUpdateString(s);if(!l){a.error("Failed to create YJS document from note ".concat(n));return}let c=i.id||i.$modelId||null,d={...i,yDocAsUpdate:l,id:c},u=await docFromValues(d,{encrypt:!0,key:o.encryptionKey,itemId:c});try{await updateNote({noteId:n,changes:u,graph:o})}catch(e){(0,y.Tb)(e),a.error("Failed to update note: ".concat(n))}}async function updateNote(e){let{noteId:n,changes:r,graph:a}=e,i=(0,o.J4)({db:g.db,graphId:a.id}),s=m.RZ.doc(i,n);await m.RZ.updateDoc(s,r)}async function readDocument(e){let{noteId:n,dbDocumentJson:r,graph:o}=e,a={key:o.encryptionKey,itemId:n};try{let e=await (0,d.MJ)({type:"Note",value:r,...a});return e?JSON.parse(e):void 0}catch(e){return(0,y.Tb)(e),null}}async function readDocWithAllEncrypted(e){let n,{graph:r,noteId:o,data:a}=e;try{n=await decryptFieldPair({type:"Note",encrypted:a.encrypted_note_json,plain:a.note_json,key:r.encryptionKey,itemId:o})}catch(e){return(0,y.Tb)(e),null}if(!n)return null;try{return JSON.parse(n)}catch(e){return(0,y.Tb)(e),null}}async function createEncryptedYjsDoc(e,n,r){try{let o=await createYjsUpdateString(n);return await encryptYjsDocAsUpdate(o,{key:r.encryptionKey,encrypt:!0,itemId:e})}catch(e){return(0,y.Tb)(e),null}}async function createYjsUpdateString(e){let{ydoc:n}=(0,s.kg)(e,{template:!0}),r=a.pU.encodeStateAsUpdate(n);return(0,i.kZ)(r)}async function decryptFieldPair(e){let{type:n,encrypted:r,plain:o,key:a,itemId:i}=e;if(r){if(!a)throw Error("No key provided");return await (0,d.O6)({type:n,encrypted:r,key:a,itemId:i})}if(o)return o}async function docFromValues(e,n){var r,o,a,i,s,l;let c={id:e.id,version:u.C,acl:e.acl,created_at:(0,h.M)(e.createdAt),updated_at:(0,h.M)(e.updatedAt),edited_at:(0,h.M)(null!==(r=e.editedAt)&&void 0!==r?r:null),deleted_at:(0,h.M)(e.deletedAt),backlinked_count:e.backlinkedCount,daily:e.daily,ignored_backlink_from_note_ids:e.ignoredBacklinkFromNoteIds,ignored_backlink_labels:await (0,p.FS)(null!==(o=e.ignoredBacklinkLabels)&&void 0!==o?o:[],n),ignored_contact_names:await (0,p.FS)(null!==(a=e.ignoredContactNames)&&void 0!==a?a:[],n),pinned_index:null!==(i=e.pinnedIndex)&&void 0!==i?i:null,system_metadata:null!==(s=e.systemMetadata)&&void 0!==s?s:null,subject:await (0,p.Wu)(null!==(l=e.subject)&&void 0!==l?l:"",n),document_json:e.yDocAsUpdate?null:await (0,p.ec)(e.document,n)};return e.yDocAsUpdate&&(c.yjs_doc=await encryptYjsDocAsUpdate(e.yDocAsUpdate,n)),c}function encryptYjsDocAsUpdate(e,n){(0,l.hu)(e,"yDocAsUpdate is required");let r=(0,i._f)(e);return(0,d.RY)({plain:r,...n})}},25152:function(e,n,r){"use strict";var o,a;r.d(n,{HM:function(){return isIpad},Ky:function(){return currentAgent},d:function(){return isElectron},ob:function(){return currentPlatform},qx:function(){return isIphone},t4:function(){return o}}),(a=o||(o={})).App="app",a.Web="web",a.Mobile="mobile";let isElectron=()=>void 0!==window.electron,isIphone=()=>navigator.userAgent.match(/iphone/i),isIpad=()=>navigator.userAgent.match(/ipad/i);function currentPlatform(){return isElectron()?"app":"web"}function currentAgent(){return isIphone()?"iphone":isIpad()?"ipad":"browser"}},69963:function(e,n,r){"use strict";r.d(n,{T8:function(){return useSentry},Tb:function(){return captureException},uT:function(){return captureMessage}});var o=r(64487),a=r(64210),i=r(66604),s=r.n(i),l=r(67294),c=r(88766),d=r(91425),u=r(35339),p=r(25152);function useSentry(){(0,l.useEffect)(()=>{console.log("Register Sentry..."),(0,u.Mo)(setUser)},[])}function setUser(e){let{id:n,email:r}=e;o.av({id:n,email:r})}function captureException(e,n){let r=sentryContext(n);(0,d.Y8)()||console.error(e,r.extra),o.Tb(e,r),flushIfNeeded(n)}function captureMessage(e,n){let r=sentryContext(n);(0,d.Y8)()||console.warn(e,r.extra),o.uT(e,r),flushIfNeeded(n)}async function flushIfNeeded(e){(null==e?void 0:e.flush)&&await a.yl(2e3)}function sentryContext(e){var n;let r=null==e?void 0:e.tags,o=null==e?void 0:e.level,a=s()(null!==(n=null==e?void 0:e.extra)&&void 0!==n?n:{},e=>JSON.stringify(e));return{extra:a,level:o,tags:r}}o.YA("platform",(0,p.ob)()),o.YA("agent",(0,p.Ky)()),o.YA("capacitor",(0,c.W)())},24654:function(){}}]);