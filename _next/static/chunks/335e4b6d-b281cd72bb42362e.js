"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7754],{15965:function(e,t,n){n.d(t,{$b:function(){return migrateJson},Ak:function(){return getTasks},DA:function(){return syncNodesToParentList},Dx:function(){return rewriteBacklinkGraphIds},FT:function(){return jsonFromNode},G5:function(){return getEmails},H9:function(){return getBacklinkNodes},HT:function(){return appendNodesToParentList},HU:function(){return obfuscateDocument},Jk:function(){return getDocJsonWithoutSubject},K3:function(){return nB},KZ:function(){return tS},LX:function(){return listLabelFromMarkdown},MQ:function(){return createInlineDocumentJson},M_:function(){return addSubjectToContent},Mc:function(){return ReflectEditor},NJ:function(){return getTags},Ne:function(){return applyTransform},Nk:function(){return getDomains},Oj:function(){return getLine},Pc:function(){return yjsMigrateVersion},QA:function(){return findBacklink},Qo:function(){return appendOrUpdateTask},R7:function(){return nodeFromHtml},S3:function(){return insertOrUpdateBacklink},Su:function(){return a.Su},VN:function(){return a.VN},WJ:function(){return ensureNamedList},Y8:function(){return fragmentFromMarkdown},YK:function(){return rewriteBacklinkNoteIds},_F:function(){return function remirrorJsonIsEmpty(e){var t;if(!e)return!0;if(Array.isArray(e))return 0===e.length||e.every(remirrorJsonIsEmpty);if("object"!=typeof e)throw TypeError("content must be an object");return!e.text&&(t=e.type,!tg.has(t)&&remirrorJsonIsEmpty(e.content))}},_u:function(){return collectChildren},_w:function(){return a._w},b8:function(){return markdownFromNode},bo:function(){return updateListKind},cO:function(){return taskNodeToTaskDocumentJson},d1:function(){return i.d1},d5:function(){return hasTask},e$:function(){return a.e$},e3:function(){return a.e3},eJ:function(){return htmlFromNode},fK:function(){return nb},fL:function(){return ensureList},hH:function(){return nodeFromJson},jU:function(){return mergeDocument},kB:function(){return getSubject},kE:function(){return getTasksWithContext},kv:function(){return syncNodesToNamedList},lW:function(){return replacePrefixLink},mD:function(){return getPhoneNumbers},n8:function(){return syncNamedListItems},nM:function(){return getLineFromDocJson},nv:function(){return getLinkHrefs},pU:function(){return a.Y},rc:function(){return getBacklinksWithContextHtml},rx:function(){return appendNodesToFirstList},sW:function(){return addSuggestedBacklinkToNodes},sd:function(){return getMetadata},tW:function(){return appendNodesToNamedList},tw:function(){return a.tw},vh:function(){return updateTaskChecked},vu:function(){return getClickedTaskCheckbox},wc:function(){return hasDeprecatedList},wk:function(){return applyInlineDocumentJson},wn:function(){return searchTextInDoc},x4:function(){return a.x4}});var r,a=n(53584),i=n(97153),l=n(77273),o=n(41210),s=n(53198),c=n(67294),u=n(93355),d=n(5956),p=n(81877),m=n(44573),h=n(378),f=n(55658),g=n(64010),k=n(32594),v=n(11033),y=n(22242),b=n(35770),w=n(25934),x=n(99711),E=n(63520),C=n(27398),T=n(23006),L=n(31871),S=n(56073),I=n(57555),N=n(36912),M=n(84799),D=n(78822),A=n(97934),B=n(12806),P=n(88482),H=n(34598),R=n(55843),F=n(76209),Z=n(126),O=n(65241),j=n(24534),_=n(94207),z=n(64042),$=n(58038),V=n(37736),W=n(2376),U=n(96853),K=n(93809),q=n(47126),Y=n(33194),J=n(83266),G=n(29430),Q=n(27204),X=n(16042),ee=n(66749),et=n(93851),en=n(290),er=n(68793),ea=n(84348),ei=n(111),el=n(28800),eo=n(16560),es=n(84672),ec=n(13848),eu=n(27784),ed=n(71265),ep=n(93080),em=n(82192),eh=n(12321),ef=n(85983),eg=n(66037),ek=n(44080),ev=n(73935),ey=n(61193),eb=n(83227),ew=n(5705),ex=n(60440),eE=n(611),eC=n(78469),eT=n(72845),eL=n(94956),eS=n(54340),eI=n(62339),eN=n(27771),eM=n(66843),eD=n(59202),eA=n(50576),eB=n(40545),eP=n(38198),eH=n(5128),eR=n(29527),eF=n(69010),eZ=n(36409),eO=n(69782),ej=n(11720),e_=n(68365),ez=n(87783),e$=n(57851),eV=n(54573),eW=n(91592),eU=n(12003),eK=n(50660),eq=n(76228);function notEmpty(e){return null!=e}var eY=h.xV.High,eJ=eY+1,eG=eY+1,eQ=eJ+1,eX=eY+1,defaultFileUploadHandler=e=>{let t=URL.createObjectURL(e);return Promise.resolve({src:t,fileName:e.name})};function guid(){return(0,w.Z)()}function formatFileType(e){var t;if(!e)return"";let n=e.split("/")[1];return null!=(t=({"vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xlsx","vnd.ms-excel":"xls"})[n])?t:n}function formatFileSize(e,t){if(0==e)return"0";let n=t||2,r=Math.floor(Math.log(e)/Math.log(1024));return Number.parseFloat((e/Math.pow(1024,r)).toFixed(n))+"\xa0"+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]}function formatFileName(e){return e.replace(/\.[^.]+$/,"")}function AttachmentView(e){var t;let{selected:n,context:r,node:i}=e,l=i.attrs,o=!!r;l.error&&console.warn(`Found a upload error: ${l.error}`);let[u,d]=(0,c.useState)(1),p=(0,c.useCallback)(e=>{e<=1||d(20+.75*(e=(0,E.Z)(e,0,100)))},[]);return(0,c.useEffect)(()=>{r&&r.addListener(e=>{let t=e[a.Lr];t&&p(t)})},[r,p]),(0,c.useEffect)(()=>{let e=setInterval(()=>{d(t=>t<20?t+1:(clearInterval(e),t))},250);return()=>clearInterval(e)},[]),c.createElement("div",{className:(0,s.Z)(["relative max-w-[350px] select-none overflow-hidden rounded-md bg-coolgray-50 text-sm font-medium text-coolgray-400 outline outline-offset-0 transition duration-300 hover:bg-coolgray-100 dark:bg-coolgray-800 dark:text-near-white dark:hover:bg-coolgray-700",n?"outline-blue-400":"outline-transparent"])},c.createElement("div",{className:"flex select-none items-center space-x-3 p-3"},l.error?c.createElement("div",{className:"text-red-500"},c.createElement("p",null,"Oh no! Something went wrong when uploading your file. Please try again.")):o?c.createElement(c.Fragment,null,c.createElement("div",null,"File is uploading...")):c.createElement(c.Fragment,null,c.createElement("div",{className:"block max-w-14 flex-none truncate rounded-md bg-white p-2 text-center text-xs font-bold uppercase text-red-400 dark:bg-dark-black-800 dark:text-near-white"},formatFileType(l.fileType)),c.createElement("div",{className:"max-w-[160px] shrink truncate text-base text-blue-500"},formatFileName(l.fileName||"")),c.createElement("div",{className:"w-16 truncate text-coolgray-500 dark:text-near-white"},formatFileSize(null!=(t=l.fileSize)?t:0,1)),c.createElement("div",{className:"reflect-editor-spacer"}),c.createElement("a",{href:o?void 0:l.url,target:"_blank",download:l.fileName,rel:"noreferrer"},c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},c.createElement("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"}))))),o&&c.createElement("div",{className:"absolute inset-x-0 bottom-0 h-1 overflow-hidden bg-gray-200"},c.createElement("div",{className:"h-full bg-accent transition duration-500 dark:bg-accent-dk",style:{transformOrigin:"0",transform:`scaleX(${u/100})`}})))}var e0=class extends x.b9{createNodeSpec(e,t){let n=super.createNodeSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{toDOM:e=>{let t=e.attrs;return["div",{class:"reflect-editor-attachment-container p-1","data-url":t.url,"data-file":"","data-filename":t.fileName,"data-filetype":t.fileType,"data-filesize":t.fileSize},function(e){var t;let n=e.node.attrs;return["div",{class:"relative max-w-[350px] select-none overflow-hidden rounded-md bg-coolgray-50 text-sm font-medium text-coolgray-400 outline outline-offset-0 transition duration-300 hover:bg-coolgray-100 dark:bg-coolgray-800 dark:text-near-white dark:hover:bg-coolgray-700 outline-transparent"},["div",{class:"flex select-none items-center space-x-3 p-3"},["div",{class:"block max-w-14 flex-none truncate rounded-md bg-white py-2 px-2 text-center text-xs font-bold uppercase text-red-400 dark:bg-dark-black-800 dark:text-near-white"},["span",formatFileType(n.fileType)]],["div",{class:"max-w-[160px] shrink truncate text-base text-blue-500"},["span",formatFileName(n.fileName||"")]],["div",{class:"w-16 truncate text-coolgray-500 dark:text-near-white"},formatFileSize(null!=(t=n.fileSize)?t:0,1)],["div",{class:"reflect-editor-spacer"}],["a",{href:n.url,target:"_blank",download:n.fileName},["svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor"},["path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"}]]]]]}({node:e})]}})}};function wrapOnBacklinkAdd(e){return t=>{let n=(0,l.EZ)((0,l.ih)({},t),{id:t.id===a.S5?"":t.id,graphId:t.graphId===a.S5?"":t.graphId});return e(n)}}function maybeFixBacklinks(e,t){e&&t&&setTimeout(()=>{fixBacklinks(e,t)},50)}async function fixBacklinks(e,t){if(e.isDestroyed)return;let n=e.state.tr;await updateDocBacklinks(n,t),e.isDestroyed||e.dispatch(n)}async function updateDocBacklinks(e,t){let n=e.doc,r=[];for(let{node:i,pos:l}of(n.descendants((e,t)=>{if(e.type.name===a.qh){let n=e.attrs;n.id&&n.id!==a.S5&&n.graphId!==a.S5||r.push({node:e,pos:t})}}),r))await updateDocBacklink(e,l,i.attrs,t)}async function updateDocBacklink(e,t,n,r){let i=await wrapOnBacklinkAdd(r)(n);if(i.id===a.S5||i.groupId===a.S5)throw Error("Backlink id cannot be a placeholder");let l=e.doc.nodeAt(t);(null==l?void 0:l.type.name)===a.qh&&e.setNodeMarkup(t,void 0,i)}var e1=C.NZ.isMac?e=>e.metaKey:e=>e.ctrlKey;function isHighlightDecorationSpec(e){return e&&"object"==typeof e&&"string"==typeof e.searchTerm&&"boolean"==typeof e.active}function findHighlightDecorationSearchTerm(e){var t;let n=e.map(e=>e.spec).find(isHighlightDecorationSpec);return null!=(t=null==n?void 0:n.searchTerm)?t:null}function addHighlightFromDecoration(e,t){let n=findHighlightDecorationSearchTerm(t);n&&(0,i.CC)(e,n)}var e5=null,e2=["[","【"],e7=["]","】"],e3="["+e2.map(e=>"\\"+e).join("")+"]";function trimEndRightBrackets(e){for(let t of e7)if(e.endsWith(t))return(0,T.Z)(e,t);return e}e7.map(e=>"\\"+e).join("");var e4=null,e8="https://reflect.app/g/",e6=/reflect.app\/g\/([^/]+)\/([^/]+)\/?/;function toBacklinkHref({graphId:e,id:t}){return`${e8}${e}/${t}`}var e9=class extends m.QR{constructor(){super(...arguments),this.atInputStart=-1,this.atInputEnd=-1}get name(){return"backlink"}createTags(){return[h.eX.InlineNode,h.eX.Behavior]}shouldBacklinkSelection(e){return!(0,C.Ab)(e)&&(0,C.hT)(e)&&e.$head.sameParent(e.$anchor)}handleEnterKeyPress(e,{modKey:t}){var n,r;let a=e.selection.node;if((null==a?void 0:a.type.name)===this.name){let e=a.attrs;return null==(r=(n=this.options).onOpen)||r.call(n,null,e,{modKey:t}),!0}return!1}handleSquareBracketInsert(e,{allowEmpty:t=!1}={}){let n=e.selection;if(!(0,C.hT)(n)||!n.$head.sameParent(n.$anchor)||!t&&n.empty)return!1;let{from:r,to:a}=n,i=e.doc.cut(r,a).textContent;if(function(e){for(let t of e2)if(e.startsWith(t+t))return!0;return!1}(i))return!1;(function(e){for(let t of e2)if(e.startsWith(t))return!0;return!1})(i)&&(i=i.slice(1));let l=`[[${i}`;return this.store.commands.replaceText({content:l,selection:e.selection,keepSelection:!1}),this.store.commands.selectText(this.store.view.state.selection.to),!0}createKeymap(){return[eX,{"Mod-Shift-k":({state:e})=>this.handleSquareBracketInsert(e,{allowEmpty:!0}),"[":({state:e})=>this.handleSquareBracketInsert(e,{allowEmpty:!1}),Enter:({state:e})=>this.handleEnterKeyPress(e,{modKey:!1}),"Mod-Enter":({state:e})=>this.handleEnterKeyPress(e,{modKey:!0})}]}createNodeSpec(e,t){return(0,l.EZ)((0,l.ih)({inline:!0,selectable:this.options.selectable,draggable:this.options.draggable,atom:!0},t),{attrs:(0,l.EZ)((0,l.ih)({},e.defaults()),{id:{},label:{},graphId:{default:this.options.graphId}}),parseDOM:[{tag:"span[data-backlink]",priority:h.xV.High,getAttrs:t=>{if(!(0,C.jd)(t))return!1;let n=t.getAttribute("data-id"),r=t.getAttribute("data-label"),a=t.getAttribute("data-graph-id")||this.options.graphId;return!!n&&(0,l.EZ)((0,l.ih)({},e.parse(t)),{graphId:a,id:n,label:r})}},{tag:`${this.options.mentionTag}[href^="${e8}"]`,priority:h.xV.High,getAttrs:t=>{if(!(0,C.jd)(t))return!1;let n=t.getAttribute("href"),{graphId:r,id:a}=function(e){if(!e)return{};let t=e.match(e6);if(t){let[e,n,r]=t;return{graphId:n,id:r}}return{}}(n);if(!a)return!1;let i=t.textContent;return(0,l.EZ)((0,l.ih)({},e.parse(t)),{graphId:r,id:a,label:i})}}],toDOM:e=>{let{label:t}=e.attrs;return[this.options.mentionTag,{href:this.buildHref(e)},t]},leafText:e=>e.attrs.label})}createNodeViews(){return(e,t,n,r)=>{let i=e.attrs;i.id===a.S5&&maybeFixBacklinks(this.store.view,this.options.onAdd);let l=document.createElement(this.options.mentionTag);l.setAttribute("href",this.buildHref(e)),l.setAttribute("tabindex","-1"),l.setAttribute("data-editor-backlink",""),l.textContent=i.label,addHighlightFromDecoration(l,r);let o=this.options.onOpen,s=!1;if(l.addEventListener("pointerdown",e=>{s=!0,e.preventDefault()}),l.addEventListener("pointerup",e=>{s&&(null==o||o(e,i,{modKey:e1(e)})),s=!1}),l.addEventListener("click",e=>{e.preventDefault()}),this.options.onHover){let e=this.options.onHover;l.addEventListener("mouseenter",t=>{e(t,i,!0)}),l.addEventListener("mouseleave",t=>{e(t,i,!1)})}return{dom:l,update:()=>!1}}}buildHref(e){let{graphId:t,id:n}=e.attrs,r=this.options.graphId;return toBacklinkHref({graphId:null!=t?t:r,id:n})}replaceWithBacklink(e,t,n,r){var a;e.replaceWith(n,r,this.type.create((0,l.EZ)((0,l.ih)({},t),{graphId:null!=(a=t.graphId)?a:this.options.graphId})))}insertBacklink(e){return({tr:t,dispatch:n})=>{let{from:r}=(0,C.b0)(t.selection,t.doc);return this.replaceWithBacklink(t,e,r,r),null==n||n(t),!0}}createBacklink(e,t){let{range:n}=e;return e=>{let{tr:r,dispatch:a}=e;return this.replaceWithBacklink(r,t,n.from,n.cursor),null==a||a(r),!0}}createMatchRules(){let e={match:(e4||(e4="(?:(?:"+e3+e3+")|(?:(?:^|"+((null===e5&&(e5=function(){try{return"ac"==="ab".replace(RegExp("(?<=a)b","g"),"c")}catch(e){return!1}}()),e5)?"(?<=\\s)":"\\s")+")@))(.*)$"),RegExp(e4,"i")),onMatch:e=>{let t=e.match[0];return!(t.startsWith("@")&&-1===this.atInputStart||function(e){for(let t of e7)if(e.includes(t+t))return!0;return!1}(trimEndRightBrackets(t)))&&this.options.onBacklinkMatchV2(e)},onDismiss:()=>{this.options.onBacklinkDismissV2()}};return[e]}createEventHandlers(){return{textInput:({text:e,from:t,to:n})=>{if("@"===e){this.atInputStart=t,this.atInputEnd=t+1;return}-1!==this.atInputStart&&(n<this.atInputStart||t>this.atInputEnd+1?(this.atInputStart=-1,this.atInputEnd=-1):this.atInputEnd=n+1)}}}};(0,l.u2)([(0,m.WDe)()],e9.prototype,"insertBacklink",1),(0,l.u2)([(0,m.WDe)()],e9.prototype,"createBacklink",1),e9=(0,l.u2)([(0,m.AOx)({defaultOptions:{selectable:!0,draggable:!1,mentionTag:"a",appendText:" ",disableDecorations:!1,graphId:"",onOpen:null,onHover:null,onAdd:null},handlerKeys:["onBacklinkMatchV2","onBacklinkDismissV2"],staticKeys:["selectable","draggable","mentionTag","graphId"]})],e9);var te=class extends L.z{wrapInBlockquote(){return e=>(0,C.ym)(this.type)(e)}createPasteRules(){return[]}};function spaceMarkInputRule(e){let t;let{regexp:n,type:r,getAttributes:a,ignoreWhitespace:i=!1,beforeDispatch:l,updateCaptured:o,shouldSkip:s,invalidMarks:c}=e,u=new N.VK(n,(e,n,d,p)=>{var m;let{tr:f,schema:g}=e;t||(t=(0,I.HD)(r)?g.marks[r]:r,(0,I.kG)(t,{code:h.mA.SCHEMA,message:`Mark type: ${r} does not exist on the current schema.`}));let k=n[1],v=n[0],y=function({captureGroup:e,fullMatch:t,end:n,start:r,rule:a,ignoreWhitespace:i,shouldSkip:l,updateCaptured:o,state:s,invalidMarks:c}){var u,d,p,m,h,f;if(null==t)return null;let g=null!=(u=null==o?void 0:o({captureGroup:e,fullMatch:t,start:r,end:n}))?u:{};e=null!=(d=g.captureGroup)?d:e,t=null!=(p=g.fullMatch)?p:t,r=null!=(m=g.start)?m:r,n=null!=(h=g.end)?h:n;let k=s.doc.resolve(r),v=s.doc.resolve(n);return c&&(0,M.j4)({$from:k,$to:v},c)||a.invalidMarks&&(0,M.j4)({$from:k,$to:v},a.invalidMarks)||i&&(null==e?void 0:e.trim())===""||(null==l?void 0:l({state:s,captureGroup:e,fullMatch:t,start:r,end:n,ruleType:"mark"}))||(null==(f=a.shouldSkip)?void 0:f.call(a,{state:s,captureGroup:e,fullMatch:t,start:r,end:n,ruleType:"mark"}))?null:{captureGroup:e,end:n,fullMatch:t,start:r}}({captureGroup:k,fullMatch:v,end:p,start:d,rule:u,state:e,ignoreWhitespace:i,invalidMarks:c,shouldSkip:s,updateCaptured:o});if(!y)return null;({start:d,end:p,captureGroup:k,fullMatch:v}=y);let b=(0,I.mf)(a)?a(n):a,w=p,x=[];if(k){let e=v.search(/\S/),t=d+v.indexOf(k),n=t+k.length;x=null!=(m=f.storedMarks)?m:[],n<p&&f.delete(n,p),t>d&&f.delete(d+e,t),w=d+e+k.length,d+=e}return f.insertText(" "),f.addMark(d,w,t.create(b)),f.setStoredMarks(x),null==l||l({tr:f,match:n,start:d,end:p}),f});return u}(0,l.u2)([(0,m.WDe)()],te.prototype,"wrapInBlockquote",1);var tt=class extends S.H{createInputRules(){return[spaceMarkInputRule({regexp:/(?:\*\*|__)([^*_]+)(?:\*\*|__)\s$/,type:this.type,ignoreWhitespace:!0})]}},tn=class extends D.W{createKeymap(){return[eG,{Tab:insertTab,"Shift-Tab":removeTab}]}},insertTab=({tr:e,dispatch:t})=>!!(e.selection.$from.parent.type.spec.code&&e.selection.empty&&(0,C.hT)(e.selection))&&(null==t||t(e.insertText("	")),!0),removeTab=({tr:e,dispatch:t})=>{if(e.selection.$from.parent.type.spec.code&&e.selection.empty&&(0,C.hT)(e.selection)){let n=e.selection.from;if(n>1&&"	"===e.doc.textBetween(n-1,n))return null==t||t(e.deleteRange(n-1,n)),!0}return!1},tr=RegExp("^https?:\\/\\/(?:www\\.)?(?:youtu\\.be\\/|youtube(?:-nocookie)?\\.com\\/(?:watch\\?v=|embed\\/))(?<youtube_video_id>[\\w-]+)\\S*","i");function extractYoutubeVideoIdFromMatch(e){var t,n;return null!=(n=null==(t=null==e?void 0:e.groups)?void 0:t.youtube_video_id)?n:null}function normalizeIframeLink(e){var t,n;let r=null!=(t=e.src)?t:"";if("youtube"===e.type){let e=(n=r,tr.lastIndex=0,extractYoutubeVideoIdFromMatch(n.match(tr)));e&&(r=`https://www.youtube.com/watch?v=${e}`)}return null!=r?r:""}function createCustomDOMSerializer(e,t){let{wrapBacklinkWithBrackets:n=!1,removeTagLinks:r=!1,normalizeListItem:i=!1,normalizeTaskListItem:o=!1,normalizeIframe:s=!1,nativeList:c=!1}=null!=t?t:{},u=c?A.SD:B.PW,d=u.fromSchema(e),p=(0,l.ih)({},d.nodes);n&&(p.backlink=e=>{var t;let n=e.attrs;return["span",{"data-backlink":"","data-id":n.id,"data-graph-id":null!=(t=n.graphId)?t:"","data-label":n.label},`[[${n.label}]]`]}),r&&(p.tag=e=>{var t;let n=e.attrs;return["span",{"data-tag":"","data-id":n.id,"data-graph-id":null!=(t=n.graphId)?t:"","data-label":n.label},e.textContent]}),i&&(p.listItem=e=>{var t;if((null==(t=e.firstChild)?void 0:t.type.name)!==a.e3)return d.nodes.listItem(e);{let t=document.createElement("li");return e.forEach((e,n,r)=>{if(0===r){let n=m.serializeNode(e);t.append(...n.childNodes)}else t.append(m.serializeNode(e))}),{dom:t}}}),o&&(p.taskListItem=e=>{var t;if((null==(t=e.firstChild)?void 0:t.type.name)!==a.e3)return d.nodes.listItem(e);{let t=document.createElement("li");t.setAttribute("data-task-list-item","");let n=document.createElement("input");return n.setAttribute("type","checkbox"),e.attrs.checked&&(t.setAttribute("data-checked",""),n.setAttribute("checked","")),t.appendChild(n),e.forEach((e,n,r)=>{if(0===r){let n=m.serializeNode(e);t.append(...n.childNodes)}else t.append(m.serializeNode(e))}),{dom:t}}}),c&&o&&(p.list=e=>{var t;let n=document.createElement("ordered"===e.attrs.kind?"ol":"ul"),r=n.appendChild(document.createElement("li")),i=e.attrs;if((null==(t=e.firstChild)?void 0:t.type.name)!==a.e3)return d.nodes.list(e);if("task"===i.kind||"checklist"===i.kind){let e=document.createElement("input");e.setAttribute("type","checkbox"),i.checked&&e.setAttribute("checked",""),r.appendChild(e)}return"checklist"===i.kind&&r.setAttribute("data-list-kind","checklist"),e.forEach((e,t,n)=>{if(0===n){let t=m.serializeNode(e);r.append(...t.childNodes)}else r.append(m.serializeNode(e))}),{dom:n}}),s&&(p.iframe=e=>{let t=normalizeIframeLink(e.attrs);return["a",{href:t},t]});let m=new u(p,d.marks);return m}function unsafeFilter(e){return"+"!==e.character&&"["!==e.character}var textHandle=(e,t,n,r)=>H.p.text(e,t,(0,l.EZ)((0,l.ih)({},n),{unsafe:n.unsafe.filter(unsafeFilter)}),r),hardBreakHandle=(...e)=>{let t=H.p.hardBreak(...e);return"\\\n"===t?"\n":t},nonStandardLinkHandle=(e,t,n,r)=>{let a=(e.url||"").trim(),i=n.unsafe;n.unsafe=[];let l=n.containerPhrasing(e,r);n.unsafe=i;let o=a.startsWith(e8),s=a.replace(/^(tel:|mailto:|\/\/)/,""),c=s.replace(/^https?:\/\//,"");return o||l===c||l===a?l:`${l} (${s})`};function createProcessor(e){let t={text:textHandle,break:hardBreakHandle};return"clipboard"===e&&(t.link=nonStandardLinkHandle),(0,j.l)().use(R.Z).use(F.Z,{checked:"[x] ",unchecked:"[ ] ",handlers:{u:P.q.span,mark:P.q.span,strike:P.q.span,del:P.q.span,s:P.q.span}}).use(Z.Z).use(O.Z,{handlers:t,emphasis:"_",bullet:"-",listItemIndent:"one",fences:!0,tightDefinitions:!0,join:[(e,t)=>(null==e?void 0:e.type)==="listItem"&&(null==t?void 0:t.type)==="listItem"||(null==e?void 0:e.type)==="paragraph"&&(null==t?void 0:t.type)==="list"?0:1]})}var ta=null,ti=null;function htmlToMarkdown(e,t="clipboard"){ta&&ti||(ta=createProcessor("markdown"),ti=createProcessor("clipboard"));let n="markdown"===t?ta:ti;return String(n.processSync(e)).trimEnd()}function markdownFromFragment(e,t,n){let r=document.createElement("div");r.appendChild(t.serializeFragment(e));let a=r.innerHTML,i=(htmlToMarkdown(a,n)||"").trim();return i}function unwrapSlice(e){let{content:t,openStart:n,openEnd:r}=e;for(;n>1&&r>1&&1==t.childCount&&1==t.child(0).childCount;)n--,r--,t=t.child(0).content;return t}function getSliceText(e,t){var n,r;let a=unwrapSlice(e);if("plain"===t)return a.textBetween(0,a.size," ");{let e=null==(r=null==(n=a.firstChild)?void 0:n.type)?void 0:r.schema;if(!e)return"";let t=createCustomDOMSerializer(e,{normalizeListItem:!0,normalizeTaskListItem:!0,normalizeIframe:!0,wrapBacklinkWithBrackets:!0,removeTagLinks:!0,nativeList:!0});return markdownFromFragment(a,t,"markdown")}}function getPriorSelectionText(e,t,n){let{$to:r,to:a}=e,i=Math.max(0,a-t),{doc:l}=r,o=l.slice(i,a),s=getSliceText(o,n);return s.length>t?s.slice(s.length-t,s.length):s}var tl=class extends m.nNj{get name(){return"reflectCommand"}insertTextAt(e,t){return n=>{let{from:r,to:a}=n.tr.selection,{position:i="before"}=null!=t?t:{},l="before"===i?r:a;return this.store.commands.insertText(e,{from:l,to:l}),!0}}getPriorSelectionText(e,t){return getPriorSelectionText(this.store.view.state.selection,e,t)}};(0,l.u2)([(0,m.WDe)()],tl.prototype,"insertTextAt",1),(0,l.u2)([(0,m._y)()],tl.prototype,"getPriorSelectionText",1);var to=/[^./\s@:](?:[^/\s@:]*[^\s@:.])?@[^./\s@]+(?:\.[^./\s@]+)*/.source,ts=`(?:^|\\s+)(${to})`,tc=/(?:\+?(\d{1,3}))/.source,tu=`(?:(?:${tc}[-. ]{0,3})?)`+/[(]?(\d{3})[-. )]*(\d{3})[-. ]{0,3}(\d{4})/.source,td=`(?:^|\\s+)(${tu})(?:(?=[^0-9])|$)`,tp=[{regexp:RegExp(ts+"\\s$"),contactType:"mailto"},{regexp:RegExp(td+"\\s$"),contactType:"tel"}],tm=[{regexp:new RegExp(ts),contactType:"mailto"},{regexp:new RegExp(td),contactType:"tel"}];function createLinkInputRule({regexp:e,contactType:t,linkType:n}){return spaceMarkInputRule({regexp:e,type:n,getAttributes:([e])=>({href:t?`${t}:${e.trim()}`:extractHref(e.trim())}),shouldSkip:({state:e})=>e.selection.$from.node().type.name===a.tw})}var th=class extends m.nNj{get name(){return"contact"}createInputRules(){return tp.map(({regexp:e,contactType:t})=>createLinkInputRule({regexp:e,contactType:t,linkType:this.store.schema.marks.link}))}createPasteRules(){return tm.map(({regexp:e,contactType:t})=>(function({regexp:e,contactType:t,linkType:n,priority:r}){return{regexp:e,type:"mark",markType:n,getAttributes:([e])=>({href:t?`${t}:${e.trim()}`:extractHref(e.trim())}),transformMatch:e=>e[1],replaceSelection:!1,priority:r,ignoredMarks:["link"]}})({regexp:e,contactType:t,linkType:this.store.schema.marks.link,priority:h.xV.High}))}};function extractHref(e,t="http:"){return e.startsWith("http")||e.startsWith("//")?e:`${t}//${e}`}function isListItemNode(e){return!!e&&a.D4.includes(e.type.name)}function isListNode(e){return!!e&&a.V9.includes(e.type.name)}function isSelectionInsideListGroup(e){let t=e.$from,n=(0,C.Tr)({selection:t,types:a.V9});return!!n&&n.depth===t.depth-2&&0==t.index(t.depth-1)&&(n.node.type.name===a.xy?a.xy:n.node.type.name===a.oL?a.oL:a.IH)}function isInsideCollapsedList(e,t,n=t){let r=!1;return e.nodesBetween(t,n,(e,t,n)=>{((0,A.Sz)(e)||n&&(0,A.Sz)(n))&&(r=!0)}),r}function isEmptyParagraph(e){return!!(e&&e.type.name===a.e3&&0===e.childCount)}function isEmptyItem(e){return(isListItemNode(e)||(0,A.yD)(e))&&e.childCount<=1&&isEmptyParagraph(e.firstChild)}th=(0,l.u2)([(0,m.AOx)({defaultPriority:h.xV.High})],th);var tf=/reflect.app\/g\/([^/]+)\/tag\/([^/]+)/;function toTagHref({graphId:e,id:t}){return`https://reflect.app/g/${e}/tag/${t}`}function getTextFromTagAttrs(e){return`#${e.label}`}function getTextFromTweetAttrs(e){var t,n,r,a,i,l,o,s;let c=null!=(n=null==(t=null==e?void 0:e.tweetData)?void 0:t.text)?n:"",u=null!=(i=null==(a=null==(r=null==e?void 0:e.tweetData)?void 0:r.user)?void 0:a.name)?i:"",d="@"+(null!=(s=null==(o=null==(l=null==e?void 0:e.tweetData)?void 0:l.user)?void 0:o.screen_name)?s:"");return[c,u,d].join(" ")}function collectChildren(e){let t=[];for(let n=0;n<e.childCount;n++)t.push(e.child(n));return t}function isHeadingNode(e){return(null==e?void 0:e.type.name)===a.tw}var tg=new Set(["text","horizontalRule","emoji","image","tweet","file","tag","backlink","hardBreak","iframe"]),tk=RegExp("(?:(?:(?:https?:)?\\/\\/)?(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:a(?:a(?:a|rp)|b(?:arth|b(?:ott|vie)?|c|le|ogado|udhabi)|c(?:ademy|c(?:enture|ountants?)|o|tor)?|d(?:s|ult)?|e(?:g|ro|tna)?|f(?:l|rica)?|g(?:akhan|ency)?|i(?:g|r(?:bus|force|tel))?|kdn|l(?:faromeo|i(?:baba|pay)|l(?:finanz|state|y)|s(?:ace|tom))?|m(?:azon|e(?:rican(?:express|family)|x)|fam|ica|sterdam)?|n(?:alytics|droid|quan|z)|ol?|p(?:artments|p(?:le)?)|q(?:uarelle)?|r(?:a(?:b|mco)|chi|my|pa|te?)?|s(?:da|ia|sociates)?|t(?:hleta|torney)?|u(?:ction|di(?:ble|o)?|spost|t(?:hor|os?))?|vianca|ws?|xa?|z(?:ure)?)|b(?:a(?:by|idu|n(?:a(?:mex|narepublic)|d|k)|r(?:c(?:elona|lay(?:card|s))|efoot|gains)?|s(?:eball|ketball)|uhaus|yern)?|b(?:c|t|va)?|c[gn]|d|e(?:a(?:ts|uty)|er|ntley|rlin|st(?:buy)?|t)?|f|g|h(?:arti)?|i(?:ble|d|ke|ngo?|o|z)?|j|l(?:ack(?:friday)?|o(?:ckbuster|g|omberg)|ue)|m[sw]?|n(?:pparibas)?|o(?:ats|ehringer|fa|m|nd|o(?:k(?:ing)?)?|s(?:ch|t(?:ik|on))|t|utique|x)?|r(?:adesco|idgestone|o(?:adway|ker|ther)|ussels)?|s|t|u(?:ild(?:ers)?|siness|y|zz)|v|w|y|zh?)|c(?:a(?:b|fe|l(?:l|vinklein)?|m(?:era|p)?|non|p(?:etown|ital(?:one)?)|r(?:avan|ds|e(?:ers?)?|s)?|s(?:a|e|h|ino)|t(?:ering|holic)?)?|b(?:a|n|re|s)|c|d|e(?:nter|o|rn)|f[ad]?|g|h(?:a(?:n(?:el|nel)|rity|se|t)|eap|intai|r(?:istmas|ome)|urch)?|i(?:priani|rcle|sco|t(?:adel|ic?|y(?:eats)?))?|k|l(?:aims|eaning|i(?:ck|ni(?:c|que))|o(?:thing|ud)|ub(?:med)?)?|m|n|o(?:ach|des|ffee|l(?:lege|ogne)|m(?:cast|m(?:bank|unity)|p(?:a(?:ny|re)|uter)|sec)?|n(?:dos|s(?:truction|ulting)|t(?:act|ractors))|o(?:king(?:channel)?|l|p)|rsica|u(?:ntry|pons?|rses))?|pa|r(?:edit(?:card|union)?|icket|own|s|uises?)?|u(?:isinella)?|v|w|x|y(?:mru|ou)?|z)|d(?:a(?:bur|d|nce|t(?:a|e|ing|sun)|y)|clk|ds|e(?:al(?:er|s)?|gree|l(?:ivery|l|oitte|ta)|mocrat|nt(?:al|ist)|si(?:gn)?|v)?|hl|i(?:amonds|et|gital|rect(?:ory)?|s(?:co(?:unt|ver)|h)|y)|j|k|m|np|o(?:c(?:s|tor)|g|mains|t|wnload)?|rive|tv|u(?:bai|nlop|pont|rban)|v(?:ag|r)|z)|e(?:a(?:rth|t)|co?|d(?:eka|u(?:cation)?)|e|g|m(?:ail|erck)|n(?:ergy|gineer(?:ing)?|terprises)|pson|quipment|r(?:icsson|ni)?|s(?:q|tate)?|t(?:isalat)?|u(?:rovision|s)?|vents|x(?:change|p(?:ert|osed|ress)|traspace))|f(?:a(?:ge|i(?:l|rwinds|th)|mily|ns?|rm(?:ers)?|s(?:hion|t))|e(?:dex|edback|rr(?:ari|ero))|i(?:at|d(?:elity|o)|lm|na(?:l|nc(?:e|ial))|r(?:e(?:stone)?|mdale)|sh(?:ing)?|t(?:ness)?)?|j|k|l(?:i(?:ckr|ghts|r)|o(?:rist|wers)|y)|m|o(?:o(?:d(?:network)?|tball)?|r(?:d|ex|sale|um)|undation|x)?|r(?:e(?:e|senius)|l|o(?:gans|nt(?:door|ier)))?|tr|u(?:jitsu|nd?|rniture|tbol)|yi)|g(?:a(?:l(?:l(?:ery|o|up))?|mes?|p|rden|y)?|b(?:iz)?|dn?|e(?:a|nt(?:ing)?|orge)?|f|g(?:ee)?|h|i(?:fts?|v(?:es|ing))?|l(?:ass|e|ob(?:al|o))?|m(?:ail|bh|o|x)?|n|o(?:daddy|l(?:d(?:point)?|f)|o(?:dyear|g(?:le)?)?|p|t|v)|p|q|r(?:a(?:inger|phics|tis)|een|ipe|o(?:cery|up))?|s|t|u(?:ardian|cci|ge|i(?:de|tars)|ru)?|w|y)|h(?:a(?:ir|mburg|ngout|us)|bo|dfc(?:bank)?|e(?:alth(?:care)?|l(?:p|sinki)|r(?:e|mes))|gtv|i(?:phop|samitsu|tachi|v)|kt?|m|n|o(?:ckey|l(?:dings|iday)|me(?:depot|goods|s(?:ense)?)|nda|rse|s(?:pital|t(?:ing)?)|t(?:el(?:es|s)|mail)?|use|w)|r|sbc|t|u(?:ghes)?|y(?:att|undai))|i(?:bm|c(?:bc|e|u)|d|e(?:ee)?|fm|kano|l|m(?:amat|db|mo(?:bilien)?)?|n(?:c|dustries|f(?:initi|o)|g|k|s(?:titute|ur(?:ance|e))|t(?:ernational|uit)?|vestments)?|o|piranga|q|r(?:ish)?|s(?:maili|t(?:anbul)?)?|t(?:au|v)?)|j(?:a(?:guar|va)|cb|e(?:ep|tzt|welry)?|io|ll|mp?|nj|o(?:b(?:s|urg)|t|y)?|p(?:morgan|rs)?|u(?:egos|niper))|k(?:aufen|ddi|e(?:rry(?:hotels|logistics|properties))?|fh|g|h|i(?:a|ds|m|nd(?:er|le)|tchen|wi)?|m|n|o(?:eln|matsu|sher)|p(?:mg|n)?|r(?:d|ed)?|uokgroup|w|y(?:oto)?|z)|l(?:a(?:caixa|m(?:borghini|er)|n(?:c(?:aster|ia)|d(?:rover)?|xess)|salle|t(?:ino|robe)?|w(?:yer)?)?|b|c|ds|e(?:ase|clerc|frak|g(?:al|o)|xus)|gbt|i(?:dl|fe(?:insurance|style)?|ghting|ke|lly|m(?:ited|o)|n(?:coln|de|k)|psy|v(?:e|ing))?|k|l[cp]|o(?:ans?|c(?:ker|us)|l|ndon|tt[eo]|ve)|pl(?:financial)?|r|s|t(?:da?)?|u(?:ndbeck|x(?:e|ury))?|v|y)|m(?:a(?:cys|drid|i(?:f|son)|keup|n(?:agement|go)?|p|r(?:ket(?:ing|s)?|riott|shalls)|serati|ttel)?|ba|c(?:kinsey)?|d|e(?:d(?:ia)?|et|lbourne|m(?:e|orial)|nu?|rckmsd)?|g|h|i(?:ami|crosoft|l|n[it]|t(?:subishi)?)|k|l[bs]?|ma?|n|o(?:bi(?:le)?|da|e|i|m|n(?:ash|ey|ster)|r(?:mon|tgage)|scow|to(?:rcycles)?|v(?:ie)?)?|p|q|r|sd?|t[nr]?|u(?:s(?:eum|ic)|tual)?|v|w|x|y|z)|n(?:a(?:b|goya|me|tura|vy)?|ba|c|e(?:c|t(?:bank|flix|work)?|ustar|ws?|x(?:t(?:direct)?|us))?|fl?|go?|hk|i(?:co|k(?:e|on)|nja|ssa[ny])?|l|o(?:kia|rt(?:hwesternmutual|on)|w(?:ruz|tv)?)?|p|r[aw]?|tt|u|yc|z)|o(?:b(?:i|server)|ffice|kinawa|l(?:ayan(?:group)?|dnavy|lo)|m(?:ega)?|n(?:e|g|l(?:ine)?)|oo|pen|r(?:a(?:cle|nge)|g(?:anic)?|igins)|saka|t(?:suka|t)|vh)|p(?:a(?:ge|nasonic|r(?:is|s|t(?:ners|s|y))|ssagens|y)?|ccw|et?|f(?:izer)?|g|h(?:armacy|d|ilips|o(?:ne|to(?:graphy|s)?)|ysio)?|i(?:c(?:s|t(?:et|ures))|d|n[gk]?|oneer|zza)|k|l(?:a(?:ce|y(?:station)?)|u(?:mbing|s))?|m|nc?|o(?:hl|ker|litie|rn|st)|r(?:a(?:merica|xi)|ess|ime|o(?:d(?:uctions)?|f|gressive|mo|pert(?:ies|y)|tection)?|u(?:dential)?)?|s|t|ub|wc?|y)|q(?:a|pon|ue(?:bec|st))|r(?:a(?:cing|dio)|e(?:a(?:d|l(?:estate|t(?:or|y)))|cipes|d(?:stone|umbrella)?|hab|i(?:sen?|t)|liance|n(?:t(?:als)?)?|p(?:air|ort|ublican)|st(?:aurant)?|views?|xroth)?|i(?:c(?:h(?:ardli)?|oh)|l|o|p)|o(?:c(?:her|ks)|deo|gers|om)?|s(?:vp)?|u(?:gby|hr|n)?|we?|yukyu)|s(?:a(?:arland|fe(?:ty)?|kura|l(?:e|on)|ms(?:club|ung)|n(?:dvik(?:coromant)?|ofi)|p|rl|s|ve|xo)?|b[is]?|c(?:a|b|h(?:aeffler|midt|o(?:larships|ol)|ule|warz)|ience|ot)?|d|e(?:a(?:rch|t)|cur(?:e|ity)|ek|lect|ner|rvices|ven|w|xy?)?|fr|g|h(?:a(?:ngrila|rp|w)|ell|i(?:a|ksha)|o(?:es|p(?:ping)?|uji|w(?:time)?))?|i(?:lk|n(?:a|gles)|te)?|j|k(?:in?|y(?:pe)?)?|l(?:ing)?|m(?:art|ile)?|n(?:cf)?|o(?:c(?:cer|ial)|ft(?:bank|ware)|hu|l(?:ar|utions)|n[gy]|y)?|p(?:a(?:ce)?|o(?:rt|t))|rl?|s|t(?:a(?:da|ples|r|te(?:bank|farm))|c(?:group)?|o(?:ckholm|r(?:age|e))|ream|ud(?:io|y)|yle)?|u(?:cks|pp(?:l(?:ies|y)|ort)|r(?:f|gery)|zuki)?|v|w(?:atch|iss)|x|y(?:dney|stems)?|z)|t(?:a(?:b|ipei|lk|obao|rget|t(?:a(?:motors|r)|too)|xi?)|ci?|dk?|e(?:am|ch(?:nology)?|l|masek|nnis|va)|f|g|h(?:d|eat(?:er|re))?|i(?:aa|ckets|enda|ffany|ps|r(?:es|ol))|j(?:maxx|x)?|k(?:maxx)?|l|m(?:all)?|n|o(?:day|kyo|ols|p|ray|shiba|tal|urs|wn|y(?:ota|s))?|r(?:a(?:d(?:e|ing)|ining|vel(?:channel|ers(?:insurance)?)?)|ust|v)?|t|u(?:be|i|nes|shu)|vs?|w|z)|u(?:a|b(?:ank|s)|g|k|n(?:i(?:com|versity)|o)|ol|ps|s|y|z)|v(?:a(?:cations|n(?:a|guard))?|c|e(?:gas|ntures|r(?:isign|sicherung)|t)?|g|i(?:ajes|deo|g|king|llas|n|p|rgin|s(?:a|ion)|v[ao])?|laanderen|n|o(?:dka|l(?:kswagen|vo)|t(?:e|ing|o)|yage)|u(?:elos)?)|w(?:a(?:l(?:es|mart|ter)|ng(?:gou)?|tch(?:es)?)|e(?:ather(?:channel)?|b(?:cam|er|site)|d(?:ding)?|i(?:bo|r))|f|hoswho|i(?:en|ki|lliamhill|n(?:dows|e|ners)?)|me|o(?:lterskluwer|odside|r(?:ks?|ld)|w)|s|t[cf])|x(?:box|erox|finity|i(?:huan|n)|xx|yz)|y(?:a(?:chts|hoo|maxun|ndex)|e|o(?:dobashi|ga|kohama|u(?:tube)?)|t|un)|z(?:a(?:ppos|ra)?|ero|ip|m|one|uerich|w)))(?::\\d{2,5})?(?:[/?#]\\S*)?(?=$|\\s|\\.|,|;)","gi"),tv=RegExp("^"+tu),ty=/^(([^\s"(),.:;<>@[\]]+(\.[^\s"(),.:;<>@[\]]+)*)|(".+"))@(([^\s"(),.:;<>@[\]]+\.)+[^\s"(),.:;<>@[\]]{2,})$/i;function urlToHref(e){if(!e)return"";switch(urlType(e)){case"email":return e.startsWith("mailto:")?e:`mailto:${e}`;case"phone":return e.startsWith("tel:")?e:`tel:${e}`;case"http":case"https":case"current_protocol":return e;default:return`http://${e}`}}function urlType(e){return e.startsWith("mailto:")||ty.test(e)?"email":e.startsWith("tel:")||tv.test(e)?"phone":e.startsWith("https://")?"https":e.startsWith("http://")?"http":e.startsWith("//")?"current_protocol":null}var isPhoneUrl=e=>"phone"===urlType(e),isEmailUrl=e=>"email"===urlType(e);function isExactUrl(e){tk.lastIndex=0;let t=tk.exec(e);return!!t&&t[0]===e}function isWebOrUnknownUrl(e){let t=urlType(e);return!t||"http"===t||"https"===t}function getSubject(e){let t=e.firstChild;return(null==t?void 0:t.type.name)===a.tw?t.textContent:""}function getDocJsonWithoutSubject(e){var t,n;return e&&"object"==typeof e&&(null==(n=null==(t=e.content)?void 0:t[0])?void 0:n.type)===a.tw?(0,l.EZ)((0,l.ih)({},e),{content:e.content.slice(1)}):e}function getLine(e){return e.textBetween(getAfterSubjectPosition(e),e.content.size," ")}function getLineFromDocJson(e){var t;let n=null==e?void 0:e.content;return n?((null==(t=n[0])?void 0:t.type)===a.tw&&(n=n.slice(1)),n.map(getTextFromNodeJson).join(" ")):""}function getTextFromNodeJson(e){var t;if(!e)return"";if(e.text)return e.text;switch(e.type){case a.lr:return getTextFromTagAttrs(e.attrs);case a.qh:return String((null==(t=e.attrs)?void 0:t.label)||"");case a.r9:return" ";case a.Q0:return getTextFromTweetAttrs(e.attrs).trim()}if(e.content&&e.content.length>0){let t=null!=e.content[0].text;return e.content.map(getTextFromNodeJson).join(t?"":" ")}return""}function getEndOfSubjectPosition(e){return Math.max(getAfterSubjectPosition(e)-1,0)}function getAfterSubjectPosition(e){let t=e.firstChild;return(null==t?void 0:t.type.name)===a.tw&&1===t.attrs.level?t.nodeSize:0}function getMaxListRange(e){if(e.isTextblock)return null;let t=-1,n=-1,r=e.type.schema.topNodeType===e.type?0:1;for(let a=0;a<e.childCount;a++){let i=e.child(a);if((0,A.yD)(i))-1===t&&(t=r),r+=i.nodeSize,n=r;else if(-1===t)r+=i.nodeSize;else break}if(-1===t)return null;let a=t+1,i=n-1;return a>i?null:[a,i]}function getEndOfLastListPosition(e){let t=(0,C.N2)({node:e,predicate:({node:e})=>e.type.name===a.l1}),n=t.pop();if(n)return n.pos+n.node.nodeSize-2}function getLinkMarks(e){let t=[];return e.descendants(e=>{for(let n of e.marks)n.type.name===a.et&&t.push(n)}),t}function getEmails(e){let t=getLinkMarks(e).filter(e=>isEmailUrl(e.attrs.href)).map(e=>e.attrs.href.replace("mailto:",""));return(0,_.Z)(t)}function getPhoneNumbers(e){let t=getLinkMarks(e).filter(e=>isPhoneUrl(e.attrs.href)).map(e=>e.attrs.href.replace("tel:",""));return(0,_.Z)(t)}function getDomains(e){let t=getLinkMarks(e).filter(e=>isWebOrUnknownUrl(e.attrs.href)).map(e=>(function(e){var t;let n=/:\/\//.test(e)?e:`http://${e}`;try{let e=new URL(n);if(/^\/.+/.test(e.pathname))return;let r=null==(t=e.hostname)?void 0:t.replace("www.","");return r}catch(e){return null}})(e.attrs.href)).filter(e=>e);return(0,_.Z)(t)}function getLinkHrefs(e){let t=getLinkMarks(e).filter(e=>isWebOrUnknownUrl(e.attrs.href)).map(e=>e.attrs.href);return(0,_.Z)(t)}function getTags(e){let t=[];return e.descendants(e=>{if(e.type.name===a.lr)return t.push(e.attrs.label),!1}),(0,_.Z)(t)}function getMetadata(e){let t={},n=(0,C.N2)({node:e,predicate:({node:e})=>e.type.name===a.l1||e.type.name===a.WQ,descend:!0}),r=n.flatMap(({node:e})=>(0,C.N2)({node:e,predicate:({node:e})=>e.type.name===a.e3,descend:!1}));for(let{node:e}of r){let n=e.textContent,r=n.indexOf(":");if(r<0)continue;let a=n.slice(0,r),i=(0,z.Z)((0,z.Z)(n.slice(r),":")),l=(0,$.Z)(a);l&&i&&(t[l]=i)}return t}function getBacklinkNodes(e){let t=[];return e.descendants((e,n)=>e.type.name===a.qh?(t.push([e,n]),!1):e.isBlock),t}function hasBacklink(e){return!!findBacklink(e,()=>!0)}function findBacklink(e,t){let n=null;return e.descendants(e=>{if(n)return!1;if(e.type.name===a.qh){let r=e.attrs;t(r)&&(n=r)}}),n}function getBacklinksWithContextHtml(e){let t=[];return e.descendants((n,r,i)=>{if(n.type.name===a.qh){let o=n.attrs,s=e.resolve(r);if(!i)return;let c=function(e,t){var n;let r=e.depth;if(isHeadingNode(t)){let t=e.node(r-1),n=e.index(r-1);return(function(e,t){let n=[e.child(t)];for(let r=t+1;r<e.childCount;r++){let t=e.child(r);if(isHeadingNode(t))break;n.push(t)}return n})(t,n).map(e=>(0,C.Em)(e)).join("")}let i=r>=1&&e.node(r-1),l=r>=2&&e.node(r-2);if(i&&(0,A.yD)(i)){if(!(l&&(0,A.yD)(l))||(null==(n=l.firstChild)?void 0:n.type.name)!==a.e3)return(0,C.Em)(i);{let e=l.copy(B.HY.from([l.child(0),i]));return(0,C.Em)(e)}}return(0,C.Em)(t)}(s,i);t.push((0,l.EZ)((0,l.ih)({},o),{contextHtml:c}))}}),(0,_.Z)(t)}function searchTextInNode(e){let{node:t,posFrom:n=0,wordsToMatch:r}=e,a=[];return t.descendants((e,t)=>{e.isText&&t>n&&(a=[...a,...(function(e,t){var n;if(!e||0===t.length)return[];let r=e.toLowerCase(),a=t.map(e=>e.toLowerCase().trim()).filter(e=>e.trim()),i=[];for(let e of a){let t=0,a=0,l=(0,V.Z)(e),o=RegExp(`(?:^|\\s)${l}(?:\\s|$)`);for(;-1!==a;){let l=r.slice(t);if((a=l.search(o))>-1){let r=null==(n=l.match(o))?void 0:n[0],s=t+a+((null==r?void 0:r.startsWith(" "))?1:0);i.push(s),t=s+e.length}}}return i})(e.textContent,r).map(e=>e+t)])}),a}function searchTextInDoc(e,t){return searchTextInNode({node:e,wordsToMatch:t})}function formatAsParagraph(e){if(!e)return null;let t=function getFirstTextBlock(e){if(!e)return null;if(e.isTextblock)return e;for(let t=0;t<e.childCount;t++){let n=getFirstTextBlock(e.child(t));if(n)return n}return null}(e);if(t){let n=t.content,r=e.type.schema.nodes[a.e3],i=r.createChecked(null,n);return i}return null}function getTasks(e){let t=[],n=new Set;return e.descendants(e=>{if(e.isTextblock)return!1;if(isTask(e)&&!isEmptyItem(e)){let r=e.attrs.guid,a=formatAsParagraph(e);a&&r&&!n.has(r)&&(t.push(e.copy(B.HY.from(a))),n.add(r))}}),t}function hasTask(e){let t=!1;return e.descendants(e=>{if(e.isTextblock||t)return!1;isTask(e)&&!isEmptyItem(e)&&(t=!0)}),t}function getTasksWithContext(e){let t=[],n=[],dfs=e=>{var r;if(!e||e.isTextblock)return;if(isTask(e)){t.push({task:e,parentBreadcrumbs:[...n]});return}let a=isListItemNode(e)||(0,A.yD)(e)?null==(r=formatAsParagraph(e))?void 0:r.textContent:null;a&&n.push(a);for(let t=0;t<e.childCount;t++)dfs(e.child(t));a&&n.pop()};return dfs(e),t}function isTask(e){return e.type.name===a.RF||e.type.name===a.VM&&"task"===e.attrs.kind}function getFirstListRange(e){let t=getMaxListRange(e);if(!t)return null;let[n,r]=t;return(0,A.gY)(e.resolve(n),e.resolve(r))}function getListAppendPositionRange(e){let t=getFirstListRange(e);if(!t){let t=getAfterSubjectPosition(e);return[t,t]}let{parent:n,endIndex:r,startIndex:a,end:i}=t,l=i;for(let e=r-1;e>=a;e--){let t=n.child(e);if(function(e){if(!e.firstChild)return!0;if(e.textContent)return!1;for(let t of collectChildren(e))if(!t.type.isTextblock||collectChildren(t).some(e=>!e.type.isText)||t.textContent)return!1;return!0}(t))l-=t.nodeSize;else break}return[l,i]}function createCustomClipboardSerializer(e){return createCustomDOMSerializer(e,{normalizeListItem:!0,normalizeTaskListItem:!0,wrapBacklinkWithBrackets:!1,removeTagLinks:!1,normalizeIframe:!0,nativeList:!0})}var remarkBacklink=function(){let e=this.data(),t=e.DATA_ON_BACKLINK_ADD;t&&G.Z.call(this,{pageResolver:e=>[e.trim()],hrefTemplate:e=>{let n=t({label:e.trim(),id:""});if(!n.graphId)throw Error("Backlink should not have an empty graphId");if(!n.id)throw Error("Backlink should not have an empty id");return toBacklinkHref({graphId:n.graphId,id:n.id})},aliasDivider:"//"})},tb=/#([^\s!#$&'"*+,\\/:;=?@%|(){}[\]<>]+)/giu,remarkTag=function(){let e=this.data(),t=e.DATA_ON_TAG_ADD;return e=>{t&&(0,Q.n)(e,[[tb,e=>{e=e.toLocaleLowerCase();let n=e.startsWith("#")?e.slice(1):null;if(!n)return!1;let r=t({label:n,id:""});if(!r.graphId)throw Error("Tag should not have an empty graphId");if(!r.id)throw Error("Tag should not have an empty id");let a=toTagHref({graphId:r.graphId,id:r.id});return{type:"link",title:null,url:a,children:[{type:"text",value:e}]}}]],{ignore:["link","linkReference"]})}},autoLinkGuard=()=>e=>(0,J.U)(e,e=>{var t;return"link"!==e.type||isExactUrl(e.url||"")||(null==(t=e.children)?void 0:t.length)!==1?e:e.children[0]}),tw=null;function markdownToHtml(e,t){tw||(tw=(0,j.l)().use(q.Z).use(K.Z).use(Z.Z).use(remarkBacklink).use(remarkTag).use(autoLinkGuard).use(Y.Z,{allowDangerousHtml:!0}).use(U.Z));let n=tw(),{onTagAdd:r,onBacklinkAdd:a}=null!=t?t:{};return r&&n.data("DATA_ON_TAG_ADD",r),a&&n.data("DATA_ON_BACKLINK_ADD",a),String(n.processSync(e))}function obfuscateString(e){return e?"string"!=typeof e?`<obfuscated ${typeof e}>`:e.replace(/\S/g,"a"):e}function obfuscateAttrs(e){if("object"==typeof e){for(let n of Object.keys(e)){var t;e[n]=(t=e[n])&&"number"!=typeof t&&"boolean"!=typeof t?"string"==typeof t?t.startsWith("tel:")?"tel:123-456-7890":t.startsWith("mailto:")?"mailto:hi@example.com":t.startsWith("http://")?"http://example.com":t.startsWith("https://")?"https://example.com":obfuscateString(t):`<obfuscated ${typeof t}>`:t}return e}}function obfuscateDocument(e){if(!e)return e;let t=(0,X.Z)(e);return function obfuscateNode(e){var t;if(!e)return e;for(let n of(e.text&&(e.text=(t=e.text)?obfuscateString(t):t),e.attrs&&(e.attrs=obfuscateAttrs(e.attrs)),e.content||[]))obfuscateNode(n);for(let t of e.marks||[])t&&"string"!=typeof t&&"object"==typeof t&&(t.type,obfuscateAttrs(t.attrs));return e}(t)}function debugParseSlice(e){let{openStart:t,openEnd:n}=e,{openStart:r,openEnd:a}=B.p2.maxOpen(e.content);return!(t>r)&&!(n>a)||(console.warn(`[reflect-editor] Found wrong open for pasted slice. result=${JSON.stringify({openStart:t,openEnd:n,maxOpenStart:r,maxOpenEnd:a})}`),console.warn(`[reflect-editor] Pasted content: ${JSON.stringify(obfuscateDocument(e.toJSON()))}`),!1)}function isTruthy(e){return!!e}function isSettledImage(e){let t=e.src||"";return e.settled||t.toLowerCase().startsWith("https://firebasestorage.googleapis.com/")||t.includes("reflect-settled-image-mocking")}var tx=class extends m.nNj{constructor(){super(...arguments),this.shiftKey=!1}get name(){return"plainPaste"}createPlugin(){let e=createCustomClipboardSerializer(this.store.schema);return{props:{transformCopied:e=>(0,A.Yf)(e),transformPasted:e=>{e=function(e){let t=function(e){let t=[];for(let n=0;n<e.childCount;n++)t.push(function(e){if(e.isInline)return e;let t=e.firstChild,n=e.lastChild,r=[];for(let t=0;t<e.childCount;t++)r.push(e.child(t));return(null==t?void 0:t.type.name)===a.r9?r.shift():(null==n?void 0:n.type.name)===a.r9&&r.pop(),e.copy(B.HY.from(r))}(e.child(n)));return B.HY.from(t)}(e.content);return new B.p2(t,e.openStart,e.openEnd)}(e=function(e){var t;if(1!==e.content.childCount)return e;let n=e.content.child(0);if(n.type.name!==a.iL)return e;let r=n.marks.find(e=>e.type.name===a.et),i=null==(t=null==r?void 0:r.attrs)?void 0:t.href;return i&&(tr.test(i)||a.W2.test(i))?new B.p2(B.HY.fromArray([n.type.schema.text(i,n.marks)]),0,0):e}(e));let[t,n]=function(e){let t=new Map,alterPendingImage=(e,n)=>{let r=e.attrs,a=t.get(n)||(0,ee.Z)("pending-image-");t.set(r.src,a);let i=(0,l.EZ)((0,l.ih)({},r),{id:a,src:n});return e.type.createChecked(i,e.content,e.marks)},alterBase64Image=e=>{let t=e.attrs,n=function(e){try{let[t,n]=e.split(","),r=t.match(/:(.*?);/)[1],a=function(e,t=""){let n=atob(e),r=n.length,a=new Uint8Array(r);for(let e=0;e<r;e++)a[e]=n.charCodeAt(e);return new Blob([a],{type:t})}(n,r);return URL.createObjectURL(a)}catch(t){return console.warn(`Failed to parse base64 URL: ${e.slice(0,20)} ...: ${t}`),null}}(t.src);return n?alterPendingImage(e,n):null},iterNode=e=>{if(e.isText)return e;if(e.type.name===a.MM){let t=e.attrs;return isSettledImage(t)?e:"string"==typeof t.src&&t.src.startsWith("data:")?alterBase64Image(e):alterPendingImage(e,t.src)}return e.copy(iterFragment(e.content))},iterFragment=e=>{let t=collectChildren(e).map(iterNode).filter(isTruthy);return B.HY.from(t)};e=new B.p2(iterFragment(e.content),e.openStart,e.openEnd);let n=Array.from(t.entries()).map(([e,t])=>({url:e,id:t}));return[n,e]}(e);return this.store.commands.uploadImagesInBackground(t),n},clipboardTextParser:(e,t,n,r)=>{let a=document.createElement("div");if(n){let n=t.marks(),{schema:r}=this.store.view.state,i=B.PW.fromSchema(r);e.split(/(?:\r\n?|\n)+/).forEach(e=>{let t=a.appendChild(document.createElement("p"));e&&t.appendChild(i.serializeNode(r.text(e,n)))})}else if(isExactUrl(e)){let t=document.createElement("a");t.textContent=e,t.setAttribute("href",urlToHref(e)),a.appendChild(t)}else a.innerHTML=markdownToHtml(e,this.options.markdown);let i=B.aw.fromSchema(this.store.schema).parseSlice(a),l=debugParseSlice(i);return l||console.warn("[reflect-editor] Found error in CopyPasteExtension"),hasBacklink(i.content)&&maybeFixBacklinks(r,this.options.onBacklinkAdd),i},clipboardSerializer:e,clipboardTextSerializer:t=>{let n=unwrapSlice(t),r=1==n.childCount&&(n.child(0).isTextblock||n.child(0).isInline);return this.shiftKey||r?t.content.textBetween(0,t.content.size,"\n\n"):markdownFromFragment(n,e)},handleDOMEvents:{keydown:(e,t)=>{this.shiftKey=t.shiftKey},keyup:(e,t)=>{this.shiftKey=t.shiftKey}}}}}};tx=(0,l.u2)([(0,m.AOx)({defaultOptions:{markdown:{},onBacklinkAdd:null}})],tx);var tE=class extends m.nNj{get name(){return"debugPastedSliceExtension"}createPlugin(){return{props:{transformPasted:e=>{let t=debugParseSlice(e);return t||console.warn("[reflect-editor] Found error in DebugPastedSliceExtension"),e}}}}},tC=class extends Error{constructor(e,t){super(e,t)}},tT=class extends tC{constructor(){super("This note has been edited in a newer version of Reflect. Please update your app to the latest version"),this.name="UnsupportedDocumentVersionError"}};function migrateV2File(e){return"attachment"===e.type&&(e.type="file"),Array.isArray(e.content)&&e.content.forEach(migrateV2File),e}function isLink(e){return"object"==typeof e&&(null==e?void 0:e.type)==="link"}function migrateV6FlatList(e){let t=(0,A.b7)(e);return t?(function assignGuid(e){if(e&&"object"==typeof e){if(e.type===a.WQ){e.attrs||(e.attrs={});let t=e.attrs;t.guid||(t.guid=guid())}e.content&&Array.isArray(e.content)&&e.content.forEach(assignGuid)}}(t),t):e}function createMigrate(e,t){let{debug:n}=t||{};return function(t,r,a){var i,l;let o=a?`[prosemirror-migration] (${a}):`:"[prosemirror-migration]:",s=null!=(l=null==(i=t.attrs)?void 0:i.version)?l:0;if(!(0,en.Z)(s))return console.error(`${o} "doc.attrs.version" must be a number, undefined or null`),!1;if(s===r)return!1;if(s-r>=1)throw console.error(`${o} downgrading version is not supported`),new tT;if(s-r>=0)return!1;let c=(0,X.Z)(t),u=Object.keys(e).map(e=>Number.parseInt(e)).filter(e=>r>=e&&e>s).sort((e,t)=>e-t);n&&console.log(`${o} migrationKeys`,u);let d=!1,p=u.reduce((t,r)=>{n&&console.log(`${o} running migration for versionKey`,r);let a=e[r](t);return a?(d=!0,a):t},c);return!!d&&p}}var tL={0:e=>e,1:e=>{let t=function(e){if("doc"!==e.type)throw Error(`node.type must be "doc", instead of "${e.type}"`);return function migrateNodes(e){for(let t of e)t.content&&(t.content=migrateNodes(t.content));let t=e.map(e=>(function(e,t){var n;if("listItem"!==e.type)return e;if(t||(null==(n=e.attrs)?void 0:n.hasCheckbox)){let t=(0,l.ih)({},e.attrs);return delete t.hasCheckbox,delete t.closed,delete t.nested,t.checked=!!t.checked,(0,l.EZ)((0,l.ih)({},e),{attrs:t,type:"taskListItem"})}{let t=e.attrs;return t&&(delete t.hasCheckbox,delete t.checked),e}})(e,!1));return(0,er.Z)(t.map(e=>(function(e){var t;if("bulletList"!==e.type&&"orderedList"!==e.type)return[e];let n=e.attrs;n&&(delete n.order,0===Object.keys(n).length&&delete e.attrs);let r=function(e,t){let n=[],r=[];return e.map(e=>{0===r.length?r.push(e):t(e)===t(r[0])?r.push(e):(n.push(r),r=[e])}),r.length>0&&n.push(r),n}(null!=(t=e.content)?t:[],e=>e.type),a=r.map(t=>{let n="taskListItem"===t[0].type;return(0,l.EZ)((0,l.ih)({},e),{type:n?"taskList":e.type,content:t})});return a})(e)))}([e])[0]}(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:1}),t},2:e=>{let t=migrateV2File(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:2}),t},3:e=>{let t=migrateV2File(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:3}),t},4:e=>{let t=function migrateV4DedupLink(e){var t;if("text"===e.type&&(null==(t=e.marks)?void 0:t.length)){let t=e.marks.filter(isLink);if(t.length>=2){let n=e.marks.filter(e=>!isLink(e));e.marks=[...n,t[0]]}}return Array.isArray(e.content)&&e.content.forEach(migrateV4DedupLink),e}(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:4}),t},5:e=>{let t=function migrateV5TaskGuid(e){var t;return e.type!==a.RF||(null==(t=e.attrs)?void 0:t.guid)||(e.attrs||(e.attrs={}),e.attrs.guid=guid()),Array.isArray(e.content)&&e.content.forEach(migrateV5TaskGuid),e}(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:5}),t},6:e=>{let t=migrateV6FlatList(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:6}),t},6.1:e=>{let t=migrateV6FlatList(e);return t.attrs=(0,l.EZ)((0,l.ih)({},t.attrs),{version:6.1}),t}},tS=6.1,tI=createMigrate(tL,{debug:!1}),tN=createMigrate(tL,{debug:!0});function migrateJson(e){return tI(e,tS,"migrateJson")||e}var tM=class extends et.V{createNodeSpec(e,t){return(0,l.EZ)((0,l.ih)({},super.createNodeSpec(e,t)),{attrs:{version:{default:tS}}})}},tD=class extends m.nNj{get name(){return"doubleSpace"}createPlugin(){let e=0;return{state:{init:()=>null,apply:t=>{t.docChanged&&(e=Date.now())}},props:{decorations:t=>{if(!this.options.enabled)return null;let n=Date.now()-e<500;if(!n)return null;let r=t.selection,a=r.empty&&(0,C.hT)(r)&&r.$to.parentOffset===r.$to.parent.content.size;return a?ea.EH.create(t.doc,[ea.p.widget(r.$to.pos,createTelomereSpan,{side:1,key:"cursor-telomere"})]):null}}}}};function createTelomereSpan(){let e=document.createElement("span");return e.innerText="\uFEFF",e}tD=(0,l.u2)([(0,m.AOx)({defaultOptions:{enabled:!1}})],tD);var tA=null,tB=null;function safeNodeSelection(e){let t=e.nodeAfter;return t&&W.qv.isSelectable(t)?new W.qv(e):null}function findDropPoint(e,t,n){var r;let a=e.posAtCoords({left:t.clientX,top:t.clientY});if(!a)return null;let i=a.inside>=0&&e.state.doc.nodeAt(a.inside),l=i&&i.type.spec.disableDropCursor;if(l)return null;let o=a.inside>=0?a.inside:a.pos;if(i&&a.inside>=0){let n=null==(r=e.domAtPos(a.inside))?void 0:r.node,l=null==n?void 0:n.getBoundingClientRect();l&&t.clientY>(l.top+l.height)/2&&(o+=i.nodeSize)}return function(e,t,n){var r;if(t>e.content.size)return null;let a=(0,eo.nj)(e,t,n);if(null==a||isInsideCollapsedList(e,a))return null;let i=e.resolve(a);if(0===i.index()&&(null==(r=i.nodeAfter)?void 0:r.type.isTextblock)&&i.depth>=1){let t=i.before();return isInsideCollapsedList(e,t)?null:t}return a}(e.state.doc,o,n)}function handleMove(e,t,n,r,a){var i;if(!r||0===n.size)return!1;let l=findDropPoint(e,t,n);if(!l)return!1;if(!a){a=e.state.tr;let t=null==(i=tB)?void 0:i.node;t?t.replace(a):a.deleteSelection()}let o=a.mapping.map(l),s=0===n.openStart&&0===n.openEnd&&1===n.content.childCount&&n.content.firstChild,c=a.doc;if(s?a.replaceRangeWith(o,o,s):a.replaceRange(o,o,n),a.doc.eq(c))return!1;let u=a.doc.resolve(o);if(s&&W.qv.isSelectable(s)&&u.nodeAfter&&u.nodeAfter.sameMarkup(s)){let e=safeNodeSelection(u);e&&a.setSelection(e)}else{let e=a.mapping.map(l);a.mapping.maps[a.mapping.maps.length-1].forEach((t,n,r,a)=>e=a),a.setSelection(W.Bs.between(u,a.doc.resolve(e)))}return e.focus(),e.dispatch(a.setMeta("uiEvent","drop")),!0}function normalizeSlice(e,t){var n,r;if((null==(r=null==(n=e.content.maybeChild(0))?void 0:n.type)?void 0:r.schema)===t)return e;try{return B.p2.fromJSON(t,e.toJSON())}catch(e){return B.p2.empty}}var tP=C.NZ.isMac?"altKey":"ctrlKey",tH=class extends m.nNj{constructor(){super(...arguments),this.draggableHandler=null,this.onAddCustomHandler=({draggable:e})=>{if(e)return this.draggableHandler=e,()=>this.draggableHandler=null}}get name(){return"drag"}createPlugin(){return{props:{handleDrop:handleMove,handleDOMEvents:{mousemove:(0,ei.Z)((e,t)=>{var n;return null==(n=this.draggableHandler)||n.call(this,function(e,t){var n;let r=e.dom,a=r.getBoundingClientRect(),i=e.posAtCoords({left:Math.max(a.left+a.width/2,t.clientX),top:t.clientY});if(!i)return null;let l=e.state.doc.resolve(i.pos),o=function(e){let t=e.nodeAfter;if(t&&t.isAtom&&!t.isInline){let n=e.parent;return isNested(t,n)?e.before(e.depth):e.pos}if(0===e.depth)return null;let n=e.parent,r=e.node(e.depth-1);return e.depth-1>0&&isNested(n,r)?e.before(e.depth-1):e.before()}(l);if(!o)return null;let s=e.domAtPos(o,1),c=-1===s.offset?s.node:s.node.children[s.offset];if(!(null==c?void 0:c.getBoundingClientRect))return null;let u=c.getBoundingClientRect();return{pos:o,element:c,lineHeight:getPxNumber(window.getComputedStyle(c).lineHeight),left:null!=(n=getPxNumber(window.getComputedStyle(r).paddingLeft))?n:0,top:u.top-a.top,width:u.width,height:u.height,clientX:t.clientX-a.left,clientY:t.clientY-a.top}}(e,t)),!0},100),dragstart:e=>(tA=e,!1),drop:(e,t)=>(function(e,t){var n,r,a;if(!t.dataTransfer)return!1;(tB=a=null!=(n=e.dragging)?n:null)&&setTimeout(()=>{tB===a&&(tB=null)},50);let i=function(){let e=tA;return tA=null,e}();if(!i||i===e||i.isDestroyed)return!1;let l=null==(r=i.dragging)?void 0:r.slice;if(!l)return!1;i.dragging=null,i.dispatch(i.state.tr.deleteSelection());let o=normalizeSlice(l,e.state.schema);e.someProp("transformPasted",t=>{o=t(o,e)});let s=e.posAtCoords({left:t.clientX,top:t.clientY});if(!s)return!1;let c=!t[tP],u=e.state.tr;return handleMove(e,t,o,c,u)})(e,t)}}}}};function isNested(e,t){return!!((e.isTextblock||e.isAtom&&e.isBlock)&&[a.WQ,a.H1].includes(t.type.name))}function getPxNumber(e){if("number"==typeof e)return(0,el.Z)(e)?null:e;if(e.endsWith("px")&&(e=e.slice(0,-2)),/\d+(?:\.\d*)?/.test(e)){let t=Number.parseFloat(e);if(!(0,el.Z)(t))return t}return null}tH=(0,l.u2)([(0,m.AOx)({customHandlerKeys:["draggable"]})],tH);var tR=class{constructor(e,t){var n;this.editorView=e,this.cursorPos=null,this.element=null,this.elementStartLeft=-1,this.elementStartTop=-1,this.timeout=null,this.prevEventX=null,this.prevEventY=null,this.width=null!=(n=t.width)?n:1,this.color=!1===t.color?void 0:t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map(t=>{let handler=e=>{this[t](e)};return e.dom.addEventListener(t,handler),{name:t,handler}})}destroy(){this.handlers.forEach(({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null,this.elementStartLeft=-1,this.elementStartTop=-1):this.updateOverlay())}updateOverlay(){let e,t;let n=this.editorView.state.doc.resolve(this.cursorPos),r=!n.parent.inlineContent,a=null;if(r){let e=n.nodeBefore,t=n.nodeAfter;if(e||t){let n=this.editorView.nodeDOM(this.cursorPos-(e?e.nodeSize:0));if(n){var i;let r=n.getBoundingClientRect(),l=n.classList.contains("list-content")&&(null==(i=n.parentElement)?void 0:i.classList.contains("prosemirror-flat-list"))||n.classList.contains("prosemirror-flat-list"),o=e?r.bottom:r.top;e&&t&&(o=(o+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),a={left:r.left-(l?20:0),right:r.right,top:o-this.width/2,bottom:o+this.width/2}}}}if(!a){let e=this.editorView.coordsAtPos(this.cursorPos);a={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let l=this.editorView.dom.offsetParent;if(!this.element&&(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",r),this.element.classList.toggle("prosemirror-dropcursor-inline",!r),l&&(l!=document.body||"static"!=getComputedStyle(l).position)){let n=l.getBoundingClientRect();e=n.left-l.scrollLeft,t=n.top-l.scrollTop}else e=-pageXOffset,t=-pageYOffset;let o=a.left-e,s=a.top-t,c=a.right-a.left,u=a.bottom-a.top;-1===this.elementStartLeft&&(this.elementStartLeft=o,this.elementStartTop=s),this.element.style.left=`${this.elementStartLeft}px`,this.element.style.top=`${this.elementStartTop}px`,this.element.style.transform=`translate(${o-this.elementStartLeft}px, ${s-this.elementStartTop}px)`,this.element.style.width=`${c}px`,this.element.style.height=`${u}px`}scheduleRemoval(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){var t;if(!this.editorView.editable||this.prevEventX===e.clientX&&this.prevEventY===e.clientY)return;this.prevEventX=e.clientX,this.prevEventY=e.clientY;let n=this.editorView.dragging?this.editorView:tA,r=null==(t=null==n?void 0:n.dragging)?void 0:t.slice;if(!r)return;let a=normalizeSlice(r,this.editorView.state.schema),i=findDropPoint(this.editorView,e,a);i&&(this.setCursor(i),this.scheduleRemoval(5e3))}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.scheduleRemoval(20)}},tF=class extends m.nNj{get name(){return"reflectDropCursor"}createPlugin(){return{view:e=>new tR(e,{width:this.options.width,color:!1})}}};tF=(0,l.u2)([(0,m.AOx)({defaultOptions:{width:2}})],tF);var tZ=[{annotation:"red question mark",hexcode:"2753",tags:["?","mark","punctuation","question"],emoji:"❓️",text:"❓︎",type:1,order:4163,group:8,subgroup:91,version:.6,shortcodes:["red_question_mark"]},{annotation:"red heart",hexcode:"2764",tags:["heart"],emoji:"❤️",text:"❤︎",type:0,order:142,group:0,subgroup:14,version:.6,emoticon:"<3",shortcodes:["red_heart"]},{annotation:"grinning face",hexcode:"1F600",tags:["face","grin"],emoji:"\uD83D\uDE00",text:"",type:1,order:1,group:0,subgroup:0,version:1,emoticon:":D",shortcodes:["grinning_face"]},{annotation:"face with tears of joy",hexcode:"1F602",tags:["face","joy","laugh","tear"],emoji:"\uD83D\uDE02",text:"",type:1,order:8,group:0,subgroup:0,version:.6,emoticon:":')",shortcodes:["face_with_tears_of_joy"]},{annotation:"slightly smiling face",hexcode:"1F642",tags:["face","smile"],emoji:"\uD83D\uDE42",text:"",type:1,order:9,group:0,subgroup:0,version:1,emoticon:":)",shortcodes:["slightly_smiling_face"]},{annotation:"winking face",hexcode:"1F609",tags:["face","wink"],emoji:"\uD83D\uDE09",text:"",type:1,order:11,group:0,subgroup:0,version:.6,emoticon:";)",shortcodes:["winking_face"]}],tO=class extends ec.h{createNodeSpec(e,t){return(0,l.EZ)((0,l.ih)({},super.createNodeSpec(e,t)),{parseDOM:[{tag:"br",getAttrs:e=>{let t=null==e?void 0:e.parentElement;return(!t||"P"!==t.tagName||1!==t.childNodes.length)&&null}}]})}createKeymap(){let e=super.createKeymap();return delete e["Mod-Enter"],e}},tj=class extends ed.e{setHeading({level:e}){return(0,eu.QF)((0,C.uJ)(this.type,{level:e}),t=>{let{state:n,dispatch:r}=t,i=n.selection.$anchor,l=(0,C.Tr)({types:a.D4,selection:i});return!!l&&!(i.depth-l.depth>=3)&&(!r||(this.store.commands.liftListItemOutOfList(l.node.type),this.store.commands.setBlockNodeType(this.type,{level:e}),!0))})}createKeymap(){let e={Backspace:({state:e,dispatch:t})=>{let{selection:n}=e;if(!n.empty)return!1;let r=(0,C.Tr)({types:this.type,selection:n});if((null==r?void 0:r.start)!==n.from)return!1;let a=e.tr.setBlockType(r.start,r.start,e.schema.nodes.paragraph);return t&&t(a),!0}};return this.options.levels.forEach(t=>{e[`mod-alt-${t}`]=this.setHeading({level:t})}),e}};(0,l.u2)([(0,m.WDe)()],tj.prototype,"setHeading",1);var ColorTheme=({children:e})=>{let t="dark"===(0,i.Fg)();return c.createElement("div",{className:(0,s.Z)("reflect-editor-scope",t?"dark":"")},e)},ThemedFloatingPortal=({children:e})=>{let t=(0,eh.GH)();return t?(0,ev.createPortal)(c.createElement(ColorTheme,null,e),t):null},t_=(0,c.forwardRef)(function(e,t){var{label:n,disabled:r}=e,a=(0,l.S0)(e,["label","disabled"]);return c.createElement("button",(0,l.EZ)((0,l.ih)({type:"button"},a),{ref:t,role:"menuitem",disabled:r}),n)}),tz=(0,c.forwardRef)(function(e,t){var n;let{children:r,as:a}=e,i=(0,l.S0)(e,["children","as"]),o=null!=(n=c.Children.map(r,e=>{if(!c.isValidElement(e))throw Error("Found invalid child in 'Menu'");return e}))?n:[],[s,u]=c.useState(!1),[d,p]=c.useState(null),[m,h]=c.useState(!1),f=c.useRef([]),g=c.useRef(o.map(e=>e.props.label||null)),k=(0,eh.ay)(),v=(0,eh.jV)(),y=(0,eh.Zm)(),b=null!=y,{x:w,y:x,strategy:E,refs:C,context:T}=(0,eh.YF)({nodeId:v,open:s,onOpenChange:u,placement:b?"right-start":"bottom-start",middleware:[(0,ef.cv)({mainAxis:b?0:4,alignmentAxis:b?-4:0}),(0,ef.RR)(),(0,ef.uY)()],whileElementsMounted:eg.Me}),L=(0,eh.XI)(T,{enabled:b&&m,delay:{open:75},handleClose:(0,eh.xp)({blockPointerEvents:!0})}),S=(0,eh.eS)(T,{event:"mousedown",toggle:!b||!m,ignoreMouse:b}),I=(0,eh.qs)(T,{role:"menu"}),N=(0,eh.bQ)(T),M=(0,eh.c0)(T,{listRef:f,activeIndex:d,nested:b,onNavigate:p}),D=(0,eh.ox)(T,{enabled:s,listRef:g,onMatch:s?p:void 0,activeIndex:d}),{getReferenceProps:A,getFloatingProps:B,getItemProps:P}=(0,eh.NI)([L,S,I,N,M,D]);c.useEffect(()=>{if(k)return k.events.on("click",handleTreeClick),k.events.on("menuopen",onSubMenuOpen),()=>{k.events.off("click",handleTreeClick),k.events.off("menuopen",onSubMenuOpen)};function handleTreeClick(){u(!1)}function onSubMenuOpen(e){e.nodeId!==v&&e.parentId===y&&u(!1)}},[k,v,y]),c.useEffect(()=>{s&&k&&k.events.emit("menuopen",{parentId:y,nodeId:v})},[k,s,v,y]),c.useEffect(()=>{function onPointerMove({pointerType:e}){"touch"!==e&&h(!0)}function onKeyDown(){h(!1)}return window.addEventListener("pointermove",onPointerMove,{once:!0,capture:!0}),window.addEventListener("keydown",onKeyDown,!0),()=>{window.removeEventListener("pointermove",onPointerMove,{capture:!0}),window.removeEventListener("keydown",onKeyDown,!0)}},[m]);let H=(0,eh.qq)([C.setReference,t]);return c.createElement(eh.mN,{id:v},c.createElement("button",(0,l.ih)({ref:H,"data-open":s?"":void 0},A((0,l.ih)((0,l.EZ)((0,l.ih)({},i),{onClick(e){e.stopPropagation()}}),b&&{role:"menuitem"}))),c.createElement(a,{isNested:b})),c.createElement(ThemedFloatingPortal,null,c.createElement(ek.u,{show:s,enter:"transition transform ease-out duration-100",enterFrom:"opacity-0 scale-100",enterTo:"opacity-100 scale-100 z-floating-menu",leave:"transition transform ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-100"},c.createElement(eh.wD,{context:T,modal:!1,initialFocus:b?-1:0,returnFocus:!b},c.createElement("div",(0,l.ih)({ref:C.setFloating,className:"absolute right-0 z-floating-menu mt-2 w-max min-w-[110px] overflow-hidden rounded-md bg-white text-coolgray-900 shadow-lg outline-none ring-1 ring-black/5 transition focus:outline-none dark:bg-app-dark-tint dark:text-near-white dark:ring-white/25",style:{position:E,top:null!=x?x:0,left:null!=w?w:0,width:"max-content"}},B()),o.map((e,t)=>c.cloneElement(e,P({tabIndex:d===t?0:-1,className:"flex h-8 w-full cursor-pointer items-center px-3 text-2xs leading-5 transition focus:bg-coolgray-100 focus:text-coolgray-900 focus:dark:bg-white/10 focus:dark:text-white outline-none z-floating-menu",ref(e){f.current[t]=e},onClick(t){var n,r;null==(r=(n=e.props).onClick)||r.call(n,t),null==k||k.events.emit("click")},onMouseEnter(){m&&s&&p(t)}}))))))))}),t$=(0,c.forwardRef)(function(e,t){let n=(0,eh.Zm)();return null===n?c.createElement(eh.RB,null,c.createElement(tz,(0,l.EZ)((0,l.ih)({},e),{ref:t}))):c.createElement(tz,(0,l.EZ)((0,l.ih)({},e),{ref:t}))});function useEditorView(){return(0,o.rj)().view}var Resizable=({width:e,setWidth:t,children:n,aspectRatio:r="16 / 9",className:a})=>{let i=useEditorView(),[l,o]=(0,c.useState)(e),u=(0,c.useRef)(l),[d,p]=(0,c.useState)(!1),[m,h]=(0,c.useState)(!1),f=(0,c.useCallback)(()=>{i.hasFocus()&&i.dom.blur()},[i]),g=(0,c.useCallback)(e=>{o(t=>(u.current=t+e,u.current))},[]),k=(0,c.useCallback)(()=>{p(!0)},[]),v=(0,c.useCallback)((e,t)=>{f(),g(-t.deltaX)},[f,g]),y=(0,c.useCallback)((e,t)=>{f(),g(t.deltaX)},[f,g]),b=(0,c.useCallback)(()=>{t(u.current),p(!1)},[t]),w=(0,c.useCallback)(()=>{h(!0)},[]),x=(0,c.useCallback)(()=>{h(!1)},[]);return c.createElement("div",{style:{width:Math.max(l,200),aspectRatio:r},className:(0,s.Z)("relative",a),onMouseOver:w,onMouseOut:x},c.createElement(ResizableHandler,{position:"left",show:d||m,onStart:k,onDrag:v,onStop:b}),c.createElement(ResizableHandler,{position:"right",show:d||m,onStart:k,onDrag:y,onStop:b}),c.cloneElement(n,d?{style:{pointerEvents:"none"}}:void 0))},ResizableHandler=({position:e,show:t,onStart:n,onDrag:r,onStop:a})=>c.createElement(ey.DraggableCore,{onStart:n,onDrag:r,onStop:a},c.createElement("div",{className:(0,s.Z)("absolute inset-y-0 z-10 flex w-[15px] cursor-col-resize items-center justify-center opacity-0 transition-opacity duration-300 hover:opacity-100","left"===e?"left-0":"right-0",t?"opacity-100":"opacity-0")},c.createElement("div",{className:"box-content h-[36px] max-h-[50%] w-[4px] rounded-full border border-white/50 bg-black/70"})));async function copyTextToClipboard(e){if(!(null==navigator?void 0:navigator.clipboard))return console.warn("Clipboard not supported"),!1;try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.warn("Copy failed",e),!1}}function IframeView({node:e,selected:t,getPosition:n,view:r}){var i;let l=e.attrs,u=function(e,t){if("number"==typeof e)return e;if("string"==typeof e){let t=e.match(/^(\d+(?:\.\d+)?)px/);if(t)return Number.parseInt(t[0])}return 300}(null!=(i=l.width)?i:"",0),d=(0,c.useCallback)(e=>{try{let t=n();if(t&&t>=1&&!r.isDestroyed){let n=r.state.doc.nodeAt(t);if(n&&n.type.name===a._M&&n.attrs.width!==e){let n=r.state.tr;n.setNodeAttribute(t,"width",e),n.setNodeAttribute(t,"height",e/16*9),r.dispatch(n)}}}catch(e){console.warn("Failed to resize:",e)}},[n,r]),{replaceIframeToLink:p}=(0,o.xd)(),m=(0,c.useCallback)(()=>{copyTextToClipboard(normalizeIframeLink(l))},[l]),h=(0,c.useCallback)(()=>{let e=n();e&&p({pos:e})},[n,p]);return c.createElement(Resizable,{width:u,setWidth:d,className:(0,s.Z)("max-w-full outline outline-offset-0",t?"outline-blue-400":"outline-transparent")},c.createElement("div",{className:"relative h-full w-full"},c.createElement(YoutubeMenu,{handleCopy:m,handleReplace:h}),c.createElement("iframe",{src:l.src,"data-embed-type":l.type,className:"h-full w-full"})))}var YoutubeMenu=({handleCopy:e,handleReplace:t})=>c.createElement(t$,{as:YoutubeMenuIcon,label:"Edit",className:"absolute top-2 right-2 flex h-7 w-7 items-center justify-center rounded-sm bg-coolgray-600/50 text-white outline-none transition hover:bg-coolgray-600/80"},c.createElement(t_,{label:"Copy link",onClick:e}),c.createElement(t_,{label:"Transform to plain link",onClick:t}));function YoutubeMenuIcon(){return c.createElement(em.T,{className:"h-5 w-5","aria-hidden":"true"})}var tV=class extends ep.a{constructor(){super(...arguments),this.ReactComponent=IframeView}createNodeSpec(e,t){let n=super.createNodeSpec((0,l.EZ)((0,l.ih)({},e),{dom:t=>(0,l.EZ)((0,l.ih)({},e.dom(t)),{loading:"lazy"})}),t);return(0,l.EZ)((0,l.ih)({},n),{attrs:(0,l.EZ)((0,l.ih)({},n.attrs),{width:{default:560},height:{default:315}}),selectable:!0})}createEventHandlers(){return{blur:()=>(setTimeout(()=>{let e=document.activeElement;if((null==e?void 0:e.tagName)!=="IFRAME")return;let t=this.store.view;if(!t||t.isDestroyed)return;let n=t.posAtDOM(e,0,-1);if(n&&!(n<=0))for(let e of[n-1,n])try{let n=W.qv.create(t.state.doc,e);if(n.node.type.name===this.type.name){t.dispatch(t.state.tr.setSelection(n));return}}catch(e){console.warn("Failed to select iframe:",e)}}),!1)}}createPasteRules(){return[{type:"node",nodeType:this.type,regexp:tr,getAttributes:e=>{var t;let n=null!=(t=extractYoutubeVideoIdFromMatch(e))?t:"";return{src:`https://www.youtube-nocookie.com/embed/${n}`,type:"youtube"}},getContent:()=>{}}]}replaceIframeToLink({pos:e}){return({tr:t,dispatch:n})=>{let r=t.doc.nodeAt(e);if((null==r?void 0:r.type)!==this.type)return!1;let a=normalizeIframeLink(r.attrs),i=this.store.schema;return t.replaceRangeWith(e,e+r.nodeSize,i.nodes.paragraph.createChecked(null,[i.text(a,[i.marks.link.create({href:a})])])),null==n||n(t),!0}}};function cacheImage(e,t=3e3){return new Promise(n=>{let r=new Image;r.addEventListener("load",()=>{n({width:null==r?void 0:r.naturalWidth,height:null==r?void 0:r.naturalHeight})}),r.addEventListener("error",()=>n({})),r.src=e,setTimeout(()=>n({}),t)})}function isImageFileName(e){return/\.(gif|jpe?g|tiff?|png|webp|bmp)$/i.test(e)}(0,l.u2)([(0,m.WDe)()],tV.prototype,"replaceIframeToLink",1);var tW=class extends eb.aF{constructor(e,t,n){super(e,t,n),this.editorView=null,this.editorView=t}createElement(e){let t=e.node.attrs;if(t.error){console.warn(`Found a upload error: ${t.error}`);let e=document.createElement("div");e.className="reflect-image-error";let n=document.createElement("p");n.textContent="Upload Failed",n.className="reflect-image-error-title";let r=document.createElement("p");return r.textContent="Oh no! Something went wrong when uploading your file. Please try again.",e.appendChild(n),e.appendChild(r),e}let n=super.createElement(e);if(!isSettledImage(t)){let{wrapper:e,progressHandler:r}=function(e){let t=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");t.className="relative",t.appendChild(e),n.appendChild(r),t.appendChild(n),n.className="h-1 bg-gray-200 overflow-hidden absolute bottom-0 left-0 w-full",r.className="h-full bg-accent dark:bg-accent-dk transition duration-500",r.style.transformOrigin="0",r.style.transform="scaleX(0)";let a=1,applyPrecentUI=()=>{r.style.transform=`scaleX(${a/100})`};applyPrecentUI();let i=setInterval(()=>{a<20?(a+=1,applyPrecentUI()):clearInterval(i)},250);return{wrapper:t,progressHandler:e=>{e<=1||(a=20+.75*(e=(0,E.Z)(e,0,100)),applyPrecentUI())}}}(n);return setTimeout(()=>{(function(e,t,n=1e3){return new Promise((e,r)=>{let attempt=async a=>{try{e(await t())}catch(e){a>0?(console.error(e),setTimeout(()=>void attempt(a-1),n)):r(e)}};attempt(3)})})(0,()=>this.addProgressListener(t,r),3e3).catch(e=>console.error(`Can't add progress listener: ${e}`))}),e}return n}addProgressListener(e,t){let n=e.id||"";if(!n)throw new tC("Can't add progress listener for an image without id");let r=this.editorView;if(!r)throw new tC("Can't add progress listener for an image without editor view");let i=(0,m.Nj1)(r.state,n),l=null==i?void 0:i.context;if(!l)throw new tC("Can't add progress listener for an image without upload context");return l.addListener(e=>{let n=e[a.Lr];t(null!=n?n:0)}),!0}},tU={"audio/aac":".aac","application/x-abiword":".abw","application/x-freearc":".arc","image/avif":".avif","video/x-msvideo":".avi","application/vnd.amazon.ebook":".azw","application/octet-stream":".bin","image/bmp":".bmp","application/x-bzip":".bz","application/x-bzip2":".bz2","application/x-cdf":".cda","application/x-csh":".csh","text/css":".css","text/csv":".csv","application/msword":".doc","application/vnd.openxmlformats-officedocument.wordprocessingml.document":".docx","application/vnd.ms-fontobject":".eot","application/epub+zip":".epub","application/gzip":".gz","image/gif":".gif","text/html":".html","image/vnd.microsoft.icon":".ico","text/calendar":".ics","application/java-archive":".jar","image/jpeg":".jpeg","text/javascript":".js","application/json":".json","application/ld+json":".jsonld","audio/midi":".midi","audio/x-midi":".midi","audio/mpeg":".mp3","video/mp4":".mp4","video/mpeg":".mpeg","application/vnd.apple.installer+xml":".mpkg","application/vnd.oasis.opendocument.presentation":".odp","application/vnd.oasis.opendocument.spreadsheet":".ods","application/vnd.oasis.opendocument.text":".odt","audio/ogg":".oga","video/ogg":".ogv","application/ogg":".ogx","audio/opus":".opus","font/otf":".otf","image/png":".png","application/pdf":".pdf","application/x-httpd-php":".php","application/vnd.ms-powerpoint":".ppt","application/vnd.openxmlformats-officedocument.presentationml.presentation":".pptx","application/vnd.rar":".rar","application/rtf":".rtf","application/x-sh":".sh","image/svg+xml":".svg","application/x-tar":".tar","image/tiff":".tiff","video/mp2t":".ts","font/ttf":".ttf","text/plain":".txt","application/vnd.visio":".vsd","audio/wav":".wav","audio/webm":".weba","video/webm":".webm","image/webp":".webp","font/woff":".woff","font/woff2":".woff2","application/xhtml+xml":".xhtml","application/vnd.ms-excel":".xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":".xlsx","application/xml":".xml","application/vnd.mozilla.xul+xml":".xul","application/zip":".zip","video/3gpp":".3gp","audio/3gpp":".3gp","video/3gpp2":".3g2","audio/3gpp2":".3g2","application/x-7z-compressed":".7z"};function onFileLoaded({id:e,attrs:t,fileType:n,view:r}){let a=(0,m.fZ6)(r.state,e);if(null==a)return;let i=r.state.doc.resolve(a),o=i.nodeAfter;if(!o||o.type.name!==n||o.attrs.id!==e){let t=r.state.tr;(0,m.en2)(t,{type:1,id:e}),r.dispatch(t);return}let s=r.state.tr;(0,m.en2)(s,{type:1,id:e});let c=(0,l.EZ)((0,l.ih)((0,l.ih)({},o.attrs),t),{id:null});s.setNodeMarkup(a,void 0,c),r.dispatch(s)}var createNanoEvents=()=>({events:{},emit(e,...t){(this.events[e]||[]).forEach(e=>e(...t))},on(e,t){return(this.events[e]=this.events[e]||[]).push(t),()=>this.events[e]=(this.events[e]||[]).filter(e=>e!==t)}});async function startUpload(e,t,{id:n,url:r}){let{context:i,fileUploader:l}=t,o=await downloadImage(r),s=l.insert(o);try{let t=await l.upload(i);onFileLoaded({id:n,fileType:a.MM,view:e,attrs:t})}catch(t){onFileLoaded({id:n,fileType:a.MM,view:e,attrs:s})}}async function downloadImage(e){var t,n;let r=await fetch(e),a=await r.blob();return new File([a],"image"+(null!=(t=null!=(n=tU[a.type])?n:null)?t:""),{type:a.type})}var tK=class extends eb.Gc{constructor(e){super(e)}createNodeSpec(e,t){let n=super.createNodeSpec({defaults:()=>(0,l.EZ)((0,l.ih)({},e.defaults()),{id:{default:null},error:{default:null},settled:{default:!1}}),parse:e=>"string"!=typeof e&&"IMG"===e.nodeName?{id:e.getAttribute("data-image-id"),error:e.getAttribute("data-image-error"),settled:e.hasAttribute("data-image-settled")}:{},dom:e=>{let t=e.attrs,n={};return t.id&&(n["data-image-id"]=t.id),t.error&&(n["data-image-error"]=t.error),t.settled&&(n["data-image-settled"]=""),n.loading="lazy",n}},t);return(0,l.EZ)((0,l.ih)({},n),{selectable:!0})}createEventHandlers(){let handleClick=(e,t)=>{var n;let{pos:r,nodeWithPosition:a,state:i}=t;if(a.node.type!==this.type)return!1;let l=e.target;if((null==l?void 0:l.tagName)!=="IMG")return!1;let{selection:o}=i,{from:s,to:c}=o,u=(0,C.EG)(o)&&(s===r||c===r)||s===r&&c===r;if(u){let e=this.options;return null==(n=e.onClick)||n.call(e,l),!0}return!1};return{click:handleClick,doubleClick:handleClick}}createPasteRules(){return[{type:"file",regexp:/^image.*$/i,fileHandler:e=>{var t;if("paste"===e.type&&(null==(t=e.event.clipboardData)?void 0:t.types.includes("text/html")))return!1;let n="drop"===e.type?function(e,t){let n=e.state.doc.resolve(t);return W.Bs.near(n).from}(e.view,e.pos):void 0;for(let t of e.files)this.uploadFileV2(t,n);return!0}}]}async uploadFileV2(e,t){let n=URL.createObjectURL(e),{width:r,height:a}=await cacheImage(n),{uploadImageHandler:i}=this.options;if(!i)throw Error("The 'uploadImageHandler' option is required.");(0,m.cTq)({file:e,pos:t,view:this.store.view,fileType:this.type,uploadHandler:this.createUploadHandler({src:n,width:r,height:a})})}createUploadHandler(e){let{uploadImageHandler:t}=this.options;if(!t)throw Error("The 'uploadImageHandler' option is required.");return()=>{let n;return{insert:t=>(n=t,e),upload:async r=>{var i;if(t){let o=await t(n,e=>{r.set(a.Lr,e)});return isImageFileName(null!=(i=o.fileName)?i:"")&&await cacheImage(o.src),(0,l.EZ)((0,l.ih)({},e),{src:o.src||e.src,fileName:o.fileName||e.fileName,settled:!0})}return e},abort:()=>{}}}}uploadImages(e){return()=>{for(let t of e)this.uploadFileV2(t);return!0}}uploadImagesInBackground(e){let t=this.createUploadHandler({src:""});return()=>(!function(e,t,n){for(let r of n)(function(e,t,{id:n,url:r}){let a=function(){let e={},t=createNanoEvents();return{set:(n,r)=>{e[n]=r,t.emit("set",e)},get:t=>e[t],addListener:e=>t.on("set",e)}}(),i=t(),l={context:a,fileUploader:i};startUpload(e,l,{id:n,url:r});let o=e.state.tr;(0,m.en2)(o,{type:0,id:n,payload:l,pos:1}),e.dispatch(o)})(e,t,r)}(this.store.view,t,e),!0)}createNodeViews(){return this.options.enableResizing?(e,t,n)=>new tW(e,t,n):{}}};function fragmentFromHtml(e,t){let n=(0,C.OC)({content:"<h1></h1>"+e,schema:t});return n.cut(n.child(0).nodeSize).content}function createElement(e,t,...n){let r=document.createElement(e);for(let[e,n]of Object.entries(t))r.setAttribute(e,n);return r.append(...n),r}(0,l.u2)([(0,m.WDe)()],tK.prototype,"uploadImages",1),(0,l.u2)([(0,m.WDe)()],tK.prototype,"uploadImagesInBackground",1),tK=(0,l.u2)([(0,m.AOx)({defaultOptions:(0,l.EZ)((0,l.ih)({},eb.Gc.defaultOptions),{onClick:null,uploadImageHandler:null})})],tK);var tq=class extends m.nNj{get name(){return"reflectIndicator"}createPlugin(){let e=null,createDecoration=(t,n)=>ea.EH.create(t,[ea.p.widget(n,()=>(e||(e=createElement("div",{class:"relative h-5 w-5 mx-2 my-1 select-none inline-flex align-middle",contentEditable:"false"},createElement("div",{class:"absolute h-full w-full rounded-[50%] border-[3px] border-bluegray-500/10"}),createElement("div",{class:"animate-spin ease-in-out absolute h-full w-full rounded-[50%] border-l-[3px] border-t-[3px] border-purple-500 border-t-transparent"}))),e),{key:"reflect-indicator",side:-20,ignoreSelection:!0,stopEvent:()=>!0})]);return{state:{init:()=>({decoration:null}),apply:(e,t)=>{let n=e.getMeta("updateSpinner");return n?n.pos?{decoration:createDecoration(e.doc,n.pos)}:{decoration:null}:t.decoration?{decoration:t.decoration.map(e.mapping,e.doc)}:t}},props:{decorations:e=>{let t=this.getPluginState(e);return null==t?void 0:t.decoration}}}}deleteSpinnerKeyBinding(e){let t=e.state.selection;if(t.empty){let n=this.getPluginState(e.state),r=(null==n?void 0:n.decoration)&&getDecorationPos(n.decoration);if(r&&t.from===r)return this.disableSpinner()(e),!0}return!1}updateSpinner(e){return({tr:t,dispatch:n})=>(t.setMeta("updateSpinner",{pos:e}),null==n||n(t),!0)}enableSpinner(){return e=>{let{tr:t}=e,n=t.selection.to;return this.updateSpinner(n)(e)}}disableSpinner(){return e=>this.updateSpinner(null)(e)}replaceMarkdown(e){return({view:t,tr:n,dispatch:r})=>{let a=markdownToHtml(e,this.options.markdown),i=fragmentFromHtml(a,this.store.schema),l=B.p2.maxOpen(i);return n.replaceSelection(l),null==r||r(n),hasBacklink(l.content)&&maybeFixBacklinks(t,this.options.onBacklinkAdd),!0}}insertMarkdownAt(e,t,n){return({view:r,tr:a,dispatch:i})=>{t=Math.min(a.doc.content.size-1,t);let l=markdownToHtml(e,this.options.markdown),o=fragmentFromHtml(l,this.store.schema),s=n?B.p2.maxOpen(o):new B.p2(o,0,0);return a.replaceRange(t,t,s),null==i||i(a),hasBacklink(s.content)&&maybeFixBacklinks(r,this.options.onBacklinkAdd),!0}}insertMarkdownAtIndicator(e){return t=>{let n=this.getPluginState(),r=null==n?void 0:n.decoration;if(!r)return!1;let a=getDecorationPos(r);return!!a&&this.insertMarkdownAt(e,a,!0)(t)}}insertMarkdownAfterSelection(e){return t=>{let n=t.tr.selection.to;return this.insertMarkdownAt(e,n,!1)(t)}}};function getDecorationPos(e){for(let t of e.find())return t.from;return null}(0,l.u2)([(0,m.IGC)({shortcut:"Backspace",priority:h.xV.High})],tq.prototype,"deleteSpinnerKeyBinding",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"updateSpinner",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"enableSpinner",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"disableSpinner",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"replaceMarkdown",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"insertMarkdownAt",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"insertMarkdownAtIndicator",1),(0,l.u2)([(0,m.WDe)()],tq.prototype,"insertMarkdownAfterSelection",1),tq=(0,l.u2)([(0,m.AOx)({defaultOptions:{markdown:{},onBacklinkAdd:null}})],tq);var tY=class extends ew.f{createPasteRules(){return[{type:"mark",markType:this.type,regexp:/\b_([^_]+)_\b/g,ignoredMarks:["link"]},{type:"mark",markType:this.type,regexp:/(?:^|\s+)\*([^*]+)\*/g,ignoredMarks:["link"]}]}createInputRules(){return[spaceMarkInputRule({regexp:/(?:^|\s+)\*([^*]+)\*(?:\s$|\s+)$/,type:this.type.name,updateCaptured:({fullMatch:e,start:t})=>e.startsWith("*")?{}:{fullMatch:e.slice(1),start:t+1}}),spaceMarkInputRule({regexp:/(?:^|\s+)_([^_]+)_(?:\s$|\s+)$/,type:this.type.name,updateCaptured:({fullMatch:e,start:t})=>e.startsWith("_")?{}:{fullMatch:e.slice(1),start:t+1}})]}},tJ=class extends m.nNj{constructor(){super(...arguments),this.extraKeyBindings=[],this.onAddCustomHandler=({keymap:e})=>{if(e)return this.extraKeyBindings=[...this.extraKeyBindings,e],this.setupKeymapKeyDownHandler(),()=>{this.extraKeyBindings=this.extraKeyBindings.filter(t=>t!==e),this.setupKeymapKeyDownHandler()}}}get name(){return"reflectBeforeKeymap"}setupKeymapKeyDownHandler(){this.keymapKeyDownHandler=this.createKeyDownHandler(this.extraKeyBindings)}setupInputruleKeyDownHandler(){this.inputRuleKeyDownHandler=this.createKeyDownHandler([this.createEnterInputRuleKeymap()])}createExternalPlugins(){return this.setupKeymapKeyDownHandler(),this.setupInputruleKeyDownHandler(),[new W.Sy({props:{handleKeyDown:(e,t)=>{var n,r;return(null==(n=this.keymapKeyDownHandler)?void 0:n.call(this,e,t))?(t.stopPropagation(),!0):null==(r=this.inputRuleKeyDownHandler)?void 0:r.call(this,e,t)}}})]}createKeyDownHandler(e){let t=this.sortKeymaps(e),n={};for(let e of t)for(let[t,r]of Object.entries(e))n[t]||(n[t]=[]),n[t].push(r);let next=()=>{throw Error("Not implemented")},r={};for(let[e,t]of Object.entries(n)){let pmCommand=(e,n,r)=>{if(!r)return!1;for(let e of t){let t=r.state,a=t.tr;if(e({view:r,state:t,tr:a,dispatch:n,next}))return!0}return!1};r[e]=pmCommand}return(0,ex.$)(r)}sortKeymaps(e){return(0,I.DY)(e.map(e=>(0,I.kJ)(e)?e:[h.xV.Default,e]),(e,t)=>t[0]-e[0]).map(e=>e[1])}extractInputRules(){var e,t;let n=[];for(let r of this.store.extensions)if((null==(e=this.store.managerSettings.exclude)||!e.inputRules)&&r.createInputRules&&(null==(t=r.options.exclude)||!t.inputRules))for(let e of r.createInputRules())n.push(e);return n}createEnterInputRuleKeymap(){let e=this.extractInputRules();return[eJ,{Enter:t=>{let{view:n,state:r,dispatch:a}=t;if(!n||n.composing)return!1;let i=function(e,t){if(!e.selection.empty)return!1;let{$from:n,from:r}=e.selection;if(n.parent.type.spec.code)return!1;let a=n.parent.textBetween(Math.max(0,n.parentOffset-500),n.parentOffset,void 0,"￼")+" ";for(let n of t){n.match.lastIndex=0;let t=n.match.exec(a);if(!t)continue;let i=t[0].slice(0,-1),l=n.handler(e,t,r-i.length,r);if(l){if(l.selection.empty){let e=l.selection.$from,t=e.parentOffset;if(t>=1){let n=e.parent.textBetween(t-1,t);" "===n&&l.delete(e.pos-1,e.pos)}}return l}}return!1}(r,e);return!!i&&(null==a||a(i),!!i.selection.empty&&!!i.selection.$from.parent.type.spec.code)}}]}};tJ=(0,l.u2)([(0,m.AOx)({defaultPriority:eQ,customHandlerKeys:["keymap"]})],tJ);var tG=class extends eE.y5{createMarkSpec(e,t){let n=super.createMarkSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{excludes:void 0})}createPasteRules(){return[{type:"mark",regexp:this.options.autoLinkRegex,markType:this.type,getAttributes:(e,t)=>({href:(0,C.FI)(e),auto:!t}),replaceSelection:e=>!(tB||(0,C.EG)(this.store.view.state.selection))&&!!e.trim(),ignoredMarks:["link"]}]}createInputRules(){return[createLinkInputRule({regexp:RegExp(this.options.autoLinkRegex.source+"\\s$","gi"),contactType:void 0,linkType:this.type})]}};function alwaysTrue(e){return(...t)=>(e(...t),!0)}function jsonFromNode(e){return e.toJSON()}function withDocumentReplacement(e){return t=>{let n=t.dispatch,r=n?e=>{let t=e.doc.type.schema,r=e.doc.content,a=r.size,i=new B.p2(r,0,0),l=e.selection,o=i.toJSON(),s=l.toJSON();e.replace(0,a,B.p2.fromJSON(t,o)),e.setSelection(W.Y1.fromJSON(e.doc,s)),n(e)}:void 0;return e((0,l.EZ)((0,l.ih)({},t),{dispatch:r}))}}var tQ=class extends m.QR{get name(){return"list"}createTags(){return[h.eX.Block]}createNodeSpec(e,t){return function(e){let t=(0,A.LX)(),getAttributes=e=>{let t=e.attrs,n="task"===t.kind&&t.guid||void 0;return(0,l.EZ)((0,l.ih)({},(0,A.YD)(e)),{"data-guid":n})},n=(0,A.EN)().map(t=>{var n;return(0,l.EZ)((0,l.ih)({},t),{getAttrs:(n=t.getAttrs)?t=>{let r=n(t);if(!r)return r;if(Object.assign(r,e.parse(t)),"string"!=typeof t){let e=t.getAttribute("data-list-kind");if(e&&"object"==typeof r)return(0,l.EZ)((0,l.ih)({},r),{kind:e})}return r}:n})});return(0,l.EZ)((0,l.ih)({},t),{attrs:(0,l.ih)((0,l.ih)({},t.attrs),e.defaults()),toDOM:e=>(0,A.QI)({node:e,getMarkers,getAttributes}),parseDOM:n})}(e)}createKeymap(){var e;let t=(0,eu.A_)((0,A.ej)({isToggleable:isCollapsedToggleable,collapsed:!0})),n=(0,eu.A_)((0,A.ej)({isToggleable:isCollapsedToggleable,collapsed:!1})),r={Enter:(0,eu.A_)((e=withFalsyArchived(A.Kb),(t,n,r)=>{try{return e(t,n,r)}catch(a){let e=t.selection.toJSON(),n=obfuscateDocument(jsonFromNode(t.doc)),r=JSON.stringify({selection:e,doc:n});throw console.warn(`Command fail. State: ${r}`),a}})),Backspace:(0,eu.A_)(withFalsyArchived(A.FI)),Delete:(0,eu.A_)(withFalsyArchived(A.JL)),"Shift-Tab":alwaysTrue((0,eu.A_)(withFalsyArchived((0,A.xH)()))),Tab:alwaysTrue((0,eu.A_)(withFalsyArchived((0,A.RI)()))),"Alt-Mod-[":t,"Alt-Mod-]":n,"Mod-Enter":rotateListType,"Alt-ArrowUp":(0,eu.A_)((0,A.C$)("up")),"Alt-ArrowDown":(0,eu.A_)((0,A.C$)("down")),"Mod-Shift-7":(0,eu.A_)((0,A.vP)({kind:"ordered",archived:!1})),"Mod-Shift-8":(0,eu.A_)((0,A.vP)({kind:"bullet",archived:!1})),"Mod-Shift-9":(0,eu.A_)((0,A.vP)({kind:"task",archived:!1}))};for(let[e,t]of Object.entries(r))r[e]=withDocumentReplacement(t);return r}createPlugin(){return{props:{handleDOMEvents:{mousedown:(e,t)=>{var n;return(0,A.pH)({view:e,event:t,onListClick:(n=this.options.onCheckboxChange,e=>{let t=e.attrs;return"task"===t.kind||"checklist"===t.kind?(null==n||n(),(0,l.EZ)((0,l.ih)({},t),{archived:!1,checked:!t.checked})):"bullet"===t.kind?(0,l.EZ)((0,l.ih)({},t),{archived:!1,collapsed:!!isCollapsedToggleable(e)&&!t.collapsed}):t})})}}}}}createExternalPlugins(){return[(0,A.pm)(),(0,A.xf)()]}createInputRules(){return[(0,A.T2)(/^\s?([*-])\s$/,{kind:"bullet",collapsed:!1,archived:!1}),(0,A.T2)(/^\s?(\+)\s$/,{kind:"checklist",collapsed:!1,archived:!1}),(0,A.T2)(/^\s?(\d+)\.\s$/,e=>{let t=(0,A.Lk)(e[1]);return{kind:"ordered",collapsed:!1,order:null!=t&&t>=2?t:null,archived:!1}}),(0,A.T2)(/^\s?\[([\sXx]?)]\s$/,e=>({kind:"task",checked:["x","X"].includes(e[1]),collapsed:!1,archived:!1}))]}createCommands(){return{indentList:e=>{let{from:t,to:n,onSuccess:r}=null!=e?e:{};return withDocumentReplacement(withOnSuccess((0,eu.A_)((0,A.RI)({from:t,to:n})),r))},dedentList:e=>{let{from:t,to:n,onSuccess:r}=null!=e?e:{};return withDocumentReplacement(withOnSuccess((0,eu.A_)((0,A.xH)({from:t,to:n})),r))},wrapInList:e=>withDocumentReplacement((0,eu.A_)((0,A.BA)(e))),moveList:e=>withDocumentReplacement((0,eu.A_)((0,A.C$)(e)))}}};function isCollapsedToggleable(e){if(!(0,A.yD)(e))return!1;let t=e.attrs;return"bullet"===t.kind&&e.childCount>=2&&!(0,A.yD)(e.firstChild)}function withOnSuccess(e,t){return n=>{let r=e(n);return r&&n.dispatch&&t&&t(),r}}function getMarkers(e){let t=e.attrs;switch(t.kind){case"task":case"checklist":return[["label",["input",{type:"checkbox",checked:t.checked?"":void 0}]]];case"bullet":return[["div",{class:"list-bullet-bottom list-marker-click-target"}],["div",{class:"list-spine list-marker-click-target"}]];default:return null}}tQ=(0,l.u2)([(0,m.AOx)({defaultOptions:{onCheckboxChange:()=>{}}})],tQ);var rotateListType=({tr:e,dispatch:t})=>{let{$from:n,$to:r}=e.selection,a=(0,A.gY)(n,r);if(!a)return!1;if(t){let{parent:r,startIndex:i,endIndex:l,depth:o}=a,s=r.child(i),c=s.attrs,u={kind:"bullet",collapsed:!1,checked:!1,archived:!1};"bullet"===c.kind?u.kind="task":"task"!==c.kind||c.checked?"task"===c.kind&&c.checked&&(u.kind="bullet"):(u.kind="task",u.checked=!0);for(let t=i;t<l;t++){let a=n.posAtIndex(t,o);for(let[n,i]of Object.entries(u)){let l=r.child(t).attrs;l[n]!==i&&e.setNodeAttribute(a,n,i)}}null==t||t(e)}return!0};function getClickedTaskCheckbox(e){var t;let n=null==(t=e.target)?void 0:t.closest(".list-marker-click-target"),r=null==n?void 0:n.closest(".prosemirror-flat-list");if(!n||!r||"task"!==r.getAttribute("data-list-kind"))return null;let a=r.getAttribute("data-guid"),i=n.querySelector('input[type="checkbox"]');return a&&i?{guid:a,checked:i.hasAttribute("checked")}:null}function withFalsyArchived(e){return function(t,n,r){return e(t,n?e=>n(function(e){if(!e.docChanged||!e.selection.empty)return e;let{$from:t}=e.selection,n=t.depth-1;if(n<=0)return e;let r=t.node(n);if(!r||r.type.name!==a.WQ)return e;let i=r.attrs;return i.archived?e.setNodeAttribute(t.before(n),"archived",!1):e}(e)):void 0,r)}}function isListItem(e){return!!e&&a.D4.includes(e.type.name)}var tX="(paragraph|tweet|blockquote|codeBlock) block*";function createCustomMarkListItemNodeView({node:e,mark:t,updateDOM:n,updateMark:r}){let a=document.createElement("label");a.contentEditable="false",a.classList.add(eT.MQ.LIST_ITEM_MARKER_CONTAINER),a.append(t);let i=document.createElement("div"),l=document.createElement("li");l.classList.add(eT.MQ.LIST_ITEM_WITH_CUSTOM_MARKER),l.append(a),l.append(i);let update=a=>a.type===e.type&&(n(e=a,l),r(e,t),!0);return update(e),{dom:l,contentDOM:i,update}}var t0=class extends eC.UQ{createNodeSpec(e,t){let n=super.createNodeSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{parseDOM:[]})}createInputRules(){return[]}wrapInBulletList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,C.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return isSelectionInsideListGroup(t.selection)?r.wrapSelectedItemsToBulletList():r.toggleBulletList(),r.focus(),r.run(),!0}}createExtensions(){return[]}};(0,l.u2)([(0,m.WDe)()],t0.prototype,"wrapInBulletList",1);var t1=class extends eC._3{createNodeSpec(e,t){let n=super.createNodeSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{parseDOM:[]})}createInputRules(){return[]}wrapInOrderedList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,C.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return isSelectionInsideListGroup(t.selection)?r.wrapSelectedItemsToOrderedList():r.toggleOrderedList(),r.focus(),r.run(),!0}}createExtensions(){return[]}};(0,l.u2)([(0,m.WDe)()],t1.prototype,"wrapInOrderedList",1);var t5=class extends eC.Jb{createKeymap(){return{}}createNodeSpec(e,t){return(0,l.EZ)((0,l.ih)({},super.createNodeSpec(e,t)),{content:tX,toDOM:t=>["li",(0,l.EZ)((0,l.ih)({},e.dom(t)),{class:"remirror-list-item-with-custom-mark"}),["span",{class:"remirror-list-item-marker-container"},["div",{class:"remirror-collapsible-list-item-button"}]],["div",0]]})}createNodeViews(){return this.options.enableCollapsible?(e,t,n)=>{let r=document.createElement("div");return r.classList.add(eT.MQ.COLLAPSIBLE_LIST_ITEM_BUTTON),r.contentEditable="false",r.addEventListener("click",()=>{if(r.classList.contains("disabled"))return;let e=n(),a=t.state.doc.nodeAt(e);if(a){let n=!a.attrs.closed,r=t.state.tr;t.dispatch(r.setNodeMarkup(e,void 0,(0,l.EZ)((0,l.ih)({},a.attrs),{closed:n}))),n&&this.store.commands.moveCursorOutOfCollapsedContent()}}),r.addEventListener("pointerdown",e=>{e.preventDefault()}),createCustomMarkListItemNodeView({mark:r,node:e,updateDOM:updateNodeViewDOM,updateMark:updateNodeViewMark})}:{}}createExtensions(){return[]}safeSinkListItem({listItemStartPos:e,afterAction:t}){let n=(0,eu.A_)(function(t,n){let r=t.doc.resolve(e),a=r.blockRange(r,e=>e.childCount>=1&&isListItem(e.firstChild));if(!a)return!1;let i=a.startIndex;if(0==i)return!1;let l=a.parent,o=l.child(i-1);if(!isListItem(o))return!1;let s=o.type;if(n){let e=o.lastChild&&o.lastChild.type==l.type,r=B.HY.from(e?s.create():void 0),i=new B.p2(B.HY.from(s.create(null,B.HY.from(l.type.create(null,r)))),e?3:1,0),c=a.start,u=a.end;n(t.tr.step(new eo.FC(c-(e?3:1),u,c,u,i,1,!0)))}return!0});return e=>{let r=n(e);return r&&e.dispatch&&(null==t||t()),r}}safeLiftListItem({listItemStartPos:e,afterAction:t}){let n=(0,eu.A_)(function(t,n){var r;let a=t.doc.resolve(e),i=a.blockRange(a,e=>isListNode(e)&&isListItemNode(e.firstChild));if(!i)return!1;if(!n)return!0;let l=a.node(i.depth-1);if(!isListItem(l))return!1;{let e=l.type;return(null==(r=i.parent.firstChild)?void 0:r.type)===e&&function(e,t,n,r){let a=e.tr,i=r.end,l=r.$to.end(r.depth);i<l&&(a.step(new eo.FC(i-1,l,i,l,new B.p2(B.HY.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new B.Ts(a.doc.resolve(r.$from.pos),a.doc.resolve(l),r.depth));let o=(0,eo.k9)(r);return null!=o&&(t(a.lift(r,o)),!0)}(t,n,e,i)}});return e=>{let r=n(e);return r&&e.dispatch&&(null==t||t()),r}}wrapSelectedItemsToBulletList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,eC.g5)({listType:t.nodes[a.oL],itemType:t.nodes[a.l1],tr:e}),null==n||n(e),!0)}wrapSelectedItemsToOrderedList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,eC.g5)({listType:t.nodes[a.IH],itemType:t.nodes[a.l1],tr:e}),null==n||n(e),!0)}wrapSelectedItemsToTaskList(){return({tr:e,state:{schema:t},dispatch:n})=>((0,eC.g5)({listType:t.nodes[a.xy],itemType:t.nodes[a.RF],tr:e}),null==n||n(e),!0)}moveCursorOutOfCollapsedContent(){return({tr:e,dispatch:t})=>{try{if(function(e){var t;let n=e.selection.empty?[e.selection.$from]:[e.selection.$from,e.selection.$to],r=-1;for(let e of n)for(let n=e.depth;n>=1;n--){let i=e.node(n);if(i.type.name===a.l1&&i.attrs.closed){let a=e.start(n),l=a+1,o=l+((null==(t=i.firstChild)?void 0:t.content.size)||0);e.pos>o&&(r=o)}}return -1!==r&&(e.setSelection(W.Bs.near(e.doc.resolve(r),-1)),!0)}(e))return null==t||t(e),!0;return!1}catch(e){return console.warn("failed to call command moveCursorOutOfCollapsedContent:",e),!1}}}};function updateNodeViewDOM(e,t){e.attrs.closed?t.classList.add(eT.MQ.COLLAPSIBLE_LIST_ITEM_CLOSED):t.classList.remove(eT.MQ.COLLAPSIBLE_LIST_ITEM_CLOSED)}function updateNodeViewMark(e,t){e.childCount<=1?t.classList.add("disabled"):t.classList.remove("disabled")}(0,l.u2)([(0,m.WDe)()],t5.prototype,"safeSinkListItem",1),(0,l.u2)([(0,m.WDe)()],t5.prototype,"safeLiftListItem",1),(0,l.u2)([(0,m.WDe)()],t5.prototype,"wrapSelectedItemsToBulletList",1),(0,l.u2)([(0,m.WDe)()],t5.prototype,"wrapSelectedItemsToOrderedList",1),(0,l.u2)([(0,m.WDe)()],t5.prototype,"wrapSelectedItemsToTaskList",1),(0,l.u2)([(0,m.WDe)()],t5.prototype,"moveCursorOutOfCollapsedContent",1);var t2=class extends eC.Mc{get priority(){return h.xV.High}createKeymap(){let e=super.createKeymap();return(0,l.EZ)((0,l.ih)({},e),{Tab:t=>{var n,r;return null!=(r=null==(n=null==e?void 0:e.Tab)?void 0:n.call(e,t))&&r},"Shift-Tab":({tr:e,dispatch:t})=>{var n;if((0,eC.QY)(e))return null==t||t(e.scrollIntoView()),!0;{let t=function(e){let{$from:t,$to:n}=e;return t.blockRange(n,isListNode)}(e.selection),r=null==(n=null==t?void 0:t.parent.firstChild)?void 0:n.type;if(r&&a.D4.includes(r.name))return this.store.commands.liftListItemOutOfList(r),!0}return!1}})}};function maybeJoinList(e,t){let n,r,a,i;let l=t||e.selection.$from,o=[];for(let e=l.depth;e>=0;e--){if(r=l.node(e),n=l.index(e),a=r.maybeChild(n-1),i=r.maybeChild(n),a&&i&&a.type.name===i.type.name&&isListNode(a)){let t=l.before(e+1);o.push(t)}if(n=l.indexAfter(e),a=r.maybeChild(n-1),i=r.maybeChild(n),a&&i&&a.type.name===i.type.name&&isListNode(a)){let t=l.after(e+1);o.push(t)}}o=[...new Set(o)].sort((e,t)=>t-e);let s=!1;for(let t of o)(0,eo.Mn)(e.doc,t)&&(e.join(t),s=!0);return s}var t7=class extends eC.JQ{createExtensions(){return[]}createNodeSpec(e,t){let n=super.createNodeSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{parseDOM:[]})}},t3=class extends eC.nc{createNodeSpec(e,t){return(0,l.EZ)((0,l.ih)({},super.createNodeSpec(e,t)),{parseDOM:[],toDOM:e=>["li",{class:"remirror-list-item-with-custom-mark","data-task-list-item":"","data-checked":e.attrs.checked?"":void 0,"data-task-guid":"string"==typeof e.attrs.guid?e.attrs.guid:void 0},["span",{class:"remirror-list-item-marker-container"},["input",{type:"checkbox",class:"remirror-list-item-checkbox",checked:e.attrs.checked?"":void 0}]],["div",0]],content:tX})}createInputRules(){return[]}createExtensions(){return[]}createNodeViews(){return(e,t,n)=>{let r;let a=document.createElement("input");a.type="checkbox",a.classList.add(eT.MQ.LIST_ITEM_CHECKBOX),a.contentEditable="false";let i=(r=n(),()=>{let e=n();return e||0===e?r=e:console.warn(`getPos() returned ${e}, using cached value`),r});return a.addEventListener("click",e=>{var n;if(i(),t.editable){let e=this.options;null==(n=null==e?void 0:e.onCheckboxChange)||n.call(e)}else e.preventDefault()}),a.addEventListener("change",()=>{let e=i(),n=t.state.doc.resolve(e+1);this.store.commands.toggleCheckboxChecked({$pos:n})}),a.addEventListener("pointerdown",e=>{i(),e.preventDefault()}),createCustomMarkListItemNodeView({node:e,mark:a,updateDOM:updateNodeViewDOM2,updateMark:updateNodeViewMark2})}}createKeymap(){return{Enter:function(e,t=["checked"]){return function({tr:n,dispatch:r,state:a}){var i,o;let s=(0,C.jo)(e,a.schema),{$from:c,$to:u}=n.selection;if((0,C.EG)(n.selection)&&n.selection.node.isBlock||c.depth<2||!c.sameParent(u))return!1;let d=c.node(-1);if(d.type!==s)return!1;if(0===c.parent.content.size&&c.node(-1).childCount===c.indexAfter(-1)){if(2===c.depth||c.node(-3).type!==s||c.index(-2)!==c.node(-2).childCount-1)return!1;if(r){let e=c.index(-1)>0,t=B.HY.empty;for(let n=c.depth-(e?1:2);n>=c.depth-3;n--)t=B.HY.from(c.node(n).copy(t));let a=(null==(i=s.contentMatch.defaultType)?void 0:i.createAndFill())||void 0;t=t.append(B.HY.from(s.createAndFill(null,a)||void 0));let l=c.indexAfter(-1)<c.node(-2).childCount?1:c.indexAfter(-2)<c.node(-3).childCount?2:3;n.replace(c.before(e?void 0:-1),c.after(-l),new B.p2(t,e?3:2,2)),n.setSelection(n.selection.constructor.near(n.doc.resolve(c.pos+(e?3:2)))),r(n.scrollIntoView())}return!0}if(d.attrs.closed&&c.sameParent(u)&&u.pos===u.end()){if(r){let e=c.after(-1),t=(null==(o=s.contentMatch.defaultType)?void 0:o.createAndFill())||void 0,a=s.createAndFill(null,t);a&&(n.insert(e,a),n.setSelection(W.Bs.create(n.doc,e+1))),n.delete(c.pos,u.pos),r(n.scrollIntoView())}return!0}let p=Object.fromEntries(Object.entries(d.attrs).filter(([e])=>!t.includes(e))),m=u.pos===c.end()?d.contentMatchAt(0).defaultType:null,h=(0,l.ih)({},c.node().attrs);return n.delete(c.pos,u.pos),!!(0,eo.Ax)(n.doc,c.pos,2)&&(r&&r(n.split(c.pos,2,m?[{type:s,attrs:p},{type:m,attrs:h}]:[{type:s,attrs:p}]).scrollIntoView()),!0)}}(this.type,["checked","guid"])}}checkAllUncheckedCheckboxs(){return({tr:e,dispatch:t})=>{let{$from:n,$to:r,to:i}=e.selection,l=n.sharedDepth(i),o=-1;for(let e=l;e>=0;e--)if(n.node(e).type.name===a.xy){o=e;break}if(-1===o)return!1;let s=n.index(o),c=r.index(o),u=[];for(let t=s;t<=c;t++){let r=n.posAtIndex(t,o),a=e.doc.nodeAt(r);a&&u.push({pos:r,node:a})}if(0===u.length)return!1;let d=!1;for(let t of u)t.node.attrs.checked||(e.setNodeMarkup(t.pos,void 0,{checked:!0}),d=!0);return!!d&&(null==t||t(e),!0)}}wrapInTaskList(){return e=>{let{state:t,dispatch:n}=e;if(!(0,C.hT)(t.selection))return!1;if(!n)return!0;let r=this.store.chain;return isSelectionInsideListGroup(t.selection)?r.wrapSelectedItemsToTaskList():r.toggleTaskList(),r.focus(),r.run(),!0}}liftTaskListItemOutOfList(){var e;return e=this.type,t=>{let{dispatch:n,tr:r}=t,a=(0,eu.Ux)(r,t.state),i=function(e,t){let{$from:n,$to:r}=t,a=n.blockRange(r,t=>{var n;return(null==(n=t.firstChild)?void 0:n.type)===e});return a}(e,r.selection);return!!i&&(!n||(function(e,t,n){let r=e.tr,a=n.parent,i=r.mapping.maps.length;for(let e=n.end,t=n.endIndex-1,i=n.startIndex;t>i;t--)e-=a.child(t).nodeSize,r.delete(e-1,e+1);let l=r.doc.resolve(n.start),o=l.nodeAfter;if(!o||r.mapping.slice(i).map(n.end)!==n.start+o.nodeSize)return;let s=0===n.startIndex,c=n.endIndex===a.childCount,u=l.node(-1),d=l.index(-1);if(!u.canReplace(d+(s?0:1),d+1,o.content.append(c?B.HY.empty:B.HY.from(a))))return;let p=l.pos,m=p+o.nodeSize;r.step(new eo.FC(p-(s?1:0),m+(c?1:0),p+1,m-1,new B.p2((s?B.HY.empty:B.HY.from(a.copy(B.HY.empty))).append(c?B.HY.empty:B.HY.from(a.copy(B.HY.empty))),s?0:1,c?0:1),s?0:1)),t(r.scrollIntoView())}(a,n,i),!0))}}};function updateNodeViewDOM2(e,t){e.attrs.checked?t.setAttribute("data-checked",""):t.removeAttribute("data-checked"),t.setAttribute("data-task-list-item",""),t.setAttribute("data-task-guid","string"==typeof e.attrs.guid?e.attrs.guid:"")}function updateNodeViewMark2(e,t){t.checked=!!e.attrs.checked}function excludeSuggestMark(e){var t;return null==(t=e.type.spec.group)?void 0:t.split(" ").includes(h.eX.ExcludeInputRules)}function ignoreMatch(e){return e.parent.type.spec.code||e.marks().some(excludeSuggestMark)}(0,l.u2)([(0,m.WDe)()],t3.prototype,"checkAllUncheckedCheckboxs",1),(0,l.u2)([(0,m.WDe)()],t3.prototype,"wrapInTaskList",1),(0,l.u2)([(0,m.WDe)()],t3.prototype,"liftTaskListItemOutOfList",1),t3=(0,l.u2)([(0,m.AOx)({defaultOptions:{onCheckboxChange:()=>{}}})],t3);var t4="__prosemirror_suggest_ignore_key__",t8=class extends m.nNj{get name(){return"reflectMatchRules"}createExternalPlugins(){let e=[];for(let t of this.store.extensions)t.createMatchRules&&e.push(...t.createMatchRules());return e.length>0?[function({rules:e}){let t=null,n=-1,r=new W.Sy({state:{init:()=>null,apply:e=>(t&&e.getMeta(t4)&&(n=t.from),null)},view:()=>({update:r=>{let a=function(e,t){let{$from:n}=e.selection;if(ignoreMatch(n))return null;let r=Math.max(0,n.parentOffset-500),a=n.parent.textBetween(r,n.parentOffset,null,"￼");for(let i of t){i.match.lastIndex=0;let t=i.match.exec(a);if(!t)continue;let l=t[0];if(l.includes("￼"))continue;let o=n.start()+r+t.index,s=o+l.length;if(ignoreMatch(e.doc.resolve(o)))continue;let c=i.onMatch({match:t,start:o,end:s});if(c)return{from:o,to:s,match:t,rule:i}}return null}(r.state,e);a||(n=-1),t&&t.rule!==(null==a?void 0:a.rule)&&(t.rule.onDismiss(),t=null),a&&-1!==n&&a.from===n&&a.rule.onDismiss(),t=a}})});return r}({rules:e})]:[]}ignoreMatchRulePosition(){return({tr:e,dispatch:t})=>(null==t||t(e.setMeta(t4,!0)),!0)}};(0,l.u2)([(0,m.WDe)()],t8.prototype,"ignoreMatchRulePosition",1);var t6=class extends m.nNj{get name(){return"reflectOfflineStatus"}createExternalPlugins(){let e=new W.Sy({key:t9,state:{init:()=>!1,apply:(e,t)=>{let n=e.getMeta("REFLECT_OFFLINE_STATUS");return!0===n||!1===n?n:t}},props:{decorations:e=>{let t=e.doc.firstChild,n=t9.getState(e);if(!n||!t||t.type.name!==a.tw)return ea.EH.empty;let r=ea.p.widget(t.nodeSize-1,createIndicator);return ea.EH.create(e.doc,[r])}}});return[e]}},t9=new W.H$("offlineStatus");function createIndicator(){let e=document.createElement("span");return e.setAttribute("data-offline-status-indicator",""),e.className='relative bottom-1 left-2 cursor-help select-none rounded-md border border-gray-300 dark:border-near-white px-1 align-text-bottom text-xs font-normal leading-normal text-gray-400 dark:text-near-white tracking-wide transition-opacity after:content-["Offline"] inline-block',e}var ne=class extends m.nNj{get name(){return"reflectPatchTransaction"}createPlugin(){return{appendTransaction:(e,t,n)=>{let r=n.tr;return!function(e){let t=e.selection;if((0,C.hT)(t)){let{$anchor:n,$head:r,anchor:a,head:i}=t,l=a===i?W.Bs.near(n):W.Bs.between(n,r);if(l.anchor!==a||l.head!==i)return console.warn(`Found a unexpected TextSelection with invalid positions. Fixing it. Old selection: ${a} ${i}, Fixed selection: ${l.anchor} ${l.head}`),e.setSelection(l),!0}return!1}(r)?null:r}}}},nt=class extends m.nNj{constructor(){super(...arguments),this.searching=!1,this.searchTerm="",this.searchNodeGuid="",this.results=[],this.activeIndex=null}get name(){return"reflectSearch"}createPlugin(){return{state:{init:()=>ea.EH.empty,apply:(e,t)=>{if(this.searching){let{collapsedRanges:t,textRanges:n}=function(e,t){if(!t)return{textRanges:[],collapsedRanges:[]};let n=(0,i.BF)(t),r=[],a=[],l=[];return e.descendants((e,t,o,s)=>{if(o&&(0,A.Sz)(o)&&s>=1&&l.push({from:t,to:t+e.nodeSize}),e.isLeaf&&e.isBlock)return testTextInLeafNode(e,n)&&r.push({from:t,to:t+e.nodeSize,blockLeafNode:!0}),!1;if(!e.isTextblock)return!0;let c=t+1,u="",d=!1,flush=()=>{var e;if(!u)return;let t=(0,i.l9)(u);for(let a of(t.length===u.length&&(u=t),eL(u,n))){let t=c+(null!=(e=a.index)?e:0),n=t+a[0].length;r.push({from:t,to:n}),d=!0}c+=u.length,u=""};if(e.nodesBetween(0,e.content.size,t=>{t.isText?u+=t.text:(flush(),testTextInLeafNode(e,n)&&(r.push({from:c,to:c+t.nodeSize,inlineLeafNode:!0}),d=!0),c+=t.nodeSize)}),flush(),d){for(let e of l)e.from<=t&&t<=e.to&&a.push(e);l=[]}return!1}),{textRanges:r,collapsedRanges:a}}(e.doc,this.searchTerm),r=function(e,t){let n=[];return t&&e.descendants((e,r)=>!(n.length>0)&&(e.attrs.guid===t&&n.push({from:r,to:r+e.nodeSize}),!e.isTextblock&&void 0)),n}(e.doc,this.searchNodeGuid);this.results=n,this.normalizeActiveIndex();let a=this.results.map((e,t)=>{if(e.inlineLeafNode){let n={searchTerm:this.searchTerm,active:t===this.activeIndex};return ea.p.inline(e.from,e.to,{},n)}if(!e.blockLeafNode)return ea.p.inline(e.from,e.to,{class:t===this.activeIndex?i.wA:i.Dy});{let n={searchTerm:this.searchTerm,active:t===this.activeIndex};return ea.p.node(e.from,e.to,{},n)}}),l=t.map(e=>ea.p.node(e.from,e.to,{class:i.Ui})),o=r.map(e=>ea.p.node(e.from,e.to,{class:i.op}));return setTimeout(()=>this.scrollToActiveResult(),50),ea.EH.create(e.doc,[...a,...l,...o])}return e.docChanged?t.map(e.mapping,e.doc):t}},props:{decorations:e=>this.getPluginState(e)}}}search(e){var t;return this.store.commands.startSearch(e),{matches:this.results.length,activeIndex:null!=(t=this.activeIndex)?t:null}}startSearch({searchTerm:e,searchNodeGuid:t,activeIndex:n}){return e||t?({tr:r,dispatch:a})=>(this.searchTerm=e,this.searchNodeGuid=null!=t?t:"",this.activeIndex=null!=n?n:null,this.updateView(r,a)):this.stopSearch()}stopSearch(){return({tr:e,dispatch:t})=>(this.searchTerm="",this.searchNodeGuid="",this.activeIndex=null,this.updateView(e,t))}updateView(e,t){return this.searching=!0,t&&t(e),this.searching=!1,!0}normalizeActiveIndex(){var e,t;null!=this.activeIndex&&(this.activeIndex=(e=this.activeIndex,(t=this.results.length)<=0?0:(e%t+t)%t))}scrollToActiveResult(){var e;if(null==this.activeIndex)return;let t=this.results[this.activeIndex];if(!t)return;let n=this.store.view,r=n.state.doc.content.size,a=t.from;if(a>r)return;let i=n.domAtPos(a).node;null==(e=null==i?void 0:i.scrollIntoView)||e.call(i,{block:"nearest",behavior:"smooth"})}};function testTextInLeafNode(e,t){t.lastIndex=0;let n=t.test((0,i.l9)(e.textContent));return t.lastIndex=0,n}(0,l.u2)([(0,m._y)()],nt.prototype,"search",1),(0,l.u2)([(0,m.WDe)()],nt.prototype,"startSearch",1),(0,l.u2)([(0,m.WDe)()],nt.prototype,"stopSearch",1);var nn=class extends m.nNj{get name(){return"slash"}createSuggesters(){return[{startOfLine:!1,char:"/",name:"slash",appendTransaction:!1,onChange:e=>{this.options.onSlashChange(e)},invalidMarks:["code"],supportedCharacters:/[^#*/=@[\\\]`|~]+/,emptySelectionsOnly:!0,invalidNodes:["codeBlock","codeMirror","codeMirror5","codeMirror6"]}]}};nn=(0,l.u2)([(0,m.AOx)({defaultOptions:{},handlerKeys:["onSlashChange"]})],nn);var nr=class extends eS.V{createMarkSpec(e,t){let n=super.createMarkSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{parseDOM:[]})}createPasteRules(){return super.createPasteRules().map(e=>(0,l.EZ)((0,l.ih)({},e),{ignoredMarks:["link"]}))}createInputRules(){return[spaceMarkInputRule({regexp:/~~([^~]+)~~\s$/,type:this.type,ignoreWhitespace:!0}),spaceMarkInputRule({regexp:/~([^~]+)~\s$/,type:this.type,ignoreWhitespace:!0})]}},na=class extends m.nNj{constructor(){super(...arguments),this.lastActive=!1}get name(){return"subjectMerge"}onApplyState(e){let{tr:t}=e,n=t.selection.$from,r=n.node(),a=r.textContent,i="heading"==r.type.name&&1==r.attrs.level,l=n.parentOffset===r.content.size,o=0===n.index(0),s=1===n.depth&&i&&l&&o;if(s!==this.lastActive||a!==this.lastValue||n.pos!==this.lastPosition){this.lastActive=s,this.lastValue=a,this.lastPosition=n.pos;let e=s?a:void 0;this.options.onSubjectChange(n.pos,s,e)}}};na=(0,l.u2)([(0,m.AOx)({defaultOptions:{},handlerKeys:["onSubjectChange"]})],na);var ni=class extends m.QR{get name(){return"tag"}createPlugin(){return{props:{handleDOMEvents:{keydown:({state:e},t)=>"Enter"===t.key&&this.handleEnterKeyPress(t,e)}}}}createTags(){return[h.eX.InlineNode,h.eX.Behavior]}createNodeSpec(e,t){let n="data-tag";return(0,l.EZ)((0,l.ih)({inline:!0,selectable:this.options.selectable,draggable:this.options.draggable,atom:!0},t),{attrs:(0,l.EZ)((0,l.ih)({},e.defaults()),{id:{},label:{},graphId:{default:this.options.graphId}}),parseDOM:[{tag:"span[data-tag]",getAttrs:t=>{if(!(0,C.jd)(t))return!1;let n=t.getAttribute("data-id"),r=t.getAttribute("data-label"),a=t.getAttribute("data-graph-id")||this.options.graphId;return!!n&&(0,l.EZ)((0,l.ih)({},e.parse(t)),{id:n,label:r,graphId:a})}},{tag:`${this.options.mentionTag}[${n}]`,getAttrs:t=>{var r;if(!(0,C.jd)(t))return!1;let a=t.getAttribute(n),i=null==(r=t.textContent)?void 0:r.replace(/#/g,"");return(0,l.EZ)((0,l.ih)({},e.parse(t)),{id:a,label:i})}},{tag:`${this.options.mentionTag}[href^="https://reflect.app/g/"][href*="/tag/"]`,priority:h.xV.Highest,getAttrs:t=>{var n;if(!(0,C.jd)(t))return!1;let r=t.getAttribute("href"),{graphId:a,id:i}=function(e){if(!e)return{};let t=e.match(tf);if(t){let[e,n,r]=t;return{graphId:n,id:r}}return{}}(r);if(!i)return!1;let o=null==(n=t.textContent)?void 0:n.replace(/#/g,"");return(0,l.EZ)((0,l.ih)({},e.parse(t)),{graphId:a,id:i,label:o})}}],toDOM:t=>{let{label:n,graphId:r,id:a}=(0,C.Kh)(t.attrs,e),i=this.options.graphId,o=(0,l.EZ)((0,l.ih)({},e.dom(t)),{href:toTagHref({graphId:r||i,id:a}),"data-editor-tag":n});return[this.options.mentionTag,o,`#${n}`]},leafText:e=>getTextFromTagAttrs(e.attrs)})}createNodeViews(){return(e,t,n,r)=>{let a=e.attrs,i=document.createElement(this.options.mentionTag);i.setAttribute("href",this.buildHref(e)),i.setAttribute("data-editor-tag",a.label),i.setAttribute("tabindex","-1"),i.textContent="#"+a.label,addHighlightFromDecoration(i,r);let l=this.options.onClick,o=!1;return i.addEventListener("pointerdown",e=>{o=!0,e.preventDefault()}),i.addEventListener("pointerup",e=>{o&&(null==l||l(e,a)),o=!1}),i.addEventListener("click",e=>{e.preventDefault()}),{dom:i,update:()=>!1}}}buildHref(e){let{graphId:t,id:n}=e.attrs,r=this.options.graphId;return toTagHref({graphId:null!=t?t:r,id:n})}createTag(e,t){let{name:n,range:r}=e;return(0,C.lp)({type:this.type,appendText:this.options.appendText,attrs:(0,l.EZ)((0,l.ih)({name:n},t),{graphId:this.options.graphId}),range:{from:r.from,to:r.cursor}})}handleEnterKeyPress(e,t){var n,r;if(!e.metaKey&&!e.ctrlKey)return!1;let a=t.selection.node;if((null==a?void 0:a.type.name)===this.name){e.preventDefault();let t=a.attrs;return null==(r=(n=this.options).onClick)||r.call(n,e,t),!0}return!1}createMatchRules(){return[{match:/#(([^\s/?[\]_-][^\s#/?[\]]*)?)$/i,onMatch:e=>!e.match[0].startsWith("##")&&this.options.onTagMatchV2(e),onDismiss:()=>{this.options.onTagDismissV2()}}]}};(0,l.u2)([(0,m.WDe)()],ni.prototype,"createTag",1),ni=(0,l.u2)([(0,m.AOx)({defaultOptions:{selectable:!0,draggable:!1,mentionTag:"a",appendText:" ",disableDecorations:!1,graphId:"",onClick:null},handlerKeys:["onTagMatchV2","onTagDismissV2"],staticKeys:["selectable","draggable","mentionTag","graphId"]})],ni);var nl=class extends m.nNj{get name(){return"reflectTemplate"}insertContentTemplate(e){return({dispatch:t,tr:n,state:r})=>{let a=(0,X.Z)(e.document);!function normalizeTemplate(e){if(e){if(Array.isArray(e))e.forEach(normalizeTemplate);else if("object"==typeof e){for(let t of Object.keys(e))"guid"===t?delete e[t]:normalizeTemplate(e[t]);"list"===e.type&&e.attrs&&"object"==typeof e.attrs&&(e.attrs.archived=!1)}}}(a=tN(a,tS,"contentTemplate")||a);let i=B.HY.fromJSON(r.schema,a.content),l=B.p2.maxOpen(function(e){for(;1===e.childCount&&(0,A.yD)(e.child(0))&&(0,A.yD)(e.child(0).firstChild);)e=e.child(0).content;return e}(i));return n.setSelection(W.Bs.near(n.selection.$from)),n.replaceSelection(l),null==t||t(n),!0}}};(0,l.u2)([(0,m.WDe)()],nl.prototype,"insertContentTemplate",1);var no=class extends eI.x{createKeymap(){return{"Mod-Shift-h":e=>(this.toggleHighlight(e.state.selection),!0)}}createMarkSpec(e,t){let n=super.createMarkSpec(e,t);return(0,l.EZ)((0,l.ih)({},n),{parseDOM:[]})}createInputRules(){return[spaceMarkInputRule({regexp:/={2}([^=]+)={2}\s$/,type:this.type,ignoreWhitespace:!0}),spaceMarkInputRule({regexp:/\^{2}([^^]+)\^{2}\s$/,type:this.type,ignoreWhitespace:!0})]}toggleHighlight(e){return this.store.commands.toggleMark({type:this.type,selection:e})}},ns=class extends m.nNj{constructor(){super(...arguments),this.name="transactionFilter"}createPlugin(){return{filterTransaction:(e,t)=>this.options.filterTransaction(e,t)}}};function assertUnreachable(e){throw Error("Didn't expect to get here")}function createChecked(e,t,n,r){try{let a=n?function contentToFragment(e){if((0,C.PH)(e))return B.HY.from(e);if((0,C.mt)(e))return e;if((0,eN.Z)(e))return e.reduce((e,t)=>e.append(contentToFragment(t)),B.HY.empty);throw Error(`unknown content type: ${e}`)}(n):null;return e.createAndFill(t,a,r)||e.createChecked(t,a,r)}catch(e){if(e instanceof RangeError)throw RangeError(`${e.message} (content: ${null==n?void 0:n.toString()})`);throw e}}function assertContentType(e,t){!function(e,t){flattenContent(e).map(t)}(e,e=>{if(!t.includes(e.type.name))throw Error(`expected node type ${t} but got ${e.type.name}`)})}function flattenContent(e){return(0,C.PH)(e)?[e]:(0,C.mt)(e)?collectChildren(e):(0,eN.Z)(e)?e.flatMap(flattenContent):void assertUnreachable(e)}function buildGenerators(e){let text=(t,n)=>e.text(t,n),hardBreak=()=>e.nodes.hardBreak.create(),header=(t="")=>createChecked(e.nodes.heading,{level:1},t?[text(t)]:[]),paragraphText=(e="")=>paragraph(e?[text(e)]:[]),paragraph=t=>createChecked(e.nodes.paragraph,null,t),backlink=t=>createChecked(e.nodes.backlink,t),listItem=t=>{let n={kind:"bullet",guid:guid(),archived:!1};return createChecked(e.nodes.list,n,t)},list=e=>(assertContentType(e,["listItem","list"]),e),emptyList=()=>list(listItem(paragraphText(""))),namedListItem=e=>listItem([paragraphText(e),emptyList()]),backlinkedListItem=e=>listItem([paragraph(backlink(e)),emptyList()]);return{doc:t=>createChecked(e.nodes.doc,{},t),docWithSubject:(t="")=>createChecked(e.nodes.doc,{},[header(t),paragraphText()]),text,header,paragraphText,paragraphTextWithHardBreaks:(e="")=>{let t=e.split("\n").filter(e=>e.length>0),n=t.reduce((e,n,r)=>(e.push(text(n)),r<t.length-1&&e.push(hardBreak()),e),[]);return paragraph(n)},paragraph,codeBlock:(t="")=>createChecked(e.nodes.codeBlock,null,t?[text(t)]:[]),blockquote:t=>((function(e,t){flattenContent(e).map(t)})(t,e=>{if(!e.isBlock)throw Error(`expected node to be a block node but get ${e.type.name}`)}),createChecked(e.nodes.blockquote,null,t)),backlink,tag:t=>createChecked(e.nodes.tag,t),link:(t,n)=>{if(!n)throw Error("link href should not be empty");return e.text(t,[e.marks.link.create({href:n})])},listItem,list,taskListItem:(t,n)=>{let r={kind:"task",checked:!!n.checked,guid:n.guid||guid(),archived:!!n.archived};return createChecked(e.nodes.list,r,t)},taskList:e=>(assertContentType(e,["taskListItem","list"]),e),emptyList,namedList:e=>list(namedListItem(e)),namedListItem,backlinkedList:e=>list(backlinkedListItem(e)),backlinkedListItem,parentList:e=>listItem([paragraph(e),emptyList()]),image:t=>{if(!t.src)throw Error("image link should exist");return createChecked(e.nodes.image,t)},tweet:t=>{if(!t.url)throw Error("tweet link should exist");return createChecked(e.nodes.tweet,t)}}}function findNode(e,t){let n=null;return e.descendants((e,r)=>!n&&(t(e)?(n={node:e,pos:r},!1):void 0)),n}function findParentList(e,t){return findNode(e,e=>(0,A.yD)(e)&&function(e,t){if(!e||!t)return e===t;if(e.childCount!==t.childCount)return!1;for(let n=0;n<e.childCount;n++)if(!function(e,t){if(e.eq(t))return!0;if(e.type.name===a.qh&&e.type.name===a.qh){let n=e.attrs,r=t.attrs;if(n.label===r.label)return!0}return!1}(e.child(n),t.child(n)))return!1;return!0}(function(e){if((0,A.yD)(e.firstChild))return null;let t=findNode(e,e=>e.isTextblock);return t?t.node.content:null}(e),t))}function findLabeledSublistRange(e,t){let n=findParentList(e,t);return n?function(e,t){let n=getMaxListRange(t.node);if(n){let[r,a]=n;return r+=t.pos,a+=t.pos,(0,A.gY)(e.resolve(r),e.resolve(a))}return null}(e,n):null}function assertFlatList(e){let t=[];t=e instanceof B.HY?collectChildren(e):(0,eN.Z)(e)?e:[e],console.assert((0,eM.Z)(t,e=>e.type.name===a.WQ),"the prosemirror nodes must be flat list nodes")}function applyTransform(e,t){if(!e)return;let n=(0,C.Z)(e)?e:W.yy.create({schema:e.type.schema,doc:e}),{tr:r,schema:a}=n;t({tr:r,schema:a});let i=n.apply(r);return i.doc}function mergeDocument(e,t){let n=[];for(let e=1;e<t.content.childCount;e++){let r=t.content.child(e);n.push(r)}return appendNodesToDocument(e,n=n.filter(e=>!isEmptyParagraph(e)))}function appendNodesToDocument(e,t){let n=e.tr.doc,r=n.content.size,a=r;for(let e=n.childCount-1;e>=0;e--)isEmptyParagraph(n.child(e))&&(a-=2);let i=new B.p2(B.HY.fromArray(t),0,0);return e.tr.replaceRange(a,r,i),maybeJoinList(e.tr,e.tr.doc.resolve(a)),!0}function addSubjectToContent(e,t){let n=buildGenerators(e.schema);return e.tr.replaceRangeWith(0,getAfterSubjectPosition(e.tr.doc),n.header(t)),!0}function rewriteBacklinkNoteIds(e,t,n,r={}){let a=getBacklinkNodes(e.tr.doc);for(let[i,o]of a)i.attrs.id===t&&e.tr.setNodeMarkup(o,void 0,(0,l.ih)((0,l.EZ)((0,l.ih)({},i.attrs),{id:n}),r));return a.length>0}function rewriteBacklinkGraphIds(e,t){let n=getBacklinkNodes(e.tr.doc);for(let[r,a]of n)r.attrs.graphId!==t&&e.tr.setNodeMarkup(a,void 0,(0,l.EZ)((0,l.ih)({},r.attrs),{graphId:t}));return n.length>0}function ensureList(e){var t;let n=(t=e.tr.doc,(0,C.N2)({node:t,predicate:({node:e})=>e.type.name===a.oL||e.type.name===a.WQ}));if(n.length>0)return!1;let r=buildGenerators(e.schema);return e.tr.insert(getAfterSubjectPosition(e.tr.doc),r.emptyList()),function(e){let t=e.tr.doc,n=t.content.size,r=n;for(let e=t.childCount-1;e>=2;e--){let n=t.child(e);isEmptyParagraph(n)&&(r-=n.nodeSize)}r<n&&e.tr.delete(r,n)}(e),!0}function appendNodesToFirstList(e,t){assertFlatList(t);let[n,r]=getListAppendPositionRange(e.tr.doc);return e.tr.replaceRange(n,r,new B.p2(B.HY.from(t),0,0)),!0}function addSuggestedBacklinkToNodes(e,t){let{tr:n,schema:r}=e,a=buildGenerators(r),i=getAfterSubjectPosition(n.doc),l=searchTextInNode({node:n.doc,posFrom:i,wordsToMatch:[t.label]});if(0===l.length)return!1;let o=a.backlink(t);for(let e of l.reverse())n.replaceWith(e,e+t.label.length,o);return!0}function assertDocJson(e){if(!e)throw Error("Unexpected empty doc");if("doc"!==e.type)throw Error(`Invalid doc type: ${e.type}`)}function emptyParagraphJson(){return{type:a.e3,content:[]}}function createInlineDocumentJson(e){var t;assertDocJson(e);let n=null==(t=null==e?void 0:e.content)?void 0:t[0],r=(null==n?void 0:n.type)===a.e3?n:emptyParagraphJson();return(0,l.EZ)((0,l.ih)({},e),{content:[r]})}function applyInlineDocumentJson({doc:e,inlineDoc:t}){var n,r,i,o,s;assertDocJson(e),assertDocJson(t);let c=null!=(r=null==(n=null==t?void 0:t.content)?void 0:n[0])?r:emptyParagraphJson(),u=null!=(i=null==e?void 0:e.content)?i:[],d=(null==(s=null==(o=null==e?void 0:e.content)?void 0:o[0])?void 0:s.type)===a.e3?[c,...u.slice(1)]:[c,...u];return(0,l.EZ)((0,l.ih)({},t),{content:d})}function insertOrUpdateBacklink(e,t,n){var r;let i,l,o;let s=buildGenerators(e.type.schema).backlink(t);return(e.descendants(e=>{if(i)return!1;if(e.type.name===a.qh){let t=e.attrs;n(t)&&(i=e)}}),i)?(r=i,l=!1,function replace(e){if(l)return e;if(e.eq(r))return l=!0,s;let t=e.content;if(0===t.size)return e;let n=B.HY.fromArray(collectChildren(t).map(replace));return e.copy(n)}(e)):(o=!1,function insert(e){if(o)return e;if(e.isTextblock){let t=e.content,n=e.type.schema.text(" "),r=t.addToEnd(n).addToEnd(s);return o=!0,e.copy(r)}let t=e.content;if(0===t.size)return e;let n=B.HY.fromArray(collectChildren(t).map(insert));return e.copy(n)}(e))}function ensureParentList(e,t,{position:n="bottom"}={}){var r;let i=findParentList(e.tr.doc,t);if(i)return function(e,t){var n;let r=t.node.maybeChild(1);if((null==(n=null==r?void 0:r.type)?void 0:n.name)!==a.WQ){let n=buildGenerators(e.schema),r=t.pos+t.node.child(0).nodeSize;return e.tr.insert(r,n.emptyList()),!0}return!1}(e,i);let l=(r=e.tr.doc,"bottom"===n?getListAppendPositionRange(r):function(e){let t=getFirstListRange(e);if(!t){let t=getAfterSubjectPosition(e);return[t,t]}let{start:n}=t;return[n,n]}(r))[0],o=buildGenerators(e.schema);return e.tr.insert(l,o.parentList(t)),!0}function appendNodesToParentList(e,t,n){assertFlatList(n),ensureParentList(e,t);let r=findLabeledSublistRange(e.tr.doc,t);return e.tr.insert(r.end,n),!function(e,t){let n=findLabeledSublistRange(e.tr.doc,t);n&&function(e,t){console.assert((0,A.ji)(t),"range should only contain list nodes");let{startIndex:n,endIndex:r,parent:a}=t,{end:i}=t,l=i;if(!(r-n<2))for(let t=r-1;t>=n;t--){let n=a.child(t);l=i-n.nodeSize,isEmptyItem(n)&&e.tr.deleteRange(l,i),i=l}}(e,n)}(e,t),!0}function syncNodesToParentList(e,t,n,r){assertFlatList(n),ensureParentList(e,t,r);let a=findLabeledSublistRange(e.tr.doc,t);if(!a)return!1;let i=(function(e){let{parent:t,startIndex:n,endIndex:r}=e,a=[];for(let e=n;e<r;e++)a.push(t.child(e));return a})(a).map(copyWithoutArchivedAndGuid),l=n.filter(e=>(e=copyWithoutArchivedAndGuid(e),i.every(t=>!t.eq(e))));return appendNodesToParentList(e,t,l),!0}function copyWithoutArchivedAndGuid(e){return function(e,t,...n){let r=(0,l.ih)({},e.attrs);for(let e of[t,...n])r[e]=void 0;return e.type.create(r,e.content,e.marks)}(e,"archived","guid")}function labelFromBacklink(e,t){let n=buildGenerators(e.schema);return B.HY.from(n.backlink(t))}function ensureNamedList(e,t,{position:n="bottom"}={}){return ensureParentList(e,labelFromListName(e,t),{position:n})}function appendNodesToNamedList(e,t,n){return appendNodesToParentList(e,labelFromListName(e,t),n)}function syncNamedListItems(e,t,n){let r=buildGenerators(e.schema),a=n.filter(e=>e).map(e=>r.listItem(r.paragraphText(e)));return syncNodesToParentList(e,labelFromListName(e,t),a)}function syncNodesToNamedList(e,t,n,r){return syncNodesToParentList(e,labelFromListName(e,t),n,r)}function labelFromListName(e,t){if(!t)throw Error("listName cannot be empty");let n=buildGenerators(e.schema);return B.HY.from(n.text(t))}ns=(0,l.u2)([(0,m.AOx)({defaultOptions:{filterTransaction:()=>!0}})],ns);var nc="force-update-subject",nu=class extends m.nNj{get name(){return"transformCommands"}ensureNamedList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!ensureNamedList({schema:n,tr:r},e)&&(null==t||t(r),!0)}syncNamedListItems(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!syncNamedListItems({schema:r,tr:a},e,t)&&(null==n||n(a),!0)}appendNodesToNamedList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!appendNodesToNamedList({schema:r,tr:a},e,t)&&(null==n||n(a),!0)}appendNodesToParentList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!appendNodesToParentList({schema:r,tr:a},e,t)&&(null==n||n(a),!0)}ensureBacklinkedList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!function(e,t,{position:n="bottom"}={}){return ensureParentList(e,labelFromBacklink(e,t),{position:n})}({schema:n,tr:r},e)&&(null==t||t(r),!0)}syncBacklinkedListItems(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!function(e,t,n){let r=buildGenerators(e.schema),a=n.filter(e=>e).map(e=>r.listItem(r.paragraphText(e)));return syncNodesToParentList(e,labelFromBacklink(e,t),a)}({schema:r,tr:a},e,t)&&(null==n||n(a),!0)}appendNodesToBacklinkedList(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>{var i;return!!appendNodesToParentList(i={schema:r,tr:a},labelFromBacklink(i,e),t)&&(null==n||n(a),!0)}}ensureList(){return({dispatch:e,state:{schema:t,tr:n}})=>!!ensureList({schema:t,tr:n})&&(null==e||e(n),!0)}appendNodesToFirstList(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!appendNodesToFirstList({schema:n,tr:r},e)&&(null==t||t(r),!0)}rewriteBacklinks(e,t){return this.rewriteBacklinkNoteIds(e,t)}rewriteBacklinkNoteIds(e,t){return({dispatch:n,state:{schema:r,tr:a}})=>!!rewriteBacklinkNoteIds({schema:r,tr:a},e,t)&&(null==n||n(a),!0)}rewriteBacklinkGraphIds(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!rewriteBacklinkGraphIds({schema:n,tr:r},e)&&(null==t||t(r),!0)}addSubjectToContent(e,t=!1){return({dispatch:n,state:{schema:r,tr:a}})=>!!addSubjectToContent({schema:r,tr:a},e)&&(t&&a.setMeta(nc,!0),null==n||n(a),!0)}mergeDocument(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!mergeDocument({schema:n,tr:r},e)&&(null==t||t(r),!0)}addSuggestedBacklinkToNodes(e){return({dispatch:t,state:{schema:n,tr:r}})=>!!addSuggestedBacklinkToNodes({schema:n,tr:r},e)&&(null==t||t(r),!0)}};(0,l.u2)([(0,m.WDe)()],nu.prototype,"ensureNamedList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"syncNamedListItems",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"appendNodesToNamedList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"appendNodesToParentList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"ensureBacklinkedList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"syncBacklinkedListItems",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"appendNodesToBacklinkedList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"ensureList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"appendNodesToFirstList",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"rewriteBacklinks",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"rewriteBacklinkNoteIds",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"rewriteBacklinkGraphIds",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"addSubjectToContent",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"mergeDocument",1),(0,l.u2)([(0,m.WDe)()],nu.prototype,"addSuggestedBacklinkToNodes",1);var ImageFallback=e=>{var{sources:t}=e,n=(0,l.S0)(e,["sources"]);let[r,a]=(0,c.useState)(0);return c.createElement("img",(0,l.EZ)((0,l.ih)({},n),{onError:()=>{a(e=>e<t.length-1?e+1:e)},src:t.length>0?t[r]:""}))};function formatLocalDate(e){try{return e.toLocaleDateString(void 0!=navigator.languages?navigator.languages[0]:navigator.language,{year:"numeric",month:"short",day:"numeric"})}catch(t){return e.toLocaleDateString()}}function TweetLink(e){var{children:t}=e,n=(0,l.S0)(e,["children"]);return c.createElement("a",(0,l.ih)({target:"_blank",rel:"noopener noreferrer"},n),t)}var TweetText=({searchTerm:e,children:t})=>{let n=(0,c.useRef)(null);return(0,c.useEffect)(()=>{e&&n.current&&(0,i.CC)(n.current,e)},[e]),c.createElement("span",{ref:n},t)},getUserUrl=e=>`https://twitter.com/${e}`;function getTweetUrl(e){return`https://twitter.com/${e.user.screen_name}/status/${e.id_str}`}function getMediaUrl(e,t){let n=new URL(e.media_url_https),r=n.pathname.split(".").pop();return r?(n.pathname=n.pathname.replace(`.${r}`,""),n.searchParams.set("format",r),n.searchParams.set("name",t),n.toString()):e.media_url_https}function getMp4VideoUrl(e){var t,n;return null!=(n=null==(t=function(e){let t=function(e){if(!e.video_info)return[];let{variants:t}=e.video_info,n=t.filter(e=>"video/mp4"===e.content_type).sort((e,t)=>{var n,r;return(null!=(n=t.bitrate)?n:0)-(null!=(r=e.bitrate)?r:0)});return n}(e);return 0===t.length?null:t.length>1?t[1]:t[0]}(e))?void 0:t.url)?n:""}function addEntities(e,t,n){for(let r of t)for(let[t,a]of e.entries()){if(r.indices[0]<a.indices[0]||r.indices[1]>a.indices[1])continue;let i=[(0,l.EZ)((0,l.ih)({},r),{type:n})];a.indices[0]<r.indices[0]&&i.unshift({indices:[a.indices[0],r.indices[0]],type:"text"}),a.indices[1]>r.indices[1]&&i.push({indices:[r.indices[1],a.indices[1]],type:"text"}),e.splice(t,1,...i);break}}function TweetBody({tweet:e,searchTerm:t}){let n=function(e){let t=[{indices:e.display_text_range,type:"text"}];return addEntities(t,e.entities.hashtags,"hashtag"),addEntities(t,e.entities.user_mentions,"mention"),addEntities(t,e.entities.urls,"url"),addEntities(t,e.entities.symbols,"symbol"),e.entities.media&&addEntities(t,e.entities.media,"media"),t}(e);e.entities.media&&e.entities.media[0].indices[0]<e.display_text_range[1]&&(e.display_text_range[1]=e.entities.media[0].indices[0]);let r=n.at(-1);return r&&r.indices[1]>e.display_text_range[1]&&(r.indices[1]=e.display_text_range[1]),c.createElement("div",{className:"w-full"},n.map((n,r)=>{let a=Array.from(e.text).splice(n.indices[0],n.indices[1]-n.indices[0]).join("");switch(n.type){case"hashtag":return c.createElement(TweetLink,{key:r,href:`https://twitter.com/hashtag/${n.text}`},a);case"mention":return c.createElement(TweetLink,{key:r,href:getUserUrl(n.screen_name)},a);case"url":return c.createElement(TweetLink,{key:r,href:n.expanded_url},n.display_url);case"symbol":return c.createElement(TweetLink,{key:r,href:`https://twitter.com/search?q=%24${n.text}`},a);case"media":return null;default:return c.createElement(TweetText,{key:r,searchTerm:t},(0,eD.Z)(a))}}))}var TweetMediaDetail=({media:e,tweetUrl:t})=>{let n=e.original_info.height||200,r=e.original_info.width||200;return"video"==e.type||"animated_gif"==e.type?c.createElement("video",{className:"!m-0",width:r,height:n,muted:!0,controls:!0,playsInline:!0,preload:"metadata",style:{aspectRatio:`${r} / ${n}`}},c.createElement("source",{src:getMp4VideoUrl(e),type:"video/mp4"})):c.createElement("a",{key:e.media_url_https,href:t,target:"_blank",rel:"noreferrer"},c.createElement("img",{width:r,height:n,src:getMediaUrl(e,"small")}))};function createStaticTweetMediaDetail(e){let t=e.original_info.height||200,n=e.original_info.width||200;return"video"==e.type||"animated_gif"==e.type?["video",{class:"!m-0",width:n,height:t,muted:"",controls:"",playsInline:"",preload:"metadata",style:`aspect-ratio: ${n} / ${t};`},["source",{src:getMp4VideoUrl(e),type:"video/mp4"}]]:["img",{width:n,height:t,src:getMediaUrl(e,"small")}]}var TweetMedia=({tweet:e})=>{var t,n;if(!(null==(t=null==e?void 0:e.mediaDetails)?void 0:t.length))return null;let r=getTweetUrl(e);return c.createElement("div",{className:(0,s.Z)("mt-3 inline-grid overflow-hidden rounded-xl border border-gray-300 drop-shadow-sm dark:border-gray-500",1===e.mediaDetails.length?"grid-cols-1":"grid-cols-2")},null==(n=e.mediaDetails)?void 0:n.map((e,t)=>c.createElement(TweetMediaDetail,{key:t,media:e,tweetUrl:r})))};function getMediaDetailsData(e){return{type:e.type,media_url_https:e.media_url_https,original_info:{width:e.original_info.width,height:e.original_info.height},video_info:"video"===e.type||"animated_gif"===e.type?e.video_info:null}}var nd=["https://tweet.reflect.app","https://react-tweet.vercel.app","https://react-tweet-next.vercel.app"];async function fetchTweetFromHost({host:e,tweetId:t}){var n,r;let a=`${e}/api/tweet/${t}`,i=await fetch(a),l=await i.json();if(!i.ok)return null;let o=l.data;if((null==o?void 0:o.text)==null||(null==(n=null==o?void 0:o.user)?void 0:n.name)==null)throw Error(`Invalid tweet data ${JSON.stringify(o)}`);return{version:2,created_at:o.created_at,display_text_range:o.display_text_range,entities:o.entities,id_str:o.id_str,text:o.text,user:o.user,mediaDetails:null==(r=o.mediaDetails)?void 0:r.map(getMediaDetailsData),in_reply_to_screen_name:o.in_reply_to_screen_name,in_reply_to_status_id_str:o.in_reply_to_status_id_str,in_reply_to_user_id_str:o.in_reply_to_user_id_str}}async function fetchTweet({tweetId:e}){for(let t of nd)try{let n=await fetchTweetFromHost({host:t,tweetId:e});if(n)return n}catch(e){console.error(`Failed to fetch tweet from ${t}`,e)}return null}function TweetPreview({node:e,selected:t,getPosition:n,decorations:r}){let i=findHighlightDecorationSearchTerm(r),{tweetUrl:l,tweetData:s,error:u,handleCopy:d,handleReplace:p}=function(e,t){var n;let r=e.attrs,i=!!r.tweetData&&!function(e){var t;let n=null!=(t=e.version)?t:0;return n<2}(r.tweetData),l=r.url||"",[s,u]=(0,c.useState)(null),d=useEditorView();(0,c.useEffect)(()=>{var e,t;if(!d||d.isDestroyed||i)return;let n=null==(t=null==(e=l.match(a.W2))?void 0:e.groups)?void 0:t.tweet_id;if(!n){u(Error("Can't paste tweet URL "+l));return}fetchTweet({tweetId:n}).then(e=>{!function(e,t,n){if(e.isDestroyed||!n)return;let{state:r}=e,i=[];if(r.doc.descendants((e,r)=>{if(e.type.name===a.Q0){let a=e.attrs;a.url!==t||(0,eA.Z)(n,a.tweetData)||i.push(r)}if(e.isTextblock)return!1}),0===i.length)return;let l=e.state.tr;for(let e of i)l.setNodeAttribute(e,"tweetData",n);e.dispatch(l)}(d,l,e)}).catch(e=>{u(e)})},[i,l,d]);let{replaceTweetToLink:p}=(0,o.xd)(),m=(0,c.useCallback)(()=>{copyTextToClipboard(l)},[l]),h=(0,c.useCallback)(()=>{let e=t();e&&p({pos:e})},[t,p]);return{tweetUrl:l,tweetData:null!=(n=r.tweetData)?n:null,error:s,handleCopy:m,handleReplace:h}}(e,n);return c.createElement("div",{className:"p-1"},c.createElement("div",{className:`relative min-h-20 w-full max-w-[500px] overflow-hidden rounded-xl bg-gray-50 p-3 outline outline-offset-0 dark:bg-gray-800 ${t?"outline-blue-400":"outline-transparent"}`,"data-tweet-url":l},c.createElement(TweetContent,{key:"tweet-"+(null!=i?i:""),tweetUrl:l,tweetData:s,error:u,searchTerm:null!=i?i:void 0,handleCopy:d,handleReplace:p})))}function TweetContent({tweetUrl:e,tweetData:t,error:n,searchTerm:r,handleCopy:a,handleReplace:i}){return n?c.createElement(TweetError,{error:n,tweetUrl:e}):c.createElement(TweetCard,{tweet:t,searchTerm:r,handleCopy:a,handleReplace:i})}function TweetCard({tweet:e,searchTerm:t,handleCopy:n,handleReplace:r}){var a,i;let l=e?new Date(e.created_at):new Date,o=null!=(i=null==(a=null==e?void 0:e.user)?void 0:a.profile_image_url_https)?i:"",s=[guessLargerTwitterProfileImage(o),o].filter(notEmpty);return c.createElement("div",{className:"flex w-full select-none space-x-4 overflow-hidden text-sm"},e?c.createElement(ImageFallback,{className:"h-12 w-12 rounded-full",sources:s,alt:e.user.name}):c.createElement("img",{className:"h-12 w-12 rounded-full bg-bluegray-200 dark:bg-bluegray-600"}),c.createElement("div",{className:"flex flex-1 flex-col items-stretch overflow-hidden"},c.createElement("div",{className:"flex items-center justify-between space-x-1 overflow-hidden"},c.createElement("div",{className:"inline-flex min-w-0 flex-1 items-center space-x-2 overflow-hidden"},e?c.createElement(c.Fragment,null,c.createElement(TweetLink,{className:"shrink overflow-hidden",href:getUserUrl(e.user.screen_name)},c.createElement("span",{className:"inline-block w-full overflow-hidden truncate align-top font-semibold text-coolgray-800 hover:underline dark:text-near-white"},c.createElement(TweetText,{searchTerm:t},e.user.name))),c.createElement(TweetLink,{className:"shrink overflow-hidden",href:getUserUrl(e.user.screen_name)},c.createElement("span",{className:"inline-block w-full overflow-hidden truncate align-top text-coolgray-500"},c.createElement(TweetText,{searchTerm:t},"@",e.user.screen_name))),c.createElement(TweetLink,{className:"shrink-0 overflow-hidden",href:getTweetUrl(e)},c.createElement("time",{className:"inline-block w-full overflow-hidden whitespace-nowrap align-top text-coolgray-500 hover:underline",dateTime:l.toISOString()},formatLocalDate(l)))):c.createElement("span",{className:"w-full max-w-[270px] bg-bluegray-200 dark:bg-bluegray-600"},c.createElement("br",null))),c.createElement(TweetMenu,{handleCopy:n,handleReplace:r})),c.createElement("div",{className:"mt-1"},e?c.createElement(TweetBody,{tweet:e,searchTerm:t}):c.createElement("div",{className:"w-full max-w-[270px] bg-bluegray-200 dark:bg-bluegray-600"},c.createElement("br",null))),c.createElement(TweetMedia,{tweet:e})))}function TweetError({error:e,tweetUrl:t}){return(0,c.useEffect)(()=>{console.error("Failed to load tweet:",e)},[e]),c.createElement("div",{className:"flex min-h-16 items-center justify-center space-x-4"},c.createElement("p",null,"Failed to load tweet"," ",c.createElement("a",{href:t,target:"_blank",rel:"noreferrer"},t)))}var TweetMenu=({handleCopy:e,handleReplace:t})=>c.createElement(t$,{as:TweetMenuIcon,label:"Edit",className:"flex h-7 w-7 items-center justify-center rounded-sm outline-none transition hover:bg-black/10 hover:dark:bg-white/10"},c.createElement(t_,{label:"Copy link",onClick:e}),c.createElement(t_,{label:"Transform to plain link",onClick:t}));function TweetMenuIcon(){return c.createElement(em.T,{className:"h-5 w-5","aria-hidden":"true"})}function guessLargerTwitterProfileImage(e){if(!e||!isImageFileName(e))return null;let t=e.replace(/_normal(\.[a-z]+)$/i,"_x96$1");return t===e?null:t}var np=class extends m.QR{constructor(){super(...arguments),this.ReactComponent=TweetPreview}get name(){return"tweet"}createTags(){return[h.eX.Block]}createNodeSpec(e){return{attrs:(0,l.EZ)((0,l.ih)({},e.defaults()),{url:{default:null},tweetData:{default:null}}),selectable:!0,draggable:!0,atom:!0,content:"",parseDOM:[{tag:'a[href^="https://twitter.com/"][href*="/status/"][data-preview="1"]',priority:h.xV.High,getAttrs:t=>{let n=t.getAttribute("href");return(0,l.EZ)((0,l.ih)({},e.parse(t)),{url:n})},getContent:()=>B.HY.empty},{tag:'div[data-tweet-url^="https://twitter.com/"]',priority:h.xV.High,getAttrs:t=>{let n=t.getAttribute("data-tweet-url");return(0,l.EZ)((0,l.ih)({},e.parse(t)),{url:n})},getContent:()=>B.HY.empty}],toDOM:e=>{let t=e.attrs;return["div",function(e){let{tweetData:t,url:n}=e;return["div",{class:"p-1"},["div",{class:"relative min-h-20 w-full max-w-[500px] overflow-hidden rounded-xl bg-gray-50 p-3 outline outline-offset-0 dark:bg-gray-800 outline-transparent","data-tweet-url":n},t?function(e){var t,n,r,a,i,l,o,c,u,d,p,m,h,f,g,k,v;let y=e?new Date(e.created_at):new Date;return["div",{class:"flex w-full select-none space-x-4 overflow-hidden text-sm"},["img",{class:"h-12 w-12 rounded-full",src:null!=(g=guessLargerTwitterProfileImage(f=null!=(n=null==(t=null==e?void 0:e.user)?void 0:t.profile_image_url_https)?n:""))?g:f,alt:null!=(a=null==(r=null==e?void 0:e.user)?void 0:r.name)?a:""}],["div",{class:"flex flex-1 flex-col items-stretch overflow-hidden"},["div",{class:"flex items-center justify-between space-x-1 overflow-hidden"},["div",{class:"inline-flex min-w-0 flex-1 items-center space-x-2 overflow-hidden"},["a",{target:"_blank",rel:"noopener noreferrer",href:getUserUrl(null!=(l=null==(i=null==e?void 0:e.user)?void 0:i.screen_name)?l:""),class:"shrink overflow-hidden"},["span",{class:"inline-block w-full overflow-hidden truncate align-top font-semibold text-coolgray-800 hover:underline dark:text-near-white"},null!=(c=null==(o=null==e?void 0:e.user)?void 0:o.name)?c:""]],["a",{target:"_blank",rel:"noopener noreferrer",href:getUserUrl(null!=(d=null==(u=null==e?void 0:e.user)?void 0:u.screen_name)?d:""),class:"shrink overflow-hidden"},["span",{class:"inline-block w-full overflow-hidden truncate align-top text-coolgray-500"},"@"+(null!=(m=null==(p=null==e?void 0:e.user)?void 0:p.screen_name)?m:"")]],["a",{target:"_blank",rel:"noopener noreferrer",className:"shrink-0 overflow-hidden",href:e?getTweetUrl(e):""},["time",{class:"inline-block w-full overflow-hidden whitespace-nowrap align-top text-coolgray-500 hover:underline"},formatLocalDate(y)]]]],["div",{class:"mt-1"},["div",{class:"w-full"},null!=(h=null==e?void 0:e.text)?h:""]],(null==(k=null==e?void 0:e.mediaDetails)?void 0:k.length)?["div",{class:(0,s.Z)("mt-3 inline-grid overflow-hidden rounded-xl border border-gray-300 drop-shadow-sm dark:border-gray-500",1===e.mediaDetails.length?"grid-cols-1":"grid-cols-2")},...(null!=(v=e.mediaDetails)?v:[]).map(createStaticTweetMediaDetail)]:["div",{class:"hidden"}]]]}(t):["div",{class:"flex min-h-16 items-center justify-center space-x-4"},["a",{href:n},n]]]]}(t)]},leafText:e=>{let t=e.attrs;return getTextFromTweetAttrs(t)}}}createPasteRules(){return[{type:"node",nodeType:this.store.schema.nodes.tweet,regexp:a.W2,getAttributes:e=>{var t,n;let r=`https://twitter.com/${null==(t=e.groups)?void 0:t.user_id}/status/${null==(n=e.groups)?void 0:n.tweet_id}`;return{url:r,"data-preview":"1"}},getContent:()=>{}}]}insertTweet({url:e}){return({tr:t,dispatch:n})=>{let{from:r,to:a}=(0,C.b0)(t.selection,t.doc),i=this.type.create({url:e});return null==n||n(t.replaceRangeWith(r,a,i)),!0}}replaceTweetToLink({pos:e}){return({tr:t,dispatch:n})=>{let r=t.doc.nodeAt(e);if((null==r?void 0:r.type)!==this.type)return!1;let{url:a}=r.attrs,i=this.store.schema;return t.replaceRangeWith(e,e+r.nodeSize,i.nodes.paragraph.createChecked(null,[i.text(a,[i.marks.link.create({href:a})])])),null==n||n(t),!0}}};(0,l.u2)([(0,m.WDe)()],np.prototype,"insertTweet",1),(0,l.u2)([(0,m.WDe)()],np.prototype,"replaceTweetToLink",1),np=(0,l.u2)([(0,m.AOx)({})],np);var nm=[{regexp:/<-/,replace:"←"},{regexp:/->/,replace:"→"},{regexp:/\(c\)/,replace:"\xa9"},{regexp:/\(r\)/,replace:"\xae"},{regexp:/1\/2/,replace:"\xbd"},{regexp:/\+\/-$/,replace:"\xb1"},{regexp:/!=/,replace:"≠"},{regexp:/<</,replace:"\xab"},{regexp:/>>/,replace:"\xbb"},{regexp:/--/,replace:"—"}],nh=class extends m.nNj{get name(){return"typography"}createInputRules(){return nm.map(e=>(0,C.TY)({regexp:RegExp(`(${e.regexp.source})[\\s]$`),transformMatch:([t])=>t?e.replace+" ":null}))}};nh=(0,l.u2)([(0,m.AOx)({})],nh);var nf=class extends eB.A{createMarkSpec(e,t){let n=super.createMarkSpec(e,t);return(0,l.ih)({},n)}},ng=class extends m.nNj{get name(){return"reflectVirtualCursor"}createExternalPlugins(){return this.options.enabled?[(0,eP.K)()]:[]}onSetOptions(e){e.changes.enabled.changed&&this.store.updateExtensionPlugins(this)}};ng=(0,l.u2)([(0,m.AOx)({defaultOptions:{enabled:!1}})],ng);var nk=new Set([a.MM,a.OE]),nv=class extends m.nNj{get name(){return"reflectVirtualSelection"}createDecorations(e){var t;let{selection:n,doc:r}=e;if(((0,C.hT)(n)||(0,C.d7)(n))&&!n.empty){let{from:e,to:a}=n,i=[];return r.nodesBetween(e,a,(e,t)=>{nk.has(e.type.name)&&i.push(ea.p.node(t,t+e.nodeSize,{class:"ProseMirror-selectednode"}))}),(null==(t=this.store.view)?void 0:t.hasFocus())||i.push(ea.p.inline(e,a,{class:"virtual-selection"})),ea.EH.create(r,i)}return ea.EH.empty}createPlugin(){return{props:{handleDOMEvents:{blur:e=>(e.dispatch(e.state.tr.setMeta("virtual-selection",!1)),!1)}}}}},ny=class extends m.nNj{constructor(){super(...arguments),this.yjsDoc=new eR.Doc}get name(){return"yjs"}createExternalPlugins(){let{yjsDoc:e,yjsOnUpdate:t}=this.options;if(e){let t=eR.encodeStateAsUpdate(e);eR.applyUpdate(this.yjsDoc,t)}this.yjsDoc.on("update",e=>{null==t||t({update:e,doc:this.yjsDoc})});let n=this.yjsDoc.getXmlFragment("prosemirror");return[(0,eH.Z)(n)]}yjsApplyUpdates(e){return()=>{let t=eR.mergeUpdates(e);return eR.applyUpdate(this.yjsDoc,t),!0}}};function buildExtensions({onFileUpload:e=defaultFileUploadHandler,onTagClick:t,onBacklinkOpen:n,onBacklinkHover:r,onBacklinkAdd:i,onTagAdd:o,onImageClick:s,onCheckboxChange:c,graphId:u,isTagSelectable:d,isBacklinkSelectable:p,yjsDoc:w,yjsOnUpdate:x,subjectRequired:E=!0,inline:C=!1,virtualCursorEnabled:T=!1,doubleSpaceEnabled:L=!1}){let S={onTagAdd:o,onBacklinkAdd:i?e=>(0,l.EZ)((0,l.ih)({},e),{id:e.id||a.S5,graphId:e.graphId||a.S5}):void 0};return[w?new ny({yjsDoc:null!=w?w:null,yjsOnUpdate:null!=x?x:null}):null,new tF,new tH,new g.i,new nu,new tJ,new ns,new nv,new ne,new tl,new tq({markdown:S,onBacklinkAdd:i}),new tD({enabled:L}),new t6,new tO,new v.V,new tj,function(){let e=new tG({autoLink:!1,autoLinkRegex:tk});return e.addHandler("onClick",(e,t)=>{let n=urlToHref(t.href);try{window.open(n,"_blank")}catch(e){console.error(`failed to open URL ${n}:`,e),window.alert(`Sorry, we couldn't open that link: ${n}`)}return!0}),e}(),new y.Q,new te,new tn,function(e){let{data:t}=e,n=(0,l.S0)(e,["data"]);for(let e of t){var r;e.emoticon&&(r=e.emoticon,/[\da-z]/i.test(r))&&delete e.emoticon}return new es.x((0,l.EZ)((0,l.ih)({},n),{data:t}))}({plainText:!0,data:tZ}),new nh,new t1,new t0({enableSpine:!0}),new t5({enableCollapsible:!0,priority:eY}),new tQ({extraAttributes:{guid:{default:()=>guid(),parseDOM:e=>e.getAttribute("data-guid")||guid(),toDOM:e=>e.guid},archived:{default:!0,parseDOM:()=>!1}},onCheckboxChange:c}),new k.u,new tK({enableResizing:!0,uploadImageHandler:async(t,n)=>{let{src:r}=await e(t,n);return Promise.resolve({src:r,fileName:t.name})},onClick:s}),new b.b9,new np,function({uploadHandler:e}){return new e0({render:AttachmentView,uploadFileHandler:()=>{let t;return{insert:e=>(t=e,{url:void 0,fileName:e.name,fileType:e.type,fileSize:e.size}),upload:n=>e(t,e=>{n.set(a.Lr,e)}),abort:()=>{}}}})}({uploadHandler:async(t,n)=>{let{src:r}=await e(t,n);return Promise.resolve({url:r,fileName:t.name,fileType:t.type,fileSize:t.size})}}),new tV({enableResizing:!0}),new t7,new t3({priority:eY,extraAttributes:{guid:{default:()=>guid(),parseDOM:e=>e.getAttribute("data-guid")||guid(),toDOM:e=>e.guid}},onCheckboxChange:c}),new t2,function({onTagClick:e,graphId:t,isTagSelectable:n}){let r=new ni({graphId:t,onClick:e,selectable:n});return r}({onTagClick:t,graphId:u,isTagSelectable:d}),function({onBacklinkOpen:e,onBacklinkHover:t,graphId:n,isBacklinkSelectable:r}){let a=new e9({appendText:"",graphId:n,onOpen:e,onHover:t,selectable:r});return a}({onBacklinkOpen:n,onBacklinkHover:r,graphId:u,isBacklinkSelectable:p}),new nn,new na,new f.l({markOverride:{excludes:""}}),new tt,new nr,new nf,new tY,new th,new no,new m.i8b,new m.orf({shortcuts:(0,l.EZ)((0,l.ih)({},m.klI),{[h.vO.OrderedList]:"",[h.vO.BulletList]:"",[h.vO.TaskList]:"",[h.vO.Strike]:"Mod-shift-x"})}),new tx({markdown:S,onBacklinkAdd:i}),new t8,new nt,function({subjectRequired:e,inline:t}){return new tM({content:function({subjectRequired:e,inline:t}){return t?"paragraph":e?"heading block+":"block+"}({subjectRequired:e,inline:t})})}({subjectRequired:E,inline:C}),new nl,new ng({enabled:T}),new tE({priority:h.xV.Lowest})].filter(notEmpty)}(0,l.u2)([(0,m.WDe)()],ny.prototype,"yjsApplyUpdates",1),ny=(0,l.u2)([(0,m.AOx)({defaultOptions:{yjsDoc:null,yjsOnUpdate:null},defaultPriority:h.xV.High})],ny);var DoubleSpaceConfigurer=({enabled:e})=>((0,o.Ml)(tD,{enabled:null===e?C.NZ.isIos:e}),null),handleEscape=({state:e,tr:t,dispatch:n})=>!e.selection.empty&&(null==n||n(t.setSelection(W.Bs.near(e.selection.$head))),!0),NavigationExtension=e=>{let{onNavigatePrevious:t,onNavigateNext:n}=e,r=(0,u.Z)((e,r)=>{let{tr:a}=r,i=a.selection.$from;return"up"==e&&function(e){let t=e.doc,n=W.Bs.near(t.resolve(0));return e.pos<=n.from}(i)?(null==t||t(),!0):!!("down"==e&&function(e){let t=e.doc,n=W.Bs.near(t.resolve(t.content.size));return e.pos>=n.to}(i))&&(null==n||n(),!0)}),a=(0,u.Z)(e=>r("up",e)),i=(0,u.Z)(e=>r("down",e));return(0,eF.og)("ArrowUp",a,h.xV.Low),(0,eF.og)("ArrowDown",i,h.xV.Low),(0,eF.og)("Escape",handleEscape,h.xV.Low),null},TransactionFilterConfigurer=e=>((0,o.Ml)(ns,{filterTransaction:e.filterTransaction}),null),VirtualCursorConfigurer=({enabled:e})=>((0,o.Ml)(ng,{enabled:e}),null),nb=(0,eO.J)(buildExtensions({})).schema;function yjsMigrateVersion({yjsDoc:e,version:t}){let n=new eR.Doc;eR.applyUpdate(n,eR.encodeStateAsUpdate(e));let r=[];n.on("update",e=>{r.push(e)}),(0,a.w2)({yjsDoc:n,version:t});let i=eR.mergeUpdates(r);return i}function useIsTyping(){let[e,t]=(0,c.useState)(!1),n=(0,c.useMemo)(()=>(0,eZ.Z)(t,500),[]);(0,c.useEffect)(()=>()=>n.cancel(),[n]);let r=(0,c.useCallback)(()=>{t(!0),n(!1)},[n]);return(0,eF.xN)("keypress",r),{isTyping:e}}var DefaultEditor=({spellCheck:e})=>{let{getRootProps:t}=(0,o.rj)(),n=t(),r=function(e){let{isTyping:t}=useIsTyping();return e&&!t}(e);return c.createElement("div",(0,l.ih)({className:"reflect-editor",spellCheck:r,autoCapitalize:"off"},n))};function useFocusEditor(){let{commands:e,view:t}=(0,o.rj)(),n=(0,c.useCallback)(({selected:n,scrollSelectedIntoView:r})=>{if(t.isDestroyed)return;let focus=(n=!0)=>{n&&(!0!==n&&e.selectText(n),t.hasFocus()||t.focus(),r&&t.dispatch(t.state.tr.scrollIntoView()))};if(n&&"object"==typeof n){let e=n.anchor||0,t=n.head||0;focus({anchor:e,head:t});return}switch(n){case"start":focus("start");break;case"end":focus("end");break;case"list_start":(()=>{let e=function(e){let t=(0,C.N2)({node:e,predicate:({node:e})=>e.type.name===a.l1}),n=t.shift();if(n)return n.pos+n.node.nodeSize-2}(t.state.doc);focus(null!=e?e:"end")})();break;case"list_end":(()=>{let e=getEndOfLastListPosition(t.state.doc);focus(null!=e?e:"end")})();break;case"subject_end":(()=>{let e=getEndOfSubjectPosition(t.state.doc);focus(null!=e?e:"start")})();break;case!0:focus(!0)}},[e,t]);return n}var EditorFocusing=({selected:e,scrollSelectedIntoView:t})=>{let n=useFocusEditor();return(0,c.useEffect)(()=>{setTimeout(()=>{setTimeout(()=>{n({selected:e,scrollSelectedIntoView:t})})})},[n,t,e]),null},nw=(0,c.forwardRef)(function({setPrediction:e},t){let n=(0,o.rj)(),r=useFocusEditor();return(0,c.useImperativeHandle)(t,()=>({yjsApplyUpdates:e=>{n.commands.yjsApplyUpdates(e)},getNode:()=>n.getState().doc,uploadImages:e=>{n.commands.uploadImages(e)},getSelectionPositions:()=>{let{anchor:e,head:t}=n.view.state.selection;return{anchor:e,head:t}},getSelectionCoords:()=>{let{view:e}=n;return e.coordsAtPos(e.state.selection.from)},getSelectionText:e=>getSliceText(n.view.state.selection.content(),e),getPriorSelectionText:(e,t)=>{let r=n.view.state;return getPriorSelectionText(r.selection,e,t)},focus:(e,t=!1)=>{r({selected:null==e||e,scrollSelectedIntoView:t})},focusEnd:()=>{let{view:e}=n,{tr:t}=n.getState(),r=function(e){let t=W.Bs.atEnd(e),n=getEndOfLastListPosition(e);if(void 0!==n){let r=(0,C.JO)({doc:e,from:n,to:t.from});if(0===r.length)return W.Bs.near(e.resolve(n),-1)}return t}(e.state.doc);t.setSelection(r),t.scrollIntoView(),e.dispatch(t),e.focus()},blur:()=>{var e;n.commands.blur();let t=document.activeElement;null==(e=null==t?void 0:t.blur)||e.call(t)},insertText:(e,t)=>{n.commands.insertTextAt(e,t)},replaceText:e=>{let{commands:t}=n;t.replaceText({content:e})},insertBacklink:e=>{let{commands:t}=n;t.insertBacklink(e)},turnToBulletList:()=>{let{commands:e}=n;e.wrapInList({kind:"bullet",archived:!1})},turnToTaskList:()=>{let{commands:e}=n;e.wrapInList({kind:"task",archived:!1})},canIndentListItem:()=>{let{view:e}=n;return(0,A.RI)()(e.state)},canDedentListItem:()=>{let{view:e}=n;return(0,A.xH)()(e.state)},indentListItem:()=>{let{view:e}=n;return(0,A.RI)()(e.state,e.dispatch.bind(e))},dedentListItem:()=>{let{view:e}=n;return(0,A.xH)()(e.state,e.dispatch.bind(e))},canMoveUpListItem:()=>{let{view:e}=n;return(0,A.C$)("up")(e.state)},canMoveDownListItem:()=>{let{view:e}=n;return(0,A.C$)("down")(e.state)},moveUpListItem:()=>{let{view:e}=n;return(0,A.C$)("up")(e.state,e.dispatch.bind(e))},moveDownListItem:()=>{let{view:e}=n;return(0,A.C$)("down")(e.state,e.dispatch.bind(e))},search:e=>n.helpers.search(e),stopSearch:()=>n.commands.stopSearch(),togglePrediction:()=>{e(e=>!e)},hasFocus:()=>{let{view:e}=n;return e.hasFocus()},obfuscateCurrentState:()=>{let{view:e}=n;return function(e){try{let t=e.toJSON();return t.doc=obfuscateDocument(t.doc),t.debugInfo={anchor:e.selection.$anchor.toString(),head:e.selection.$head.toString(),nodeSize:e.doc.nodeSize},t}catch(e){console.error("failed to obfuscate state:",e)}return null}(e.state)},getRanges:()=>{let{view:e}=n;return[...e.state.selection.ranges]},getChain:()=>n.chain})),null}),EffectComponent=({searchTerm:e})=>(!function(e){let{startSearch:t,stopSearch:n}=(0,o.xd)();e=e||null,(0,c.useEffect)(()=>{e?t({searchTerm:e,activeIndex:null}):n()},[e,t,n])}(e),null),nx=class extends c.Component{constructor(e){super(e),this.state={}}static getDerivedStateFromError(e){if(e instanceof tC)return{error:e};throw e}componentDidCatch(e,t){console.error(`[reflect-editor] catch error: ${e} ${t.componentStack}`)}render(){return this.state.error?c.createElement(ErrorBoundaryFallback,{error:this.state.error}):this.props.children}},ErrorBoundaryFallback=({error:e})=>c.createElement(i.$S,{dark:!0,className:"p-4"},c.createElement("h1",{className:"mb-4 text-xl"},"Sorry, something went wrong!"),c.createElement("h2",{className:"text-sm","data-testid":"reflect-editor-error-boundary-message"},e.message)),nE="__create__";function getCoordsFromEditor(e,t){try{return e.coordsAtPos(t)}catch(e){console.warn(`failed to get corrds from position ${t}:`,e)}return{top:0,left:0,right:0,bottom:0}}function queryFloatingBoundary(e,t){let n=e.dom;if(t&&n){let e=n.closest(t);if(e)return e}return n}var nC=null;function parseSize(e){return e&&e.endsWith("px")?Number.parseInt(e,10):0}function getSafeArea(){return null===nC&&(nC=function(){let e=window.getComputedStyle(document.documentElement),t=e.getPropertyValue("--reflect-editor-safe-area-inset-top"),n=e.getPropertyValue("--reflect-editor-safe-area-inset-bottom");return{top:parseSize(t),bottom:parseSize(n)}}()),nC}function calcSafeBoundaryRect(e){let{x:t,y:n,width:r,height:a}=e.getBoundingClientRect(),i=getSafeArea().top,l=e.ownerDocument.body.getBoundingClientRect().height-getSafeArea().bottom,o=n<i&&a>i?i-n:0;return n=n+=o,a-=o,o=n+a>l&&n<l?n+a-l:0,{x:t,y:n,width:r,height:a-=o}}function useMenuFloating(e,t,n,r){let a=useEditorView(),i=queryFloatingBoundary(a,r),l=calcSafeBoundaryRect(i),{x:o,y:s,strategy:u,update:d,refs:p}=(0,eh.YF)({open:e&&t>0,placement:"bottom-start",middleware:[(0,ef.cv)(10),(0,ef.RR)({fallbackPlacements:["bottom","bottom-end","top-start","top","top-end"],boundary:l}),(0,ef.dp)({apply({availableHeight:e,elements:t}){Object.assign(t.floating.style,{maxHeight:`${e}px`})},boundary:l,padding:10}),(0,ef.uY)({boundary:l,padding:10,mainAxis:!0,crossAxis:!0})]});return(0,c.useLayoutEffect)(()=>{e&&t>0?p.setReference(function(e,t){let{top:n,left:r,right:a,bottom:i}=getCoordsFromEditor(e,t);return{getBoundingClientRect:()=>({x:r,y:n,top:n,left:r,bottom:i,right:a+2,width:a-r+2,height:i-n})}}(a,t)):p.setReference(null)},[e,t,a,p,n]),(0,c.useEffect)(()=>{d()},[n,d]),{ref:p.setFloating,style:{left:o||"",top:s||"",position:u,maxWidth:"calc(100% - 20px)"}}}function useBeforeKeymaps(e,t=eQ){let n=(0,c.useMemo)(()=>[t,e],[t,e]);(0,o.T6)(tJ,"keymap",n)}function indexFromArrowPress({direction:e,matchLength:t,previousIndex:n,startNegative:r=!1}){let a=r?-1:0;return"next"===e?n+1>t-1?a:n+1:n-1<a?t-1:n-1}var nT=["Escape","Shift-Tab"],nL=["Enter","Tab"],nS=["Mod-Enter"];function useMenuNavigation(e){let{items:t,direction:n="vertical",isOpen:r,onDismiss:a,onSubmit:i,onModSubmit:s,focusOnClick:d=!0,dismissKeys:p=nT,submitKeys:m=nL,modSubmitKeys:h=nS}=e,f=t.length>0?0:-1,[g,k]=(0,c.useState)(f),v=(0,c.useCallback)(()=>k(f),[f]),{focus:y}=(0,o.xd)(),b="vertical"===n?"ArrowDown":"ArrowRight",w="vertical"===n?"ArrowUp":"ArrowLeft",x=(0,c.useMemo)(()=>g>-1?[g]:[],[g]),{getMenuProps:E,getItemProps:T,hoveredIndex:L,itemIsSelected:S,indexIsSelected:I,indexIsHovered:N,itemIsHovered:M}=(0,ej.kY)({items:t,isOpen:r,highlightedIndexes:x,type:ej.Dy.ControlledMenu}),D=(0,u.Z)(()=>!!r&&(0!==g&&k(-1),!0)),A=(0,u.Z)(()=>!!r&&(g===t.length-1&&k(t.length-1),!0)),B=(0,u.Z)(()=>!!r&&(k(indexFromArrowPress({direction:"next",matchLength:t.length,previousIndex:g,startNegative:!0})),!0)),P=(0,u.Z)(()=>!!r&&(k(indexFromArrowPress({direction:"previous",matchLength:t.length,previousIndex:g,startNegative:!0})),!0)),H=(0,u.Z)(()=>{let e=t[g]||null;return!!r&&!!e&&i(e,"keyPress")}),R=(0,u.Z)(()=>{var e;let n=t[g]||null;return!!r&&!!n&&null!=(e=null==s?void 0:s(n))&&e}),F=(0,u.Z)(()=>!!r&&a()),Z=(0,u.Z)(e=>(0,l.ih)({},T((0,l.EZ)((0,l.ih)({},e),{onClick:t=>{var n;null==(n=e.onClick)||n.call(e,t),i(e.item,"click"),d&&y()}})))),O=(0,c.useMemo)(()=>{let e={};for(let t of m)e[t]=H;return e},[H,m]),j=(0,c.useMemo)(()=>{let e={};for(let t of h)e[t]=R;return e},[R,h]),_=(0,c.useMemo)(()=>{let e={};for(let t of p)e[t]=F;return e},[F,p]),z=(0,c.useMemo)(()=>{let e={[b]:B,[w]:P,Home:D,[`Cmd-${b}`]:D,End:B,[`Cmd-${w}`]:A};return C.NZ.isMac&&(e["Ctrl-n"]=B,e["Ctrl-p"]=P),e},[A,D,B,b,P,w]);return useBeforeKeymaps(z),useBeforeKeymaps(O),useBeforeKeymaps(j),useBeforeKeymaps(_),(0,c.useMemo)(()=>({getMenuProps:E,getItemProps:Z,hoveredIndex:L,indexIsSelected:I,itemIsSelected:S,indexIsHovered:N,itemIsHovered:M,index:g,setIndex:k,resetIndex:v}),[Z,E,L,N,I,M,S,g,v])}function useMouseActivate(e=[]){let[t,n]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{n(!1);let onMouseMove=()=>n(!0);return document.addEventListener("mousemove",onMouseMove),()=>{document.removeEventListener("mousemove",onMouseMove)}},[]),t}function useDimensions(e){let[t,n]=(0,c.useState)({width:0,height:0}),r=function(e,t){let n=(0,c.useRef)(null),r=(0,c.useRef)({width:0,height:0}),a=n.current;return(0,c.useEffect)(()=>{if(!a)return;let updateDimensions=({width:t,height:n})=>{let a={width:t,height:n};(0,eA.Z)(a,r.current)||null==e||e(a)};if("undefined"==typeof ResizeObserver){updateDimensions(a.getBoundingClientRect());return}let t=new ResizeObserver(([e])=>{updateDimensions(e.contentRect)});return t.observe(a),()=>{t.disconnect()}},[a,e,...null!=t?t:[]]),n}(n,e);return[r,t]}var Marquee=({children:e,active:t=!0,speed:n=20,hoverToPause:r=!0})=>{let[a,i]=useDimensions([t]),[l,o]=useDimensions([t]),u=Math.ceil(o.width-i.width);return c.createElement("div",{ref:a,className:(0,s.Z)("marquee",t&&"marquee-active",r&&"marquee-hover-pause")},c.createElement("div",{ref:l,className:"marquee-inner",style:{"--marquee-play":t?"running":"paused","--marquee-duration":`${u/n}s`,"--marquee-offset":`-${u}px`}},e))};function useScrollIntoSelected(e){let t=(0,c.useRef)(null);return(0,c.useEffect)(()=>{if(e){let n=setTimeout(()=>{var n;e&&(null==(n=t.current)||n.scrollIntoView({block:"nearest",behavior:"smooth"}))},0);return()=>clearTimeout(n)}},[e]),t}var PlaceholderImage=({src:e,className:t,children:n})=>{let[r,a]=(0,c.useState)(!1);if(e){let t=new Image;t.addEventListener("load",()=>a(!0)),t.src=e}return e&&r?c.createElement("img",{src:e,className:t}):c.createElement(c.Fragment,null,n)},BacklinkPickerItem=({item:e,props:t,query:n,mouseActive:r,selected:a})=>{let i=useScrollIntoSelected(a);return c.createElement("li",(0,l.EZ)((0,l.ih)({},t),{ref:i,onPointerDown:e=>e.preventDefault(),className:(0,s.Z)(["backlink-picker-item",a&&"backlink-picker-item-highlighted",r&&"hoverable-item"]),title:e.id===nE?"Create a new backlink":e.label,"data-testid":"backlink-picker-item"}),e.id===nE?c.createElement("span",null,"Create note: ",c.createElement("em",null,n)):c.createElement(c.Fragment,null,c.createElement("div",{className:(0,s.Z)(["backlink-picker-item-preview",a&&"backlink-picker-item-preview-highlighted"])},e.previewSrc&&c.createElement(PlaceholderImage,{src:e.previewSrc})),c.createElement("div",{className:"backlink-picker-item-label"},c.createElement(Marquee,{hoverToPause:r,active:a},e.label))))},BacklinkPickerV2=e=>{var t,n,r,a,i;let s=function({onBacklinkQuery:e,onBacklinkAdd:t}){let[n,r]=(0,c.useState)(null),{createBacklink:a}=(0,o.xd)(),i=(0,c.useCallback)(async(n,r,i)=>{var l,o;let s=null!=(l=await (null==e?void 0:e(n)))?l:[],c=null!=(o=s.find(e=>e.label===n))?o:{label:n};t&&(c=await t(c)),a({range:{from:r,to:i,cursor:i}},c)},[a,e,t]),l=(0,c.useCallback)(({start:e,end:t,match:n})=>{let a=n[1];if(function(e){for(let t of e7)if(e.endsWith(t+t))return!0;return!1}(a)){let n=trimEndRightBrackets(a).trim();if(n)return r(null),i(n,e,t),!0}return r({query:trimEndRightBrackets(a),start:e,end:t}),!0},[i]),s=(0,c.useCallback)(()=>{r(null)},[]);return(0,o.zf)(e9,"onBacklinkMatchV2",l),(0,o.zf)(e9,"onBacklinkDismissV2",s),n}({onBacklinkAdd:null!=(t=e.onAdd)?t:null,onBacklinkQuery:null!=(n=e.onBacklinkQuery)?n:null}),u=null!=s&&e.editorFocused&&!e.isScrolling;return u?c.createElement(BacklinkPickerComponentV2,(0,l.EZ)((0,l.ih)({},e),{isOpen:u,query:null!=(r=null==s?void 0:s.query)?r:"",start:null!=(a=null==s?void 0:s.start)?a:0,end:null!=(i=null==s?void 0:s.end)?i:0})):null},BacklinkPickerComponentV2=({isOpen:e,query:t,start:n,end:r,onAdd:a,onBacklinkQuery:i,viewportSelector:s})=>{let[d,p]=(0,c.useState)([]),m=(0,c.useCallback)(async()=>{var e;let n=null!=(e=await (null==i?void 0:i(t)))?e:[],r=t.trim(),a=r.toLowerCase();if(a){let e=n.some(e=>e.label.toLowerCase().startsWith(a));e?n.push({id:nE,label:r}):n.unshift({id:nE,label:r})}p(n)},[i,t]);(0,c.useLayoutEffect)(()=>{if(!e){p([]);return}m()},[e,m]);let h=useMenuFloating(e,n,t,s),f=useMouseActivate([e,t]),{createBacklink:g,ignoreMatchRulePosition:k}=(0,o.xd)(),v=(0,o.Ml)(e9).options.onOpen,y=(0,c.useCallback)(e=>{if(!e)return!1;let t=e.id===nE&&e.label?{label:e.label,id:""}:e;return new Promise(async e=>{a&&(t=await a(t)),g({range:{from:n,to:r,cursor:r}},t),e(t)})},[g,r,a,n]),b=useMenuNavigation({items:d,isOpen:e,onDismiss:(0,u.Z)(()=>(k(),!0)),onSubmit:(0,u.Z)(e=>!!y(e)),onModSubmit:(0,u.Z)(e=>{let t=y(e);return!!t&&(v&&setTimeout(async()=>{let e=await t;v(null,e,{modKey:!0})}),!0)})}),{getMenuProps:w,getItemProps:x,indexIsSelected:E,resetIndex:C}=b;return((0,c.useEffect)(C,[t,C]),e)?c.createElement(ThemedFloatingPortal,null,c.createElement("ul",(0,l.EZ)((0,l.ih)({},w()),{className:"backlink-picker-menu",ref:h.ref,style:(0,l.ih)({},h.style),"data-testid":"backlink-picker"}),d.map((e,n)=>c.createElement(BacklinkPickerItem,{key:e.id,item:e,props:x({item:e,index:n,key:e.id}),query:t,mouseActive:f,selected:E(n)})))):null},CopyIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M14.25 9.5V7.75C14.25 6.64543 13.3546 5.75 12.25 5.75H7.75C6.64543 5.75 5.75 6.64543 5.75 7.75V12.25C5.75 13.3546 6.64543 14.25 7.75 14.25H9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("rect",{x:"9.75",y:"9.75",width:"8.5",height:"8.5",rx:"2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),UnlinkIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.25 4C8.66421 4 9 4.33579 9 4.75V6.25C9 6.66421 8.66421 7 8.25 7C7.83579 7 7.5 6.66421 7.5 6.25V4.75C7.5 4.33579 7.83579 4 8.25 4ZM11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L17.2595 12.7803C16.9666 13.0732 16.4917 13.0732 16.1989 12.7803C15.906 12.4874 15.906 12.0126 16.1989 11.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L12.2803 7.80115C11.9874 8.09404 11.5126 8.09404 11.2197 7.80115C10.9268 7.50825 10.9268 7.03338 11.2197 6.74049L11.7093 6.25089ZM4 8.25C4 7.83579 4.33579 7.5 4.75 7.5H6.25C6.66421 7.5 7 7.83579 7 8.25C7 8.66421 6.66421 9 6.25 9H4.75C4.33579 9 4 8.66421 4 8.25ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM7.80115 11.2197C8.09404 11.5126 8.09404 11.9874 7.80115 12.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L11.7197 16.1989C12.0126 15.906 12.4874 15.906 12.7803 16.1989C13.0732 16.4917 13.0732 16.9666 12.7803 17.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L6.74049 11.2197C7.03338 10.9268 7.50825 10.9268 7.80115 11.2197ZM17 15.75C17 15.3358 17.3358 15 17.75 15H19.25C19.6642 15 20 15.3358 20 15.75C20 16.1642 19.6642 16.5 19.25 16.5H17.75C17.3358 16.5 17 16.1642 17 15.75ZM15.75 17C16.1642 17 16.5 17.3358 16.5 17.75V19.25C16.5 19.6642 16.1642 20 15.75 20C15.3358 20 15 19.6642 15 19.25V17.75C15 17.3358 15.3358 17 15.75 17Z",fill:"currentColor"}));function useHotkeys(e,t,n){let{enabled:r=!0,ref:a,capture:i,stopPropagation:l}=null!=n?n:{},o=useEditorView();(0,c.useEffect)(()=>{if(!r)return;let n={};for(let t of e)n[t]=()=>!0;let s=(0,ex.$)(n),keyDownHandler=e=>{s(o,e)&&(e.preventDefault(),l&&e.stopPropagation(),t(e))};if(null==a||!a.current)return document.addEventListener("keydown",keyDownHandler,i),()=>document.removeEventListener("keydown",keyDownHandler,i);{let e=a.current;return e.addEventListener("keydown",keyDownHandler,i),()=>e.removeEventListener("keydown",keyDownHandler,i)}},[t,r,a,e,o,i,l])}function useIsDragging(){let[e,t]=(0,c.useState)(!1),n=(0,c.useCallback)(()=>{t(!0)},[]),r=(0,c.useCallback)(()=>{t(!1)},[]);return(0,eF.xN)("mousedown",n),(0,eF.xN)("mouseup",r),e}function useToolbarFloating({isOpen:e,viewportSelector:t,placement:n,alwaysCenter:r,onDismiss:a,enabledDismiss:i,range:u,observeElementResize:d=!1}){let{view:p}=(0,o.rj)({autoUpdate:!0}),m=queryFloatingBoundary(p,t),h=calcSafeBoundaryRect(m),f=(0,c.useMemo)(()=>({x:h.x,y:h.y,width:h.width,height:h.height}),[h.x,h.y,h.width,h.height]);if(i&&!a)throw Error("You must pass onDismiss to make dismiss work");let g=function(e){let t=(0,c.useRef)(!1);(0,c.useEffect)(()=>{setTimeout(()=>{t.current=!0},50)},[]);let n=(0,c.useMemo)(()=>{if(e)return n=>{t.current&&!n&&e()}},[e]);return n}(a),{x:k,y:v,strategy:y,context:b,refs:w}=(0,eh.YF)({open:e,placement:"viewport-bottom"===n?"bottom":n,middleware:[(0,ef.cv)(10),(0,ef.RR)({boundary:f,mainAxis:"viewport-bottom"!==n}),(0,ef.uY)({boundary:f,padding:10,mainAxis:!0,crossAxis:!0})],onOpenChange:g,whileElementsMounted:d?nI:void 0}),x=(0,eh.bQ)(b,{enabled:!!(e&&i)}),{getFloatingProps:E}=(0,eh.NI)([x]),C=p.state.selection.head,T=(0,c.useCallback)(()=>{e?"viewport-bottom"===n?w.setReference(m):w.setReference(function(e,t,n){let r=getCoordsFromEditor(e,t.anchor),a=getCoordsFromEditor(e,t.head),i=Math.min(r.left,a.left),l=Math.max(r.right,a.right),o=Math.min(r.top,a.top),s=Math.max(r.bottom,a.bottom);if(n){let t=e.dom.getBoundingClientRect();i=t.left,l=t.right}else if(Math.abs(r.top-a.top)>10){let n=Math.min(t.anchor,t.head),r=Math.max(t.anchor,t.head),a=e.domAtPos(n),o=n===r?a:e.domAtPos(r),s=document.createRange();s.setEnd(o.node,o.offset),s.setStart(a.node,a.offset);let c=s.getBoundingClientRect();c.right-c.left>l-i&&(i=c.left,l=c.right)}return{getBoundingClientRect:()=>({x:i,y:o,top:o,left:i,bottom:s,right:l,width:l-i,height:s-o})}}(p,u||p.state.selection,r)):w.setReference(null)},[r,m,e,n,u,w,p]);(0,c.useLayoutEffect)(()=>{T()},[C,T]),function({enabled:e=!0,node:t,resize:n,scroll:r,update:a}){(0,c.useEffect)(()=>{if(!e)return;let i=(0,e_.Kx)(t);return i.forEach(e=>{r&&e.addEventListener("scroll",a,{passive:!0}),n&&e.addEventListener("resize",a)}),()=>{i.forEach(e=>{r&&e.removeEventListener("scroll",a),n&&e.removeEventListener("resize",a)})}},[e,t,n,r,a])}({enabled:e,node:p.dom,resize:!0,scroll:!0,update:T});let L=(0,c.useCallback)(e=>{let t=k||v,n=null==k||null==v,r=(0,l.EZ)((0,l.ih)({},e),{style:(0,l.ih)((0,l.ih)({},{left:k||"",top:v||"",position:y,maxWidth:"calc(100% - 20px)",opacity:t?1:0}),null==e?void 0:e.style),className:(0,s.Z)(null==e?void 0:e.className,n?"toolbar-floating-hidden":"toolbar-floating-visible"),ref:w.setFloating});return E(r)},[E,w.setFloating,y,k,v]);return{getFloatingProps:L,context:b}}var nI=(r={ancestorScroll:!1,ancestorResize:!1,elementResize:!0,animationFrame:!1},(e,t,n)=>(0,eg.Me)(e,t,n,r));function isSameTextBlock(e){return e.$from.sameParent(e.$to)}var EditIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M12.75 18.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M16.75 15.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M11.4369 15.6653C10.4003 16.7018 9.09893 17.4336 7.67475 17.7808L5.75 18.25L6.21921 16.3253C6.56639 14.9011 7.2982 13.5996 8.33474 12.5631M11.4369 15.6653L17.6075 9.49462C18.4642 8.63799 18.4642 7.24911 17.6075 6.39248C16.7509 5.53584 15.362 5.53584 14.5054 6.39248L8.33474 12.5631M11.4369 15.6653L8.33474 12.5631",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),InlineLinkPreview=({url:e,onLinkMetadata:t})=>{let n=function(e,t){let[n,r]=(0,c.useState)(null),a=(0,c.useCallback)(async()=>{if(!e||!t||!/^https?:\/\//i.test(e))return;let n=await t(e);if(!n)return;let{image:a}=n,i=(0,l.S0)(n,["image"]);r(i),a&&(await cacheImage(a),r(e=>e?(0,l.EZ)((0,l.ih)({},e),{image:a}):null))},[t,e]);return(0,c.useEffect)(()=>{a()},[a]),n}(e,t);return(null==n?void 0:n.title)?c.createElement("div",{className:"flex flex-col"},c.createElement("div",{className:"flex flex-col space-y-1 p-2"},c.createElement("div",{className:"truncate text-xs font-normal text-coolgray-800 dark:text-near-white"},n.title),n.description?c.createElement("div",{className:"truncate text-xs font-light text-coolgray-800 dark:text-near-white"},n.description):null),n.image?c.createElement("a",{href:e,target:"_blank",rel:"noreferrer"},c.createElement("img",{src:n.image,alt:n.title,className:"aspect-[19/10] object-cover"})):null):null},InlineLinkTooltip=({viewportSelector:e,showLinkMenu:t,onLinkMetadata:n})=>{let[r,i]=function(){let[e,t]=(0,c.useState)(!1),n=(0,c.useRef)(null),r=(0,c.useCallback)(()=>t(!0),[]),a=(0,c.useCallback)(()=>t(!1),[]);return(0,c.useEffect)(()=>{let e=n.current;if(e)return e.addEventListener("mouseover",r),e.addEventListener("mouseout",a),()=>{e.removeEventListener("mouseover",r),e.removeEventListener("mouseout",a)}},[a,r]),[n,e]}(),[l,s]=(0,c.useState)(null),[d,p]=(0,c.useState)(!1),m=(0,u.Z)((e,{hovering:t,getMark:n})=>{var r,i,l;try{if(!t)return;let o=n(a.et);if(o&&(l=e.target)&&window.getComputedStyle(l).display.includes("inline")){s({anchor:o.from,head:o.to,href:null!=(i=null==(r=o.mark.attrs)?void 0:r.href)?i:""}),p(!0);return}p(!1)}catch(e){}});(0,eF.XI)(m);let{isTyping:h}=useIsTyping();(0,c.useEffect)(()=>{h&&p(!1)},[h]);let f=!!l,g=i||d&&f,k=function(e,t,n){let[r,a]=(0,c.useState)(t);return(0,c.useEffect)(()=>{let t=setTimeout(()=>{a(e)},n);return()=>clearTimeout(t)},[n,e]),r}(g,!1,500)&&f&&!h,{selectText:v}=(0,o.xd)(),y=(0,u.Z)(()=>{l&&(v(l),t())}),b=(0,u.Z)(()=>{let e=null==l?void 0:l.href;e&&(copyTextToClipboard(e),s(null))});return c.createElement("div",{ref:r},k?c.createElement(InlineLinkTooltipComponent,{viewportSelector:e,handleCopy:b,handleEdit:y,linkRange:l,onLinkMetadata:n}):null)},InlineLinkTooltipComponent=({viewportSelector:e,handleCopy:t,handleEdit:n,linkRange:r,onLinkMetadata:a})=>{let{getFloatingProps:i}=useToolbarFloating({isOpen:!0,viewportSelector:e,placement:"bottom",alwaysCenter:!1,range:r});return c.createElement("div",(0,l.EZ)((0,l.ih)({},i({className:"inline-floating-menu w-[320px]"})),{"data-testid":"inline-link-tooltip"}),c.createElement("div",{className:"flex w-full max-w-[400px] flex-col items-stretch divide-y divide-coolgray-900/10 dark:divide-white/20"},c.createElement("div",{className:"flex items-center divide-x divide-coolgray-900/10 overflow-hidden dark:divide-white/20"},c.createElement("div",{className:"flex-1 truncate px-3 py-1 text-sm text-coolgray-800 dark:text-near-white"},null==r?void 0:r.href),c.createElement("button",{className:"inline-flex h-8 w-10 shrink-0 cursor-pointer items-center justify-center bg-white text-2xs text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:t,title:"Copy link address"},c.createElement(CopyIcon,null)),c.createElement("button",{className:"inline-flex h-8 w-10 shrink-0 cursor-pointer items-center justify-center bg-white text-2xs text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:n,title:"Edit link"},c.createElement(EditIcon,null))),c.createElement(InlineLinkPreview,{url:null==r?void 0:r.href,onLinkMetadata:a})))},InlineLinkMenu=({isScrolling:e,viewportSelector:t,editingLink:n,setEditingLink:r,onLinkMetadata:a})=>{var i,l;let{view:s}=(0,o.rj)({autoUpdate:!0}),{selection:d}=s.state,p=d.empty,m=(0,c.useCallback)(()=>{r(!0)},[r]),h=useIsDragging(),f=isSameTextBlock(d),g=n&&!s.isDestroyed&&!e&&!h&&f,k=(0,c.useRef)(null);!function(e,t,n){let r=(0,o.rY)(),a=(0,u.Z)(()=>{if(e)return t(!1),r.focus(),!0;let{selection:n}=r.state;return!!(0,C.hT)(n)&&!n.empty&&(t(!0),!0)}),i=(0,u.Z)(e=>{let t=a();t&&(e.preventDefault(),e.stopPropagation())});useHotkeys(["mod-k"],i,{ref:n,capture:!0}),(0,eF.og)("mod-k",a)}(n,r,k);let v=null!=(l=null==(i=(0,o.l1)().link())?void 0:i.href)?l:"",y=!!v.trim();return(0,c.useEffect)(()=>{p&&!y&&r(!1)},[p,r,y]),c.createElement(ThemedFloatingPortal,null,g?c.createElement(InlineLinkMenuComponent,{setEditingLink:r,view:s,selection:d,viewportSelector:t,editingLink:n,inputRef:k,url:v}):c.createElement(InlineLinkTooltip,{viewportSelector:t,showLinkMenu:m,onLinkMetadata:a}))},InlineLinkMenuComponent=({setEditingLink:e,view:t,selection:n,viewportSelector:r,editingLink:a,inputRef:i,url:d})=>{let[p,m]=(0,c.useState)(d),h=!!d.trim();(0,c.useEffect)(()=>{m(d)},[d]);let f=n.empty,g=(0,o.wK)(),k=(0,u.Z)(e=>{m(e.target.value)}),v=(0,u.Z)(t=>{if(e(!1),""===p)g.removeLink();else{let e=urlToHref(p.trim()),t=f?(0,C.IH)(n.$from,"link"):n;g.updateLink({href:e,auto:!1},t)}g.focus().run(),t.preventDefault()}),y=(0,u.Z)(()=>{e(!1),g.removeLink().focus().run()}),b=(0,u.Z)(()=>{copyTextToClipboard(p)}),w=(0,u.Z)(()=>{e(!1),t.focus()}),{getFloatingProps:x}=useToolbarFloating({isOpen:!0,viewportSelector:r,placement:"bottom",alwaysCenter:!1,onDismiss:w,enabledDismiss:!0});return(0,c.useEffect)(()=>{if(a){let e=setTimeout(()=>{var e;null==(e=i.current)||e.focus()},0);return()=>clearTimeout(e)}},[a,i]),c.createElement("div",(0,l.EZ)((0,l.ih)({},x({className:(0,s.Z)("inline-floating-menu")})),{"data-testid":"inline-link-menu"}),c.createElement("div",{className:"flex w-[300px] flex-col divide-y divide-coolgray-900/10 dark:divide-white/20"},c.createElement("form",{onSubmit:v,className:"p-2"},c.createElement("input",{ref:i,type:"text",placeholder:"Paste link",value:p,onChange:k,className:"inline-floating-menu-input"})),h?c.createElement("button",{className:"inline-flex cursor-pointer items-center space-x-1.5 bg-white py-1 px-2 text-2xs font-medium text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:b},c.createElement(CopyIcon,{className:"text-coolgray-500"}),c.createElement("span",null,"Copy link")):null,h?c.createElement("button",{className:"inline-flex cursor-pointer items-center space-x-1.5 bg-white py-1 px-2 text-2xs font-medium text-coolgray-800 hover:bg-coolgray-100 dark:bg-app-dark-tint dark:text-coolgray-300 dark:hover:bg-white/5",onClick:y},c.createElement(UnlinkIcon,{className:"text-coolgray-500"}),c.createElement("span",null,"Remove link")):null))},AiIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M9.75 13C14 13 14 7.75 14 7.75C14 7.75 14 13 18.25 13C14 13 14 18.25 14 18.25C14 18.25 14 13 9.75 13Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M7.75 16.25H7.76",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M18.25 5.75H18.26",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M18.25 18.25H18.26",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M5.75 8C8 8 8 5.75 8 5.75C8 5.75 8 8 10.25 8C8 8 8 10.25 8 10.25C8 10.25 8 8 5.75 8Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),BoldIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M10 18C8.89543 18 8 17.1046 8 16V8C8 6.89543 8.89543 6 10 6H12.4114C13.2219 6 13.898 6.13086 14.4396 6.39258C14.9811 6.6543 15.3882 7.01758 15.6608 7.48242C15.9333 7.94336 16.0696 8.47461 16.0696 9.07617C16.0696 9.54492 15.9835 9.95703 15.8114 10.3125C15.6392 10.6641 15.4025 10.9531 15.1013 11.1797C14.8036 11.4023 14.4629 11.5605 14.0791 11.6543V11.7715C14.4987 11.791 14.8915 11.9199 15.2573 12.1582C15.6267 12.3965 15.9262 12.7305 16.1557 13.1602C16.3852 13.5859 16.5 14.0938 16.5 14.6836C16.5 15.3203 16.3547 15.8887 16.0642 16.3887C15.7773 16.8848 15.3523 17.2773 14.7892 17.5664C14.2262 17.8555 13.3916 18 12.5667 18H10ZM10 15.9258H12.3832C13.0324 15.9258 13.5058 15.791 13.8035 15.5215C14.1012 15.248 14.25 14.8848 14.25 14.4316C14.25 14.0996 14.1765 13.8066 14.0294 13.5527C13.8824 13.2988 13.6726 13.0996 13.4 12.9551C13.131 12.8105 12.81 12.7383 12.437 12.7383H10V15.9258ZM10 11.0215H12.2111C12.5303 11.0215 12.8136 10.9609 13.0611 10.8398C13.3121 10.7148 13.5094 10.5391 13.6528 10.3125C13.7999 10.0859 13.8734 9.81445 13.8734 9.49805C13.8734 9.06445 13.7318 8.71484 13.4484 8.44922C13.1687 8.18359 12.7706 8.05078 12.2541 8.05078H10V11.0215Z",fill:"currentColor"})),BulletListIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 16.25V15.75C5.75 15.1977 6.19772 14.75 6.75 14.75H7.25C7.80228 14.75 8.25 15.1977 8.25 15.75V16.25C8.25 16.8023 7.80228 17.25 7.25 17.25H6.75C6.19772 17.25 5.75 16.8023 5.75 16.25Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M5.75 8.25V7.75C5.75 7.19772 6.19772 6.75 6.75 6.75H7.25C7.80228 6.75 8.25 7.19772 8.25 7.75V8.25C8.25 8.80228 7.80228 9.25 7.25 9.25H6.75C6.19772 9.25 5.75 8.80228 5.75 8.25Z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M12.75 16.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),H2Icon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M18.25 16.25H14.75V16.1221C14.75 15.566 14.9816 15.035 15.3891 14.6566L17.3155 12.8677C17.9114 12.3144 18.25 11.538 18.25 10.7248V10.7248C18.25 10.1864 17.8136 9.75 17.2752 9.75H15.75C15.1977 9.75 14.75 10.1977 14.75 10.75V11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),H3Icon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M14.75 9.75H17.25C17.8023 9.75 18.25 10.1977 18.25 10.75V13M14.75 13H18.25M18.25 13V15.25C18.25 15.8023 17.8023 16.25 17.25 16.25H14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),ItalicIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M13.25 6.75L10.75 17.25M13.25 6.75H10.75M13.25 6.75H15.25M10.75 17.25H8.75M10.75 17.25H13.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),LinkIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L16.2595 13.7803C15.9666 14.0732 15.4917 14.0732 15.1989 13.7803C14.906 13.4874 14.906 13.0126 15.1989 12.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L11.2803 8.80115C10.9874 9.09404 10.5126 9.09404 10.2197 8.80115C9.92678 8.50825 9.92678 8.03338 10.2197 7.74049L11.7093 6.25089ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM8.80115 10.2197C9.09404 10.5126 9.09404 10.9874 8.80115 11.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L12.7197 15.1989C13.0126 14.906 13.4874 14.906 13.7803 15.1989C14.0732 15.4917 14.0732 15.9666 13.7803 16.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L7.74049 10.2197C8.03338 9.92678 8.50825 9.92678 8.80115 10.2197Z",fill:"currentColor"})),TaskListIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 7.65909L7.18182 9.25C7.81818 6.54545 9.25 5.75 9.25 5.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M5.75 16.6591L7.18182 18.25C7.81818 15.5455 9.25 14.75 9.25 14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M12.75 16.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),InlineToolbarMenuComponent=({viewportSelector:e,setEditingLink:t,setPrediction:n,predictionEnabled:r})=>{let i=function(e,t){let[n,r]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{if(e){let e=setTimeout(()=>{r(!0)},t);return()=>clearTimeout(e)}r(!1)},[e,t]),!!e&&n}(!0,150),{getFloatingProps:u}=useToolbarFloating({isOpen:i,viewportSelector:e,placement:"top",alwaysCenter:!1}),d=function({setEditingLink:e,setPrediction:t,predictionEnabled:n}){let r=(0,o.xd)(),i=(0,o.tZ)(!0),s=(0,o.sZ)().selection,u={bold:i.bold(),italic:i.italic(),link:i.link(),taskList:i.list({kind:"task"}),bulletList:i.list({kind:"bullet"}),h2:i.heading({level:2}),h3:i.heading({level:3}),heading:i.heading()},d={bold:r.toggleBold.enabled(),italic:r.toggleItalic.enabled(),link:isSameTextBlock(s),taskList:!u.heading,bulletList:!u.heading,h2:r.toggleHeading.enabled({level:2}),h3:r.toggleHeading.enabled({level:3})};return(0,c.useMemo)(()=>{let i={width:23,height:23};return[{id:"bold",label:"Bold",icon:c.createElement(BoldIcon,(0,l.ih)({},i)),active:u.bold,available:d.bold,submit:()=>r.toggleBold()},{id:"italic",label:"Italic",icon:c.createElement(ItalicIcon,(0,l.ih)({},i)),active:u.italic,available:d.italic,submit:()=>r.toggleItalic()},{id:"todo",label:"Todo List",icon:c.createElement(TaskListIcon,(0,l.ih)({},i)),active:u.taskList,available:d.taskList,submit:()=>{let e={kind:"task",archived:!1};return u.taskList?r.toggleWrappingNode(a.WQ,e):r.wrapInList(e)}},{id:"list",label:"Bullet List",icon:c.createElement(BulletListIcon,(0,l.ih)({},i)),active:u.bulletList,available:d.bulletList,submit:()=>{let e={kind:"bullet",archived:!1};return u.bulletList?r.toggleWrappingNode(a.WQ,e):r.wrapInList(e)}},{id:"h2",label:"Big header",icon:c.createElement(H2Icon,(0,l.ih)({},i)),active:u.h2,available:d.h2,submit:()=>r.toggleHeading({level:2})},{id:"h3",label:"Small header",icon:c.createElement(H3Icon,(0,l.ih)({},i)),active:u.h3,available:d.h3,submit:()=>r.toggleHeading({level:3})},{id:"link",label:"Link",icon:c.createElement(LinkIcon,(0,l.ih)({},i)),active:u.link,available:d.link,submit:()=>e(!0)},{id:"edit-with-ai",label:"Edit with AI",icon:c.createElement(AiIcon,(0,l.ih)({},i)),active:!1,available:n,submit:()=>t(!0)}]},[u.bold,u.bulletList,u.h2,u.h3,u.italic,u.link,u.taskList,d.bold,d.bulletList,d.h2,d.h3,d.italic,d.link,d.taskList,r,n,e,t])}({setEditingLink:t,setPrediction:n,predictionEnabled:r});return c.createElement("ul",(0,l.EZ)((0,l.ih)({},u({className:"inline-floating-menu"})),{"data-testid":"inline-toolbar-menu"}),d.filter(e=>e.available).map(e=>c.createElement("li",{key:e.id,className:(0,s.Z)("inline-floating-menu-item",e.active&&"inline-floating-menu-item-active"),onPointerDown:t=>{t.preventDefault(),e.submit()},title:e.label,"data-testid":`inline-toolbar-menu-item-${e.id}`},e.icon)))},InlineToolbarMenu=({editorFocused:e,isScrolling:t,subjectRequired:n,viewportSelector:r,setEditingLink:a,setPrediction:i,predictionEnabled:l})=>{let{view:s}=(0,o.rj)({autoUpdate:!0}),{selection:u}=s.state,d=useIsDragging(),p=!!n&&u.from<=getEndOfSubjectPosition(s.state.doc),m=e&&!s.isDestroyed&&!t&&!d&&!u.empty&&!p&&(0,C.hT)(u);return c.createElement(ThemedFloatingPortal,null,m?c.createElement(InlineToolbarMenuComponent,{viewportSelector:r,setEditingLink:a,setPrediction:i,predictionEnabled:l}):null)};function useIsScrolling(e){let[t,n]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{let t=null==e?void 0:e.current,r=(0,eZ.Z)(()=>{n(!1)},250),listener=()=>{n(!0),r()};return null==t||t.addEventListener("scroll",listener),()=>{null==t||t.removeEventListener("scroll",listener)}},[e]),t}function filterItemsByQuery(e){let{items:t,query:n,maxItems:r,sortByExactMatch:a}=e;if(!n)return t.slice(0,r);let l=(0,i.l9)(n).toLowerCase(),o=[];for(let e of t){let t=(0,i.l9)(e.label).toLowerCase();if(t.includes(l)){let n=t===l,r=n?1:0;o.push([e,r])}}return a&&(o=o.sort(([,e],[,t])=>t-e)),(o=(o=(0,ez.Z)(o,([e])=>e.id)).slice(0,r)).map(([e])=>e)}function SlashPickerListItem(e){var{selected:t,item:n,mouseActive:r}=e,a=(0,l.S0)(e,["selected","item","mouseActive"]);let i=useScrollIntoSelected(t);return c.createElement("li",(0,l.ih)({onPointerDown:e=>e.preventDefault(),className:(0,s.Z)("slash-picker-item",t&&"slash-picker-item-highlighted",r&&"hoverable-item"),title:n.displayLabel,"data-testid":`slash-picker-item-${n.id}`,ref:i},a),c.createElement("div",{className:"slash-picker-item-icon"},n.icon),c.createElement("div",{className:"slash-picker-item-label"},n.displayLabel))}var BacklinkIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M9.25 5.75H6.75C6.19772 5.75 5.75 6.19772 5.75 6.75V17.25C5.75 17.8023 6.19772 18.25 6.75 18.25H9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M14.75 5.75H17.25C17.8023 5.75 18.25 6.19772 18.25 6.75V17.25C18.25 17.8023 17.8023 18.25 17.25 18.25H14.75",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),ClockIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6.5C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12C17.5 8.96243 15.0376 6.5 12 6.5ZM5 12C5 8.13401 8.13401 5 12 5C15.866 5 19 8.13401 19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 8C12.4142 8 12.75 8.33579 12.75 8.75V11.6893L13.7803 12.7197C14.0732 13.0126 14.0732 13.4874 13.7803 13.7803C13.4874 14.0732 13.0126 14.0732 12.7197 13.7803L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8.75C11.25 8.33579 11.5858 8 12 8Z",fill:"currentColor"})),H1Icon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 7.75V12.25M5.75 16.25V12.25M11.25 7.75V12.25M11.25 16.25V12.25M5.75 12.25H11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M14.75 11.25L16.25 9.75V16.25M16.25 16.25H14.75M16.25 16.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),OrderedListIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M12.75 7.75H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M12.75 16.25H18.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M6.75 6.875L7.75 5.75V9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M6.75 14.75H8.27841C8.68509 14.75 8.92165 15.2097 8.68527 15.5406L7.31473 17.4594C7.07835 17.7903 7.31491 18.25 7.72159 18.25H9.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),QuoteIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M6.75 14.5V11.75C6.75 11.75 6.75 12.75 8 12.75H8.5C9.4665 12.75 10.25 13.5335 10.25 14.5C10.25 15.4665 9.4665 16.25 8.5 16.25C7.5335 16.25 6.75 15.4665 6.75 14.5Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M13.75 14.5V11.75C13.75 11.75 13.75 12.75 15 12.75H15.5C16.4665 12.75 17.25 13.5335 17.25 14.5C17.25 15.4665 16.4665 16.25 15.5 16.25C14.5335 16.25 13.75 15.4665 13.75 14.5Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M6.75 11.75V11.75C6.75 10.0931 8.09315 8.75 9.75 8.75H10.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M13.75 11.75V11.75C13.75 10.0931 15.0931 8.75 16.75 8.75H17.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),TemplateIcon=e=>c.createElement("svg",(0,l.ih)({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),c.createElement("path",{d:"M5.75 9.25V7.75C5.75 6.64543 6.64543 5.75 7.75 5.75H16.25C17.3546 5.75 18.25 6.64543 18.25 7.75V9.25M5.75 9.25V16.25C5.75 17.3546 6.64543 18.25 7.75 18.25H11.25M5.75 9.25H18.25M18.25 9.25V11.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),c.createElement("path",{d:"M14.75 17C17 17 17 14.75 17 14.75C17 14.75 17 17 19.25 17C17 17 17 19.25 17 19.25C17 19.25 17 17 14.75 17Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})),SlashPicker=({scrollingNode:e,editorFocused:t,viewportSelector:n,templates:r,timeFormat:a,predictionEnabled:i,setPrediction:s})=>{var d;let p=function({templates:e,timeFormat:t,predictionEnabled:n,setPrediction:r}){let{commands:a}=(0,o.rj)(),i=(0,o.tZ)(!0),l={heading:i.heading()},s={h1:a.setHeading.enabled({level:1}),h2:a.setHeading.enabled({level:2}),h3:a.setHeading.enabled({level:3}),task:a.wrapInList.enabled({kind:"task",archived:!1})&&!l.heading,checklist:a.wrapInList.enabled({kind:"checklist",archived:!1})&&!l.heading,bullet:a.wrapInList.enabled({kind:"bullet",archived:!1})&&!l.heading,ordered:a.wrapInList.enabled({kind:"ordered",archived:!1})&&!l.heading,blockquote:a.wrapInBlockquote.enabled()},u=(0,c.useMemo)(()=>[{id:"h1",label:"heading1 heading 1 h1 head1",displayLabel:"Heading 1",available:s.h1,icon:c.createElement(H1Icon,null),submit:()=>a.setHeading({level:1})},{id:"h2",label:"heading2 heading 2 h2 head2",displayLabel:"Heading 2",available:s.h2,icon:c.createElement(H2Icon,null),submit:()=>a.setHeading({level:2})},{id:"h3",label:"heading3 heading 3 h3 head3",displayLabel:"Heading 3",available:s.h3,icon:c.createElement(H3Icon,null),submit:()=>a.setHeading({level:3})},{id:"task",label:"To-do list todo list task list",displayLabel:"Task",available:s.task,icon:c.createElement(TaskListIcon,null),submit:()=>a.wrapInList({kind:"task",archived:!1})},{id:"bullet",label:"bulleted list bullet list",displayLabel:"Bulleted list",available:s.bullet,icon:c.createElement(BulletListIcon,null),submit:()=>a.wrapInList({kind:"bullet",archived:!1})},{id:"ordered",label:"ordered list order list number list numbered list",displayLabel:"Ordered list",available:s.ordered,icon:c.createElement(OrderedListIcon,null),submit:()=>a.wrapInList({kind:"ordered",archived:!1})},{id:"checklist",label:"check checklist list",displayLabel:"Checklist",available:s.checklist,icon:c.createElement(TaskListIcon,null),submit:()=>a.wrapInList({kind:"checklist",archived:!1})},{id:"quote",label:"quote block quoteblock quote-block",displayLabel:"Quote",available:s.blockquote,icon:c.createElement(QuoteIcon,null),submit:()=>{a.wrapInBlockquote()}},{id:"backlink",label:"backlink",displayLabel:"Backlink",available:!0,icon:c.createElement(BacklinkIcon,null),submit:()=>a.insertText("[[")},{id:"ai-palette",label:"AI Assistant Palette AIAssistant AIPalette GTP3 GTP-3 prediction",displayLabel:"AI Palette",available:n,icon:c.createElement(AiIcon,null),submit:()=>{r(!0)}},{id:"now",label:"now time",displayLabel:"Now",available:!0,icon:c.createElement(ClockIcon,null),submit:()=>{var e;return a.insertText((e=new Date,"12"===t?function(e){let t=e.getHours(),n=e.getMinutes(),r=t>=12?"pm":"am";t%=12,t=t||12;let a=t.toString(),i=n.toString().padStart(2,"0");return`${a}:${i}${r}`}(e):function(e){let t=e.getHours(),n=e.getMinutes(),r=t.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${r}:${a}`}(e)))}}].filter(e=>e.available),[s.h1,s.h2,s.h3,s.task,s.bullet,s.ordered,s.blockquote,n,a,r,t]),d=(0,c.useMemo)(()=>e.map(e=>({id:`template-${e.id}`,label:`template${e.name}`,displayLabel:`${e.name}`,available:!0,icon:c.createElement(TemplateIcon,null),submit:()=>a.insertContentTemplate(e)})),[a,e]);return(0,c.useMemo)(()=>[...u,...d],[u,d])}({templates:r,timeFormat:a,predictionEnabled:i,setPrediction:s}),{state:m,getMenuProps:h,getItemProps:f,indexIsSelected:g,query:k,filteredItems:v}=function(e){var t,n,r,a;let{items:i,ignoreMatchesOnDismiss:s=!0,direction:d,dismissKeys:p,focusOnClick:m,submitKeys:h}=e,[f,g]=(0,c.useState)(null),k=(0,o.z8)(),v=null!=(a=null==(r=null==(n=null==(t=null==f?void 0:f.query)?void 0:t.partial)?void 0:n.trim())?void 0:r.toLowerCase())?a:null,y=(0,c.useMemo)(()=>null==v?[]:filterItemsByQuery({items:i,query:v,maxItems:i.length}),[i,v]),b=!!f&&y.length>0,{delete:w}=(0,o.xd)(),x=(0,c.useCallback)(()=>{if(!f)return!1;let{range:e,name:t}=f;return s&&k.getSuggestMethods().addIgnored({from:e.from,name:t,specific:!0}),g(null),!0},[k,s,f]),E=(0,c.useCallback)(e=>!!f&&(w({from:f.range.from,to:f.range.cursor}),e.submit(),g(null),!0),[w,f]),C=useMenuNavigation({items:y,isOpen:b,onDismiss:x,onSubmit:E,direction:d,dismissKeys:p,focusOnClick:m,submitKeys:h}),{resetIndex:T}=C,L=(0,u.Z)(e=>{let{query:t,range:n,name:r,exitReason:a,changeReason:i,text:l}=e;if(a){g(null);return}if(t.partial.endsWith(" ")){let e=(0,z.Z)(t.partial);if(e){g(null);return}}i&&(i!==M.$Y.Move&&T(),g({query:t,range:n,name:r,reason:i,text:l}))});return(0,o.zf)(nn,"onSlashChange",L),(0,c.useMemo)(()=>(0,l.EZ)((0,l.ih)({},C),{state:f,query:v,filteredItems:y}),[C,v,f,y])}({ignoreMatchesOnDismiss:void 0,direction:void 0,items:p}),y=useIsScrolling(e),b=!!m&&t&&!y&&v.length>0,w=useMenuFloating(b,null!=(d=null==m?void 0:m.range.from)?d:0,k,n),x=useMouseActivate([b,k]);return b?c.createElement(ThemedFloatingPortal,null,c.createElement("ul",(0,l.EZ)((0,l.ih)({},h()),{className:"slash-picker-menu",ref:w.ref,style:(0,l.ih)({},w.style),"data-testid":"slash-picker-menu"}),v.map((e,t)=>c.createElement(SlashPickerListItem,(0,l.EZ)((0,l.ih)({key:e.id},(0,l.EZ)((0,l.ih)({},f({item:e,index:t,key:e.id})),{ref:void 0})),{item:e,mouseActive:x,selected:g(t)}))))):null},SubjectMergeMenu=e=>{var t;let{mergeNoteGenerator:n,onMergeNote:r,viewportSelector:a}=e,[i,d]=(0,c.useState)({isActive:!1,position:void 0,value:void 0}),[p,m]=(0,c.useState)(!1);(0,o.zf)(na,"onSubjectChange",(0,u.Z)((e,t,n)=>{setTimeout(()=>{d({isActive:t,position:e,value:n})},0)}));let h=(0,c.useMemo)(()=>n?n(i.value):[],[n,i.value]),f=(0,c.useMemo)(()=>i.isActive&&!p&&h.length>0,[i,p,h]),g=(0,c.useCallback)(()=>!!f&&(m(!0),!0),[f]),k=(0,c.useCallback)(e=>!!f&&(null==r||r(e),!1),[f,r]),v=f&&void 0!==i.position,y=useMouseActivate([v]),{getMenuProps:b,getItemProps:w,indexIsSelected:x}=useMenuNavigation({items:h,isOpen:v,onDismiss:g,onSubmit:k,direction:void 0,dismissKeys:void 0,focusOnClick:void 0,submitKeys:void 0}),E=useMenuFloating(v,null!=(t=i.position)?t:0,i.value,a);return v?c.createElement("ul",(0,l.EZ)((0,l.ih)({},b()),{className:"subject-merge-menu",ref:E.ref,style:(0,l.ih)({},E.style)}),h.map((e,t)=>c.createElement("li",(0,l.EZ)((0,l.ih)({key:e.id},w({item:e,index:t,key:e.id})),{className:(0,s.Z)(["flex cursor-pointer items-center px-2 py-1 text-2xs leading-6 transition duration-150 ease-in-out",x(t)?"bg-coolgray-100 text-coolgray-900 dark:bg-white/10 dark:text-white":"bg-white text-coolgray-700 dark:bg-app-dark-tint dark:text-coolgray-300",y&&"hover:bg-coolgray-100 hover:text-coolgray-900 dark:hover:bg-white/10 dark:hover:text-white"])}),"Merge note with ","'"+e.label+"'","?"))):null},nN="__create__",TagPickerItem=({item:e,props:t,query:n,mouseActive:r,selected:a})=>{let i=useScrollIntoSelected(a);return c.createElement("li",(0,l.EZ)((0,l.ih)({},t),{ref:i,onPointerDown:e=>e.preventDefault(),className:(0,s.Z)(["tag-picker-item",a&&"tag-picker-item-highlighted",r&&"hoverable-item"]),"data-testid":"tag-picker-item"}),e.id===nN?c.createElement(c.Fragment,null,"Create new tag: #",n):c.createElement(c.Fragment,null,"#",e.label))},TagPickerComponentV2=({onAdd:e,onTagQuery:t,query:n,start:r,end:a,viewportSelector:i,isOpen:s})=>{let d=(0,c.useMemo)(()=>{var e;if(!s)return[];let r=n.trim(),a=null!=(e=null==t?void 0:t(r))?e:[];return r&&!a.some(e=>e.label===r)&&a.push({id:nN,label:r}),a},[s,t,n]),p=useMenuFloating(s,r,n,i),m=useMouseActivate([s,n]),{createTag:h,ignoreMatchRulePosition:f}=(0,o.xd)(),g=useMenuNavigation({items:d,isOpen:s,onDismiss:(0,u.Z)(()=>(f(),!0)),onSubmit:(0,u.Z)(t=>{if(!t)return!1;let n=t.id===nN&&t.label?{label:t.label,id:""}:t;return e&&(n=e(n)),h({name:"tag",range:{from:r,to:a,cursor:a}},n),!0})}),{getMenuProps:k,getItemProps:v,indexIsSelected:y,resetIndex:b}=g;return((0,c.useEffect)(b,[n,b]),s)?c.createElement(ThemedFloatingPortal,null,c.createElement("ul",(0,l.EZ)((0,l.ih)({},k),{className:"tag-picker-menu",ref:p.ref,style:p.style}),d.map((e,t)=>c.createElement(TagPickerItem,{key:e.id,item:e,props:v({item:e,index:t,key:e.id}),query:n,mouseActive:m,selected:y(t)})))):null},TagPickerV2=({onAdd:e,onTagQuery:t,editorFocused:n,isScrolling:r,viewportSelector:a})=>{var i,l,s;let u=function(){let[e,t]=(0,c.useState)(null),n=(0,c.useCallback)(e=>(t({query:e.match[1],start:e.start,end:e.end}),!0),[]),r=(0,c.useCallback)(()=>{t(null)},[]);return(0,o.zf)(ni,"onTagMatchV2",n),(0,o.zf)(ni,"onTagDismissV2",r),e}(),d=null!=u&&n&&!r;return d?c.createElement(TagPickerComponentV2,{query:null!=(i=null==u?void 0:u.query)?i:"",start:null!=(l=null==u?void 0:u.start)?l:0,end:null!=(s=null==u?void 0:u.end)?s:0,onTagQuery:t,onAdd:e,viewportSelector:a,isOpen:d}):null};function RiDraggable(e){return c.createElement("svg",(0,l.ih)({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},e),c.createElement("path",{fill:"currentColor",d:"M8.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm0 6.5a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0ZM15.5 7a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm1.5 5a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0Zm-1.5 8a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Z"}))}var DragIndicator=()=>{let[e,t]=(0,c.useState)(null);(0,o.T6)(tH,"draggable",t);let{isTyping:n}=useIsTyping(),r=function(e){let t=(0,c.useRef)(e);return(0,c.useEffect)(()=>{e&&(t.current=e)},[e]),e||t.current}(e);if(!r)return null;let a=r.left-28,i=r.lineHeight?(r.lineHeight-24)/2:0,l=r.top+i,s=!!e&&!n&&r.clientX<=r.left+48;return c.createElement(DragIndicatorComponent,{show:s,left:a,top:l,pos:r.pos,element:r.element})},DragIndicatorComponent=({show:e,left:t,top:n,pos:r,element:a})=>{let i=useEditorView(),l=(0,c.useMemo)(()=>createCustomClipboardSerializer(i.state.schema),[i.state.schema]),o=(0,c.useRef)(null),u=(0,c.useCallback)(e=>{let t=i.state.tr;if(r>t.doc.content.size)return;let n=t.doc.resolve(r),a=safeNodeSelection(n);a&&(t.setSelection(a),i.dispatch(t),o.current=a.node,setTimeout(()=>{i.focus()},0))},[r,i]),d=(0,c.useCallback)(e=>{let t=o.current;if(!t)return;o.current=null;let n=l.serializeNode(t),r=n.innerHTML;e.dataTransfer.clearData(),e.dataTransfer.setData("text/html",r),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage(a,0,0),i.dragging={slice:new B.p2(B.HY.from(t),0,0),move:!0},tA=i},[l,a,i]);return c.createElement(ek.u,{show:e,enter:"transition-opacity duration-100",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0"},c.createElement("div",{className:(0,s.Z)("absolute top-0 left-0 flex h-[24px] w-[24px] cursor-grab flex-row-reverse items-center justify-center transition-transform"),style:{transform:`translateX(${t}px) translateY(${n}px)`},draggable:"true",onDragStart:d,onMouseDown:u},c.createElement(RiDraggable,{width:"22px",height:"22px",className:"text-gray-300 dark:text-gray-700"})))},OfflineStatusTooltip=({offline:e,getOfflineStatus:t})=>{let[n,r]=(0,c.useState)(!1),a=useEditorView(),i=e?t():null,l=!!(null==i?void 0:i.since),{refs:o,x:s,y:u,strategy:d,context:p}=(0,eh.YF)({open:n,onOpenChange:r,middleware:[(0,ef.cv)(10)],whileElementsMounted:eg.Me});return((0,eh.XI)(p),(0,c.useEffect)(()=>{!function(e,t){e.dispatch(e.state.tr.setMeta("REFLECT_OFFLINE_STATUS",t))}(a,l);let e=setTimeout(()=>{let e=a.dom.querySelector("span[data-offline-status-indicator]");o.setReference(e)},10);return()=>clearTimeout(e)},[a,o,l]),n&&(null==i?void 0:i.since))?c.createElement("div",{ref:o.setFloating,style:{left:null!=s?s:0,top:null!=u?u:0,position:d},className:"z-floating-menu max-w-[300px] rounded-md border bg-gray-50 p-2 px-2.5 text-sm text-gray-500 dark:border-gray-500 dark:bg-gray-800 dark:text-near-white"},"You have made"," ",c.createElement("em",null,i.changes," edit",i.changes>=2?"s":""),". ",i.changes>=2?"They":"It"," will be synced when you go online."):null};function cn(...e){return(0,e$.m)((0,s.W)(e))}var PrimaryButton=({onClick:e,type:t="button",className:n="",children:r,disabled:a,endDecorator:i,testid:l})=>c.createElement("button",{onClick:e,type:t,disabled:a,className:(0,s.Z)(`
          group inline-flex cursor-pointer items-center 
          space-x-1 rounded-md border border-transparent bg-indigo-600 px-2.5 py-1 text-xs 
          font-medium leading-4 text-white shadow-sm transition duration-300 
          ease-in-out hover:bg-indigo-500 
          focus:outline-none focus:ring-2 focus:ring-indigo-500
          focus:ring-offset-2 disabled:cursor-not-allowed disabled:bg-bluegray-400
        `,n),"data-testid":l},c.createElement("span",{className:"inline-flex items-center"},r),i&&c.createElement("kbd",{className:"\n            flex flex-none items-center justify-center rounded-md bg-indigo-800\n            px-1.5 py-0.5 font-sans text-[10px]\n            font-medium uppercase leading-4 text-white/90 transition\n            duration-300 ease-in-out group-disabled:bg-bluegray-500\n          "},i)),nM=C.NZ.isApple?()=>c.createElement("span",{className:"flex h-[16px] items-center justify-center"},c.createElement(eV.m,{width:10,height:10}),c.createElement(eW.G,{width:10,height:10,className:"rotate-180"})):()=>c.createElement("span",null,"Ctrl+Enter"),nD=(0,eU.j)("fixed z-floating-menu bg-white shadow-lg dark:bg-app-dark-tint overflow-y-auto rounded-md ring-1 ring-coolgray-900/5 dark:ring-gray-600 min-w-52  transition text-black dark:text-gray-200 divide-y divide-gray-900/5 dark:divide-white/10 select-none",{variants:{layout:{desktop:"w-[420px] max-w-xl max-h-[720px]",mobile:"w-full max-h-[70vh]"},reverse:{false:"flex flex-col",true:"flex flex-col-reverse"}},defaultVariants:{layout:"desktop",reverse:!1}}),PredictionContextTextarea=({viewportSelector:e,mobile:t,prompt:n,text:r,setText:a,onSubmit:i,onDismiss:o})=>{var s;let d=(0,c.useRef)(null),{getFloatingProps:p}=useToolbarFloating({isOpen:!0,viewportSelector:e,placement:t?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:o,enabledDismiss:!0,observeElementResize:!0});(0,c.useEffect)(()=>{setTimeout(()=>{var e;null==(e=d.current)||e.focus({preventScroll:!0})})},[]);let m=(0,u.Z)(()=>{i(n,r)});return useHotkeys(["Mod-Enter"],m,{capture:!0}),c.createElement("div",(0,l.EZ)((0,l.ih)({},p({className:cn(nD({layout:t?"mobile":"desktop"}))})),{"data-testid":"prediction-prompt-textarea-menu"}),c.createElement("form",{className:"space-y-1 p-2"},c.createElement("textarea",{ref:d,className:"prediction-prompt-textarea-menu-input",placeholder:null!=(s=n.customInputPlaceholder)?s:"Enter some context text...",rows:4,value:r,onChange:e=>{a(e.target.value)}}),c.createElement(PrimaryButton,{endDecorator:t?null:c.createElement(nM,null),onClick:m,disabled:!r},"Submit")))},PredictionPromptListGroup=({name:e,children:t})=>c.createElement("li",{className:"py-1"},e?c.createElement("h3",{className:"select-none px-3 py-1 text-xs capitalize text-coolgray-400 dark:text-coolgray-500"},e):null,c.createElement("ul",null,t)),PredictionPromptListItem=({selected:e,mouseActive:t,item:n,unsaved:r=!1,onClick:a,onHover:i})=>{let l=useScrollIntoSelected(e);return c.createElement("li",{ref:l,onClick:e=>{e.preventDefault(),a()},onPointerEnter:i,className:(0,s.Z)([`
        flex h-8 cursor-pointer items-center space-x-2 bg-white px-3 text-2xs
        leading-5 text-coolgray-700 transition      
        duration-150 ease-in-out dark:bg-app-dark-tint dark:text-coolgray-300
        `,e&&"bg-coolgray-100 text-coolgray-900 dark:bg-white/10 dark:text-white"]),"data-testid":e?"prediction-prompt-list-item-selected":"prediction-prompt-list-item"},c.createElement(Marquee,{hoverToPause:t,active:e},r?c.createElement("span",null,"New custom prompt: ",c.createElement("em",null,n.label||n.template)):n.label))},nA="__CUSTOM_PROMPT__";function isUnsavedPromptTemplate(e){return e.id===nA||!e.id}var PredictionPromptPicker=({viewportSelector:e,mobile:t,promptTemplates:n,onSubmit:r,onDismiss:a})=>{let[i,o]=(0,c.useState)(""),s=(0,c.useMemo)(()=>(function(e,t){e=e.trim();let n=t.filter(e=>"custom"===e.type),r=t.filter(e=>"system"===e.type),a=filterItemsByQuery({query:e,items:r,maxItems:100}),i=filterItemsByQuery({query:e,items:n,maxItems:100}),l=e?[{id:nA,type:"custom",label:"",template:e}]:[];return[{groupName:"custom",items:i},{groupName:"system",items:a},{groupName:null,items:l}].filter(e=>e.items.length>0)})(i,n),[i,n]),d=(0,c.useRef)(null),[p,m]=(0,c.useState)(-1),[h,f]=(0,c.useState)(-1);(0,c.useEffect)(()=>{m(0),f(0)},[i]);let{getFloatingProps:g}=useToolbarFloating({isOpen:!0,viewportSelector:e,placement:t?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:a,enabledDismiss:!0,observeElementResize:!0}),k=(0,u.Z)(async(e,t)=>{let n=s[null!=e?e:p],a=null==n?void 0:n.items[null!=t?t:h];a&&r(a)}),v=(0,u.Z)((e,t)=>{y&&(m(e),f(t))}),y=useMouseActivate([i,p,h]);return useHotkeys(["ArrowDown","ctrl-n"],e=>{var t;e.preventDefault();let[n,r]=(t=h+1)===s[p].items.length?function(e,t){let n=e.length;return[(t+1)%n,0]}(s,p):[p,t];m(n),f(r)},{ref:d}),useHotkeys(["ArrowUp","ctrl-p"],e=>{var t;e.preventDefault();let[n,r]=-1==(t=h-1)?function(e,t){let n=e.length,r=(t+n-1)%n;return[r,e[r].items.length-1]}(s,p):[p,t];m(n),f(r)},{ref:d}),(0,c.useEffect)(()=>{setTimeout(()=>{var e;null==(e=d.current)||e.focus({preventScroll:!0})})},[]),c.createElement("div",(0,l.EZ)((0,l.ih)({},g({className:cn(nD({layout:t?"mobile":"desktop",reverse:t}))})),{"data-testid":"prediction-prompt-picker-menu"}),c.createElement("form",{onSubmit:e=>{e.preventDefault(),k()},className:"p-3 pb-2"},c.createElement("input",{className:"prediction-prompt-picker-menu-input",ref:d,value:i,placeholder:"Ask anything to AI...",onChange:e=>o(e.target.value)})),c.createElement("ul",{className:"prediction-prompt-picker-menu-list divide-y divide-gray-900/5 dark:divide-white/20"},s.map((e,t)=>{var n;return c.createElement(PredictionPromptListGroup,{key:null!=(n=e.groupName)?n:"none",name:e.groupName},e.items.map((e,n)=>c.createElement(PredictionPromptListItem,{key:e.id,item:e,selected:t===p&&n===h,mouseActive:y,unsaved:isUnsavedPromptTemplate(e),onClick:()=>void k(t,n),onHover:()=>v(t,n)})))})))},SecondaryButton=({onClick:e,type:t="button",className:n="",children:r,disabled:a,endDecorator:i,testid:l})=>c.createElement("button",{onClick:e,type:t,disabled:a,className:(0,s.Z)(`
          group inline-flex cursor-pointer items-center
          space-x-1 rounded-md
          border border-transparent bg-indigo-100
          px-2.5 py-1 text-xs font-medium
          leading-4 text-indigo-700
          transition duration-150 ease-in-out
          hover:bg-indigo-50
          focus:border-indigo-300 focus:outline-none active:bg-indigo-200
          disabled:cursor-not-allowed disabled:bg-bluegray-100 disabled:text-coolgray-400 dark:bg-indigo-900 dark:text-white dark:hover:bg-indigo-800 disabled:dark:bg-bluegray-800
        `,n),"data-testid":l},c.createElement("span",{className:"inline-flex items-center"},r),i&&c.createElement("kbd",{className:"\n            flex h-[15px] min-w-[15px] flex-none items-center justify-center \n            rounded-md border bg-indigo-500 px-[3px]\n            font-sans text-[8px] font-medium uppercase leading-4 text-white opacity-50 group-disabled:bg-bluegray-500\n          "},i)),PredictionResultAction=({disabled:e,done:t,mobile:n,handleReplace:r,handleInsert:a,handleRerun:i,handleCopy:l,handleStop:o})=>{let s=useEditorView(),u=s.state.selection.empty,d=t&&!u,p=!t;return c.createElement("div",{className:"flex shrink-0 grow flex-row gap-2 overflow-x-auto whitespace-nowrap"},c.createElement(RerunButton,{onClick:i,disabled:e,mobile:n}),t&&c.createElement(InsertButton,{onClick:a,disabled:e,mobile:n}),t&&c.createElement(CopyButton,{onClick:l,disabled:e,mobile:n}),p&&c.createElement(StopButton,{onClick:o,disabled:e,mobile:n}),c.createElement("div",{className:"flex-1"}),d&&c.createElement(ReplaceButton,{onClick:r,disabled:e,mobile:n}))},ReplaceButton=({onClick:e,disabled:t,mobile:n})=>(useHotkeys(["Mod-Enter"],e,{capture:!0,enabled:!t}),c.createElement(PrimaryButton,{onClick:e,endDecorator:n?null:c.createElement(nM,null),disabled:t},"Replace")),InsertButton=({onClick:e,disabled:t,mobile:n})=>(useHotkeys(["i","shift-i"],e,{enabled:!t}),c.createElement(SecondaryButton,{onClick:e,endDecorator:n?null:"I",disabled:t},"Insert")),RerunButton=({onClick:e,disabled:t,mobile:n})=>(useHotkeys(["r","shift-r"],e,{enabled:!t}),c.createElement(SecondaryButton,{onClick:e,endDecorator:n?null:"R",disabled:t},"Re-run")),CopyButton=({onClick:e,disabled:t,mobile:n})=>(useHotkeys(["c","shift-c"],e,{enabled:!t}),n)?null:c.createElement(SecondaryButton,{onClick:e,endDecorator:n?null:"C",disabled:t},"Copy"),StopButton=({onClick:e,disabled:t,mobile:n})=>(useHotkeys(["Escape"],e,{capture:!0,stopPropagation:!0,enabled:!t}),c.createElement(SecondaryButton,{onClick:e,endDecorator:n?null:"ESC",disabled:t},"Stop")),PredictionResultContent=({text:e})=>c.createElement("div",{className:"select-text overflow-y-auto whitespace-pre-line rounded-md bg-gray-50 p-3 text-sm dark:bg-white/5"},e),Transition3=({show:e,enter:t,enterFrom:n,enterTo:r,leave:a,leaveFrom:i,leaveTo:l,children:o})=>{let u;let[d,p]=(0,c.useState)(e?2:5),m=(0,c.useRef)(null);(0,c.useEffect)(()=>{p(t=>{if(e)switch(t){case 2:return t;case 4:return 1;default:return 0}else switch(t){case 5:return t;case 1:return 4;default:return 3}})},[e]),(0,c.useEffect)(()=>{switch(d){case 0:requestAnimationFrame(()=>p(1));break;case 3:requestAnimationFrame(()=>p(4))}},[d]);let h=(0,c.useCallback)(()=>{p(e=>{switch(e){case 1:return 2;case 4:return 5}return e})},[]);switch((0,c.useEffect)(()=>{let e=m.current;if(e)return e.addEventListener("transitionend",h),()=>{e.removeEventListener("transitionend",h)}},[h]),d){case 0:u=(0,s.Z)(t,n);break;case 1:u=(0,s.Z)(t,r);break;case 2:case 5:u="";break;case 3:u=(0,s.Z)(a,i);break;case 4:u=(0,s.Z)(a,l);break;default:throw Error(`Invalid state ${d}`)}return c.createElement("div",{ref:m,className:u},5===d?null:o)},Collapse=({open:e,children:t})=>c.createElement(Transition3,{show:e,enter:"grid overflow-hidden transition-[grid-template-rows] ease-out",enterFrom:"grid-rows-[0fr]",enterTo:"grid-rows-[1fr]",leave:"grid overflow-hidden transition-[grid-template-rows] ease-in",leaveFrom:"grid-rows-[1fr]",leaveTo:"grid-rows-[0fr]"},c.createElement("div",{className:"min-h-0"},t)),PredictionResultHeading=({prompt:e,hasPendingChange:t,setLabel:n,setTemplate:r,onClonePrompt:a,onSavePrediction:i,onDeletePrediction:l,setActionDisabled:o})=>{let[s,u]=(0,c.useState)(!1),[d,p]=(0,c.useState)(!1),[m,h]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!1),[k,v]=(0,c.useState)(!1),y=isUnsavedPromptTemplate(e),b="system"===e.type,handleClick=()=>{u(!s)},handleSave=async t=>{t.preventDefault(),e.label&&e.template&&(p(!0),await i(),p(!1))},handleDelete=async()=>{h(!0),await l(),h(!1),u(!1)};(0,c.useEffect)(()=>{o(f||k)},[f,k,o]);let w=s?eK.f:eq.A,x=!(s&&t),E=!b&&(y||t),C=!b&&!y,T=!y;return c.createElement("form",{className:"flex flex-col py-3 px-4",onSubmit:handleSave,"data-testid":"prediction-result-heading"},c.createElement("div",{className:"flex min-h-[24px] space-x-2",onClick:s?void 0:handleClick,"data-testid":"prediction-result-heading-label"},s&&!b?c.createElement("input",{value:e.label,onChange:e=>n(e.target.value),onFocus:()=>g(!0),onBlur:()=>g(!1),className:"\n              m-0 inline-flex\n              w-full flex-1 rounded-sm border-0 bg-transparent\n              text-sm text-gray-700 outline-none placeholder:text-gray-500\n              dark:text-gray-300\n            ",autoFocus:!0,placeholder:"Input your prompt name here",required:!0}):c.createElement("div",{className:"flex flex-1 items-center truncate text-sm"},c.createElement("span",null,e.label||e.template)),x&&c.createElement("button",{onClick:s?handleClick:void 0,type:"button",className:"flex-none cursor-default"},c.createElement(w,{width:24,height:24,className:"text-gray-400 dark:text-gray-400"}))),c.createElement(Collapse,{open:s},c.createElement("div",{className:"mt-3"},c.createElement("textarea",{value:e.template,onChange:e=>r(e.target.value),onFocus:()=>v(!0),onBlur:()=>v(!1),disabled:b,placeholder:"Input your prompt template here. Use {{selectedText}} as a placeholder for selected text.",className:"\n              m-0 h-40 w-full resize-y rounded-md border-0 bg-gray-50\n              px-3 py-2 text-sm text-gray-700\n              outline-none placeholder:text-gray-500 focus:ring-2 focus:ring-accent\n              dark:bg-white/10 dark:text-gray-300\n            ",required:!0})),c.createElement("p",{className:"mt-2 mb-3 text-xs"},"Tip: Use ",c.createElement("strong",null,c.createElement("code",null,"{{selectedText}}"))," as a placeholder for selected text"),c.createElement("div",{className:"flex w-full flex-row-reverse gap-2"},C&&c.createElement(SecondaryButton,{onClick:handleDelete,disabled:m,testid:"prediction-result-heading-button-delete",className:"items-end justify-self-end"},m?"Deleting...":"Delete"),T&&c.createElement(SecondaryButton,{onClick:()=>{a()},testid:"prediction-result-heading-button-clone"},"Clone"),E&&c.createElement(SecondaryButton,{disabled:d,type:"submit",testid:"prediction-result-heading-button-save"},d?"Saving...":"Save"))))},PredictionResult=({viewportSelector:e,stream:t,prompt:n,hasPendingChange:r,mobile:a,setLabel:i,setTemplate:s,onDismiss:u,onRerun:d,onClonePrompt:p,onSavePrediction:m,onDeletePrediction:h})=>{let{text:f,done:g,canceled:k,cancel:v}=function(e){let[t,n]=(0,c.useState)(""),[r,a]=(0,c.useState)(!1),[i,l]=(0,c.useState)(!1),[o,s]=(0,c.useState)(null);return(0,c.useEffect)(()=>{if(n(""),a(!1),l(!1),s(null),!e)return;if(e.locked){console.warn("Cannot read from a locked stream");return}let t=e.getReader(),r=null,i=!1,o=!1,read=async()=>{for(;!i&&!o;){r=t.read();let{value:e,done:l}=await r;if(i||o)break;if(e&&n(t=>t+e),l){a(!0);break}}},cancel2=async()=>{i=!0,!o&&(r&&await r,o||(l(!0),await t.cancel()))},release=async()=>{o=!0,r&&await r,t.releaseLock()};return read(),s(()=>cancel2),()=>{release()}},[e]),{text:t,done:r,canceled:i,cancel:o}}(t),[y,b]=(0,c.useState)(!1),{handleReplace:w,handleInsert:x,handleRerun:E,handleCopy:C,handleStop:T}=function({text:e,onRerun:t,onDismiss:n,onCancelStream:r}){let a=(0,c.useRef)(null),i=(0,o.xd)();return{ref:a,handleReplace:()=>{e&&(n(),i.replaceMarkdown(e))},handleInsert:()=>{e&&(n(),i.insertMarkdownAfterSelection(e))},handleRerun:()=>{null==r||r(),t()},handleDismiss:()=>{null==r||r(),n()},handleStop:()=>{null==r||r()},handleCopy:()=>{copyTextToClipboard(e),n()}}}({onCancelStream:v,text:f,onRerun:d,onDismiss:u}),{getFloatingProps:L}=useToolbarFloating({isOpen:!0,viewportSelector:e,placement:a?"viewport-bottom":"bottom",alwaysCenter:!0,onDismiss:u,enabledDismiss:!0,observeElementResize:!0});return c.createElement("div",(0,l.EZ)((0,l.ih)({},L({className:cn(nD({layout:a?"mobile":"desktop"}))})),{"data-testid":"prediction-result-menu"}),c.createElement(PredictionResultHeading,{prompt:n,hasPendingChange:r,setLabel:i,setTemplate:s,onClonePrompt:p,onSavePrediction:m,onDeletePrediction:h,setActionDisabled:b}),c.createElement("div",{className:"space-y-3 p-3"},c.createElement(PredictionResultContent,{text:f}),t?c.createElement(PredictionResultAction,{disabled:y,done:g||k,mobile:a,handleReplace:w,handleInsert:x,handleRerun:E,handleCopy:C,handleStop:T}):null))},PredictionMenuComponent=({viewportSelector:e,mobile:t,setPrediction:n,onPrediction:r,onSetPromptTemplate:a,onRemovePromptTemplate:i,promptTemplates:o=[]})=>{let[s,d]=(0,c.useState)(null),[p,m]=(0,c.useState)(""),[h,f]=(0,c.useState)(!1),[g,k]=(0,c.useState)(null),[v,y]=(0,c.useState)(!1),b=!g&&!h,w=(0,c.useRef)(null),x=useEditorView(),E=(0,c.useCallback)(e=>{y(!0),d(t=>t?(0,l.EZ)((0,l.ih)({},t),{label:e}):null)},[]),C=(0,c.useCallback)(e=>{y(!0),d(t=>t?(0,l.EZ)((0,l.ih)({},t),{template:e}):null)},[]),T=(0,u.Z)(()=>{if(v){let e=window.confirm("Do you want to discard unsaved prompt template?");if(!e)return}n(!1),x.focus()}),L=(0,u.Z)(async(e,t)=>{let n;d(e);let a=x.state.selection,i=a.empty,l=i?void 0:getSliceText(a.content(),"markdown"),o=isUnsavedPromptTemplate(e)?void 0:e.id,s=e.template.includes("{{selectedText}}")||e.template.includes("{input}"),c=l||t||"";if(s&&!c)return;n=s&&c?e.template.replaceAll("{input}",c).replaceAll("{{selectedText}}",c):!s&&c?`${e.template}

Use the following text in triple quotes as context for your response:
"""
${c}
"""`:e.template;let u={promptTemplateId:o,prompt:n,temperature:e.temperature,optimize:e.optimize};f(!0);let{stream:p}=await r(u);f(!1),k(p)}),S=(0,u.Z)(()=>{k(null),!p&&s&&L(s)}),I=(0,c.useCallback)(()=>{d(e=>e?(0,l.EZ)((0,l.ih)({},e),{id:nA,label:e.label+" (cloned)",type:"custom"}):e),y(!0)},[]),N=(0,u.Z)(async()=>{if(!s||!v)return;let{id:e}=await a({id:isUnsavedPromptTemplate(s)?void 0:s.id,label:s.label,template:s.template});d((0,l.EZ)((0,l.ih)({},s),{id:e,type:"custom"})),y(!1)}),M=(0,u.Z)(async()=>{s&&(await i({id:s.id}),d((0,l.EZ)((0,l.ih)({},s),{id:nA})),y(!1))});return useHotkeys(["mod-j"],T,{ref:w}),c.createElement("div",{ref:w},s?b?c.createElement(PredictionContextTextarea,{viewportSelector:e,mobile:t,onSubmit:L,onDismiss:T,text:p,setText:m,prompt:s}):c.createElement(PredictionResult,{viewportSelector:e,mobile:t,stream:g,prompt:s,hasPendingChange:v,setLabel:E,setTemplate:C,onDismiss:T,onRerun:S,onClonePrompt:I,onSavePrediction:N,onDeletePrediction:M}):c.createElement(PredictionPromptPicker,{viewportSelector:e,mobile:t,promptTemplates:o,onSubmit:L,onDismiss:T}))},PredictionMenu=({viewportSelector:e,mobile:t,prediction:n,setPrediction:r,onPrediction:a,onSetPromptTemplate:i,onRemovePromptTemplate:l,promptTemplates:o=[]})=>{let s=(0,u.Z)(()=>!n&&(r(!0),!0));return(0,eF.og)("mod-j",s),c.createElement(ThemedFloatingPortal,null,n?c.createElement(PredictionMenuComponent,{viewportSelector:e,mobile:t,setPrediction:r,onPrediction:a,onSetPromptTemplate:i,onRemovePromptTemplate:l,promptTemplates:o}):null)},FloatingComponents=({onTagAdd:e,onBacklinkAdd:t,maxPickerItems:n=5,scrollingNode:r,viewportSelector:a="",backlinkGenerator:i,tagGenerator:l,mergeMenuEnabled:o=!0,dragIndicatorEnabled:s=!1,inlineToolbarEnabled:u=!0,mergeNoteGenerator:d,onMergeNote:p,templates:m=[],subjectRequired:h=!0,timeFormat:f="12",inline:g=!1,mobile:k=!1,offline:v,getOfflineStatus:y,onPrediction:b,onSetPromptTemplate:w,onRemovePromptTemplate:x,promptTemplates:E,onLinkMetadata:C,isFocused:T,prediction:L,setPrediction:S})=>{let[I,N]=(0,c.useState)(!1),M=useIsScrolling(r);return c.createElement(c.Fragment,null,c.createElement(TagPickerV2,{onAdd:e,maxItems:n,onTagQuery:l,editorFocused:T,isScrolling:M,viewportSelector:a}),c.createElement(BacklinkPickerV2,{onAdd:t,onBacklinkQuery:i,editorFocused:T,isScrolling:M,viewportSelector:a}),g?null:c.createElement(SlashPicker,{editorFocused:T,scrollingNode:r,viewportSelector:a,templates:m,timeFormat:f,predictionEnabled:!!b,setPrediction:S}),s?c.createElement(DragIndicator,null):null,o?c.createElement(SubjectMergeMenu,{mergeNoteGenerator:d,onMergeNote:p,viewportSelector:a}):null,u?c.createElement(InlineToolbarMenu,{setEditingLink:N,setPrediction:S,predictionEnabled:!!b,editorFocused:T,isScrolling:M,viewportSelector:a,subjectRequired:h}):null,u?c.createElement(InlineLinkMenu,{editingLink:I,setEditingLink:N,isScrolling:M,viewportSelector:a,onLinkMetadata:C}):null,b&&w&&x?c.createElement(PredictionMenu,{prediction:L,setPrediction:S,mobile:k,viewportSelector:a,onPrediction:b,onSetPromptTemplate:w,onRemovePromptTemplate:x,promptTemplates:E}):null,y?c.createElement(OfflineStatusTooltip,{offline:v,getOfflineStatus:y}):null)},ReflectEditor=e=>c.createElement(nx,null,c.createElement(InnerReflectEditor,(0,l.EZ)((0,l.ih)({},e),{key:e.editorKey}))),InnerReflectEditor=({editorKey:e,content:t,onDocumentChange:n,onDocumentChangeDebounced:r,onTransaction:m,yjsOnUpdate:h,subject:f,inline:g=!1,selected:k=!1,scrollSelectedIntoView:v=!1,dark:y=!1,editableSubject:b=!0,highlightSubject:w=!1,readOnly:x=!1,editable:E=!0,mergeMenuEnabled:T=!0,dragIndicatorEnabled:L=!1,inlineToolbarEnabled:S=!0,virtualCursorEnabled:I=!1,doubleSpaceReplacement:N=null,isTagSelectable:M=!0,isBacklinkSelectable:D=!0,spellCheck:B=!0,mobile:P=!1,maxPickerItems:H=5,searchTerm:R,className:F,size:Z,style:O,editorStyle:j,graphId:_,editorRef:z,offline:$,getOfflineStatus:V,onTagAdd:W,onTagClick:U,onBacklinkAdd:K,onBacklinkOpen:q,onBacklinkHover:Y,backlinkGenerator:J,tagGenerator:G,onFocus:Q,onBlur:X,mergeNoteGenerator:ee,onMergeNote:et,onNavigatePrevious:en,onNavigateNext:er,onSelection:ea,onFileUpload:ei,onImageClick:el,onCheckboxChange:eo,onLinkMetadata:es,onPrediction:ec,onSetPromptTemplate:eu,onRemovePromptTemplate:ed,promptTemplates:ep,children:em,scrollingNode:eh,viewportSelector:ef="",templates:eg,subjectRequired:ek=!0,timeFormat:ev})=>{var ey;let eb=function({content:e,inline:t,yjsOnUpdate:n,editorKey:r}){return(0,c.useMemo)(()=>{if(e||assertUnreachable(e),"yjs"===e.type){if(t)throw Error("inline editor does not support YJS yet");let i=function({yjsDoc:e,yjsOnUpdate:t,appVersion:n,extraLogInfo:r}){let i=(0,a.Su)({yjsDoc:e});i!==n&&console.log(`${r} current version in the yjsDoc: ${i}`);let o=(0,p.R3)(e);o.attrs=(0,l.EZ)((0,l.ih)({},o.attrs),{version:i});let s=tN(o,n,r);if(!s)return e;let c=nb.nodeFromJSON(s),u=new eR.Doc;eR.applyUpdate(u,eR.encodeStateAsUpdate(e));let d=[];u.on("update",e=>{d.push(e)});let m=u.get("prosemirror",eR.XmlFragment);(0,p.e$)(c,m),(0,a.w2)({yjsDoc:u,version:n});let h=eR.mergeUpdates(d);return null==t||t({update:h,doc:u}),u}({yjsDoc:e.yjsDoc,yjsOnUpdate:n,appVersion:tS,extraLogInfo:`editorKey: ${r} (yjs)`}),o=(0,p.R3)(i);return{yjsDoc:i,document:o}}if("prosemirror"===e.type){let n=(e.document?tN(e.document,tS,`editorKey: ${r} (prosemirror)`):void 0)||e.document;if(t&&n){let e=function findParagraphJSON(e){var t;if(!e)return null;if((null==e?void 0:e.type)===a.e3)return e;for(let n of null!=(t=null==e?void 0:e.content)?t:[]){let e=findParagraphJSON(n);if(e)return e}return null}(n);n=(0,l.EZ)((0,l.ih)({},n),{content:e?[e]:[]})}return{yjsDoc:void 0,document:n}}assertUnreachable(e)},[e,r,t,n])}({content:t,inline:g,yjsOnUpdate:h,editorKey:e}),ew=(0,c.useMemo)(()=>K?wrapOnBacklinkAdd(K):K,[K]),{manager:ex}=(0,o.iF)({content:eb.document,extensions:()=>buildExtensions({onTagClick:U,onBacklinkOpen:q,onBacklinkHover:Y,onBacklinkAdd:ew,onTagAdd:W,onFileUpload:ei,onImageClick:el,onCheckboxChange:eo,graphId:_,isTagSelectable:M,isBacklinkSelectable:D,yjsDoc:eb.yjsDoc,yjsOnUpdate:h,subjectRequired:ek,inline:g,virtualCursorEnabled:I})});(0,c.useEffect)(()=>{"undefined"!=typeof window&&(window._reflect_editor_view=ex.view)},[ex.view]);let eE=function(e,t){let n=(0,c.useMemo)(()=>{if(!e&&!t)return null;let n=t?(0,eZ.Z)(t,800):null,onStateChange=t=>{let r=t.doc.toJSON();null==e||e(r),null==n||n(r)};return onStateChange.flush=()=>{null==n||n.flush()},onStateChange},[e,t]);return(0,c.useEffect)(()=>()=>{null==n||n.flush()},[n]),n}(n,r),eC=function(e,t){let n=(0,c.useRef)("__default_editor_key__"),r=(0,c.useCallback)(r=>{n.current!==e&&(n.current=e);let{transactions:a}=r,i=a.some(e=>e.docChanged),l=a.every(e=>e.getMeta(d.Gt));i&&!l&&t(r)},[e,t]);return r}(e,(0,c.useCallback)(({transactions:e,newState:t})=>{e.length>0&&(null==m||m(e,t),null==eE||eE(t))},[eE,m]));(0,c.useEffect)(()=>{var e,t,n,r,a,i;if(!f)return;let l=null==(n=null==(t=null==(e=ex.store)?void 0:e.view)?void 0:t.state)?void 0:n.doc;l&&getSubject(l)!==f&&(null==(i=null==(a=null==(r=ex.store)?void 0:r.commands)?void 0:a.addSubjectToContent)||i.call(a,f,!0))},[ex,f]);let[eT,eL]=(0,c.useState)(!1),eS=(0,c.useRef)(!1),eI=(ey={onSelection:ea},(e,t)=>{var n;let{selection:r}=e,i=(0,A.RI)()(e),l=(0,A.xH)()(e),o=(0,A.C$)("up")(e),s=(0,A.C$)("down")(e),c=!!(0,C.Tr)({selection:e.selection,types:a.tw});null==(n=ey.onSelection)||n.call(ey,{selection:{from:r.from,to:r.to},canIndent:i,canDedent:l,canMoveUp:o,canMoveDown:s,selectedSubject:c,didFocus:t})}),[eN,eM]=(0,c.useState)(!1),eD=(0,c.useCallback)(e=>{e.transactions&&e.transactions.length>0?eC({transactions:e.transactions,newState:e.state}):e.tr&&(console.warn("onChange called with a tr but no transactions"),eC({transactions:[e.tr],newState:e.state})),eI(e.state,eS.current),eS.current=!1},[eI,eC]),eA=(0,c.useCallback)((e,t)=>{let n=e.docChanged,r=!0;return x?r=!1:b||getSubject(e.doc)===getSubject(t.doc)||e.getMeta(nc)||e.getMeta(d.Gt)||(r=!1),!!r||!n},[x,b]),eB=(0,u.Z)((e,t)=>{eS.current=!0,eL(!0),null==Q||Q(t),eM(!1)}),eP=(0,u.Z)((e,t)=>{eL(!1),null==X||X(t,e.state.doc.toJSON())}),eH=(0,c.useMemo)(()=>eb.document?k&&"object"==typeof k?[eb.document,k]:eb.document:void 0,[eb.document,k]),eF={xs:"reflect-editor-xs",sm:"reflect-editor-sm",md:"reflect-editor-md",lg:"reflect-editor-lg"}[null!=Z?Z:"sm"];return c.createElement(i.Q2,{dark:y,className:(0,s.Z)(F,eF,w&&"highlight-subject",x&&"readonly"),style:O},c.createElement(o.O1,{onFocus:eB,onBlur:eP,onChange:eD,manager:ex,initialContent:eH,editable:E,attributes:j?{style:j}:void 0},c.createElement(DefaultEditor,{spellCheck:B}),c.createElement(EffectComponent,{searchTerm:R}),c.createElement(TransactionFilterConfigurer,{filterTransaction:eA}),c.createElement(VirtualCursorConfigurer,{enabled:I}),c.createElement(DoubleSpaceConfigurer,{enabled:N}),c.createElement(NavigationExtension,{onNavigatePrevious:en,onNavigateNext:er}),c.createElement(EditorFocusing,{selected:k,scrollSelectedIntoView:v}),c.createElement(nw,{ref:z,setPrediction:eM}),E?c.createElement(FloatingComponents,{onTagAdd:W,onBacklinkAdd:ew,maxPickerItems:H,scrollingNode:eh,viewportSelector:ef,mergeMenuEnabled:T,dragIndicatorEnabled:L,inlineToolbarEnabled:S,backlinkGenerator:J,tagGenerator:G,mergeNoteGenerator:ee,onMergeNote:et,templates:eg,isFocused:eT,timeFormat:ev,inline:g,mobile:P,offline:$,getOfflineStatus:V,onLinkMetadata:es,onPrediction:ec,onSetPromptTemplate:eu,onRemovePromptTemplate:ed,promptTemplates:ep,prediction:eN,setPrediction:eM}):null,em))},nB=buildGenerators(nb);function fragmentFromMarkdown(e,t){let n=markdownToHtml(e,t);return fragmentFromHtml(n,nb)}function htmlFromNode(e,t){let n=createCustomDOMSerializer(e.type.schema,t);return function(e,t){let n=(0,C.Me)(),r=n.createElement("div");return r.append(function(e,t,n){let r=(0,C.PH)(e)&&(0,C.aQ)(e)?e.content:B.HY.from(e);return t.serializeFragment(r,{document:n})}(e,t,n)),r}(e,n).innerHTML}function nodeFromHtml(e){var t;let n=(0,C.OC)({content:"<h1></h1>"+e,schema:nb});return(null==(t=n.maybeChild(1))?void 0:t.type.name)===a.tw?n.cut(n.child(0).nodeSize):n}function listLabelFromMarkdown(e,t){let n=fragmentFromMarkdown(e,t),r=function(e){if((0,C.PH)(e)&&e.isInline)return[e];let t=[];return e.descendants(e=>{if(e.isInline)return t.push(e),!1}),t}(n);return B.HY.fromArray(r)}function markdownFromNode(e){let t=htmlFromNode(e,{wrapBacklinkWithBrackets:!0,removeTagLinks:!0,normalizeTaskListItem:!0,normalizeListItem:!0,normalizeIframe:!0,nativeList:!0});return htmlToMarkdown(t,"markdown")}function nodeFromJson(e,t=nb){return B.NB.fromJSON(t,migrateJson(e))}function replacePrefixLink(e,t,n){if(!(0,A.yD)(n))throw Error("The given list must be a list node");let r=findNode(e.tr.doc,e=>(0,A.yD)(e)&&e.textContent.startsWith(t));if(!r)return appendNodesToDocument(e,[n]);let{tr:a}=e;return a.replaceRangeWith(r.pos,r.pos+r.node.nodeSize,n),!0}function appendOrUpdateTask(e,t,n){return function(e,t){let n=e.tr.doc,r=null;if(n.descendants((e,n)=>!r&&!e.type.isTextblock&&(isTask(e)&&e.attrs.guid===t.attrs.guid?(r={node:e,from:n},!1):void 0)),!r)return!1;let{node:a,from:i}=r;if(!a.eq(t)){if(a.content.eq(t.content))e.tr.setNodeMarkup(i,null,t.attrs);else{let n=i+a.nodeSize,r=function(e,t){var n;let r=t.content;r.size>1&&(r=B.HY.fromArray([r.child(0)]));let a=null==(n=e.content.firstChild)?void 0:n.isTextblock;for(let t=a?1:0;t<e.content.childCount;t++)r=r.addToEnd(e.content.child(t));return t.copy(r)}(a,t);e.tr.replaceRangeWith(i,n,r)}}return!0}(e,t)||function(e,t,n){let r=new Set;for(let e of t)for(let t of function(e){let t=[];return e.descendants(e=>{isTask(e)&&t.push(e.attrs.guid)}),t}(e))r.add(t);let a=t.filter(e=>!r.has(e.attrs.guid));if(0===a.length)return!1;let{tr:i,schema:l}=e,o=buildGenerators(l),s=null==n?void 0:n.listName;if(!s)return appendNodesToDocument(e,a);{let t=findParentList(e.tr.doc,B.HY.fromArray([o.text(s)]));if(t){let n=t.pos+t.node.nodeSize-1;return i.replaceRange(n,n,new B.p2(B.HY.fromArray(a),0,0)),maybeJoinList(e.tr,e.tr.doc.resolve(n)),!0}{let t=o.list(o.listItem([o.paragraphText(s),...a]));return appendNodesToFirstList(e,t)}}}(e,[t],n)}function updateListAttr(e,t,n,r){if(!t)throw Error("guid must exist");let a=e.doc,i=!1;return a.descendants((a,l)=>{if(i||a.type.isTextblock)return!1;if(isTask(a)){let o=a.attrs;o.guid===t&&(e.setNodeAttribute(l,n,r(o)),i=!0)}return!0}),i}function updateTaskChecked(e,{guid:t,checked:n}){let r=e.tr;return updateListAttr(r,t,"checked",e=>null!=n?n:!e.checked)}function updateListKind(e,{guid:t,kind:n}){let r=e.tr;return updateListAttr(r,t,"kind",()=>n)}function taskNodeToTaskDocumentJson(e,t){var n,r;let a=null!=(r=null==(n=e.toJSON())?void 0:n.content)?r:[];return{type:"doc",content:a,attrs:t}}function hasDeprecatedList(e){var t,n;let r=null!=(n=null==(t=null==e?void 0:e.attrs)?void 0:t.version)?n:0;return(!(0,en.Z)(r)||!(r<=5))&&function nodeHasDeprecatedList(e){return!!e&&(!!["bulletList","orderedList","listItem","taskList","taskListItem"].includes(e.type)||!!(e.content&&Array.isArray(e.content))&&e.content.some(nodeHasDeprecatedList))}(e)}}}]);