(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2222],{57250:function(t,e,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return r(91419)}])},1267:function(t,e,r){"use strict";r.d(e,{T:function(){return LoadingIndicator}});var n=r(85893);r(67294);var i=r(9037);let LoadingIndicator=t=>{let{duration:e=500,startAt:r=0,children:a}=t;return(0,n.jsx)("div",{className:"absolute inset-0 flex select-none items-center justify-center bg-coolgray-50 media-dark:bg-app-black dark:bg-app-black",children:(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-8 text-center",children:[(0,n.jsx)(i.P,{duration:e,startAt:r}),(0,n.jsx)("div",{className:"hidden text-gray-900",children:"Loading..."}),a]})})}},18731:function(t,e,r){"use strict";r.d(e,{k:function(){return ProgressBar}});var n=r(85893);r(67294);let ProgressBar=t=>{let{progress:e}=t;return(0,n.jsx)("div",{className:" h-3 w-60 overflow-hidden rounded-md bg-coolgray-200 media-dark:bg-white/5 dark:bg-white/5 ",style:{maskImage:"radial-gradient(white, black)"},children:(0,n.jsx)("div",{className:" duration-250 h-full w-full rounded-md bg-coolgray-400 transition-all duration-200 ease-linear media-dark:bg-primary dark:bg-primary ",style:{transform:"translate3d(".concat(-((1-e)*100),"%, 0, 0)")}})})}},9037:function(t,e,r){"use strict";r.d(e,{P:function(){return PseudoProgressBar}});var n=r(85893),i=r(67294),a=r(18731);let PseudoProgressBar=t=>{let{duration:e,startAt:r=0}=t,[o,c]=(0,i.useState)(r);return(0,i.useEffect)(()=>{let t=setInterval(()=>{c(e=>e>=1?(clearInterval(t),1):e+.01)},e/100);return()=>clearInterval(t)},[]),(0,n.jsx)(a.k,{progress:o})}},8677:function(t,e,r){"use strict";function retries(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((n,i)=>{let attempt=async t=>{try{n(await e())}catch(e){t>0?(console.error(e),setTimeout(()=>attempt(t-1),r)):i(e)}};attempt(t)})}r.d(e,{q:function(){return retries}})},52253:function(t,e,r){"use strict";r.d(e,{I:function(){return useFirebaseUser}});var n=r(67294),i=r(26655);function useFirebaseUser(){let[t,e]=(0,n.useState)(null),[r,a]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{i.I8.onAuthStateChanged(t=>{e(t),a(!0)})},[]),{authUser:t,loadedAuthUser:r}}},91419:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return Checkout}});var n=r(85893),i=r(11163),a=r(67294),o=r(1267),c=r(52253),u=r(25038),s=r(35339),l=r(31103);function Checkout(){let t=(0,i.useRouter)(),{authUser:e,loadedAuthUser:r}=(0,c.I)(),d="platoAnnually",authOrCheckout=async()=>{var r;if(!e){t.push("/auth");return}let n=await (0,s.PR)(e.uid);(null===(r=n.data())||void 0===r?void 0:r.stripe_subscription_id)?(0,l.g)():((0,u.j)("checkout_started",{products:[{productId:d}]}),(0,l.V)({plan:d,successPath:"/setup",cancelPath:"/checkout"}))};return(0,a.useEffect)(()=>{r&&authOrCheckout()},[r]),(0,n.jsx)(o.T,{})}},31103:function(t,e,r){"use strict";r.d(e,{V:function(){return redirectToCheckout},g:function(){return redirectToPortal}});var n="https://js.stripe.com/v3",i=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,findScript=function(){for(var t=document.querySelectorAll('script[src^="'.concat(n,'"]')),e=0;e<t.length;e++){var r=t[e];if(i.test(r.src))return r}return null},injectScript=function(t){var e=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(n).concat(e);var i=document.head||document.body;if(!i)throw Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(r),r},registerWrapper=function(t,e){t&&t._registerWrapper&&t._registerWrapper({name:"stripe-js",version:"1.32.0",startTime:e})},a=null,initStripe=function(t,e,r){if(null===t)return null;var n=t.apply(void 0,e);return registerWrapper(n,r),n},o=Promise.resolve().then(function(){return null!==a?a:a=new Promise(function(t,e){if("undefined"==typeof window){t(null);return}if(window.Stripe,window.Stripe){t(window.Stripe);return}try{var r=findScript();r||(r=injectScript(null)),r.addEventListener("load",function(){window.Stripe?t(window.Stripe):e(Error("Stripe.js not available"))}),r.addEventListener("error",function(){e(Error("Failed to load Stripe.js"))})}catch(t){e(t);return}})}),c=!1;o.catch(function(t){c||console.warn(t)});var loadStripe=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];c=!0;var n=Date.now();return o.then(function(t){return initStripe(t,e,n)})},u=r(14066),s=r(8677),l=r(40127);let d={platoAnnually:"price_1Lou4XIPqZUEoMM5U4PoaPb5"};async function redirectToPortal(){let t=await (0,l.tC)("/api/stripe/portal");(0,u.Ee)(t.url),window.location.replace(t.url)}async function redirectToCheckout(t){let e,{plan:r,successPath:n,cancelPath:i,trialDays:a}=t,o=d[r];if(!o)throw Error("invalid plan ".concat(r));await (0,s.q)(5,async()=>{let t=await (0,l.tC)("/api/stripe/checkout",{price_id:o,success_path:null!=n?n:null,cancel_path:null!=i?i:null,trial_days:null!=a?a:null});e=null==t?void 0:t.session_id,(0,u.Ee)(e,"session_id is not a string")});let c=await (p||(p=loadStripe("pk_live_51HiXU6IPqZUEoMM5DJzLbRZ2pIfWTQU9s3ufrPXqiRZ7YoRPNH5OvnhNpDudTgBKUkCFlIzqQvxX11B1zpQNHUVt00bqQVXfpK")),p);if(!c)throw Error("[stripe] Not loaded");let{error:f}=await c.redirectToCheckout({sessionId:e});if(f)throw Error("[stripe] Stripe error: ".concat(f.type,"/").concat(f.message))}let p=null}},function(t){t.O(0,[2016,786,461,1657,7754,2440,7641,6911,7333,8764,3418,7851,7115,8161,4596,4346,3765,4431,9774,2888,179],function(){return t(t.s=57250)}),_N_E=t.O()}]);