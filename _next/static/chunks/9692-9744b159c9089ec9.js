"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9692,198],{89692:function(e,t,n){n.d(t,{y:function(){return o}});var r=n(5152),a=n.n(r);let o=a()(()=>Promise.resolve().then(n.bind(n,87839)).then(e=>e.App),{loadableGenerated:{webpack:()=>[87839]},ssr:!1})},82531:function(e,t,n){n.r(t),n.d(t,{AppProvider:function(){return AppProvider}});var r=n(85893),a=n(9008),o=n.n(a),i=n(67294),s=n(28418),l=n(27074);let AppRegionDrag=()=>(0,r.jsx)("div",{className:"app-region-drag pointer-events-none absolute top-0 left-0 right-0 z-0 h-5"});var d=n(70670),c=n(79283),u=n(13554),h=n(1267),m=n(37226),p=n(88766),f=n(94541);let AppProvider=e=>{let{children:t,ready:n=!0}=e,[a,g]=(0,i.useState)(),x=(0,i.useMemo)(()=>(0,p.W)(),[]);return((0,i.useEffect)(()=>{n&&(0,l.k)().then(g)},[n]),a)?(0,r.jsx)(f.F0,{children:(0,r.jsxs)(d.S,{as:"main",className:"overflow-hidden",children:[(0,r.jsxs)(o(),{children:[(0,r.jsx)("link",{rel:"manifest",href:"/manifest.json"}),x&&(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"})]}),(0,r.jsx)(u.fc,{}),(0,r.jsx)(c.S,{children:(0,r.jsx)(s.LD,{value:a,children:(0,r.jsxs)(m.Q2,{children:[(0,r.jsx)(AppRegionDrag,{}),t]})})})]})}):(0,r.jsx)(h.T,{})}},87839:function(e,t,n){n.r(t),n.d(t,{App:function(){return App}});var r,a,o,i,s=n(85893),l=n(67294),d=n(61518),c=n(70586),u=n(69963),h=n(82531),m=n(15965),p=n(52300),f=n(68949),g=n(46670),x=n(28418);let v=window,y=(0,g.Pi)(()=>{let e=(0,x.Yh)();return(0,l.useEffect)(()=>(v.rootStore=e,v.nodeFromHtml=m.R7,v.toJS=f.toJS,v.fromUint8Array=p.kZ,v.toUint8Array=p._f,()=>{v.rootStore=null,v.nodeFromHtml=null,v.toJS=null,v.api=null,v.fromUint8Array=null,v.toUint8Array=null}),[e]),null});var b=n(11163),w=n(5152),j=n.n(w);let k=j()(()=>n.e(6899).then(n.bind(n,56899)).then(e=>e.Auth),{loadableGenerated:{webpack:()=>[56899]},ssr:!1}),N=j()(()=>Promise.all([n.e(1664),n.e(4644),n.e(5891)]).then(n.bind(n,75891)).then(e=>e.GraphSetupEncryption),{loadableGenerated:{webpack:()=>[75891]},ssr:!1});var S=n(540),C=n(6244),I=n(55204),V=n(57143),D=n(97197);let R=(0,g.Pi)(e=>{let{title:t,message:n,refreshLabel:r}=e,[a,o]=(0,l.useState)(!1);return(0,s.jsxs)(V.oU,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-purple-100 text-gray-900 dark:bg-dark-black-800 dark:text-purple-500",children:(0,s.jsx)(C.Z,{width:25,height:25})}),(0,s.jsxs)("div",{className:"mt-3 text-center sm:mt-5",children:[(0,s.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900 dark:text-near-white",children:t}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("p",{className:"m-auto w-2/3 text-sm leading-5 text-gray-500 dark:text-gray-200",children:n})})]})]}),(0,s.jsx)("div",{className:"mt-5 text-center sm:mt-8",children:(0,s.jsx)(I.mI,{onClick:()=>{o(!0),window.location.reload()},disabled:a,children:r})}),(0,s.jsx)("footer",{className:"absolute bottom-16 left-0 right-0 mt-10 flex items-center justify-center",children:(0,s.jsx)("button",{onClick:()=>(0,D.w)(),className:"cursor-pointer rounded-md border border-purple-200 px-5 py-2 text-sm text-purple-500 opacity-60 transition duration-300 hover:opacity-100 dark:border-purple-500",children:"Sign out"})})]})});var T=n(18731);let Spinner=e=>{let{className:t=""}=e;return(0,s.jsxs)("div",{className:"relative h-10 w-10 ".concat(t),children:[(0,s.jsx)("div",{className:"absolute h-full w-full rounded-[50%] border-[3px] border-bluegray-500/10"}),(0,s.jsx)("div",{className:"animate-spin-ease-in-out absolute h-full w-full rounded-[50%] border-l-[3px] border-t-[3px] border-purple-500 border-t-transparent"})]})},P=(0,g.Pi)(e=>{var t;let{message:n,graph:r}=e,a=null==r?void 0:null===(t=r.migrationManager)||void 0===t?void 0:t.migrationProgress;return(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,s.jsx)("p",{className:"mb-10 text-center text-gray-600",children:n}),a?(0,s.jsxs)("div",{className:"space-y-3 text-center",children:[(0,s.jsx)(T.k,{progress:a.progress}),(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-600",children:[a.percentFormatted,"%"]})]}):(0,s.jsx)(Spinner,{})]})})});var M=n(85716),E=n(1267),B=n(25038);let LoadingIndicator=e=>{let{delayedTimeout:t=!1}=e,[n,r]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!t)return;let e=setTimeout(()=>{(0,B.j)("loading_delayed"),r(!0)},1e4);return()=>clearTimeout(e)},[t]),(0,s.jsxs)(E.T,{duration:300,startAt:.3,children:[(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-1.5 text-sm text-coolgray-500",children:[(0,s.jsx)(M.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:"End-to-end encrypted"})]}),n?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-1 text-sm text-gray-900 media-dark:text-near-white dark:text-near-white",children:[(0,s.jsx)("p",{children:"Hmm, this is taking longer than it should."}),(0,s.jsx)("p",{children:"Can you try signing out and back in again?"})]}),(0,s.jsx)("footer",{className:"absolute bottom-16 left-0 right-0 mt-10 flex items-center justify-center",children:(0,s.jsx)("button",{onClick:()=>(0,D.w)(),className:"cursor-pointer rounded-md border border-purple-200 px-5 py-2 text-sm text-purple-500 opacity-60 transition duration-300 hover:opacity-100 media-dark:border-purple-500 dark:border-purple-600",children:"Sign out"})})]}):null]})};var L=n(70670),F=n(79283),A=n(12008),Z=n(70729),z=n(28394);let Banner=e=>{let{icon:t,children:n}=e;return(0,s.jsx)("div",{className:"relative bg-indigo-600",children:(0,s.jsx)("div",{className:"mx-auto max-w-7xl py-3 px-3 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"pr-16 sm:px-16 sm:text-center",children:(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-4 text-sm text-white",children:[(0,s.jsx)("div",{className:"flex-none",children:t}),(0,s.jsx)("div",{className:"font-medium",children:n})]})})})})},PaymentRequiredBanner=()=>{let e=(0,x.Yh)(),t=(0,x.Jf)(),navigateToBilling=()=>{e.setScreen(S.z2.Preferences),t.setScreen(S.JY.Billing)};return(0,s.jsx)(Banner,{icon:(0,s.jsx)(z.Z,{className:"w-6"}),children:(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{children:"Payment is required to continue using Reflect."})," ",(0,s.jsx)("a",{onClick:()=>navigateToBilling(),className:"cursor-pointer underline",children:"Go to billing →"})]})})},PaywallBanner=()=>{let e=(0,x.Yh)(),t=(0,x.Jf)(),navigateToBilling=()=>{e.setScreen(S.z2.Preferences),t.setScreen(S.JY.Billing)};return(0,s.jsx)(Banner,{icon:(0,s.jsx)(z.Z,{className:"w-6"}),children:(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{children:"Your notes are in read-only mode."})," ",(0,s.jsx)("a",{onClick:()=>navigateToBilling(),className:"cursor-pointer underline",children:"Subscribe to continue using Reflect →"})]})})},H=(0,g.Pi)(()=>{let e=(0,x.xJ)(),t=(null==e?void 0:e.subscriptionStatus)==="missing"||(null==e?void 0:e.subscriptionStatus)==="paymentRequired";return t?(0,s.jsxs)("div",{className:"flex-none",children:["missing"===e.subscriptionStatus&&(0,s.jsx)(PaywallBanner,{}),"paymentRequired"===e.subscriptionStatus&&(0,s.jsx)(PaymentRequiredBanner,{})]}):null});var _=n(73096);function useMessage(e,t){(0,l.useEffect)(()=>{let handler=t=>{t.data.command&&e(t.data)};return window.addEventListener("message",handler),()=>window.removeEventListener("message",handler)},t)}var O=n(38552);let K=(0,g.Pi)(()=>{var e,t;let n=(0,x.Pw)(),r=(0,x.Jf)(),a=(0,x.BG)(),o=(0,x.Fq)(),i=null==o?void 0:o.noteStore;return useMessage(e=>{switch(e.command){case"create-note":n.createAndEditNote();break;case"select-daily-note":n.openTodaysNoteDailyScreen();break;case"open-search":case"toggle-search":n.openSearchModal();break;case"open-shortcuts":case"toggle-shortcuts":n.toggleShortcutsModal();break;case"toggle-semi-screen":n.toggleSemiScreen();break;case"open-url":n.handleDeepLink(e.args.url)}},[n]),(0,_.y)("meta+/",e=>{e.preventDefault(),n.toggleShortcutsModal()}),(0,_.y)(O.Zx?"meta+n,meta+control+n":"control+n,control+alt+n",e=>{e.preventDefault(),n.closeModal(),n.createAndEditNote()},[n]),(0,_.y)(O.Zx?"meta+shift+n,meta+control+shift+n":"control+shift+n,control+alt+shift+n",e=>{e.preventDefault(),n.closeModal(),n.createAndEditNote({},{secondary:!0})},[n]),(0,_.y)("meta+d,meta+shift+d",e=>{e.preventDefault(),n.openTodaysNoteDailyScreen()},[n]),(0,_.y)("meta+shift+l,meta+shift+a",e=>{e.preventDefault(),n.openListScreen()},[n]),(0,_.y)("meta+shift+t",e=>{(null==o?void 0:o.tasksEnabled)&&(e.preventDefault(),n.openTaskView())},[n]),(0,_.y)("meta+shift+m",e=>{e.preventDefault(),n.openMapScreen()},[n]),(0,_.y)("meta+shift+f",e=>{e.preventDefault(),n.toggleSemiScreen()},[r]),(0,_.y)("meta+option+shift+left,meta+option+left",()=>n.focusPrimary(),{enabled:n.screenIsEditOrDaily&&!n.modal},[]),(0,_.y)("meta+option+shift+right,meta+option+right",()=>n.focusSecondary(),{enabled:n.screenIsEditOrDaily&&!n.modal},[]),(0,_.y)("escape",e=>{e.preventDefault(),n.closeSecondary()},{enabled:!n.modal&&!!(null==i?void 0:i.secondaryEditorView.hasSelectedNote)},[r]),(0,_.y)("escape",e=>{e.preventDefault(),n.setSemiScreenUser(!1)},{enabled:!n.modal&&n.semiScreenUser},[r]),(0,_.y)("escape",e=>{e.preventDefault(),n.clearEditorSearch()},{enabled:(null===(e=n.dailyEditorView)||void 0===e?void 0:e.searchEnabled)||(null===(t=n.primaryEditorView)||void 0===t?void 0:t.searchEnabled)},[n]),(0,_.y)("meta+1,meta+2,meta+3,meta+4,meta+5,meta+6,meta+7,meta+8,meta+9",e=>{if(O.d){e.preventDefault();let t=Number.parseInt(e.key.replace(/\D/,""),10),n=a.graphs[t-1];n&&a.setCurrentGraph(n)}},[a]),(0,_.y)("meta+o",e=>{let t=n.selectedNote;t&&(e.preventDefault(),null==i||i.togglePinned(t))},{enabled:n.noteHasFocus},[i]),(0,_.y)("meta+p, meta+k",e=>{e.preventDefault(),n.toggleSearchModal()},[n]),null});var G=n(90512);let Tab=e=>{let{active:t,children:n,persist:r=!0}=e,a="function"==typeof n,[o,i]=(0,l.useState)(null);return(0,l.useEffect)(()=>{t?o||i(a?n():n):r||i(null)},[t]),(0,s.jsx)("div",{tabIndex:t?void 0:-1,className:(0,G.Z)("tab absolute inset-0 flex flex-1 flex-col",!t&&"pointer-events-none -translate-x-full -translate-y-full"),children:o})},TabGroup=e=>{let{children:t}=e;return(0,s.jsx)("div",{className:"relative flex flex-1 flex-col overflow-hidden",children:t})},U=j()(()=>n.e(8930).then(n.bind(n,68930)).then(e=>e.NoteShow),{loadableGenerated:{webpack:()=>[68930]},ssr:!1}),W=(0,g.Pi)(()=>(0,s.jsx)("div",{className:"flex h-full w-full flex-1 flex-col items-center justify-center overflow-hidden",children:(0,s.jsx)("div",{className:"space-y-6 text-center",children:(0,s.jsx)("h3",{className:"text-base text-gray-400",children:"Unknown note"})})})),q=j()(()=>n.e(4522).then(n.bind(n,84522)).then(e=>e.NotesLoading),{loadableGenerated:{webpack:()=>[84522]},ssr:!1});var Q=n(6559),Y=n(25652),J=n(16592),X=n(75514);let HistoryIcon=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 6.5C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12C17.5 8.96243 15.0376 6.5 12 6.5ZM5 12C5 8.13401 8.13401 5 12 5C15.866 5 19 8.13401 19 12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 8C12.4142 8 12.75 8.33579 12.75 8.75V11.6893L13.7803 12.7197C14.0732 13.0126 14.0732 13.4874 13.7803 13.7803C13.4874 14.0732 13.0126 14.0732 12.7197 13.7803L11.4697 12.5303C11.329 12.3897 11.25 12.1989 11.25 12V8.75C11.25 8.33579 11.5858 8 12 8Z",fill:"currentColor"})]})},LinkIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.7093 6.25089C13.3771 4.58304 16.0812 4.58303 17.7491 6.25089C19.417 7.91875 19.417 10.6229 17.7491 12.2907L16.2595 13.7803C15.9666 14.0732 15.4917 14.0732 15.1989 13.7803C14.906 13.4874 14.906 13.0126 15.1989 12.7197L16.6884 11.2301C17.7705 10.148 17.7705 8.39362 16.6884 7.31155C15.6064 6.22948 13.852 6.22948 12.7699 7.31155L11.2803 8.80115C10.9874 9.09404 10.5126 9.09404 10.2197 8.80115C9.92678 8.50825 9.92678 8.03338 10.2197 7.74049L11.7093 6.25089ZM14.7803 9.21967C15.0732 9.51256 15.0732 9.98744 14.7803 10.2803L10.2803 14.7803C9.98744 15.0732 9.51256 15.0732 9.21967 14.7803C8.92678 14.4874 8.92678 14.0126 9.21967 13.7197L13.7197 9.21967C14.0126 8.92678 14.4874 8.92678 14.7803 9.21967ZM8.80115 10.2197C9.09404 10.5126 9.09404 10.9874 8.80115 11.2803L7.31155 12.7699C6.22948 13.852 6.22948 15.6064 7.31155 16.6884C8.39362 17.7705 10.148 17.7705 11.2301 16.6884L12.7197 15.1989C13.0126 14.906 13.4874 14.906 13.7803 15.1989C14.0732 15.4917 14.0732 15.9666 13.7803 16.2595L12.2907 17.7491C10.6229 19.417 7.91875 19.417 6.25089 17.7491C4.58303 16.0812 4.58304 13.3771 6.25089 11.7093L7.74049 10.2197C8.03338 9.92678 8.50825 9.92678 8.80115 10.2197Z",fill:"currentColor"})})},PinIcon=e=>{let{className:t,width:n,height:r}=e;return(0,s.jsx)("svg",{width:null!=n?n:24,height:null!=r?r:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.7983 7.78913C14.4128 7.40362 13.7877 7.40362 13.4022 7.78913L11.3891 9.80226C11.313 9.8784 11.2213 9.93726 11.1204 9.97482L8.10618 11.0967L12.9033 15.8938L14.0252 12.8796C14.0628 12.7787 14.1216 12.687 14.1978 12.6109L16.2109 10.5978C16.5964 10.2123 16.5964 9.58724 16.2109 9.20173L14.7983 7.78913ZM12.3416 6.72847C13.3129 5.75718 14.8877 5.75718 15.8589 6.72847L17.2715 8.14107C18.2428 9.11236 18.2428 10.6871 17.2715 11.6584L15.374 13.556L13.9017 17.5116C13.8127 17.7509 13.608 17.9284 13.3585 17.9828C13.1091 18.0372 12.8491 17.9609 12.6685 17.7803L9.97443 15.0862L7.28034 17.7803C6.98745 18.0732 6.51258 18.0732 6.21968 17.7803C5.92679 17.4874 5.92679 17.0126 6.21968 16.7197L8.91377 14.0256L6.21968 11.3315C6.03914 11.151 5.96285 10.891 6.01721 10.6415C6.07157 10.392 6.24911 10.1873 6.4884 10.0983L10.444 8.62604L12.3416 6.72847Z",fill:"currentColor"})})},TrashIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{d:"M17.25 8.75L15.4967 16.6817C15.2942 17.5978 14.4821 18.25 13.5438 18.25H10.4562C9.51794 18.25 8.70583 17.5978 8.50332 16.6817L6.75 8.75M17.25 8.75H18.25M17.25 8.75H15.25M6.75 8.75H5.75M6.75 8.75H8.75M8.75 8.75V8.75C8.75 7.09315 10.0931 5.75 11.75 5.75H12.25C13.9069 5.75 15.25 7.09315 15.25 8.75V8.75M8.75 8.75H15.25",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})};var $=n(93559);let UnTrashIcon=e=>{let{className:t}=e;return(0,s.jsx)("div",{className:"px-[3px] py-[3px] ".concat(t),children:(0,s.jsx)($.Z,{className:"h-full w-full"})})};var ee=n(57349),et=n(17524);let en={};function useSessionState(e,t){let n=(0,l.useMemo)(()=>en[t],[t]),[r,a]=(0,l.useState)(null!=n?n:e);return[r,e=>{a(e),en[t]=e}]}let SidebarItem=e=>{let{openKey:t,title:n,children:r}=e,[a,o]=useSessionState(!0,t);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("h3",{onClick:()=>o(!a),className:"group flex items-center px-3.5 text-xs font-medium text-muted-foreground",children:[(0,s.jsx)("span",{className:"flex-1 truncate",children:n}),(0,s.jsx)("span",{className:(0,G.Z)("flex-none group-hover:visible",a&&"invisible"),children:a?(0,s.jsx)(ee.Z,{width:12,height:12}):(0,s.jsx)(et.Z,{width:12,height:12})})]}),a&&(0,s.jsx)("div",{className:"px-2",children:r})]})};var er=n(72524),ea=n(47950),eo=n(19661),ei=n(88362),es=n(251),el=n(37997),ed=n(62269),ec=n(37226),eu=n(77004),eh=n(25152),em=n(42298),ep=n(98995),ef=n(51085),eg=n(97582),ex=n(75472),ev=n.n(ex),ey=n(98596),eb=n(46551),ew=n(14066),ej=n(34102),ek=n(27809);let HistoryView=class HistoryView{dispose(){}setLoading(e){this.loading=e}setCommits(e){let{saved:t,backups:n}=e;this.savedCommits=t,this.commitBackups=n}reset(){this.savedCommits=[],this.commitBackups=[],this.selectedCommit=null}get allCommits(){return[...this.savedCommits,...this.commitBackups]}get sortedCommits(){return ev()(this.allCommits,e=>e.createdAt,"desc")}get selectedCommitHtml(){let e=this.selectedCommitNode;return e?(0,m.eJ)(e):""}get selectedCommitNode(){return this.nodeForCommit(this.selectedCommit)}nodeForCommit(e){return e instanceof el.o?this.nodeForSavedCommit(e):e instanceof ey.f?this.nodeForBackupCommit(e):null}nodeForSavedCommit(e){if(e.documentNode)return e.documentNode;let t=this.savedCommits.indexOf(e);(0,ew.hu)(-1!==t,"selected commit not found in saved commits");let n=this.buildInitialYdoc(t);for(let e=0;e<=t;e++){var r;let t=this.savedCommits[e];(0,eb.Bu)(n,null!==(r=t.yjsUpdates)&&void 0!==r?r:[])}return(0,eb.gc)(n)}buildInitialYdoc(e){let t=new m.pU.Doc;for(let n=e;n>=0;n--){let e=this.savedCommits[n];if(e.yjsDocAsUpdate){m.pU.applyUpdate(t,e.yjsDocAsUpdate);break}}return t}nodeForBackupCommit(e){return e.documentNode}selectCommit(e){this.selectedCommit=e}selectFirstCommit(){var e;this.selectCommit(null!==(e=this.sortedCommits[0])&&void 0!==e?e:null)}async loadCommits(){if(this.reset(),!this.note)throw Error("blank note");if(!this.note.graph)return;this.setLoading(!0);let e=this.note.assertGraph,t=this.note.id,[n,r]=await Promise.all([(0,ek.x3)({graph:e,noteId:t,afterCommitId:null,skipErrors:!0}),(0,ej.t9)({graph:e,noteId:t,skipErrors:!0})]);this.setCommits({saved:n,backups:r}),this.selectFirstCommit(),this.setLoading(!1)}restoreSelectedCommit(){this.selectedCommit&&this.restoreCommit(this.selectedCommit)}restoreCommit(e){let t=this.note.assertNoteStore,n=this.nodeForCommit(e),r=n?(0,m.FT)(n):null,a=r?t.createRecoveredNote({note:this.note,document:r}):null;a&&this.mainView.editNote(a)}constructor({note:e,mainView:t}){this.loading=!1,this.savedCommits=[],this.commitBackups=[],this.selectedCommit=null,this.note=e,this.mainView=t,(0,f.makeObservable)(this)}};(0,eg.gn)([f.observable],HistoryView.prototype,"mainView",void 0),(0,eg.gn)([f.observable],HistoryView.prototype,"note",void 0),(0,eg.gn)([f.observable],HistoryView.prototype,"loading",void 0),(0,eg.gn)([f.observable],HistoryView.prototype,"savedCommits",void 0),(0,eg.gn)([f.observable],HistoryView.prototype,"commitBackups",void 0),(0,eg.gn)([f.observable],HistoryView.prototype,"selectedCommit",void 0),(0,eg.gn)([f.action],HistoryView.prototype,"setLoading",null),(0,eg.gn)([f.action],HistoryView.prototype,"setCommits",null),(0,eg.gn)([f.action],HistoryView.prototype,"reset",null),(0,eg.gn)([f.computed],HistoryView.prototype,"allCommits",null),(0,eg.gn)([f.computed],HistoryView.prototype,"sortedCommits",null),(0,eg.gn)([f.computed],HistoryView.prototype,"selectedCommitHtml",null),(0,eg.gn)([f.computed],HistoryView.prototype,"selectedCommitNode",null),(0,eg.gn)([f.action],HistoryView.prototype,"selectCommit",null);let eN=(0,g.Pi)(e=>{let{onClose:t,note:n}=e,r=(0,x.Pw)(),a=(0,eu.D)(()=>new HistoryView({note:n,mainView:r}),[n,r]),o=(0,ec.Fg)(),restoreCommit=()=>{a.restoreSelectedCommit(),t()};return(0,l.useEffect)(()=>{a.loadCommits()},[a]),(0,s.jsx)(ed.o,{onClose:t,children:(0,s.jsxs)("div",{className:" flex h-[90vh] max-h-[40rem] overflow-hidden rounded-lg border border-bluegray-200 dark:border-bluegray-800 ",children:[(0,s.jsx)("div",{className:" relative flex flex-1 flex-col overflow-scroll text-left ",children:a.loading?(0,s.jsx)(E.T,{}):(0,s.jsx)("div",{className:"flex-1 select-text overflow-auto p-8",children:a.selectedCommitHtml?(0,s.jsx)(m.d1,{size:"sm",html:a.selectedCommitHtml,dark:"dark"===o}):null})}),(0,s.jsxs)("div",{className:" flex flex-col border-l border-bluegray-200 dark:border-bluegray-800 lg:min-w-72 ",children:[(0,s.jsxs)("div",{className:"flex flex-1 flex-col overflow-auto",children:[a.sortedCommits.map(e=>{var t;return(0,s.jsxs)("div",{onClick:()=>a.selectCommit(e),className:(0,G.Z)("flex flex-none cursor-pointer flex-col space-y-0.5 px-5 py-3 text-sm","text-bluegray-600 dark:text-near-white","border-b border-bluegray-200 dark:border-bluegray-800 ",a.selectedCommit===e&&"bg-bluegray-100 dark:bg-bluegray-800"),children:[(0,s.jsxs)("div",{className:"flex justify-between space-x-[2px]",children:[e.createdAt&&(0,s.jsx)("span",{title:(t=e.createdAt,new Date(t).toUTCString()),className:"font-medium",children:function(e){let t=new Date(e);return(0,ef.Z)(t)?(0,em.Z)(t,"hh:mm a"):(0,ep.Z)(t)?(0,em.Z)(t,"eee hh:mm a"):(0,em.Z)(t,"MM/dd/yyyy")}(e.createdAt)}),(0,s.jsx)("div",{className:"text-bluegray-400 dark:text-near-white",children:e.platform===eh.t4.Web?(0,s.jsx)(ea.Z,{width:16}):e.platform===eh.t4.App?(0,s.jsx)(eo.Z,{width:16}):e.platform===eh.t4.Mobile?(0,s.jsx)(ei.Z,{width:16}):null})]}),(0,s.jsx)("div",{className:"flex space-x-[2px]",children:e instanceof el.o?(0,s.jsxs)("span",{children:["Commit #",e.id]}):(0,s.jsx)("span",{children:"(Unsaved changes)"})})]},e.id)}),!a.loading&&0===a.sortedCommits.length&&(0,s.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,s.jsx)("h3",{className:"text-bluegray-400 dark:text-bluegray-300",children:"No changes yet"})})]}),a.sortedCommits.length>0&&(0,s.jsxs)("footer",{className:" flex flex-none justify-between space-x-3 border-t border-bluegray-200 px-4 py-3 dark:border-bluegray-800 ",children:[a.selectedCommit&&(0,s.jsx)(I.KM,{title:"Create a new note from ".concat(a.selectedCommit.id),onClick:()=>restoreCommit(),children:"Restore to new note"}),(0,s.jsx)("a",{className:" inline-flex cursor-pointer items-center justify-center px-3 text-sm font-medium text-bluegray-500 dark:text-near-white ",onClick:t,children:"Cancel"})]}),(0,s.jsx)("div",{className:" flex flex-none items-center border-t border-bluegray-200 px-4 py-2 dark:border-bluegray-800 ",children:(0,s.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:"https://reflect.academy/note-history",className:" inline-flex cursor-pointer space-x-2 text-xs text-bluegray-500 dark:text-bluegray-300 ",children:[(0,s.jsx)(es.Z,{width:15,height:15}),(0,s.jsx)("span",{children:"Learn about page history"})]})})]})]})})});var eS=n(13385);let NoteActionItem=e=>{let{onClick:t,className:n="",icon:r,shortcut:a,label:o}=e;return(0,s.jsxs)("div",{className:"\n      group relative flex \n      items-center space-x-2 rounded-lg \n      px-3\n      py-2 hover:bg-gray-200/50\n      dark:hover:bg-white/3\n      dark:hover:text-white\n      ".concat(n,"\n      "),onClick:t,children:[(0,s.jsx)("div",{className:"flex h-5 w-5 flex-none items-center justify-center text-coolgray-400 group-hover:text-coolgray-900 dark:group-hover:text-white",children:r}),(0,s.jsx)("div",{className:"flex-1 text-2xs font-medium",children:o}),a&&(0,s.jsx)("kbd",{className:" invisible inline-flex items-center  rounded-md border border-coolgray-300 bg-white  px-1.5 py-0.5 font-sans text-[10px] font-medium uppercase shadow-sm group-hover:visible dark:border-white/10 dark:bg-white/5 ",children:(0,s.jsx)(eS.Ht,{shortcuts:a})})]})},eC=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.Fq)(),a=(0,x.Pw)(),o=(0,b.useRouter)(),[i,d]=(0,l.useState)(!1),onDelete=()=>{t.deletedAt?confirm("Are you sure? This will delete your note permanently.")&&(t.destroy(),(0,er.Am)({title:"Deleted",description:"Note was permanently deleted"})):(t.delete(),(0,er.Am)({title:"Trashed",description:"Note sent to trash"})),a.openListScreen()},onNotePublish=async()=>{await n.togglePublish(t),await navigator.clipboard.writeText(t.publishUrl),(0,er.Am)({description:"Public URL copied to clipboard"})};return(0,s.jsxs)(SidebarItem,{openKey:"actions",title:"Note actions",children:[i&&(0,s.jsx)(eN,{note:t,onClose:()=>d(!1)}),(0,s.jsx)(NoteActionItem,{onClick:()=>n.togglePinned(t),label:t.pinned?"Un-pin this note":"Pin this note",icon:(0,s.jsx)(PinIcon,{className:(0,G.Z)(t.pinned&&"text-accent")}),shortcut:["meta","o"]}),!t.daily&&(0,s.jsx)(NoteActionItem,{onClick:()=>onDelete(),className:(0,G.Z)(t.deletedAt&&"text-red-500"),icon:(0,s.jsx)(TrashIcon,{}),label:t.deletedAt?"Permanently delete":"Move to trash"}),!t.public&&(0,s.jsx)(NoteActionItem,{onClick:onNotePublish,icon:(0,s.jsx)(LinkIcon,{}),label:"Share with private link"}),t.public&&(0,s.jsx)(NoteActionItem,{onClick:()=>n.togglePublish(t),icon:(0,s.jsx)(LinkIcon,{}),label:"Unpublish link"}),t.deletedAt&&(0,s.jsx)(NoteActionItem,{onClick:()=>t.restore(),label:"Restore this note",icon:(0,s.jsx)(UnTrashIcon,{})}),(0,s.jsx)(NoteActionItem,{onClick:()=>d(!0),label:"Show history",icon:(0,s.jsx)(HistoryIcon,{})}),(null==r?void 0:r.hasFlag("note_debug_export"))&&(0,s.jsx)(NoteActionItem,{onClick:()=>o.push("/graphs/".concat(r.id,"/").concat(t.id,"/debug/export")),label:"Export debug file",icon:(0,s.jsx)(X.Z,{className:"w-3"})})]})});var eI=n(82280),eV=n(39138),eD=n.n(eV);let eR=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.v_)(),r=t.asin,a=r?n.findByAsin(r):null;return a?(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:" relative flex h-10  w-10 flex-none items-center justify-center overflow-hidden rounded-md ",children:[(0,s.jsx)(eI.Z,{className:"h-8 w-8 text-bluegray-200"}),a.coverSrc&&(0,s.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(a.coverSrc,")")}})]}),(0,s.jsx)("div",{className:"flex flex-1 flex-col space-y-2",children:(0,s.jsx)("h3",{className:"overflow-hidden text-sm leading-none text-primary",children:(0,s.jsx)("a",{href:a.listingUrl,target:"_blank",title:a.title,rel:"noreferrer",children:eD()(a.title,{length:30})})})})]}):null});var eT=n(97883);let CalendarIcon=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.75 6.5C7.50736 6.5 6.5 7.50736 6.5 8.75V15.25C6.5 16.4926 7.50736 17.5 8.75 17.5H15.25C16.4926 17.5 17.5 16.4926 17.5 15.25V8.75C17.5 7.50736 16.4926 6.5 15.25 6.5H8.75ZM5 8.75C5 6.67893 6.67893 5 8.75 5H15.25C17.3211 5 19 6.67893 19 8.75V15.25C19 17.3211 17.3211 19 15.25 19H8.75C6.67893 19 5 17.3211 5 15.25V8.75Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 12.246C9.00002 11.8318 9.33581 11.4961 9.75003 11.4961L10.25 11.4961C10.6642 11.4961 11 11.8319 11 12.2461C11 12.6603 10.6642 12.9961 10.25 12.9961L9.74997 12.9961C9.33576 12.9961 8.99998 12.6603 9 12.246Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 8.75C5 6.67893 6.67893 5 8.75 5H15.25C17.3211 5 19 6.67893 19 8.75V9.25C19 9.66421 18.6642 10 18.25 10H5.75C5.33579 10 5 9.66421 5 9.25V8.75Z",fill:"currentColor"})]})},ChevronLeftIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.7996 8.23966C15.0814 8.5432 15.0639 9.01775 14.7603 9.2996L11.8522 12L14.7603 14.7004C15.0639 14.9823 15.0814 15.4568 14.7996 15.7603C14.5177 16.0639 14.0432 16.0815 13.7397 15.7996L10.2397 12.5496C10.0868 12.4077 10 12.2086 10 12C10 11.7915 10.0868 11.5923 10.2397 11.4504L13.7397 8.20041C14.0432 7.91856 14.5177 7.93613 14.7996 8.23966Z",fill:"currentColor"})})},chevron_right_icon_ChevronRightIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10.2004 8.23966C9.91855 8.5432 9.93613 9.01775 10.2397 9.2996L13.1478 12L10.2397 14.7004C9.93613 14.9823 9.91855 15.4568 10.2004 15.7603C10.4823 16.0639 10.9568 16.0815 11.2603 15.7996L14.7603 12.5496C14.9132 12.4077 15 12.2086 15 12C15 11.7915 14.9132 11.5923 14.7603 11.4504L11.2603 8.20041C10.9568 7.91856 10.4823 7.93613 10.2004 8.23966Z",fill:"currentColor"})})};var eP=n(34199),eM=n(33002);let eE=(0,g.Pi)(e=>{let{selectedDate:t,onSelectDate:n,weekStart:r}=e,[a,o]=(0,l.useState)(!1),i=(0,x.dw)(),{cursorDate:d,headers:c,body:u,navigation:h}=(0,eT.ZP)({defaultWeekStart:r===x.L8.Monday?1:0,defaultDate:t}),dateIsSelected=e=>t.getTime()===e.getTime(),dateHasNotes=e=>i.hasNonEmptyNoteForDate(e);return(0,l.useEffect)(()=>{h.setDate(t)},[t]),(0,l.useEffect)(()=>{(0,eM.ZP)(()=>{o(!0)})},[]),(0,s.jsxs)("div",{className:"group min-w-36",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between px-4 py-4",children:[(0,s.jsx)("div",{className:"cursor-default text-sm font-semibold text-coolgray-900 dark:text-near-white",children:(0,em.Z)(d,"MMMM yyyy")}),(0,s.jsxs)("nav",{className:"flex items-center justify-center space-x-1 text-coolgray-400",children:[(0,s.jsx)("button",{onClick:h.toPrev,className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,s.jsx)(ChevronLeftIcon,{})}),(0,s.jsx)(eP.u,{label:"Jump to Today",shortcut:["meta","d"],children:(0,s.jsx)("button",{onClick:()=>{h.setToday(),n(new Date)},className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,s.jsx)(CalendarIcon,{})})}),(0,s.jsx)("button",{onClick:h.toNext,className:"cursor-default rounded-md transition-colors duration-100 hover:bg-gray-200/50 hover:text-coolgray-900 dark:hover:bg-white/5 dark:hover:text-white",children:(0,s.jsx)(chevron_right_icon_ChevronRightIcon,{})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"calendar-weekdays grid grid-cols-7 border-b border-coolgray-900/5 px-4 text-center dark:border-white/10",children:c.weekDays.map(e=>{let{key:t,value:n}=e;return(0,s.jsx)("div",{className:"py-2 text-2xs font-medium text-coolgray-900 dark:text-near-white",children:(0,em.Z)(n,"EEEEEE")},t)})}),(0,s.jsx)("div",{className:"px-4 py-2",children:u.value.map(e=>{let{key:t,value:r}=e;return(0,s.jsx)("div",{className:"grid grid-cols-7 text-center",children:r.map(e=>{let{key:t,date:r,isCurrentMonth:o,value:i}=e;return(0,s.jsx)(DayItem,{date:i,dayOfMonth:r,selected:dateIsSelected(i),isCurrentMonth:o,onSelectDate:n,showPresent:a&&dateHasNotes(i)},t)})},t)})})]})]})}),DayItem=e=>{let{date:t,selected:n,onSelectDate:r,isCurrentMonth:a,showPresent:o,dayOfMonth:i}=e;return(0,s.jsxs)("div",{onClick:()=>r(t),className:(0,G.Z)("calendar-day relative py-1.5 text-2xs",!a&&!n&&"opacity-20"),children:[n&&(0,s.jsx)(DayItemIndicator,{className:"bg-primary dark:bg-primary-dk"}),!n&&(0,ef.Z)(t)&&(0,s.jsx)(DayItemIndicator,{className:"bg-gray-200/50 dark:bg-gray-900"}),o&&(0,s.jsx)("div",{className:"pointer-events-none absolute bottom-1 left-1/2 -ml-0.5 h-1 w-1 rounded-full bg-primary/50 opacity-0 transition-opacity group-hover:opacity-100 dark:bg-white/50"}),(0,s.jsx)("div",{className:(0,G.Z)("relative cursor-default rounded-full duration-500 ",n&&"font-bold text-primary-foreground dark:text-primary"),children:i})]})},DayItemIndicator=e=>{let{className:t=""}=e;return(0,s.jsx)("div",{className:"absolute left-[50%] top-[50%] ml-[-16px] mt-[-16px] h-[32px] w-[32px] rounded-md ".concat(t)})},eB=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.nB)(),r=(0,x.Jf)();return(0,s.jsx)(eE,{selectedDate:t.dailyOrCreatedDate,weekStart:r.weekStart,onSelectDate:e=>n.setSelectedDate(e,{scroll:!0,edge:"subject_end"})})});var eL=n(60721),eF=n(22619),eA=n(66579),eZ=n(9340),ez=n(80133);let Company=e=>{var t,n,r,a;let{company:o,domain:i,name:l}=e;return(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"\n          relative flex h-10 \n          w-10 flex-none items-center justify-center overflow-hidden\n        ",children:[(0,s.jsx)(eL.Z,{className:"h-8 w-8 text-coolgray-200"}),(null==o?void 0:o.logo)&&(0,s.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(o.logo,")")}})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col space-y-2",children:[(0,s.jsx)("h3",{className:"text-sm leading-none text-primary",children:(0,s.jsx)("a",{href:"http://".concat(i),target:"_blank",rel:"noreferrer",children:l})}),(null==o?void 0:o.description)?(0,s.jsx)("div",{className:"text-2xs",title:null==o?void 0:o.description,children:eD()(null==o?void 0:o.description,{length:100})}):null,(0,s.jsxs)("div",{className:"flex space-x-3",children:[(null==o?void 0:null===(t=o.twitter)||void 0===t?void 0:t.handle)&&(0,s.jsx)("a",{href:"https://twitter.com/".concat(null==o?void 0:o.twitter.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eF.j,{className:"w-4"})}),(null==o?void 0:null===(n=o.github)||void 0===n?void 0:n.handle)&&(0,s.jsx)("a",{href:"https://github.com/".concat(null==o?void 0:o.github.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eA.R,{className:"w-4"})}),(null==o?void 0:null===(r=o.facebook)||void 0===r?void 0:r.handle)&&(0,s.jsx)("a",{href:"https://facebook.com/".concat(null==o?void 0:o.facebook.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eZ.d,{className:"w-4"})}),(null==o?void 0:null===(a=o.linkedin)||void 0===a?void 0:a.handle)&&(0,s.jsx)("a",{href:"https://linkedin.com/".concat(null==o?void 0:o.linkedin.handle),target:"_blank",className:"text-coolgray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(ez.m,{className:"w-4"})})]})]})]})};var eH=n(52823);let Person=e=>{var t,n,r,a,o;let{person:i,avatar:l,name:d}=e,c=(null==i?void 0:null===(t=i.linkedin)||void 0===t?void 0:t.handle)&&"https://linkedin.com/".concat(null==i?void 0:i.linkedin.handle),u=(null==i?void 0:i.site)||c;return(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:" relative flex h-10  w-10 flex-none items-center justify-center overflow-hidden rounded-md ",children:[(0,s.jsx)(eH.Z,{className:"h-8 w-8 text-bluegray-200"}),l&&(0,s.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(l,")")}})]}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col space-y-2",children:[(0,s.jsx)("h3",{className:"text-sm leading-none text-primary",children:u?(0,s.jsx)("a",{href:u,target:"_blank",rel:"noreferrer",children:d}):d}),(null==i?void 0:i.bio)||(null==i?void 0:i.employment.title)?(0,s.jsx)("div",{className:"text-sm",children:eD()(i.bio||i.employment.title||void 0,{length:100})}):null,(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(null==i?void 0:null===(n=i.twitter)||void 0===n?void 0:n.handle)&&(0,s.jsx)("a",{href:"https://twitter.com/".concat(null==i?void 0:i.twitter.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eF.j,{className:"w-4"})}),(null==i?void 0:null===(r=i.github)||void 0===r?void 0:r.handle)&&(0,s.jsx)("a",{href:"https://github.com/".concat(null==i?void 0:i.github.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eA.R,{className:"w-4"})}),(null==i?void 0:null===(a=i.facebook)||void 0===a?void 0:a.handle)&&(0,s.jsx)("a",{href:"https://facebook.com/".concat(null==i?void 0:i.facebook.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(eZ.d,{className:"w-4"})}),(null==i?void 0:null===(o=i.linkedin)||void 0===o?void 0:o.handle)&&(0,s.jsx)("a",{href:"https://linkedin.com/".concat(null==i?void 0:i.linkedin.handle),target:"_blank",className:"text-gray-400 transition-all duration-300 ease-in-out hover:text-primary",rel:"noreferrer",children:(0,s.jsx)(ez.m,{className:"w-4"})})]})]})]})},e_=(0,g.Pi)(e=>{var t;let{note:n}=e,r=(0,x.sx)(),a=(0,l.useMemo)(()=>r.findByEmail(n.firstEmail),[r,n.firstEmail]),o=n.enrichment||{},{person:i,company:d}=o,c=(null==i?void 0:null===(t=i.name)||void 0===t?void 0:t.fullName)||(null==a?void 0:a.name),u=(null==i?void 0:i.avatar)||(null==a?void 0:a.photoUrl),h=null==d?void 0:d.name,m=null==d?void 0:d.domain;return c||h||m?(0,s.jsxs)("div",{className:"space-y-4 border-t border-b border-coolgray-900/5 px-4 py-4",children:[c&&(0,s.jsx)(Person,{name:c,avatar:u,person:i}),h&&m&&(0,s.jsx)(Company,{name:h,domain:m,company:d})]}):null});var eO=n(36650);async function addMeeting(e){let t,{meeting:n,backlinkMeeting:r,note:a,noteStore:o}=e,i=o.assertGraph;o.attachNote(a);let s=[];for(let e of n.buildContacts){let t=o.findOrCreateByContact(e);s.push(t)}!r||!n.name||(t=o.findMeetingTagBySubject(n.name))||(t=o.createNote({subject:n.name,document:(0,m.FT)((0,x._F)(n,i.id))})),a.addMeeting({meeting:n,meetingNote:t,attendeeNotes:s}),i.findOrCreateTag(x.O9),await Promise.all(n.attendees.map(e=>syncAttendeeNameToContacts(e)))}async function syncAttendeeNameToContacts(e){let t=e.id,n=e.email,r=e.nameWithFallback;n&&r&&await (0,eO.Ms)({email:n,customName:r,contactId:t})}var eK=n(10928),eG=n.n(eK),eU=n(53699),eW=n(62980),eq=n(35881),eQ=n(34009),eY=n(25702),eJ=n(20833),eX=n(88766),e$=n(96445),e0=n(30842);async function setupAttendee(e){let{attendee:t,contactStore:n}=e;(function(e){let{attendee:t,contactStore:n}=e;if(!t.email)return;let r=n.findByEmail(t.email);(null==r?void 0:r.name)&&t.setName(r.name)})({attendee:t,contactStore:n}),await emailEnrich(t)}async function emailEnrich(e){var t;if(e.enrichedName||e.nameWithFallback||!e.email||!/.@./.test(e.email))return;let n=await (0,e0.I)({email:e.email});(null==n?void 0:null===(t=n.person)||void 0===t?void 0:t.email)===e.email&&e.setEnrichment(n)}let e1=(0,g.Pi)(e=>{var t,n;let{attendee:r}=e,a=(0,x.sx)();return(0,l.useEffect)(()=>{setupAttendee({attendee:r,contactStore:a})},[r,a]),(0,s.jsxs)("div",{className:"relative flex space-x-2",children:[(0,s.jsx)(eJ.o,{value:null!==(t=r.email)&&void 0!==t?t:"",onChange:e=>r.setEmail(e),onBlur:()=>emailEnrich(r),type:"email",placeholder:"Email"}),(0,s.jsx)(eJ.o,{value:null!==(n=r.nameWithFallback)&&void 0!==n?n:"",onChange:e=>r.setName(e),required:!!r.email,placeholder:"Name"}),(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 flex w-8 flex-none items-center justify-center",children:(0,s.jsx)("a",{onClick:()=>r.delete(),title:"Remove attendee",className:"cursor-pointer p-1 text-coolgray-400 transition duration-100 hover:text-coolgray-600 dark:text-near-white hover:dark:text-white",children:(0,s.jsx)(e$.Z,{className:"w-4"})})})]})}),e5=(0,g.Pi)(e=>{let{meeting:t,onClose:n,onAddMeeting:r}=e,[a,o]=(0,l.useState)(t.recurring),i=(0,l.useMemo)(()=>(0,eU.Nc9)(t),[t]),d=i.data.validAttendees,onSubmit=()=>{i.data.clearBlankAttendees(),i.commit(),r(t,a)};return(0,l.useEffect)(()=>{let e=eG()(d);e&&e.isBlank||i.data.addBlankAttendee()},[d]),(0,_.y)("meta+return",e=>{e.preventDefault(),onSubmit()},[]),(0,s.jsx)(eY.u,{onClose:n,children:(0,s.jsxs)("div",{className:"flex min-h-[400px] w-[460px] flex-1 flex-col px-10 py-10",children:[(0,s.jsx)("h3",{className:"flex-none text-center text-2xl font-medium leading-6",children:"Add meeting"}),(0,s.jsx)("div",{className:"mt-10 flex flex-1 flex-col",children:(0,s.jsxs)("form",{className:"flex flex-1 flex-col",onSubmit:e=>{e.preventDefault(),onSubmit()},children:[(0,s.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,s.jsx)("span",{children:"Name"}),(0,s.jsx)(eJ.o,{value:i.data.name,onChange:e=>i.data.setName(e),autoFocus:!(0,eX.W)(),autoComplete:"meeting-name"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("h3",{className:"block text-sm font-medium",children:"Attendees"}),d.length>0?(0,s.jsx)("button",{type:"button",className:" cursor-pointer rounded-md bg-coolgray-200/50  px-1.5 py-0.5 text-xs text-coolgray-400 outline-none  transition duration-300 ease-in-out hover:text-coolgray-900  focus-visible:ring focus-visible:ring-indigo-500 dark:bg-white/5 dark:text-white dark:hover:text-white",onClick:()=>i.data.clearAttendees(),children:"Clear all"}):null]}),(0,s.jsx)("div",{className:"mt-1.5 space-y-2",children:d.map(e=>(0,s.jsx)(e1,{attendee:e},e.id))})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"flex items-center space-x-2 text-sm font-medium",children:[(0,s.jsx)(eq.X,{checked:a,onChange:e=>o(e)}),(0,s.jsx)("span",{children:"Create backlinked note?"})]})})]}),(0,s.jsx)("footer",{className:"mt-8",children:(0,s.jsxs)(eW.M,{children:[(0,s.jsx)("span",{children:"Add to daily note"}),(0,s.jsx)(eQ.f,{title:"command return",shortcut:["meta","return"],className:"absolute right-2"})]})})]})})]})})});var e2=n(77e3);let e7=(0,g.Pi)(e=>{var t;let{meeting:n,onAddMeeting:r}=e;return(0,s.jsxs)("div",{onClick:()=>null==r?void 0:r(n),className:"\n      group flex items-center gap-2 overflow-hidden \n      rounded-lg py-2 px-4 text-2xs \n      hover:bg-coolgray-100 dark:hover:bg-white/3 dark:hover:text-white\n    ",children:[(0,s.jsx)("div",{className:"flex-1 truncate font-medium",title:"".concat(n.name," - ").concat(n.attendees.map(e=>e.email).join(" / ")),children:n.name}),(0,s.jsx)("div",{className:"min-w-[60px] flex-none tabular-nums text-coolgray-500",children:null!==(t=n.startAtTimeFormatted)&&void 0!==t?t:""}),(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)(eP.u,{label:"Add meeting to daily note",children:(0,s.jsx)("button",{className:"\n              inline-flex cursor-default items-center justify-center rounded-md\n              text-xs font-medium uppercase text-coolgray-400 outline-none\n              transition duration-100 group-hover:text-coolgray-900 dark:group-hover:text-white\n            ",children:(0,s.jsx)(e2.Z,{height:15})})})})]})}),e8=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.EC)(),a=(0,x.DV)(),[o,i]=(0,l.useState)(null),d=t.daily,c=(0,l.useCallback)(()=>{r.fetchAllMeetingsForDay(t.dailyOrCreatedDate)},[r,t.dailyOrCreatedDate]),handleAddMeeting=async(e,r)=>{i(null),await addMeeting({meeting:e,backlinkMeeting:r,note:t,noteStore:n}),(0,B.yV)({meeting_added:!0}),(0,B.j)("meeting_added")};if((0,l.useEffect)(()=>{if(!d)return;c();let e=setInterval(()=>{c()},6e5);return()=>{clearInterval(e)}},[t.id,d,a.credentials.length,c]),!d)return null;let u=r.meetingsForDaySorted(t.dailyOrCreatedDate);return 0===u.length?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(SidebarItem,{openKey:"meetings",title:"Meetings",children:u.map(e=>(0,s.jsx)(e7,{meeting:e,onAddMeeting:e=>i(e)},e.id))}),o&&(0,s.jsx)(e5,{meeting:o,onClose:()=>i(null),onAddMeeting:handleAddMeeting})]})});var e9=n(12825);let e3=(0,g.Pi)(e=>{let{note:t}=e;if(!t.public)return null;let onCopyPublishUrl=async()=>{await navigator.clipboard.writeText(t.publishUrl),(0,er.Am)({description:"Public URL copied to clipboard",icon:"check"})};return(0,s.jsx)(SidebarItem,{openKey:"published-url",title:"Published URL",children:(0,s.jsxs)("div",{className:"flex items-center overflow-hidden px-4",children:[(0,s.jsx)("a",{target:"_blank",className:"flex-1 truncate text-xs text-primary",href:t.publishUrl,rel:"noreferrer",children:t.publishUrl}),(0,s.jsx)("div",{className:"flex flex-none items-center",children:(0,s.jsx)(eP.u,{label:"Copy to clipboard",delay:400,children:(0,s.jsx)(e9.Z,{onClick:onCopyPublishUrl,className:"h-5 w-5 px-1 text-primary"})})})]})})});var e4=n(95231);let e6=(0,g.Pi)(e=>{var t;let{result:n,onClick:r}=e,a=n.title||(null===(t=n.contentLine)||void 0===t?void 0:t.slice(0,100))||"Untitled note";return(0,s.jsxs)("a",{className:"flex cursor-pointer items-center space-y-1 space-x-1 px-4 text-2xs",onClick:r,children:[(0,s.jsx)("div",{className:"flex-1 truncate",children:a}),(0,s.jsx)("div",{className:"flip",children:(0,s.jsx)(e4.Z,{height:13,width:13})})]})});function NoteSimilarNotes(e){var t;let{note:n}=e,[r,a]=(0,l.useState)([]),o=null===(t=n.noteStore)||void 0===t?void 0:t.searchStore,i=(0,x.Pw)();async function performSearch(){if(!o)return;let e=n.daily?n.line:"".concat(n.subject,". ").concat(n.line),t=await o.search(e,{type:"embedding",limit:5,similarity:.2});a(t.filter(e=>e.noteId!==n.id))}return((0,l.useEffect)(()=>{(0,eM.Kk)(()=>{performSearch()})},[n.rerenderKey,o]),0===r.length)?null:(0,s.jsx)(SidebarItem,{openKey:"similar",title:"Similar notes",children:(0,s.jsx)("div",{className:"space-y-2",children:r.map(e=>(0,s.jsx)(e6,{result:e,onClick:t=>{i.editNoteId(e.noteId,{secondary:(null==t?void 0:t.metaKey)||(null==t?void 0:t.ctrlKey)})}},e.id))})})}async function addSuggestedBacklink(e,t){let n;let r=e.findById(t.fromNoteId);if(!r)throw Error("Unknown fromNoteId:"+t.fromNoteId);t.toNoteId&&(n=n||e.findById(t.toNoteId)),t.label&&(n=n||e.findBySubject(t.label)),n=null!=n?n:e.createNote({subject:t.label});let a=r.changeManager.modifyDocument(r=>(0,m.Ne)(r,r=>{(0,m.sW)(r,{id:n.id,label:t.label,graphId:e.assertGraph.id})}));return await Promise.all([r.ignoreSuggestedBacklink(t),n.incrementBacklinkedCount(),a])}var te=n(29354),tt=n(12428),tn=n(20740),tr=n(13861);let NoteSuggestedBacklinksView=class NoteSuggestedBacklinksView{dispose(){(0,tn.$)(this.listeners)}setShouldRender(e){this.shouldRender=e}setMatchingNoteIds(e){this.matchingNoteIds=e}get suggestedIncomingBacklinks(){if(!this.shouldRender)return[];let e=this.matchingNotes.flatMap(e=>{let{node:t}=(0,tt.Zd)(e.snapshot);return t?(0,x.II)({graphId:this.graphId,fromNoteId:e.id,fromNoteNode:t,toNoteId:this.note.id,queries:this.queries}):[]});return e.filter(e=>!this.note.ignoredBacklinkFromNoteIds.includes(e.fromNoteId))}get matchingNotes(){return this.matchingNoteIds.map(e=>this.noteStore.allNotes.query.findById(e)).filter(tr.Dw)}async searchNotes(e,t){if(!e)return;if(0===t.length){this.setMatchingNoteIds([]);return}let n=await this.noteStore.searchStore.searchCombined(t),r=n.map(e=>e.noteId).filter(tr.Dw).filter(e=>e!==this.note.id);this.setMatchingNoteIds(r)}get queries(){return(0,te.gO)(this.note.subject).filter(e=>e.length>3)}get graphId(){return this.noteStore.assertGraph.id}get noteAdapter(){return this.noteStore.assertAdapter}constructor(e){this.shouldRender=!1,this.matchingNoteIds=[],this.listeners=[],this.note=e.note,this.noteStore=e.noteStore,(0,f.makeObservable)(this),(0,eM.ZP)(()=>{this.setShouldRender(!0)}),this.listeners.push((0,f.reaction)(()=>[this.shouldRender,this.queries],e=>{let[t,n]=e;this.searchNotes(t,n)}))}};(0,eg.gn)([f.observable],NoteSuggestedBacklinksView.prototype,"note",void 0),(0,eg.gn)([f.observable],NoteSuggestedBacklinksView.prototype,"noteStore",void 0),(0,eg.gn)([f.observable],NoteSuggestedBacklinksView.prototype,"shouldRender",void 0),(0,eg.gn)([f.observable],NoteSuggestedBacklinksView.prototype,"matchingNoteIds",void 0),(0,eg.gn)([f.action],NoteSuggestedBacklinksView.prototype,"setShouldRender",null),(0,eg.gn)([f.action],NoteSuggestedBacklinksView.prototype,"setMatchingNoteIds",null),(0,eg.gn)([f.computed],NoteSuggestedBacklinksView.prototype,"suggestedIncomingBacklinks",null),(0,eg.gn)([f.computed],NoteSuggestedBacklinksView.prototype,"matchingNotes",null),(0,eg.gn)([f.computed],NoteSuggestedBacklinksView.prototype,"queries",null);var ta=n(73527),to=n(68595),ti=n(13840);let ts=(0,g.Pi)(e=>{let{onClickAdd:t,onClickIgnore:n,backlink:r}=e,a=(0,x.dw)(),o=(0,x.Pw)(),i=a.findById(r.fromNoteId),l=(0,ec.Fg)();return(0,s.jsxs)("div",{className:"space-y-0.5 px-4",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)("div",{className:"flex flex-1 items-center space-x-2 overflow-hidden text-primary",title:"Incoming backlink",children:[(0,s.jsx)(ta.Z,{className:"h-3 w-3"}),(0,s.jsx)("a",{className:"flex-1 cursor-pointer truncate text-xs leading-5",onClick:()=>o.editNote(i||null),children:null==i?void 0:i.subject})]}),(0,s.jsxs)("div",{className:"ml-1 flex flex-none space-x-2",children:[(0,s.jsx)("button",{onClick:n,title:"Ignore suggestion",className:"hover:shadow-outline-purple rounded-md text-gray-300 transition duration-300 ease-in-out",children:(0,s.jsx)(to.Z,{className:"h-3 w-3"})}),(0,s.jsx)("button",{onClick:t,title:"Add backlink",className:" hover:shadow-outline-purple rounded-md text-green-400 transition duration-300 ease-in-out",children:(0,s.jsx)(ti.Z,{className:"h-3 w-3"})})]})]}),(0,s.jsx)(m.d1,{size:"xs",className:"backlink-html-context overflow-hidden !text-xs text-gray-900 empty:hidden dark:text-near-white",html:r.contextHtml,dark:"dark"===l})]})}),tl=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.dw)(),r=(0,x.Pw)(),a=r.screenHasFocus(S.oK.NoteEdit),o=(0,eu.D)(()=>new NoteSuggestedBacklinksView({note:t,noteStore:n}),[t,n]),i=o.suggestedIncomingBacklinks;return((0,l.useEffect)(()=>{o.setShouldRender(a)},[o,a]),0===i.length)?null:(0,s.jsxs)(SidebarItem,{openKey:"suggested-backlinks",title:"Suggested backlinks",children:[(0,s.jsx)("div",{className:"space-y-1",children:i.map((e,r)=>(0,s.jsx)(ts,{note:t,backlink:e,onClickAdd:()=>addSuggestedBacklink(n,e),onClickIgnore:()=>t.ignoreSuggestedBacklink(e)},r))}),(0,s.jsx)("div",{className:"flex justify-end px-4",children:(0,s.jsx)("button",{onClick:()=>i.forEach(e=>addSuggestedBacklink(n,e)),className:"flex space-x-1 text-xs text-primary",children:(0,s.jsx)("span",{children:"Add all"})})})]})}),td=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.sx)(),r=(0,l.useMemo)(()=>fetchContact(t,n),[t,n]),a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[n,r]=(0,l.useState)();return(0,l.useEffect)(()=>{let t=!1;return e.then(e=>{t||r(e)}),()=>{t=!0}},[e,...t]),n}(r);return!a||t.isContactIgnored(a)?null:(0,s.jsx)(SidebarItem,{openKey:"suggested-contact",title:"Suggested contact",children:(0,s.jsxs)("div",{className:"mt-4 flex space-x-4 rounded-md bg-background px-4 py-4 pb-3 shadow-sm",children:[(0,s.jsx)("div",{className:"h-16 w-16 flex-none overflow-hidden rounded-md bg-gray-300",children:a.photoUrl&&(0,s.jsx)("div",{className:"inline-block h-full w-full bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(a.photoUrl,")")}})}),(0,s.jsxs)("div",{className:"flex flex-1 flex-col space-y-2 overflow-hidden",children:[(0,s.jsx)("h3",{className:"text-lg leading-5 text-primary",children:a.name}),(0,s.jsxs)("div",{className:"space-y-1 text-sm text-gray-700",children:[(0,s.jsx)("div",{className:"truncate",children:a.emailValues[0]}),(0,s.jsx)("div",{className:"truncate",children:a.phoneNumberValues[0]})]})]}),(0,s.jsxs)("div",{className:"flex flex-none items-start space-x-2",children:[(0,s.jsx)("button",{onClick:()=>t.ignoreSuggestedContact(a),title:"Ignore suggestion",className:"focus:shadow-outline-purple block cursor-pointer rounded-md text-gray-300 transition duration-300 ease-in-out focus:outline-none",children:(0,s.jsx)(to.Z,{height:15})}),(0,s.jsx)("button",{onClick:()=>t.addSuggestedContact(a),title:"Add contact",className:" focus:shadow-outline-purple block cursor-pointer rounded-md text-green-400 transition duration-300 ease-in-out focus:outline-none",children:(0,s.jsx)(ti.Z,{height:15})})]})]})})});async function fetchContact(e,t){return e.enrichment||e.emails.length>0||e.phoneNumbers.length>0?null:t.findByName(e.debouncedSubject)}let tc=(0,g.Pi)(e=>{let{note:t}=e,n=(0,x.DV)();return(0,s.jsx)("div",{className:"flex flex-1 flex-col space-y-5 overflow-auto bg-coolgray-50 capacitor:pt-5 dark:bg-gray-800/30",children:t?(0,s.jsxs)(s.Fragment,{children:[t.daily&&(0,s.jsx)(eB,{note:t}),(0,s.jsxs)("div",{className:"my-4 space-y-4 pb-4",children:[(0,s.jsx)(eC,{note:t}),(0,s.jsx)(e3,{note:t}),(0,s.jsx)(td,{note:t}),(0,s.jsx)(eR,{note:t}),n.hasCredentials&&(0,s.jsx)(e8,{note:t}),(0,s.jsx)(tl,{note:t}),(0,s.jsx)(NoteSimilarNotes,{note:t}),!t.daily&&(0,s.jsx)(e_,{note:t})]})]}):null})});var tu=n(18446),th=n.n(tu),tm=n(47116),tp=n(78557),tf=n(94541),tg=n(24975),tx=n(62070);let ErrorBoundaryHtmlFallback=e=>{let{children:t,getHtml:n}=e;return(0,s.jsx)(tg.SV,{fallback:e=>{let{error:t,componentStack:r}=e;return(0,s.jsxs)("div",{className:"select-text",children:[(0,s.jsx)("h1",{className:"text-xl",children:"Sorry, something went wrong!"}),(0,s.jsx)("h2",{className:"text-sm",children:t.toString()}),(0,s.jsx)("pre",{className:"text-xs",children:r}),(0,s.jsx)("div",{className:"error-boundary pt-20",dangerouslySetInnerHTML:{__html:n()}})]})},showDialog:!0,beforeCapture:tx.W,children:t})};var tv=n(82847);let ImagePreview=e=>{let{onClose:t,imgSrc:n}=e;return(0,s.jsx)(V.oU,{onClose:t,children:(0,s.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center p-12",children:[(0,s.jsx)("img",{src:n,className:"max-h-full max-w-full cursor-zoom-out shadow-xl",onClick:t}),(0,s.jsxs)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"mt-5 flex cursor-pointer justify-center space-x-3 dark:text-gray-200",children:[(0,s.jsx)(tv.Z,{width:25,height:25}),(0,s.jsx)("span",{children:"See original in a new window"})]})]})})};var ty=n(62232);let tb=(0,ty.Z)({exact:!0}),tw=/.+@.+/;function buildEditorClickHandler(e){let{rootStore:t,noteId:n}=e;return e=>{e.preventDefault();let r=t.assertNoteStore,a=n?r.findById(n):void 0,o=(0,m.vu)(e);if(o&&a){a.toggleTaskChecked({taskGuid:o.guid});return}let i=e.target,s=i.getAttribute("href");if(!s)return;let l=new URL(function(e){if(!e)return"";switch(tw.test(e)?"email":tb.test(e)?"phone":e.startsWith("https://")?"https":e.startsWith("http://")?"http":null){case"email":return"mailto:".concat(e);case"phone":return"tel:".concat(e);case"http":case"https":return e;default:return"http://".concat(e)}}(s)),{graphStore:d,mainView:c}=t;if("https://reflect.app"===l.origin){let t=function(e){var t;let{graphId:n,tag:r,noteId:a}=(null===(t=tj.exec(e))||void 0===t?void 0:t.groups)||{};return"undefined"===n?{tag:r,noteId:a}:{graphId:n,tag:r,noteId:a}}(l.pathname),{tag:n,noteId:r,graphId:a}=t;if(a&&a!==d.currentGraphId&&(d.ensureVolatileGraphId(a),d.setCurrentGraphId(a)),n){c.openNotesListForTag(n),c.closeModal();return}if(r){let t=e.metaKey||e.ctrlKey;c.editNoteId(r,{secondary:t}),c.closeModal();return}}window.open(l.href,"_blank")}}let tj=RegExp("\\/g\\/(?<graphId>[\\w-]+)\\/(?:tag\\/(?<tag>[\\w-]+)|(?<noteId>[\\w-]+))"),tk=(0,g.Pi)(e=>{let{backlink:t,expanded:n=!0}=e,[r,a]=(0,l.useState)(n),o=(0,x.dw)(),i=(0,x.Pw)(),d=(0,x.Yh)(),c=t.fromNoteId,u=(0,l.useMemo)(()=>o.assertTable.get(c),[c]),h=(0,ec.Fg)(),p=(0,l.useMemo)(()=>buildEditorClickHandler({rootStore:d,noteId:c}),[d,c]),f=(0,l.useCallback)(e=>{let t=o.findById(c);if(!t)return;let n=e.metaKey||e.ctrlKey;i.editNote(t,{secondary:n})},[c]);return((0,l.useEffect)(()=>{a(n)},[n]),u)?(0,s.jsxs)("div",{className:"note-incoming-backlink-item group relative",children:[(0,s.jsxs)("div",{className:"relative flex items-center px-10",children:[(0,s.jsx)("a",{className:"relative block cursor-pointer select-text text-2xs text-primary dark:text-primary-dk",onClick:f,children:u.snapshot.subject}),(0,s.jsx)("div",{className:"absolute inset-y-0 left-[15px] flex items-center justify-center",children:(0,s.jsx)("div",{onClick:()=>a(!r),className:(0,G.Z)("increase-click-area hidden transform text-coolgray-400 transition-transform group-hover:block ",{"rotate-90":r}),children:(0,s.jsx)(et.Z,{className:"w-4"})})})]}),r&&(0,s.jsx)("div",{className:"px-10",children:(0,s.jsx)(m.d1,{onClick:p,html:t.contextHtml,size:"xs",className:"backlink-html-context select-text text-gray-900 transition-all empty:hidden dark:text-near-white",dark:"dark"===h})})]}):null});var tN=n(30347);let tS=(0,g.Pi)(e=>{let{note:t}=e,[n,r]=useSessionState(!0,"backlinks-expanded"),[a,o]=useSessionState(!1,"backlinks-hidden"),i=(0,x.Pw)(),l=t.incomingBacklinks,toggleExpanded=e=>{e.metaKey||e.ctrlKey?(o(e=>!e),r(!0)):(o(!1),r(e=>!e))};return((0,_.y)("control+command+b",e=>{e.preventDefault(),toggleExpanded(e)},{enabled:i.selectedNote===t},[toggleExpanded]),0===l.length)?null:(0,s.jsx)("div",{className:"flex flex-none flex-col overflow-hidden pb-8",children:(0,s.jsxs)("div",{className:"flex flex-1 flex-col",children:[(0,s.jsxs)("h3",{className:"relative flex items-center px-10 text-xs font-medium text-coolgray-400 dark:text-coolgray-600",onClick:toggleExpanded,children:[(0,s.jsxs)("span",{children:["Incoming backlinks (",l.length,")"]}),(0,s.jsx)("div",{className:"absolute inset-y-0 left-[15px] flex items-center justify-center",children:(0,s.jsx)("div",{className:(0,G.Z)("increase-click-area transform text-bluegray-400 transition-transform",{"rotate-90":n&&!a}),children:a?(0,s.jsx)(tN.Z,{className:"w-4"}):(0,s.jsx)(et.Z,{className:"w-4"})})})]}),!a&&(0,s.jsx)("div",{className:"mt-5 space-y-3 empty:hidden",children:l.map((e,t)=>(0,s.jsx)(tk,{backlink:e,expanded:n},t))})]})})});var tC=n(98240),tI=n(68825),tV=n(8677),tD=n(98930),tR=n(26655),tT=n(40127);async function uploadFile(e){let t,{blob:n,fileName:r,id:a=(0,tI.O)(),metadata:o,onProgress:i}=e,s=await (0,tT.i1)(),l="users/".concat(s.uid,"/").concat(a),d=tD.IG.ref(tR.tO,l);if(r){let e=encodeURIComponent(r);t="inline; filename*=UTF-8''".concat(e,'; filename="').concat(e,'"')}return await uploadBytes({storageRef:d,blob:n,metadata:{contentType:n.type,contentDisposition:t,cacheControl:"private,max-age=31536000",customMetadata:o},onProgress:i}),await tD.IG.getDownloadURL(d)}async function uploadFileWithUnloadWarning(e){let t,{blob:n,fileName:r,id:a=(0,tI.O)(),metadata:o,onProgress:i}=e,beforeUnloadListener=e=>(e.preventDefault(),e.returnValue="Files are currently uploading. Are you sure you want to exit?");addEventListener("beforeunload",beforeUnloadListener,{capture:!0});try{let updateCallback=async()=>await uploadFile({blob:n,fileName:r,id:a,metadata:o,onProgress:i});t=await (0,tV.q)(3,updateCallback)}catch(e){throw alert("Error uploading file. Please try again and ensure you are online."),e}finally{removeEventListener("beforeunload",beforeUnloadListener,{capture:!0})}return t}async function uploadBytes(e){let{storageRef:t,blob:n,metadata:r,onProgress:a}=e,o=tD.IG.uploadBytesResumable(t,n,r);a&&o.on("state_changed",e=>{let t=e.bytesTransferred/e.totalBytes*100;a(t)}),await new Promise((e,t)=>o.then(e,t))}function createEditorFileUploadHandler(e){let editorFileUploadHandler=async(t,n)=>{if(t.size>52428800)return alert("File is too large. 50mb is the max allowed size."),Promise.reject(Error("File is too large."));e.info("[editorFileUploadHandler] uploading ".concat(t.name));let r=await uploadFileWithUnloadWarning({blob:t,fileName:t.name,onProgress:n});return e.info("[editorFileUploadHandler] uploaded ".concat(t.name," to ").concat(r)),Promise.resolve({src:r,fileName:t.name})};return editorFileUploadHandler}var tP=n(45332);async function getLinkMetadata(e){try{var t,n;return null!==(n=await (null===tP.Z||void 0===tP.Z?void 0:null===(t=tP.Z.getUrlMetadata)||void 0===t?void 0:t.call(tP.Z,e)))&&void 0!==n?n:null}catch(e){return console.warn(e),null}}var tM=n(62431),tE=n(53522),tB=n(23279),tL=n.n(tB);let tF=tL()(function(e,t){e.warn(t)},3e4,{leading:!0});function trackPerf(e,t){let{label:n,noteId:r,logger:a,threshold:o}=t,i=performance.now();e();let s=performance.now()-i;return s>o&&tF(a,"".concat(n," took ").concat(s.toFixed(0),"ms [note: ").concat(r,"]")),s}async function createPrediction(e){let t=await (0,tT.g0)(),n=await fetch("/api/predict",{method:"POST",headers:{...t,"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){let e=await getErrorMessage(n);return alert(e),{stream:new ReadableStream}}(0,ew.hu)(n.body);let r=n.body.pipeThrough(new TextDecoderStream);return{stream:r}}async function getErrorMessage(e){try{var t;let n=await e.json();if(null===(t=n.error)||void 0===t?void 0:t.message)return n.error.message}catch(e){}return"Error fetching prediction"}var tA=n(54851);let tZ="Do not wrap responses in triple quotes. Do not translate the text.",tz=[{id:"continuation",label:"Write the next paragraph",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n"""\n{{selectedText}}\n"""\n\nWrite the next paragraph, keeping the same voice and style. Stay on the same topic. Write at least 3 sentences. '.concat(tZ)},{id:"sentence-continuation",label:"Continue writing the sentence",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n"""\n{{selectedText}}\n"""\n\nContinue writing the sentence, keeping the same voice and style. Stay on the same topic. Write 2 sentences. '.concat(tZ)},{id:"takeaways",label:"List key takeaways",temperature:.5,optimize:"accuracy",template:'My notes are below in triple quotes:\n\n"""\n{{selectedText}}\n"""\n\nWrite a markdown list (using dashes) of key takeaways from my notes. Write at least 3 items. Do not wrap responses in quotes. Use the original language - do not translate the text.'},{id:"fix-grammar",label:"Fix spelling and grammar",temperature:0,optimize:"speed",template:'Correct the text in triple quotes below into standard English and fix the grammar. Make your best effort.\n\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the corrected text. '.concat(tZ)},{id:"short-summary",label:"Write a short summary",temperature:.7,optimize:"speed",template:'Summarize the text in triple quotes but keep it concise. Summarize using plain and simple language and keep the same tense.\n            \n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the summary. '.concat(tZ)},{id:"long-summary",label:"Write a longer summary",temperature:.7,optimize:"speed",template:'Summarize the text in triple quotes below into three long paragraphs. Summarize using plain and simple language and keep the same tense.\n            \n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the summary. '.concat(tZ)},{id:"rephrase",label:"Rephrase my writing",temperature:.5,optimize:"accuracy",template:'Rewrite the text in triple below in your own words. Rephrase the text.\n\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the rephrased text. '.concat(tZ)},{id:"simplify",label:"Simplify and condense my writing",temperature:.5,optimize:"accuracy",template:'The following text in triple quotes below has already been written:\n\n""""\n{{selectedText}}\n"""\n\nSimplify and condense the writing. Do not return anything other than the simplified writing. '.concat(tZ)},{id:"copy-editor",label:"Act as a copy editor",temperature:0,optimize:"speed",template:'Act as a copy editor. Go through the text in triple quotes below. Edit it for spelling mistakes, grammar issues, punctuation, and generally for readability and flow. Format the text into appropriately sized paragraphs. Make your best effort. \n\n"""\n{{selectedText}}\n"""\n\nReturn only the edited text. Do not wrap your response in quotes. \nDo not offer anything else other than the edited text in the response. \nDo not translate the text. \nIf in doubt, or you can\'t make edits, just return the original text.'},{id:"generate-titles",label:"Suggest a few titles options",temperature:.7,optimize:"accuracy",template:'The blog post below has already been written:\n  \n"""BLOG POST: {{selectedText}}"""\n  \nGenerate a markdown list (using dashes) of five appropriate headlines for the blog post. Do not return anything other than the headlines. '.concat(tZ)},{id:"generate-tweets",label:"Suggest a few tweets based on my writing",temperature:.7,optimize:"accuracy",template:'The blog post below has already been written:\n\n"""BLOG POST: {{selectedText}}"""\n\nGenerate a markdown list (using dashes) of five tweets based off the blog post. Do not translate the text. Do not return anything other than the tweets. Do not wrap responses in quotes.'},{id:"generate-outline",label:"Generate an outline for an article",temperature:.5,optimize:"accuracy",template:'Create an outline for an essay about the topic below in the described format.\n        \nTopic:"""\n{{selectedText}}\n"""\n\nFormat:"""\n1. Introduction\n    - < sub section >\n    - < sub section >\n    - < sub section >\n2. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n3. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n4. < section >\n    - < sub section >\n    - < sub section >\n    - < sub section >\n5. Conclusion\n    - < sub section >\n    - < sub section >\n    - < sub section > \n"""\n\nDo not return anything other than the outline. '.concat(tZ)},{id:"generate-overview",label:"Generate an overview for an article",temperature:.5,optimize:"accuracy",template:'The article is below in the triple quotes:\n"""\n{{selectedText}}\n"""\n\nProvide a overview of the article. Use the following format:\n"""\nSummary: \n\n< one to two line summary >\n\nKey takeaways:\n1. < first key takeaway >\n2. < second key takeaway >\n3. < third key takeaway >\n\nCounter arguments:\n1. < first main counter argument >\n2. < second main counter argument >\n"""\n\nDo not return anything other than the overview. '.concat(tZ)},{id:"generate-counter-argument",label:"Generate a counter argument",temperature:.5,optimize:"accuracy",template:'Give the counter argument to the text below:\n"""\n{{selectedText}}\n"""\n\nDo not return anything other than the counter-argument. '.concat(tZ)},{id:"generate-email",label:"Generate an email",temperature:.5,optimize:"accuracy",template:'Write a professional and articulate email for the subject below:\n"""\nSubject: {{selectedText}}\n"""\n\nDo not return anything other than the email. '.concat(tZ)},{id:"action-items",label:"List action items",temperature:.5,optimize:"accuracy",template:'My note is below in triple quotes:\n"""\n{{selectedText}}\n"""\n\nWrite a todo list of action items from my notes using the following format:\n\n- [ ] <first action item>\n- [ ] <second action item>\n- [ ] <third action item>\n- [ ] <fourth action item>\n\nDo not return anything other than the todo list. '.concat(tZ)},{id:"blog-post",label:"Write a blog post",temperature:.5,optimize:"accuracy",template:"Write a blog post using the outline in triple quotes below. Use plain and simple language. Do not return anything other than the blog post. ".concat(tZ,'\n\n"""\n{{selectedText}}\n"""\n')},{id:"format-paragraphs",label:"Format paragraphs",temperature:0,optimize:"speed",template:"Format the text in triple quotes below into paragraphs. Do not return anything other than the formatted text. ".concat(tZ,'\n\n"""\n{{selectedText}}\n"""')},{id:"analogies",label:"Write analogies",temperature:.5,optimize:"accuracy",template:"Write three different analogies for the text in quotes below. Use plain and simple language. Do not return anything other than the analogies. ".concat(tZ,'\n\n"""\n{{selectedText}}\n"""')},{id:"backlinks",label:"Decorate my writing with backlinks",temperature:0,optimize:"speed",template:"Decorate the text in triple quotes below with backlinks. Keep the original text, but surround each person name, company name, and other nouns with double square brackets. So if the person has a name of Jerry, convert it to [[Jerry]]. Add backlinks to all people, places, things and projects. If it starts with a capital letter, backlink it. Do not include actions or verbs. ".concat(tZ,'\n     \n"""\n{{selectedText}}\n"""')},{id:"super-summarizer",label:"Super Summarizer",temperature:0,optimize:"accuracy",template:'You\'re a professional summarizer. Create a concise and comprehensive summary of the provided text, and adhere to these guidelines:  \n\n- Craft a detailed, thorough, and in-depth summary while maintaining clarity and conciseness. \n- Incorporate main ideas and essential information, eliminating extraneous language and focusing on critical aspects. \n- Rely strictly on the provided text, without including external information. \n- Format the summary in paragraph form for easy understanding starting with a bullet point at the beginning of each paragraph. \n- Write in the first-person perspective avoiding the use of things like "the speaker", "the user", and instead use the perspective of the speaker, eg "I". \n- Use markdown to cleanly format the output. \n- Bold key subject matter and indicate potential areas that may need expanded information using markdown. \n- At the beginning of each proper noun, person\'s name, project, company, workplace name, or type, surround it with double square brackets (backlinks) like this: [[Name]]. Add backlinks to all people, places, things, and projects (anything that starts with a capital letter). \n- End with a markdown checklist of action items (if any).\n\nUse the following format:\n\n## Summary title\n\n- Short summary 1\n- Short summary 2\n- Short summary 3\n- Short summary 4\n\n### Action Items\n\n- [ ] Action item 1\n- [ ] Action item 2\n- [ ] Action item 3\n\nContext in triple quotes below:\n\n """ {{selectedText}} """'},{id:"points-to-document",label:"Points to document",temperature:.3,optimize:"accuracy",template:"Turn these points into a quick document on the subject. Try and be as plithy and straightforward as possible. Bold key arguments. Use markdown to cleanly format the output.\n\nPoints:\n{{selectedText}}"}];(r=o||(o={})).System="system",r.Custom="custom";let PromptTemplateView=class PromptTemplateView{get templates(){return[...this.customPromptTemplates,...this.systemPromptTemplates]}get systemPromptTemplates(){return tz.map(e=>({id:e.id,label:e.label,template:e.template,type:o.System}))}get customPromptTemplates(){let e=this.promptTemplateStore.templates;return e.map(e=>({id:e.id,label:e.label,template:e.template,type:o.Custom}))}setPromptTemplate(e){let{id:t,label:n,template:r}=e;return(0,tA.Yu)({id:t,label:n,template:r})}removePromptTemplate(e){let{id:t}=e;return(0,tA.Lz)(t)}createPrediction(e){let{prompt:t,temperature:n,optimize:r}=e;return createPrediction({prompt:t,temperature:n,optimize:r})}constructor(e){this.promptTemplateStore=e,(0,f.makeObservable)(this)}};function usePromptTemplateConfig(){let e=(0,x.Xt)(),t=(0,l.useMemo)(()=>new PromptTemplateView(e),[e]);return{promptTemplates:t.templates,onPrediction:t.createPrediction.bind(t),onSetPromptTemplate:t.setPromptTemplate.bind(t),onRemovePromptTemplate:t.removePromptTemplate.bind(t)}}function useFocusEditor(e){return(0,l.useCallback)(t=>{!function(e,t){let{selection:n,scrollSelectedIntoView:r=!1}=t;setTimeout(()=>{try{null==e||e.focus((0,f.toJS)(n),r)}catch(e){(0,u.Tb)(e)}},0)}(e.current,t)},[])}(0,eg.gn)([f.computed],PromptTemplateView.prototype,"templates",null);let tH=new Map;let NoteDocumentView=class NoteDocumentView{get editorKey(){return[this.graph.id,this.note.id,this.note.remountCounter].join("-")}get yDoc(){return this.editorKey,(0,f.untracked)(()=>this.note.editedYDoc)}get editorContent(){return(0,ew.hu)(this.yDoc,"yjsDoc should be defined"),{type:"yjs",yjsDoc:this.yDoc}}get updatesToApply(){this.note.rerenderKey;let e=(0,f.untracked)(()=>this.getPendingUpdates()),{incomingUpdates:t,counter:n}=(0,f.untracked)(()=>this.note.getIncomingUpdates(this.incomingUpdateCounter)),r=[...t,...e];return{updates:r,counter:n}}get savingManager(){return this.note.changeManager.savingManager}get offline(){var e;let t=null===(e=this.savingManager.failure)||void 0===e?void 0:e.failedAt;return!!t}get offlineStatus(){var e;let t=null===(e=this.savingManager.failure)||void 0===e?void 0:e.failedAt,n=this.note.pendingChangesCount;return t&&n>0?{changes:n,since:t.getTime()}:{changes:n,since:null}}getPendingUpdates(){var e,t;let n=null===(e=this.note.changeStore)||void 0===e?void 0:e.getPendingCommit(this.note);return null!==(t=null==n?void 0:n.yjsUpdatesArrays)&&void 0!==t?t:[]}updatesApplied(e){this.incomingUpdateCounter=e}constructor({graph:e,note:t}){this.incomingUpdateCounter=null,this.graph=e,this.note=t,this.note.ensureYDoc(),(0,f.makeObservable)(this)}};function useNoteDocumentView(e){let{graph:t,note:n,editorRef:r,isEditable:a}=e,o=(0,l.useMemo)(()=>new NoteDocumentView({graph:t,note:n}),[t,n]);return(0,l.useEffect)(()=>{var e;let{updates:t,counter:n}=o.updatesToApply;0!==t.length&&a&&(null===(e=r.current)||void 0===e||e.yjsApplyUpdates(t),o.updatesApplied(n))},[o.updatesToApply,a]),o}(0,eg.gn)([f.observable],NoteDocumentView.prototype,"graph",void 0),(0,eg.gn)([f.observable],NoteDocumentView.prototype,"note",void 0),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"editorKey",null),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"yDoc",null),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"editorContent",null),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"updatesToApply",null),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"offline",null),(0,eg.gn)([f.computed],NoteDocumentView.prototype,"offlineStatus",null),(0,eg.gn)([f.action],NoteDocumentView.prototype,"updatesApplied",null);var t_=n(23164);function useScrollToSelection(e,t){let n=(0,t_.ze)(),r=(0,t_.zz)(),[a,o]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(!a||!n.wantsSpacer||!r.isVisible)return;o(!1);let i=e.current,s=t.current;if(!i||!s)return;let l=window.innerHeight,d=i.getSelectionCoords();if(!d)return;let c=l-n.keyboardHeight.value-5,u=d.top-c;u>0&&s.scrollBy({top:u+100,behavior:"auto"})},[a,n.wantsSpacer,r.isVisible]),()=>{o(!0)}}let tO=(0,g.Pi)(e=>{let{note:t,role:n,screenHasFocus:r}=e,a=(0,x.dw)(),o="primary"===n?a.primaryEditorView:a.secondaryEditorView,i=(0,x.Pw)(),d=(0,x.GR)(),c=(0,x.sx)(),{keyboardToolbarView:u}=(0,tf.l3)(),h=(0,x.xJ)(),{weekStart:p,dateFormat:f,timeFormat:g,spellCheck:v,editorSize:y}=(0,x.Jf)(),{onPrediction:b,promptTemplates:w,onSetPromptTemplate:j,onRemovePromptTemplate:k}=usePromptTemplateConfig(),N=(0,l.useRef)(null),[S,C]=(0,l.useState)(null),[I,V]=(0,l.useState)(null),D=(0,ec.Fg)(),R=t.assertGraph,T=R.templateStore,P=!r||!(null==h?void 0:h.inGoodStanding),M=(0,l.useRef)(null),E=(0,l.useRef)(!1),L=(0,l.useCallback)(e=>{let n=trackPerf(()=>{t.changeManager.yjsHandleUpdate(e)},{logger:R.logger,label:"Typing",threshold:50,noteId:t.id});i.addTypingMeasurement(n)},[t]),F=(0,l.useCallback)(e=>(0,tp.V)({noteStore:a,contactStore:c,backlink:e}),[a,c]),A=(0,l.useCallback)((e,t,n)=>i.handleBacklinkOpen(t,{secondary:n.modKey}),[i]),Z=(0,tM.o)({dateFormat:f,weekStart:p,backlinkStore:d,excludeNote:t}),z=(0,tE.N)(R),H=(0,l.useCallback)((e,t,n)=>{let r=a.findById(t.id);n?C(r||null):C(null)},[a,C]),_=(0,l.useCallback)(e=>((0,B.yV)({tag_created:!0}),(0,B.j)("tag_created"),R.onTagAdd(e)),[R]),O=(0,l.useCallback)((e,t)=>{i.openNotesListForTag(t.id)},[i]),K=(0,l.useCallback)(e=>{V(e.src)},[V]);(0,l.useEffect)(()=>{C(null)},[t]),(0,l.useEffect)(()=>{t.touchViewedAt()},[t]),(0,l.useEffect)(()=>{(0,m.wc)(t.document)&&R.logger.warn("Note has deprecated list format. Graph: ".concat(R.id,", Note: ").concat(t.id))},[t,R]);let U=(0,l.useCallback)(e=>a.getMergeNotesForNote(t,e),[a,t]),W=(0,l.useCallback)(async e=>{await i.mergeNotes({fromNote:t,toNoteId:e.id})},[t,i,a]),q=(0,tm.useReactToPrint)({content:()=>N.current,copyStyles:!0});useMessage(e=>{"print-note"===e.command&&r&&(null==q||q())});let Q=useNoteDocumentView({graph:R,note:t,editorRef:M,isEditable:!P}),Y=useFocusEditor(M);(0,l.useEffect)(()=>{let e=E.current,a=!e&&r&&i.activeEditor===n&&o.selectedNote===t;if(a){var s;let e=null!==(s=o.selectionView.getCursor(Q.editorKey))&&void 0!==s?s:"subject_end";Y({selection:e})}},[i.activeEditor,r,o.selectedNote,Q.editorKey]);let J=(0,l.useRef)(null),X=function(e,t){(0,l.useLayoutEffect)(()=>{var n;if(!e)return;let r=null!==(n=tH.get(e))&&void 0!==n?n:0,a=t.current;a&&(a.scrollTop=r)},[e,t]);let n=(0,l.useMemo)(()=>{if(e)return tL()(t=>{var n;let r=null!==(n=t.target.scrollTop)&&void 0!==n?n:0;tH.set(e,r)},300)},[e]);return n}(Q.editorKey,J),$=useScrollToSelection(M,J),ee=(0,l.useCallback)(e=>{u.setSelectionOptions(e),e.didFocus&&$()},[]),et=(0,l.useMemo)(()=>createEditorFileUploadHandler(R.logger),[R]),en=(0,l.useCallback)(()=>Q.offlineStatus,[Q]);return(0,l.useEffect)(()=>{r&&(0,eM.ZP)(()=>{var e,t;let n=o.searchQuery,r=o.searchNodeGuid;n||r?null===(e=M.current)||void 0===e||e.search({searchTerm:n,searchNodeGuid:r,activeIndex:0}):null===(t=M.current)||void 0===t||t.stopSearch()})},[r,o.searchQuery,o.searchNodeGuid]),(0,s.jsxs)(ErrorBoundaryHtmlFallback,{getHtml:()=>t.editedDocumentHtml,children:[(0,s.jsx)("div",{ref:N,className:"flex flex-1 flex-col overflow-hidden",children:(0,s.jsx)("div",{className:"relative flex flex-1 flex-col overflow-hidden",children:(0,s.jsx)("div",{className:(0,G.Z)("flex flex-1 flex-col overflow-auto"),ref:J,onScroll:X,children:(0,s.jsxs)("div",{className:(0,G.Z)("relative flex flex-1 flex-col",i.semiScreen&&"mx-auto w-full max-w-semi-screen"),children:[(0,s.jsx)(m.Mc,{editorKey:Q.editorKey,content:Q.editorContent,editorRef:M,graphId:R.id,yjsOnUpdate:L,templates:T.contentTemplates,onBacklinkAdd:F,onBacklinkOpen:A,onBacklinkHover:H,onImageClick:K,backlinkGenerator:Z,tagGenerator:z,onTagAdd:_,onTagClick:O,mergeNoteGenerator:U,onMergeNote:W,onFileUpload:et,readOnly:P,editable:r,onSelection:ee,onFocus:()=>{E.current=!0,u.show(M),i.handleFocus({note:t,editorView:o,editor:M.current,editorKey:Q.editorKey})},onBlur:()=>{E.current=!1,u.hide(),i.handleBlur({note:t,editorView:o,editor:M.current,editorKey:Q.editorKey})},offline:Q.offline,getOfflineStatus:en,dark:"dark"===D,timeFormat:g,spellCheck:v,promptTemplates:w,onSetPromptTemplate:j,onRemovePromptTemplate:k,onPrediction:b,onLinkMetadata:getLinkMetadata,dragIndicatorEnabled:!0,viewportSelector:"main",size:y}),(0,s.jsx)(tS,{note:t})]})})})}),S&&(0,s.jsx)(tC.f,{note:S}),I&&(0,s.jsx)(ImagePreview,{imgSrc:I,onClose:()=>V(null)})]})}),tK=(0,g.Pi)(e=>{let{note:t,visible:n,className:r}=e;return(0,s.jsx)("div",{className:(0,G.Z)("flex h-full flex-col",r),children:t&&t.isAttached&&(0,s.jsx)(tO,{note:t,role:"secondary",screenHasFocus:n})})}),tG=(0,g.Pi)(e=>{let{primaryNote:t,children:n,screenHasFocus:r}=e,a=(0,x.B0)(),{rightSidebarSize:o,secondaryEditorRatio:i}=a,d=(0,x.BO)(),c=(0,x.Pw)(),u=function(e){let[t,n]=(0,l.useState)(null!=e?e:null);return(0,l.useEffect)(()=>{e&&n(e)},[e]),t}(d.selectedNote),h={transition:"transform ".concat(250,"ms cubic-bezier(0.175, 0.885, 0.32, 1.1)"),transform:"translateX(100%)"},m={entering:{transform:"translateX(0%)"},entered:{transform:"translateX(0%)"},exiting:{transform:"translateX(100%)"},exited:{transform:"translateX(100%)"},unmounted:{}},p=(0,l.useRef)(1e3),f=function(e,t){let n=(0,l.useRef)(null),r=(0,l.useRef)({width:0,height:0});return(0,l.useEffect)(()=>{let t=n.current;if(!t)return;let a=new ResizeObserver(t=>{let[n]=t,{width:a,height:o}=n.contentRect,i={width:a,height:o};th()(i,r.current)||null==e||e(i)});return a.observe(t),()=>{a.disconnect()}},[n.current,...null!=t?t:[]]),n}(e=>{let{width:t}=e;return p.current=t}),g=c.semiScreen;return(0,s.jsx)(J.ZP,{timeout:250,in:d.hasSelectedNote,children:e=>{let l="entered"===e;return(0,s.jsxs)("div",{ref:f,className:"note-split",children:[(0,s.jsxs)(A.IF,{sidebarSize:l?i:o,sizeType:l?"ratio":"fixed",sidebarHidden:g&&!l,onResize:l?e=>a.setSecondaryEditorRatio(e):e=>a.setRightSidebarSize(e),minSidebarSize:l?300:200,sidebarPosition:"end",className:"absolute inset-0 overflow-hidden",children:[(0,s.jsx)(A.IF.Main,{className:"flex flex-row justify-center",children:(0,s.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:n})}),(0,s.jsx)(A.IF.Sidebar,{children:l?(0,s.jsx)("div",{}):(0,s.jsx)(tc,{note:t})})]}),(0,s.jsxs)("div",{className:(0,G.Z)("pointer-events-none absolute top-0 bottom-0 z-split h-full bg-background-stark pl-[3px] transition-all",["entered","entering"].includes(e)&&"shadow-2xl",!r&&"hidden"),style:{width:"".concat(100*i,"%"),right:0,...h,...m[e]},children:[(0,s.jsx)(tK,{note:u,visible:d.hasSelectedNote,className:"pointer-events-auto"}),(0,s.jsxs)("div",{className:"pointer-events-auto absolute top-4 right-4 z-50 flex gap-2",children:[(0,s.jsx)(eP.u,{label:"Open full note",children:(0,s.jsx)("button",{className:" flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-purple-50  text-purple-400 outline-none transition-all duration-50 hover:bg-purple-100 active:bg-purple-200 active:text-purple-500 dark:bg-purple-900/50 ",onClick:()=>c.editNote(u),tabIndex:-1,children:(0,s.jsx)(Q.Z,{className:"w-3"})})}),(0,s.jsx)(eP.u,{label:"Close split-view",shortcut:["esc"],children:(0,s.jsx)("button",{className:" flex h-7 w-7 cursor-pointer items-center justify-center rounded-full bg-purple-50  text-purple-400 outline-none transition-all duration-50 hover:bg-purple-100 active:bg-purple-200 active:text-purple-500 dark:bg-purple-900/50 ",onClick:()=>c.closeSecondary(),tabIndex:-1,children:(0,s.jsx)(Y.Z,{className:"w-4"})})})]}),(0,s.jsx)("div",{className:"pointer-events-none absolute top-0 -right-4 bottom-0 w-4 bg-background-stark"})]})]})}})}),tU=(0,g.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),{selectedNote:n}=(0,x.Ru)(),r=t.screenHasFocus(S.oK.NoteEdit);return n||"cache"!==e.mode?n?n.canWrite?(0,s.jsx)(tG,{primaryNote:n,screenHasFocus:r,children:(0,s.jsx)(tO,{role:"primary",note:n,screenHasFocus:r})}):(0,s.jsx)(U,{note:n}):(0,s.jsx)(W,{}):(0,s.jsx)(q,{})});var tW=n(26246),tq=n(88498);let DailyEditorItemView=class DailyEditorItemView{update(e){this.editorView=e.editorView,this.noteStore=e.noteStore,this.note=e.note,this.editorKey=e.editorKey}get dailySubject(){let{dateFormat:e}=this.assertPreferenceStore,t=(0,tq.$X)(e);return(0,tq.p6)(this.note.dailyOrCreatedDate,t)}get rootStore(){return this.noteStore.rootStore}get preferenceStore(){var e;return null===(e=this.rootStore)||void 0===e?void 0:e.preferenceStore}get assertPreferenceStore(){if(!this.preferenceStore)throw Error("Missing preference store");return this.preferenceStore}get isNoteSelected(){return this.editorView.selectedNote===this.note}get mainView(){return this.editorView.mainView}constructor({editorView:e,noteStore:t,note:n,editorKey:r}){this.editorView=e,this.noteStore=t,this.note=n,this.editorKey=r,(0,f.makeObservable)(this)}};(0,eg.gn)([f.observable],DailyEditorItemView.prototype,"editorView",void 0),(0,eg.gn)([f.observable],DailyEditorItemView.prototype,"noteStore",void 0),(0,eg.gn)([f.observable],DailyEditorItemView.prototype,"note",void 0),(0,eg.gn)([f.observable],DailyEditorItemView.prototype,"editorKey",void 0),(0,eg.gn)([f.action],DailyEditorItemView.prototype,"update",null),(0,eg.gn)([f.computed],DailyEditorItemView.prototype,"dailySubject",null),(0,eg.gn)([f.computed],DailyEditorItemView.prototype,"isNoteSelected",null);let tQ=(0,g.Pi)(e=>{let{graph:t,notes:n,note:r,virtuosoRef:a}=e,o=(0,ec.Fg)(),i=(0,x.GR)(),d=(0,x.sx)(),{keyboardToolbarView:c}=(0,tf.l3)(),u=(0,x.xJ)(),h=(0,x.dw)(),p=(0,x.Pw)(),f=(0,x.nB)(),g=t.templateStore,{weekStart:v,dateFormat:y,timeFormat:b,spellCheck:w,editorSize:j}=(0,x.Jf)(),{promptTemplates:k,onSetPromptTemplate:N,onRemovePromptTemplate:C,onPrediction:I}=usePromptTemplateConfig(),V=(0,l.useRef)(null),[D,R]=(0,l.useState)(null),[T,P]=(0,l.useState)(null),M=p.screenHasFocus(S.oK.NoteDaily),L=!M||!(null==u?void 0:u.inGoodStanding),F=(0,l.useRef)(null),A=(0,l.useRef)(!1),Z=f.selectedNote===r,z=(0,l.useMemo)(()=>n.indexOf(r),[n,r]),H=(0,l.useCallback)(e=>{h.attachNote(r);let n=trackPerf(()=>{r.changeManager.yjsHandleUpdate(e)},{logger:t.logger,label:"Typing",threshold:50,noteId:r.id});p.addTypingMeasurement(n)},[t,h,r]),_=(0,l.useCallback)(e=>(0,tp.V)({noteStore:h,contactStore:d,backlink:e}),[h,d]),O=(0,tM.o)({dateFormat:y,weekStart:v,backlinkStore:i,excludeNote:r}),K=(0,tE.N)(t),U=(0,l.useCallback)((e,t,n)=>{let r=h.findById(t.id);n?R(r||null):R(null)},[h,R]),W=(0,l.useCallback)((e,t,n)=>{p.handleBacklinkOpen(t,{secondary:n.modKey})},[p]),q=(0,l.useCallback)(e=>((0,B.yV)({tag_created:!0}),(0,B.j)("tag_created"),t.onTagAdd(e)),[t]),Q=(0,l.useCallback)((e,t)=>{p.openNotesListForTag(t.id)},[p]),Y=(0,l.useCallback)(e=>{P(e.src)},[P]),J=(0,l.useCallback)(()=>{if(z>0){let e=z-1;f.setSelectedDate(n[e].dailyOrCreatedDate,{scroll:!1,edge:"end"})}},[f,z,n]),X=(0,l.useCallback)(()=>{if(z<n.length-1){let e=z+1;f.setSelectedDate(n[e].dailyOrCreatedDate,{scroll:!1,edge:"start"})}},[f,n,z]);(0,l.useEffect)(()=>()=>{f.setSelectingEdge(null)},[]),(0,l.useEffect)(()=>{R(null)},[r.key]),(0,l.useEffect)(()=>{r.touchViewedAt()},[r.key]),(0,l.useEffect)(()=>{(0,m.wc)(r.document)&&t.logger.warn("Note has deprecated list format. Graph: ".concat(t.id,", Note: ").concat(r.id))},[r,t]);let $=(0,tm.useReactToPrint)({content:()=>V.current,copyStyles:!0});useMessage(e=>{"print-note"===e.command&&M&&Z&&(null==$||$())});let ee=useNoteDocumentView({graph:t,note:r,editorRef:F,isEditable:!L}),[et]=(0,l.useState)(()=>new DailyEditorItemView({editorView:f,noteStore:h,note:r,editorKey:ee.editorKey}));(0,l.useEffect)(()=>{et.update({editorView:f,noteStore:h,note:r,editorKey:ee.editorKey})},[f,h,r,ee.editorKey]);let en=(0,l.useCallback)(()=>{A.current=!0,c.show(F),p.handleFocus({note:r,editorView:f,editor:F.current,editorKey:ee.editorKey})},[r,f,ee.editorKey]),er=(0,l.useCallback)(()=>{A.current=!1,c.hide(),p.handleBlur({note:r,editorView:f,editor:F.current,editorKey:ee.editorKey})},[r,f,ee.editorKey]),ea=useScrollToSelection(F,a),eo=(0,l.useCallback)(e=>{c.setSelectionOptions(e),e.didFocus&&ea()},[]),ei=(0,l.useMemo)(()=>createEditorFileUploadHandler(t.logger),[t]),es=(0,l.useCallback)(()=>ee.offlineStatus,[ee]),el=useFocusEditor(F);return((0,l.useEffect)(()=>{if(f.isActive&&et.isNoteSelected&&(!A.current||f.forceFocus)){let e=f.getSelectionOption(ee.editorKey);el({selection:e,scrollSelectedIntoView:f.forceFocus}),f.resetForceFocus()}},[et.isNoteSelected,f.forceFocus,f.isActive]),(0,l.useEffect)(()=>{M&&Z&&(0,eM.ZP)(()=>{var e,t;let n=f.searchQuery,r=f.searchNodeGuid;n||r?null===(e=F.current)||void 0===e||e.search({searchTerm:n,searchNodeGuid:r,activeIndex:0}):null===(t=F.current)||void 0===t||t.stopSearch()})},[M,Z,f.searchQuery,f.searchNodeGuid]),t)?(0,s.jsxs)(ErrorBoundaryHtmlFallback,{getHtml:()=>r.editedDocumentHtml,children:[(0,s.jsx)("div",{className:(0,G.Z)("flex flex-shrink-0 flex-grow justify-center","border-b border-gray-100 dark:border-white/5",p.semiScreen&&"mx-auto w-full max-w-semi-screen"),ref:V,children:(0,s.jsxs)("div",{className:"flex w-full flex-1 flex-col",children:[(0,s.jsx)(m.Mc,{editorKey:ee.editorKey,editorRef:F,graphId:t.id,content:ee.editorContent,yjsOnUpdate:H,onBacklinkAdd:_,onBacklinkHover:U,onBacklinkOpen:W,backlinkGenerator:O,tagGenerator:K,templates:g.contentTemplates,onTagAdd:q,onTagClick:Q,onImageClick:Y,subject:et.dailySubject,editableSubject:!1,highlightSubject:r.isTodaysDailyNote,onFileUpload:ei,scrollSelectedIntoView:!0,onSelection:eo,onFocus:en,onBlur:er,onNavigateNext:X,onNavigatePrevious:J,readOnly:L,editable:M,offline:ee.offline,getOfflineStatus:es,dark:"dark"===o,timeFormat:b,spellCheck:w,promptTemplates:k,onSetPromptTemplate:N,onRemovePromptTemplate:C,onPrediction:I,onLinkMetadata:getLinkMetadata,style:{minHeight:"past"===r.dailyTense?"200px":"60vh"},dragIndicatorEnabled:!0,viewportSelector:"main",size:j}),(0,s.jsx)(tS,{note:r})]})}),D&&(0,s.jsx)(tC.f,{note:D}),T&&(0,s.jsx)(ImagePreview,{imgSrc:T,onClose:()=>P(null)})]}):(0,s.jsx)(E.T,{})}),tY=(0,g.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.nB)(),n=(0,l.useRef)(null),r=(0,l.useRef)(null),a=t.notes,o=(0,l.useRef)(new Set),i=(0,l.useRef)(1e4),[d,c]=(0,l.useState)(i.current-a.length),u=t.selectedNoteIndex,h=(0,l.useCallback)(()=>{let e=d-20;return e<=0&&(i.current=2*i.current,e=i.current-a.length),c(e),null==t||t.prependNotes(20),!1},[d,a]),{selectingScroll:m}=t,p=function(e){let[t,n]=(0,l.useState)(e);return(0,l.useEffect)(()=>{n(e)},[e]),(0,l.useEffect)(()=>{t&&n(null)},[t]),t}(t.selectedNote);return(0,l.useEffect)(()=>{if(-1===u)return;let e=p&&!o.current.has(p.id);if(m||e){var r;null===(r=n.current)||void 0===r||r.scrollToIndex({index:u,behavior:"auto",align:"start"})}t.setSelectingScroll(!1)},[u,m,p]),(0,s.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",ref:r,children:(0,s.jsx)("div",{className:"flex-1 flex-col overflow-hidden",children:(0,s.jsx)(tW.OO,{ref:n,data:a,initialTopMostItemIndex:-1===u?0:u,firstItemIndex:d,itemsRendered:e=>{o.current=new Set(e.map(e=>e.data).filter(tr.Dw).map(e=>e.id))},endReached:()=>{t.appendNotes()},startReached:h,itemContent:(t,r)=>(0,s.jsx)(tQ,{graph:e,notes:a,note:r,virtuosoRef:n},"".concat(e.id,"/").concat(r.id)),defaultItemHeight:370})})})}),tJ=(0,g.Pi)(()=>{let{selectedNote:e}=(0,x.nB)(),t=(0,x.Pw)(),n=t.screenHasFocus(S.oK.NoteDaily);return(0,s.jsx)(tG,{primaryNote:e,screenHasFocus:n,children:(0,s.jsx)(tY,{})})}),tX=j()(()=>n.e(5419).then(n.bind(n,15419)).then(e=>e.NotesList),{loadableGenerated:{webpack:()=>[15419]},ssr:!1}),t$=j()(()=>Promise.all([n.e(2166),n.e(2698),n.e(3286),n.e(3814)]).then(n.bind(n,33814)).then(e=>e.NotesMap),{loadableGenerated:{webpack:()=>[33814]},ssr:!1}),t0=j()(()=>Promise.all([n.e(2112),n.e(3423)]).then(n.bind(n,83423)).then(e=>e.Tasks),{loadableGenerated:{webpack:()=>[83423]},ssr:!1}),t1=(0,g.Pi)(()=>{let{screen:e}=(0,x.Pw)();return(0,s.jsxs)(TabGroup,{children:[(0,s.jsx)(Tab,{active:e===S.oK.NoteDaily,persist:!0,children:(0,s.jsx)(tJ,{})}),(0,s.jsx)(Tab,{active:e===S.oK.NoteList,persist:!0,children:(0,s.jsx)(tX,{})}),(0,s.jsx)(Tab,{active:e===S.oK.Map,persist:!1,children:()=>(0,s.jsx)(t$,{})}),(0,s.jsx)(Tab,{active:e===S.oK.NoteEdit,persist:!0,children:(0,s.jsx)(tU,{})}),(0,s.jsx)(Tab,{active:e===S.oK.TaskList,persist:!0,children:(0,s.jsx)(t0,{})})]})});var t5=n(12854),t2=n(86779);let t7=j()(()=>Promise.all([n.e(776),n.e(9220)]).then(n.bind(n,49220)).then(e=>e.AiChat),{loadableGenerated:{webpack:()=>[49220]},ssr:!1});var t8=n(3522),t9=n.n(t8),t3=n(94956),t4=n.n(t3);let t6=/[\n\r -#%-*,-/:;?@[-\]_{}]+/u,HighlightSnippet=e=>{let{enabled:t,snippet:n,query:r}=e,a=t?function(e){let{snippet:t,query:n,truncateLength:r=80}=e;if(!t)return[];if(!n)return[[!1,eD()(t,{length:r})]];let a=function(e){let t=e.replace(/^"(.*)"$/,"$1"),n=t.split(t6).filter(tr.Dw);return n}(n),o=function(e){let{snippet:t,queryWords:n,truncateLength:r=80}=e;if(t.length<=r)return t;let a=function(e,t){let n=e.toLowerCase();for(let e of t){let t=n.indexOf(e.toLowerCase());if(-1!==t)return t}return -1}(t,n);if(-1===a)return eD()(t,{length:r});let o=t.slice(Math.max(a-20,0),Math.min(a+r,t.length));return"...".concat(o,"...")}({snippet:t,queryWords:a,truncateLength:r}),i=function(e,t){let n=RegExp(t.filter(tr.Dw).map(t9()).join("|"),"gi"),r=[[!1,0]];for(let t of t4()(e,n)){let e=t[0].length;if(e<2)continue;let n=t.index;if(null==n)continue;let a=n+e;r.push([!0,n],[!1,a])}return r.push([!1,e.length]),r}(o,a);return 0===i.length?[[!1,eD()(o,{length:r})]]:function(e,t){let n=[];for(let r=0;r<t.length-1;r++){let[a,o]=t[r],[,i]=t[r+1];o!==i&&n.push([a,e.slice(o,i)])}return n}(o,i)}({snippet:n,query:r}):[[!1,n]];return(0,s.jsx)(s.Fragment,{children:a.map((e,t)=>{let[n,r]=e;return n?(0,s.jsx)("mark",{className:"relative bg-indigo-600/10 text-primary dark:text-indigo-400",children:r},t):(0,s.jsx)("span",{children:r},t)})})},ne=(0,g.Pi)(e=>{var t;let{query:n,result:r,selected:a,timeFormat:o,dateFormat:i,onClick:d,onMouseEnter:c}=e,u=r.timestamp,h=(0,l.useMemo)(()=>u?(0,tq.zg)(new Date(u),i,o):null,[i,o,u]);return(0,s.jsxs)("div",{style:{height:64},onClick:d,onMouseEnter:c,className:(0,G.Z)("shadow-border-b group flex cursor-pointer\n          flex-col justify-center space-y-1 px-5 py-2 text-sm\n          leading-5 focus:outline-none dark:text-near-white",{"bg-gray-200/50 dark:bg-white/5 dark:text-white":a}),children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("div",{className:"flex-1 truncate text-2xs font-medium",title:r.title,children:(0,s.jsx)(HighlightSnippet,{enabled:!!r.noteId,snippet:r.title,query:n})}),h&&(0,s.jsx)("div",{className:"flex-none text-[10px] text-coolgray-400",children:h})]}),r.noteId&&(0,s.jsxs)("div",{className:"truncate text-xs",title:eD()(r.contentLine,{length:200}),children:[(0,s.jsx)(HighlightSnippet,{enabled:!0,snippet:null!==(t=r.contentLine)&&void 0!==t?t:"",query:n}),!r.contentLine&&(0,s.jsx)("span",{className:"italic text-coolgray-400",children:"Empty"})]})]})}),nt=(0,g.Pi)(e=>{var t;let{query:n,result:r}=e,a=(0,ec.Fg)(),o=(0,x.dw)(),i=(0,x.Yh)(),[d,c]=(0,l.useState)("");(0,l.useEffect)(()=>{if(!n){c("");return}let e=setTimeout(()=>{c(n)},400);return()=>clearTimeout(e)},[n]);let u=(0,l.useMemo)(()=>r.noteId?o.findById(r.noteId):null,[r.noteId]),h=(0,l.useMemo)(()=>buildEditorClickHandler({rootStore:i}),[i]);return(0,s.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden  overflow-y-scroll p-5",children:(null==u?void 0:u.documentHtml)?(0,s.jsx)(m.d1,{size:"xs",html:null!==(t=null==u?void 0:u.documentHtml)&&void 0!==t?t:"",dark:"dark"===a,className:"!cursor-default",onClick:h,searchTerm:d}):(0,s.jsx)("div",{className:"flex flex-1 items-center justify-center",children:(0,s.jsx)("h3",{className:"text-lg font-medium",children:r.title})})})}),nn=/^#/;function skipHotkey(e){if(e.defaultPrevented)return!0;let t=window.document.activeElement;return null!=t&&!!t.closest("[data-search-badge]")}let nr=(0,g.Pi)(e=>{let{query:t,searchView:n}=e,r=(0,x.Pw)(),a=(0,x.Jf)(),[o,i]=(0,l.useState)(0),d=(0,l.useRef)(null),c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{n(!1);let onMouseMove=()=>n(!0);return window.addEventListener("mousemove",onMouseMove),()=>{window.removeEventListener("mousemove",onMouseMove)}},e),t}([n.query]),u=a.timeFormat,h=a.dateFormat,closeSearch=()=>{r.closeSearchModal()},onMouseEnter=e=>{c&&i(e)},scrollToIndex=e=>{var t;null===(t=d.current)||void 0===t||t.scrollIntoView({index:e})};return(0,_.y)("down, ctrl+n",e=>{if(skipHotkey(e))return;let t=Math.min(o+1,n.count);i(t),scrollToIndex(t)}),(0,_.y)("up, ctrl+p",e=>{if(skipHotkey(e))return;e.preventDefault();let t=Math.max(o-1,0);i(t),scrollToIndex(t)}),(0,_.y)("enter, meta+enter",e=>{var t,r;skipHotkey(e)||(e.preventDefault(),null===(r=n.results[o])||void 0===r||null===(t=r.onSelect)||void 0===t||t.call(r,e),closeSearch())}),(0,l.useEffect)(()=>{n.setQuery(t),i(0)},[n,t]),(0,l.useEffect)(()=>{let e=n.onAttached();return()=>void e()},[n]),(0,s.jsxs)("div",{className:"flex flex-1 overflow-auto",children:[(0,s.jsx)("div",{className:"shadow-border-r flex w-56 flex-none flex-col sm:w-72 md:w-96",children:(0,s.jsx)(tW.OO,{ref:d,width:"100%",height:"100%",data:n.results,itemContent:(e,t)=>(0,s.jsx)(ne,{query:n.query,result:t,selected:o===e,timeFormat:u,dateFormat:h,onClick:e=>{t.onSelect(e),closeSearch()},onMouseEnter:()=>onMouseEnter(e)},t.id)})}),(0,s.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden",children:n.results[o]?(0,s.jsx)(nt,{query:n.query,result:n.results[o]}):null})]})});var na=n(45578),no=n.n(na),ni=n(50477),ns=n(44717);let QuerySearchView=class QuerySearchView{get searchType(){return nn.test(this.query)?"tags":"notes"}get results(){switch(this.searchType){case"tags":return this.tagResults;case"notes":return[...this.searchByIdResults,...this.generatedResults,...this.noteResults,...this.actionResults,...this.noteActionResults];default:return[]}}get count(){return this.results.length}setQuery(e){this.query=e}setStrategy(e){this.strategy=e}removeFilter(e){let t=this.filters.findIndex(t=>t.type===e);-1!==t&&this.filters.splice(t,1)}addFilter(e){this.removeFilter(e.type),this.filters=[...this.filters,e]}getFilter(e){var t;return null!==(t=this.filters.find(t=>t.type===e))&&void 0!==t?t:null}hasFilter(e){return!!this.getFilter(e)}hasAnyFilter(){return this.filters.length>0}setNoteResults(e){this.noteResults=e}onAttached(){return this.listeners.push((0,f.reaction)(()=>[this.normalizedQuery,this.strategy,...this.filters],()=>{this.updateNoteResults()},{fireImmediately:!0})),()=>this.beforeDetach()}beforeDetach(){return(0,tn.$)(this.listeners)}async updateNoteResults(){let e=this.normalizedQuery;this.searching=!0;let t=e?await this.searchNoteResults(e):this.filterNoteResults();this.setNoteResults(t),this.searching=!1}async searchNoteResults(e){let t=await this.searchStore.search(e,{type:"text",exactSearch:"exact"===this.strategy||void 0}),n="semantic"===this.strategy&&await this.searchStore.search(e,{type:"embedding",similarity:.2}),r=n?no()([...n,...t],e=>e.noteId):t;return r.filter(e=>{let t=this.noteStore.findById(e.noteId);return t&&this.filterNote(t)}).map(e=>({...e,onSelect:t=>this.onSelectNote(e.noteId,t)}))}filterNoteResults(){var e;let t=this.noteStore.undeletedNotes.filter(e=>this.filterRow(e)).sortBy(e=>{var t,n;return null!==(n=null!==(t=e.snapshot.editedAt)&&void 0!==t?t:e.snapshot.updatedAt)&&void 0!==n?n:e.snapshot.createdAt},{order:"desc"}),n=this.query.length>0||this.filters.length>0;n||(t=t.limit(10));let r=t.results.map(tt.AZ);return e=(e,t)=>this.onSelectNote(e.id,t),r.map(t=>({id:t.id,title:t.title.substring(0,100),contentLine:t.line.substring(0,5e3),timestamp:t.editedOrUpdatedAt,onSelect:n=>e(t,n),noteId:t.id}))}get rootStore(){return this.noteStore.assertRootStore}get searchStore(){return this.noteStore.searchStore}get mainView(){return this.rootStore.mainView}get currentGraph(){return this.noteStore.assertGraph}get preferences(){return this.rootStore.preferenceStore}get dateFormat(){var e,t;return null!==(t=null===(e=this.preferences)||void 0===e?void 0:e.dateFormat)&&void 0!==t?t:x.t6.MonthDayYear}get weekStart(){var e,t;return null!==(t=null===(e=this.preferences)||void 0===e?void 0:e.weekStart)&&void 0!==t?t:x.L8.Monday}get backlinkDateGenerator(){return new ni.e({weekStart:this.weekStart,dateFormat:this.dateFormat})}filterRow(e){return 0===this.filters.length||this.filters.every(t=>t.filterRow(e))}filterNote(e){return 0===this.filters.length||this.filters.every(t=>t.filterNote(e))}onSelectDate(e){this.noteStore.dailyEditorView.setSelectedDate(e,{scroll:!0,focus:!0,edge:"subject_end"}),this.mainView.setScreen(S.oK.NoteDaily)}get tags(){if(!this.query)return[];let e=this.query.replace(nn,"");return this.currentGraph.tags.filter(t=>t.includes(e))}get tagResults(){return this.tags.map(e=>({id:e,title:"#".concat(e),onSelect:()=>this.mainView.openNotesListForTag(e)}))}onSelectNote(e,t){let n=this.noteStore.findById(e);this.mainView.editNote(n,{secondary:(null==t?void 0:t.metaKey)||(null==t?void 0:t.ctrlKey),searchQuery:this.query})}get normalizedQuery(){return(0,ns.U)(this.query)}get searchByIdResults(){if(!this.query)return[];let e=this.noteStore.findById(this.query);return e?[{id:e.id,title:e.subject,noteId:e.id,onSelect:t=>this.onSelectNote(e.id,t)}]:[]}get generatedResults(){if(!this.query)return[];let e=this.backlinkDateGenerator.generate(this.query),t=e.map(e=>({id:e.id,onSelect:()=>this.onSelectDate(e.dailyAt),timestamp:e.dailyAt.getTime(),title:e.label})),n=this.noteResults.map(e=>e.id);return t.filter(e=>!n.includes(e.id)).slice(0,3)}get actions(){return[{id:"daily-notes",title:"Go to daily notes",onSelect:()=>this.mainView.openTodaysNoteDailyScreen()},{id:"list-notes",title:"Go to all notes",onSelect:()=>this.mainView.openListScreen()},{id:"map",title:"Go to map",onSelect:()=>this.mainView.openMapScreen()},{id:"preferences",title:"Go to preferences",onSelect:()=>this.rootStore.openPreferencesScreen()},{id:"billing",title:"Go to billing",onSelect:()=>this.rootStore.openPreferencesScreen()},{id:"shortcuts",title:"Go to keyboard shortcuts",onSelect:()=>this.mainView.toggleShortcutsModal()},{id:"new-note",title:"Create a new note",onSelect:()=>this.mainView.createAndEditNote()},{id:"random-note",title:"Go to a random note",onSelect:()=>this.mainView.editRandomNote()},{id:"download-mac-app",title:"Install macOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-extension",title:"Install Chrome extension",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-ios-app",title:"Install iOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-mac-app",title:"Download macOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-extension",title:"Download Chrome extension",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"download-ios-app",title:"Download iOS app",contentLine:"reflect.app/download",onSelect:()=>window.open("/download")},{id:"contact-support",title:"Contact support",contentLine:"support@reflect.app",onSelect:()=>window.open("mailto:support@reflect.app")},{id:"contact-feedback",title:"Give feedback",contentLine:"feedback@reflect.app",onSelect:()=>window.open("mailto:feedback@reflect.app")},{id:"help-academy",title:"Help and academy",contentLine:"reflect.academy",onSelect:()=>window.open("/academy")},{id:"discord",title:"Community discord",contentLine:"reflect.app/discord",onSelect:()=>window.open("/discord")},{id:"roadmap",title:"Roadmap",contentLine:"roadmap.reflect.app",onSelect:()=>window.open("/roadmap")}]}get actionResults(){return this.query.length<3?[]:no()(this.actions.filter(e=>{let{title:t}=e;return t.toLowerCase().includes(this.normalizedQuery)}).slice(0,5),e=>e.id)}get noteActionResults(){return this.query?[{id:"create-note",title:"Create note '".concat(this.query,"'"),onSelect:e=>{let t=this.noteStore.createNote({subject:this.query});this.onSelectNote(t.id,e)}}]:[]}constructor(e){this.noteStore=e,this.query="",this.filters=[],this.noteResults=[],this.searching=!1,this.strategy="fuzzy",this.listeners=[],(0,f.makeObservable)(this)}};(0,eg.gn)([f.observable],QuerySearchView.prototype,"query",void 0),(0,eg.gn)([f.observable],QuerySearchView.prototype,"filters",void 0),(0,eg.gn)([f.observable.shallow],QuerySearchView.prototype,"noteResults",void 0),(0,eg.gn)([f.observable],QuerySearchView.prototype,"searching",void 0),(0,eg.gn)([f.observable],QuerySearchView.prototype,"strategy",void 0),(0,eg.gn)([f.computed],QuerySearchView.prototype,"searchType",null),(0,eg.gn)([f.computed],QuerySearchView.prototype,"results",null),(0,eg.gn)([f.computed],QuerySearchView.prototype,"count",null),(0,eg.gn)([f.action],QuerySearchView.prototype,"setQuery",null),(0,eg.gn)([f.action],QuerySearchView.prototype,"setStrategy",null),(0,eg.gn)([f.action],QuerySearchView.prototype,"removeFilter",null),(0,eg.gn)([f.action],QuerySearchView.prototype,"addFilter",null),(0,eg.gn)([f.action],QuerySearchView.prototype,"setNoteResults",null),(0,eg.gn)([(0,f.computed)({keepAlive:!0})],QuerySearchView.prototype,"backlinkDateGenerator",null),(0,eg.gn)([f.computed],QuerySearchView.prototype,"normalizedQuery",null),(0,eg.gn)([f.computed],QuerySearchView.prototype,"actions",null);var nl=n(45132),nd=n(41352),nc=n(13742),nu=n(64998),nh=n(50316),nm=n(74254),np=n(86158);let nf=nl.v2;nl.ZA,nl.h_,nl.Tr;let ng=nl.Ee,nx=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nl.fC,{ref:t,className:(0,nm.cn)("flex h-10 items-center space-x-1 rounded-md border bg-background p-1",n),...r})});nx.displayName=nl.fC.displayName;let nv=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nl.xz,{ref:t,className:(0,nm.cn)("flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",n),...r})});nv.displayName=nl.xz.displayName;let ny=l.forwardRef((e,t)=>{let{className:n,inset:r,children:a,...o}=e;return(0,s.jsxs)(nl.fF,{ref:t,className:(0,nm.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",n),...o,children:[a,(0,s.jsx)(nu.Z,{className:"ml-auto h-4 w-4"})]})});ny.displayName=nl.fF.displayName;let nb=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nl.tu,{ref:t,className:(0,nm.cn)("z-modal min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})});nb.displayName=nl.tu.displayName;let nw=l.forwardRef((e,t)=>{let{className:n,align:r="start",alignOffset:a=-4,sideOffset:o=8,...i}=e;return(0,s.jsx)(np.W,{children:(0,s.jsx)(nl.VY,{ref:t,align:r,alignOffset:a,sideOffset:o,className:(0,nm.cn)("z-modal min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...i})})});nw.displayName=nl.VY.displayName;let nj=l.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(nl.ck,{ref:t,className:(0,nm.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",n),...a})});nj.displayName=nl.ck.displayName;let nk=l.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...o}=e;return(0,s.jsxs)(nl.oC,{ref:t,className:(0,nm.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(nl.wU,{children:(0,s.jsx)(nc.Z,{className:"h-4 w-4"})})}),r]})});nk.displayName=nl.oC.displayName;let nN=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(nl.Rk,{ref:t,className:(0,nm.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(nl.wU,{children:(0,s.jsx)(nh.Z,{className:"h-2 w-2 fill-current"})})}),r]})});nN.displayName=nl.Rk.displayName;let nS=l.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(nl.__,{ref:t,className:(0,nm.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",n),...a})});nS.displayName=nl.__.displayName;let nC=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nl.Z0,{ref:t,className:(0,nm.cn)("-mx-1 my-1 h-px bg-muted",n),...r})});nC.displayName=nl.Z0.displayName;let SearchBadge=e=>{let{label:t,active:n,onActiveChange:r,value:a,onValueChange:o,onClick:i,children:d}=e,c=l.useRef(null),scrollIntoView=()=>{let e=c.current;e&&e.scrollIntoView({behavior:"smooth",block:"nearest"})};return(0,s.jsxs)("div",{className:"relative",ref:c,"data-search-badge":!0,children:[(0,s.jsxs)(nx,{value:a,onValueChange:o,className:(0,nm.cn)("relative m-0 flex h-7 space-x-0 divide-x overflow-hidden rounded-full p-0 transition","ring-ring ring-offset-1 focus-within:ring-2",n?"opacity-100":"opacity-50 focus-within:opacity-80 hover:border-primary/30 hover:opacity-80",n&&"border-accent/60 text-accent"),tabIndex:-1,onClick:i,children:[(0,s.jsx)("button",{tabIndex:0,className:(0,nm.cn)("h-full cursor-default select-none items-center whitespace-nowrap px-1.5 py-0 text-sm font-medium outline-none transition-colors first:pl-3 last:pr-3",n&&"hover:bg-secondary"),onClick:e=>{e.preventDefault(),r(!0),scrollIntoView()},children:t}),d]}),n&&(0,s.jsx)("button",{className:" absolute -top-[6px] -right-[6px] flex h-4 w-4 items-center justify-center rounded-full border-none  bg-primary text-primary-foreground opacity-100 outline-none  transition focus-within:outline-none focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-1 hover:bg-destructive hover:text-destructive-foreground hover:opacity-100 ",onClick:()=>r(!1),children:(0,s.jsx)(nd.Z,{className:"h-3 w-3"})})]})},SearchBadgeSegment=e=>{let{value:t,label:n,children:r}=e;return(0,s.jsxs)(nf,{value:t,children:[(0,s.jsx)(nv,{className:"h-full whitespace-nowrap rounded-none px-1.5 py-0 transition-colors first:pl-3 last:pr-3 hover:bg-secondary",children:n||"..."}),(0,s.jsx)(nw,{className:"max-h-[var(--radix-menubar-content-available-height)] overflow-auto",onCloseAutoFocus:preventDefaultHandler,children:r})]})},nI=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(nl.Rk,{ref:t,className:(0,nm.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),onSelect:preventDefaultHandler,...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(nl.wU,{children:(0,s.jsx)(nc.Z,{className:"h-4 w-4"})})}),r]})});function preventDefaultHandler(e){e.preventDefault()}nI.displayName="SearchBadgeCheckItem";let BoolBadge=e=>{let{label:t,value:n,onValueChange:r}=e;return(0,s.jsx)(SearchBadge,{label:t,active:n,onActiveChange:r,onClick:()=>{n&&r(!1)}})};var nV=n(77349),nD=n(11640),nR=n(99890),nT=n(37950);function isRelativeDateValue(e){return/^relative-\d+-(day|week|month|year)-(ago|ahead)$/.test(e)}function assertRelativeDateValue(e){if(!isRelativeDateValue(e))throw Error("Invalid relative date value: ".concat(e));return e}function isCustomSingleDateValue(e){return/^custom-single-\d+$/.test(e)}function isCustomRangeDateValue(e){return/^custom-range-\d+-\d+$/.test(e)}function isDateValue(e){return"today"===e||isRelativeDateValue(e)||isCustomSingleDateValue(e)||isCustomRangeDateValue(e)}function assertDateValue(e){if(!isDateValue(e))throw Error("Invalid date value: ".concat(e))}function getQuickDateValue(e,t){return!e||"today"===e||e.startsWith("relative-0-")?"today":e.startsWith("relative-1-")?e:e.startsWith("relative-")?"relative":"single"===t?"custom-single":"custom-range"}function parseDateValue(e){if(!e)return null;if(assertDateValue(e),"today"===e||e.startsWith("relative-0-"))return{from:new Date,to:null};if(isRelativeDateValue(e)){let[,t,n,r]=e.split("-"),a=new Date,o=Number.parseInt(t,10),i="ago"===r?-o:o;if("day"===n)return{from:(0,nV.Z)(a,i),to:null};if("week"===n)return{from:(0,nV.Z)(a,7*i),to:null};if("month"===n)return{from:(0,nD.Z)(a,i),to:null};if("year"===n)return{from:(0,nD.Z)(a,12*i),to:null};throw Error("Invalid date unit: ".concat(n))}if(isCustomSingleDateValue(e)){let[,,t]=e.split("-"),n=new Date(Number.parseInt(t,10));return{from:n,to:null}}if(isCustomRangeDateValue(e)){let[,,t,n]=e.split("-"),r=new Date(Number.parseInt(t,10)),a=new Date(Number.parseInt(n,10));return{from:r,to:a}}throw Error("Invalid date value: ".concat(e))}function formatNumberToEnglish(e){switch(e){case"1":return"one";case"2":return"two";case"3":return"three";case"4":return"four";case"5":return"five";case"6":return"six";case"7":return"seven";case"8":return"eight";case"9":return"nine";case"10":return"ten";default:return e}}var nP=n(3955);let CalendarPicker=e=>{let{mode:t,range:n,onChange:r,className:a}=e;if("single"!==t)return(0,s.jsx)(nP.f,{mode:"range",className:a,selected:{from:(null==n?void 0:n.from)||void 0,to:(null==n?void 0:n.to)||void 0},onSelect:e=>{if(e){var t,n;r({from:null!==(t=e.from)&&void 0!==t?t:null,to:null!==(n=e.to)&&void 0!==n?n:null})}else r(null)}});{let e=(null==n?void 0:n.from)||(null==n?void 0:n.to)||void 0;return(0,s.jsx)(nP.f,{mode:"single",className:a,selected:e,onSelect:e=>{e?r({from:e,to:e}):r(null)}})}};var nM=n(35917),nE=n(76405),nB=n(8971);let nL=nE.fC;nE.ZA;let nF=nE.B4,nA=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(nE.xz,{ref:t,className:(0,nm.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...a,children:[r,(0,s.jsx)(nE.JO,{asChild:!0,children:(0,s.jsx)(nB.Z,{className:"h-4 w-4 opacity-50"})})]})});nA.displayName=nE.xz.displayName;let nZ=l.forwardRef((e,t)=>{let{className:n,children:r,position:a="popper",...o}=e;return(0,s.jsx)(np.W,{children:(0,s.jsx)(nE.VY,{ref:t,className:(0,nm.cn)("relative z-modal min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",n),position:a,...o,children:(0,s.jsx)(nE.l_,{className:(0,nm.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})})});nZ.displayName=nE.VY.displayName;let nz=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nE.__,{ref:t,className:(0,nm.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",n),...r})});nz.displayName=nE.__.displayName;let nH=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(nE.ck,{ref:t,className:(0,nm.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(nE.wU,{children:(0,s.jsx)(nc.Z,{className:"h-4 w-4"})})}),(0,s.jsx)(nE.eT,{children:r})]})});nH.displayName=nE.ck.displayName;let n_=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nE.Z0,{ref:t,className:(0,nm.cn)("-mx-1 my-1 h-px bg-muted",n),...r})});n_.displayName=nE.Z0.displayName;let RelativeDatePicker=e=>{let{value:t,onValueChange:n,className:r}=e;t&&isRelativeDateValue(t)||(t="relative-1-day-ago");let[,a,o,i]=t.split("-");a||(a="1"),o||(o="day"),i||(i="ago");let setNum=e=>{n(assertRelativeDateValue("relative-".concat(e,"-").concat(o,"-").concat(i)))};return(0,s.jsxs)("div",{className:(0,nm.cn)("flex gap-1 overflow-x-hidden",r),children:[(0,s.jsx)(nM.I,{type:"number",value:a,className:"flex-1 !ring-transparent",onChange:e=>setNum(e.target.value)}),(0,s.jsxs)(nL,{value:o,onValueChange:e=>{n(assertRelativeDateValue("relative-".concat(a,"-").concat(e,"-").concat(i)))},children:[(0,s.jsx)(nA,{className:"flex-1 !ring-transparent",children:(0,s.jsx)(nF,{})}),(0,s.jsxs)(nZ,{className:"",children:[(0,s.jsx)(nH,{value:"day",children:"day(s)"}),(0,s.jsx)(nH,{value:"week",children:"week(s)"}),(0,s.jsx)(nH,{value:"month",children:"month(s)"}),(0,s.jsx)(nH,{value:"year",children:"years(s)"})]})]}),(0,s.jsxs)(nL,{value:i,onValueChange:e=>{n(assertRelativeDateValue("relative-".concat(a,"-").concat(o,"-").concat(e)))},children:[(0,s.jsx)(nA,{className:"flex-1 whitespace-nowrap !ring-transparent",children:(0,s.jsx)(nF,{})}),(0,s.jsxs)(nZ,{className:"",children:[(0,s.jsx)(nH,{value:"ago",children:"ago"}),(0,s.jsx)(nH,{value:"ahead",children:"from now"})]})]})]})},DatePicker=e=>{let{mode:t,value:n,onValueChange:r,onDismiss:a}=e,[o,i]=(0,l.useState)(getQuickDateValue(n,t)),d=n?parseDateValue(n):null,onQuickDateValueChange=e=>{i(e),isDateValue(e)&&(r(e),a())};return(0,l.useEffect)(()=>{i(getQuickDateValue(n,t))},[n,t]),(0,s.jsxs)("div",{className:"flex w-[300px] flex-col gap-2",children:["single"===t&&(0,s.jsxs)(ng,{value:null!=o?o:"",onValueChange:onQuickDateValueChange,children:[(0,s.jsx)(nI,{value:"today",children:"today"}),(0,s.jsx)(nI,{value:"relative-1-day-ago",children:"yesterday"}),(0,s.jsx)(nI,{value:"relative-1-day-ahead",children:"tomorrow"}),(0,s.jsx)(nI,{value:"relative-1-week-ago",children:"one week ago"}),(0,s.jsx)(nI,{value:"relative-1-week-ahead",children:"one week from now"}),(0,s.jsx)(nI,{value:"relative-1-month-ago",children:"one month ago"}),(0,s.jsx)(nI,{value:"relative-1-month-ahead",children:"one month from now"}),(0,s.jsx)(nI,{value:"relative",children:"relative date..."}),(0,s.jsx)(nI,{value:"custom-single",children:"exact date..."})]}),"range"===t&&(0,s.jsxs)(ng,{value:null!=o?o:"",onValueChange:onQuickDateValueChange,children:[(0,s.jsx)(nI,{value:"today",children:"today"}),(0,s.jsx)(nI,{value:"relative-1-week-ago",children:"the past week"}),(0,s.jsx)(nI,{value:"relative-1-month-ago",children:"the past month"}),(0,s.jsx)(nI,{value:"relative-1-year-ago",children:"the past year"}),(0,s.jsx)(nI,{value:"relative",children:"relative range..."}),(0,s.jsx)(nI,{value:"custom-range",children:"exact range..."})]}),o.startsWith("custom")&&(0,s.jsx)(CalendarPicker,{mode:t,range:d,onChange:e=>{let n=(null==e?void 0:e.from)||(null==e?void 0:e.to);if(e&&n){if("single"===t)r("custom-single-".concat(n.getTime()));else{let t=e.from||n,a=e.to||n;r("custom-range-".concat(t.getTime(),"-").concat(a.getTime()))}}}}),o.startsWith("relative")&&(0,s.jsx)(RelativeDatePicker,{value:n,onValueChange:r})]})},OperationPicker=e=>{let{value:t,onValueChange:n}=e;return(0,s.jsxs)(ng,{value:null!=t?t:"",onValueChange:n,children:[(0,s.jsx)(nI,{value:"is",children:"is..."}),(0,s.jsx)(nI,{value:"is before",children:"is before..."}),(0,s.jsx)(nI,{value:"is after",children:"is after..."}),(0,s.jsx)(nI,{value:"is within",children:"is within..."})]})},nO=(0,g.Pi)(e=>{let{label:t,view:n}=e,r=(0,x.Jf)().dateFormat;return(0,s.jsxs)(SearchBadge,{label:t,active:n.active,onActiveChange:e=>{n.handleActiveChange(e)},value:n.openSegment,onValueChange:e=>n.setOpenSegment(e),children:[n.active?(0,s.jsx)(SearchBadgeSegment,{value:"operation",label:n.operationValue,children:(0,s.jsx)(OperationPicker,{value:n.operationValue,onValueChange:e=>n.handleOperationValueChange(e)})}):null,n.active&&n.operationValue?(0,s.jsx)(SearchBadgeSegment,{value:"date",label:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return"";if(assertDateValue(e),"today"===e||e.startsWith("relative-0-"))return"today";if("relative-1-day-ago"===e)return"yesterday";if("relative-1-day-ahead"===e)return"tomorrow";if(isRelativeDateValue(e)){let[,t,r,a]=e.split("-"),o="1"===t?"":"s";return n?["the","ago"===a?"past":"feature",formatNumberToEnglish(t),r+o].join(" "):[formatNumberToEnglish(t),r+o,"ago"===a?"ago":"from now"].join(" ")}if(isCustomSingleDateValue(e)){let[,,n]=e.split("-"),r=Number.parseInt(n,10);return(0,tq.p6)(new Date(r),t)}if(isCustomRangeDateValue(e)){let[,,n,r]=e.split("-"),a=Number.parseInt(n,10),o=Number.parseInt(r,10),i=(0,tq.p6)(new Date(a),t),s=(0,tq.p6)(new Date(o),t);return i===s?i:"".concat(i," - ").concat(s)}return""}(n.dateValue,r,"is within"===n.operationValue),children:(0,s.jsx)(DatePicker,{value:n.dateValue,onValueChange:e=>n.setDateValue(e),onDismiss:()=>n.handleClose(),mode:n.calendarMode})}):null]})});var nK=n(65309),nG=n(87764);t5.fC,t5.xz;let nU=t5.h_;t5.x8;let nW=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(t5.aV,{ref:t,className:(0,nm.cn)("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...r})});nW.displayName=t5.aV.displayName;let nq=l.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(nU,{children:[(0,s.jsx)(nW,{}),(0,s.jsxs)(t5.VY,{ref:t,className:(0,nm.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg md:w-full",n),...a,children:[r,(0,s.jsxs)(t5.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(nd.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});nq.displayName=t5.VY.displayName;let nQ=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(t5.Dx,{ref:t,className:(0,nm.cn)("text-lg font-semibold leading-none tracking-tight",n),...r})});nQ.displayName=t5.Dx.displayName;let nY=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(t5.dk,{ref:t,className:(0,nm.cn)("text-sm text-muted-foreground",n),...r})});nY.displayName=t5.dk.displayName;let nJ=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nK.mY,{ref:t,className:(0,nm.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",n),...r})});nJ.displayName=nK.mY.displayName;let nX=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsxs)("div",{className:"-mt-1 flex items-center border-b px-2","cmdk-input-wrapper":"",children:[(0,s.jsx)(nG.Z,{className:"mr-2 h-3.5 w-3.5 shrink-0 opacity-50"}),(0,s.jsx)(nK.mY.Input,{ref:t,className:(0,nm.cn)("flex w-full rounded-md bg-transparent py-2 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",n),...r})]})});nX.displayName=nK.mY.Input.displayName;let n$=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nK.mY.List,{ref:t,className:(0,nm.cn)("max-h-[300px] max-w-xs overflow-y-auto overflow-x-hidden",n),...r})});n$.displayName=nK.mY.List.displayName;let n0=l.forwardRef((e,t)=>(0,s.jsx)(nK.mY.Empty,{ref:t,className:"py-6 text-center text-sm",...e}));n0.displayName=nK.mY.Empty.displayName;let n1=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nK.mY.Group,{ref:t,className:(0,nm.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",n),...r})});n1.displayName=nK.mY.Group.displayName;let n5=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nK.mY.Separator,{ref:t,className:(0,nm.cn)("-mx-1 h-px bg-border",n),...r})});n5.displayName=nK.mY.Separator.displayName;let n2=l.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(nK.mY.Item,{ref:t,className:(0,nm.cn)("relative flex cursor-default select-none items-center rounded-sm px-2.5 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...r})});n2.displayName=nK.mY.Item.displayName;let NoteBadge=e=>{let{label:t,noteId:n,onNoteIdChange:r}=e,a=(0,x.dw)(),[o,i]=(0,l.useState)(!1),[d,c]=(0,l.useState)(!1),[u,h]=(0,l.useState)(""),m=(0,l.useRef)(null),p=(0,l.useMemo)(()=>{var e,t;return null!==(t=n&&(null===(e=a.findById(n))||void 0===e?void 0:e.subject))&&void 0!==t?t:null},[a,n]),f=(0,l.useMemo)(()=>u?a.matchSubject(u).slice(0,20):a.notesEditedDesc.results.filter(e=>e.derived.normalizedSubject).slice(0,20),[a,u]),handleNoteIdChange=e=>{e?r(e):r(null)};return(0,l.useEffect)(()=>{if(o&&d){let e=setTimeout(()=>{var e;null===(e=m.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[o,d]),(0,s.jsx)(SearchBadge,{label:t,active:o,onActiveChange:e=>{i(e),e?c(!0):(c(!1),r(null))},value:d?n7:"",onValueChange:e=>{e||n||i(!1),c(!!e)},children:o?(0,s.jsx)(SearchBadgeSegment,{value:n7,label:p,children:(0,s.jsxs)(nJ,{shouldFilter:!1,children:[(0,s.jsx)(nX,{ref:m,placeholder:"Filter notes by subject...",value:u,onValueChange:h}),(0,s.jsxs)(n$,{children:[(0,s.jsx)(n0,{children:"No note found"}),f.map(e=>(0,s.jsx)(n2,{onSelect:()=>handleNoteIdChange(e.id),children:(0,s.jsx)("div",{className:"max-w-[400px] truncate",children:e.snapshot.subject})},e.id))]})]})}):null})},n7="notes_seg",n8="fuzzy",n9="strategy_seg";function StrategyBadge(e){let{strategy:t,onChange:n}=e,[r,a]=(0,l.useState)(t!==n8),[o,i]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t!==n8&&a(!0)},[t]);let d={exact:"Exact",fuzzy:"Fuzzy",semantic:"Semantic"}[t];return(0,s.jsx)(SearchBadge,{label:"Search type",active:r,onActiveChange:e=>{e?(a(!0),i(!0)):(a(!1),i(!1),n(n8))},value:o?n9:"",onValueChange:e=>{e===n9?(a(!0),i(!0)):i(!1)},children:(0,s.jsx)(SearchBadgeSegment,{value:n9,label:d,children:(0,s.jsxs)(ng,{value:t,onValueChange:e=>{n(e),i(!1)},children:[(0,s.jsx)(eP.u,{label:"Find results that are similar to your search term, allowing for minor spelling or typographical errors.",children:(0,s.jsx)(nI,{value:"fuzzy",children:"Fuzzy (default)"})}),(0,s.jsx)(eP.u,{label:"Search for an exact match to your query, with no variations on the search term.",children:(0,s.jsx)(nI,{value:"exact",children:"Exact"})}),(0,s.jsx)(eP.u,{label:"Discover content that conceptually relates to your search, even if the exact words are not used.",children:(0,s.jsx)(nI,{value:"semantic",children:"Semantic"})})]})})})}let TagBadge=e=>{var t,n;let{tags:r,onTagsChange:a}=e,o=(0,x.BG)(),[i,d]=(0,l.useState)(!1),[c,u]=(0,l.useState)(!1),h=(0,l.useRef)(null),m=null!==(n=null===(t=o.currentGraph)||void 0===t?void 0:t.tags)&&void 0!==n?n:[],p=m.filter(e=>!r.includes(e)),addTag=e=>{e&&!r.includes(e)&&a([...r,e])};return(0,l.useEffect)(()=>{if(i&&c){let e=setTimeout(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},100);return()=>clearTimeout(e)}},[i,c]),(0,s.jsx)(SearchBadge,{label:"Tags",active:i,onActiveChange:e=>{d(e),e?u(!0):(u(!1),a([]))},value:c?"tags-seg":"",onValueChange:e=>{e||0!==r.length||d(!1),u(!!e)},children:i?(0,s.jsx)(SearchBadgeSegment,{value:"tags-seg",label:(0,s.jsx)(SelectedTags,{tags:r,onDeleteTag:e=>{a(r.filter(t=>t!==e))}}),children:(0,s.jsxs)(nJ,{children:[(0,s.jsx)(nX,{placeholder:"Search tags...",ref:h}),(0,s.jsxs)(n$,{children:[(0,s.jsx)(n0,{children:"No tag found"}),p.map(e=>(0,s.jsxs)(n2,{onSelect:()=>addTag(e),children:["#",e]},e))]})]})}):null})},SelectedTags=e=>{let{tags:t,onDeleteTag:n}=e;return 0===t.length?(0,s.jsx)("span",{children:"..."}):(0,s.jsx)("span",{className:"space-x-1",children:t.map(e=>(0,s.jsxs)("span",{onClick:()=>n(e),className:"decoration-destructive/80 decoration-2 hover:text-destructive/80  hover:line-through",children:["#",e]},e))})},n3=(0,g.Pi)(e=>{let{searchFilterBarView:t}=e;return(0,s.jsxs)("div",{className:"flex flex-none gap-1 overflow-x-auto px-4 py-2",children:[(0,s.jsx)(nO,{label:"Created at",view:t.createdAtView}),(0,s.jsx)(nO,{label:"Updated at",view:t.editedAtView}),(0,s.jsx)(nO,{label:"Daily notes",view:t.dailyView}),(0,s.jsx)(NoteBadge,{label:"Linked to",noteId:t.toNoteId,onNoteIdChange:e=>t.updateToNoteId(e)}),(0,s.jsx)(NoteBadge,{label:"Linked by",noteId:t.fromNoteId,onNoteIdChange:e=>t.updateFromNoteId(e)}),(0,s.jsx)(TagBadge,{tags:t.tags,onTagsChange:e=>t.updateTags(e)}),(0,s.jsx)(BoolBadge,{label:"Pinned",value:t.pinned,onValueChange:e=>t.updatePinned(e)}),(0,s.jsx)(BoolBadge,{label:"Published",value:t.public,onValueChange:e=>t.updatePublic(e)}),(0,s.jsx)(StrategyBadge,{strategy:t.strategy,onChange:e=>t.updateStrategy(e)})]})});var n4=n(83894),n6=n(69119);function matchDateRange(e,t){let n=t.from?(0,n6.Z)(t.from).getTime():0,r=t.to?(0,n4.Z)(t.to).getTime():Number.MAX_SAFE_INTEGER;return n<=e&&e<=r}let CreatedAtFilter=class CreatedAtFilter{filterRow(e){let t=e.snapshot.createdAt;return matchDateRange(t,this.range)}filterNote(e){let t=e.createdAt;return matchDateRange(t,this.range)}constructor(e){this.range=e,this.type="createdAt"}};let EditedAtFilter=class EditedAtFilter{filterRow(e){var t;let n=null!==(t=e.snapshot.editedAt)&&void 0!==t?t:e.snapshot.createdAt;return matchDateRange(n,this.range)}filterNote(e){return matchDateRange(e.editedOrUpdatedAt,this.range)}constructor(e){this.range=e,this.type="editedAt"}};let DailyFilter=class DailyFilter{filterRow(e){let t=e.derived.dailyDate;return!!t&&matchDateRange(t,this.range)}filterNote(e){let t=e.dailyDate;return!!t&&matchDateRange(t.getTime(),this.range)}constructor(e){this.range=e,this.type="daily"}};let TagFilter=class TagFilter{filterRow(e){if(0===this.tags.length)return!0;let t=e.derived.tags;return t.length>0&&t.some(e=>this.tags.includes(e))}filterNote(e){if(0===this.tags.length)return!0;let t=e.tags;return t.length>0&&t.some(e=>this.tags.includes(e))}constructor(e){this.tags=e,this.type="tag"}};let OutgoingBacklinkFilter=class OutgoingBacklinkFilter{filterRow(e){return this.toNoteIds.has(e.snapshot.id)}filterNote(e){let t=e.subject.toLowerCase();return(t.includes("from")||t.includes("to"))&&console.log("OutgoingBacklinkFilter filterNote",t,this.toNoteIds.has(e.id)),this.toNoteIds.has(e.id)}constructor(e,t){this.fromNoteId=t,this.type="outgoingBacklink",this.toNoteIds=new Set;let n=e.getOutgoingBacklinks(t),r=n.map(e=>e.toNoteId);this.toNoteIds=new Set(r)}};let IncomingBacklinkFilter=class IncomingBacklinkFilter{filterRow(e){return this.fromNoteIds.has(e.snapshot.id)}filterNote(e){return this.fromNoteIds.has(e.id)}constructor(e,t){this.toNoteId=t,this.type="incomingBacklink",this.fromNoteIds=new Set;let n=e.getSortedIncomingBacklinks(t),r=n.map(e=>e.fromNoteId);this.fromNoteIds=new Set(r)}};let PinnedFilter=class PinnedFilter{filterRow(e){return null!=e.snapshot.pinnedIndex}filterNote(e){return null!=e.pinnedIndex}constructor(){this.type="pinned"}};let PublicFilter=class PublicFilter{filterRow(e){return e.snapshot.acl.includes("public")}filterNote(e){return e.public}constructor(){this.type="public"}};let DateBadgeView=class DateBadgeView{get calendarMode(){return"is within"===this.operationValue?"range":"single"}setOperationValue(e){this.operationValue=e}setDateValue(e){this.dateValue=e}setOpenSegment(e){this.openSegment=e}setActive(e){this.active=e}handleClose(){this.setOpenSegment("")}handleActiveChange(e){this.setActive(e),e?this.setOpenSegment("operation"):(this.setOpenSegment(""),this.setOperationValue("is"),this.setDateValue("today"),this.onDateRangeChange(null))}handleOperationValueChange(e){this.setOperationValue(e),e&&this.setOpenSegment("date")}calculateDateRange(){let e=this.dateValue,t=this.operationValue,n=this.active;if(!n)return null;{let n=parseDateValue(e);return n&&function(e,t){var n;let r=null!==(n=e.from)&&void 0!==n?n:e.to;if(r)switch(t){case"is":return{from:r,to:r};case"is before":return{from:null,to:r};case"is after":return{from:r,to:null};case"is within":if(e.from&&e.to)return{from:e.from,to:e.to};{let e=new Date,t=(0,nT.Z)([r,e]),n=(0,nR.Z)([r,e]);return{from:t,to:n}}}return null}(n,t)}}onAttached(){return this.listeners.push((0,f.autorun)(()=>{let e=this.calculateDateRange();this.onDateRangeChange(e)})),()=>{this.beforeDetach()}}beforeDetach(){return(0,tn.$)(this.listeners)}constructor(e){this.onDateRangeChange=e,this.operationValue="is",this.dateValue="today",this.openSegment="",this.active=!1,this.listeners=[],this.onDateRangeChange=e,(0,f.makeObservable)(this)}};(0,eg.gn)([f.observable],DateBadgeView.prototype,"operationValue",void 0),(0,eg.gn)([f.observable],DateBadgeView.prototype,"dateValue",void 0),(0,eg.gn)([f.observable],DateBadgeView.prototype,"openSegment",void 0),(0,eg.gn)([f.observable],DateBadgeView.prototype,"active",void 0),(0,eg.gn)([f.action],DateBadgeView.prototype,"setOperationValue",null),(0,eg.gn)([f.action],DateBadgeView.prototype,"setDateValue",null),(0,eg.gn)([f.action],DateBadgeView.prototype,"setOpenSegment",null),(0,eg.gn)([f.action],DateBadgeView.prototype,"setActive",null);let SearchFilterBarView=class SearchFilterBarView{get tags(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("tag"))||void 0===e?void 0:e.tags)&&void 0!==t?t:[]}updateTags(e){e.length>0?this.searchView.addFilter(new TagFilter(e)):this.searchView.removeFilter("tag")}get toNoteId(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("incomingBacklink"))||void 0===e?void 0:e.toNoteId)&&void 0!==t?t:null}updateToNoteId(e){e?this.searchView.addFilter(new IncomingBacklinkFilter(this.noteBacklinkStore,e)):this.searchView.removeFilter("incomingBacklink")}get fromNoteId(){var e,t;return null!==(t=null===(e=this.searchView.getFilter("outgoingBacklink"))||void 0===e?void 0:e.fromNoteId)&&void 0!==t?t:null}updateFromNoteId(e){e?this.searchView.addFilter(new OutgoingBacklinkFilter(this.noteBacklinkStore,e)):this.searchView.removeFilter("outgoingBacklink")}get pinned(){return this.searchView.hasFilter("pinned")}updatePinned(e){e?this.searchView.addFilter(new PinnedFilter):this.searchView.removeFilter("pinned")}get public(){return this.searchView.hasFilter("public")}updatePublic(e){e?this.searchView.addFilter(new PublicFilter):this.searchView.removeFilter("public")}get strategy(){return this.searchView.strategy}updateStrategy(e){this.searchView.setStrategy(e)}onAttached(){this.listeners.push(this.createdAtView.onAttached(),this.editedAtView.onAttached(),this.dailyView.onAttached())}dispose(){return(0,tn.$)(this.listeners)}constructor(e,t){this.searchView=e,this.noteBacklinkStore=t,this.createdAtView=new DateBadgeView(e=>{e?this.searchView.addFilter(new CreatedAtFilter(e)):this.searchView.removeFilter("createdAt")}),this.editedAtView=new DateBadgeView(e=>{e?this.searchView.addFilter(new EditedAtFilter(e)):this.searchView.removeFilter("editedAt")}),this.dailyView=new DateBadgeView(e=>{e?this.searchView.addFilter(new DailyFilter(e)):this.searchView.removeFilter("daily")}),this.listeners=[],this.onAttached()}};let SearchIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{d:"M13.8588 13.8588C14.7183 12.9992 15.25 11.8117 15.25 10.5C15.25 7.87665 13.1234 5.75 10.5 5.75C7.87665 5.75 5.75 7.87665 5.75 10.5C5.75 13.1234 7.87665 15.25 10.5 15.25C11.8117 15.25 12.9992 14.7183 13.8588 13.8588ZM13.8588 13.8588L18.5 18.5",stroke:"currentColor",strokeWidth:"1.5"})})};var re=n(35162),rt=n(40165);let SearchChatButton=e=>{let{className:t,onEnterChat:n}=e;return(0,s.jsx)(eP.u,{label:"Start an AI chat using your search results as context.",children:(0,s.jsxs)(rt.z,{variant:"outline",size:"sm",className:(0,nm.cn)("inline-flex gap-1",t),onClick:n,children:[(0,s.jsx)("span",{children:"Chat"}),(0,s.jsx)(re.Z,{className:"h-4 w-4"}),(0,s.jsx)("kbd",{className:"ml-1 inline-flex items-center rounded bg-white/10 px-1 font-sans text-[10px] font-medium uppercase ring-[1px] ring-gray-300/50 dark:ring-0",children:(0,s.jsx)(eS.Ht,{shortcuts:["meta","j"]})})]})})},SearchHeader=e=>{let{query:t,onChange:n,onEnterChat:r}=e;return(0,s.jsxs)("div",{className:"flex flex-none gap-2 px-4",style:{height:52},children:[(0,s.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,s.jsx)(SearchIcon,{className:"h-7 w-7"})}),(0,s.jsx)("input",{autoFocus:!0,type:"text",className:"m-0 flex-1 border-none bg-transparent p-0 text-base text-foreground outline-none focus:ring-0 dark:text-white",value:t,onChange:e=>{n(e.target.value)},autoCapitalize:"off",autoCorrect:"off",autoComplete:"off"}),r&&(0,s.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,s.jsx)(SearchChatButton,{onEnterChat:r,className:"flex-none"})})]})},rn=(0,g.Pi)(()=>{let[e,t]=(0,l.useState)("search"),n=(0,x.Pw)(),r=(0,x.dw)(),a=(0,x.Fq)(),o=(0,l.useMemo)(()=>new QuerySearchView(r),[r]),i=(0,eu.D)(()=>new SearchFilterBarView(o,a.noteBacklinkStore),[o,a]),d="notes"===o.searchType&&(!!o.query||o.hasAnyFilter());return(0,_.y)("meta+j",e=>{e.preventDefault(),t(e=>d&&"search"===e?"chat":"search")}),(0,s.jsx)(t5.fC,{open:!0,onOpenChange:e=>{e||n.closeSearchModal()},children:(0,s.jsx)(t2.W,{children:(0,s.jsx)(t5.aV,{className:"fixed inset-0 z-50 bg-background/80 backdrop-blur-sm",children:(0,s.jsx)(L.S,{className:"z-modal flex flex-col items-center px-4",children:(0,s.jsxs)(t5.VY,{className:" sm:h-lg z-modal my-[min(64px,8vh)] flex  w-full max-w-5xl flex-1 transform flex-col divide-y overflow-hidden rounded-xl bg-white shadow-2xl outline-none ring-1 ring-coolgray-900/5 transition-all dark:bg-gray-900  dark:ring-coolgray-700",role:"dialog",children:["search"===e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(SearchHeader,{query:o.query,onChange:e=>o.setQuery(e),onEnterChat:d?()=>t("chat"):void 0}),(0,s.jsx)(n3,{searchFilterBarView:i}),(0,s.jsx)(nr,{query:o.query,searchView:o})]}):null,"chat"===e?(0,s.jsx)(t7,{query:o.query,notes:o.results,onBackToSearch:()=>{t("search")}}):null]})})})})})}),rr=(0,g.Pi)(()=>{let e=(0,x.dw)(),t=(0,l.useCallback)(()=>{let t=e.assertTable;t.trigger("change",{ids:[]})},[]);return(0,s.jsxs)("div",{className:"space-y-1 py-2 px-6 text-sm",children:[(0,s.jsxs)("div",{className:"mb-2 flex justify-between font-medium text-slate-500",children:[(0,s.jsxs)("span",{children:["\uD83D\uDCE6 Model pool (",e.pool.models.size,")"]}),(0,s.jsx)("button",{onClick:t,className:"text-sm text-blue-500 hover:underline",children:"Change"})]}),Array.from(e.pool.models.entries()).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{className:"rounded border border-slate-200 bg-slate-100 p-1 text-xs font-medium text-slate-500",children:[n.id," (",n.subject,")"]},t)})]})}),check_icon_CheckIcon=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 12C5 8.13401 8.13401 5 12 5H12.25C12.6642 5 13 5.33579 13 5.75C13 6.16421 12.6642 6.5 12.25 6.5H12C8.96243 6.5 6.5 8.96243 6.5 12C6.5 15.0376 8.96243 17.5 12 17.5C15.0376 17.5 17.5 15.0376 17.5 12V11.75C17.5 11.3358 17.8358 11 18.25 11C18.6642 11 19 11.3358 19 11.75V12C19 15.866 15.866 19 12 19C8.13401 19 5 15.866 5 12Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.6664 7.37377C18.0102 7.14376 18.1036 6.67827 17.874 6.33397C17.6443 5.98933 17.1786 5.8962 16.834 6.12596L16.8329 6.12668L16.8315 6.12763L16.8276 6.13023L16.8159 6.13821C16.8063 6.14478 16.7931 6.15384 16.7767 6.16538C16.7438 6.18846 16.6976 6.22151 16.6395 6.26452C16.5234 6.35052 16.3598 6.47653 16.1605 6.64258C15.7622 6.97446 15.2199 7.46781 14.63 8.12328C13.6427 9.22029 12.5138 10.7807 11.7092 12.8057L10.3075 11.2483C10.0304 10.9404 9.55616 10.9154 9.24828 11.1925C8.94039 11.4696 8.91543 11.9438 9.19253 12.2517L11.4425 14.7517C11.6238 14.9532 11.8997 15.0411 12.1642 14.9818C12.4286 14.9225 12.6405 14.7251 12.7184 14.4655C13.4287 12.0976 14.6735 10.3173 15.745 9.12672C16.2801 8.53219 16.769 8.08804 17.1208 7.79492C17.2965 7.64847 17.4375 7.5401 17.5324 7.46986C17.5798 7.43474 17.6156 7.40919 17.6383 7.39321L17.6625 7.37643L17.6664 7.37377Z",fill:"currentColor"})]})},ListIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.75 5C6.23122 5 5 6.23122 5 7.75V16.25C5 17.7688 6.23122 19 7.75 19H16.25C17.7688 19 19 17.7688 19 16.25V9.75C19 7.12665 16.8734 5 14.25 5H7.75ZM6.5 7.75C6.5 7.05964 7.05964 6.5 7.75 6.5H10.75C11.4404 6.5 12 7.05964 12 7.75V9.25C12 10.7688 13.2312 12 14.75 12H16.25C16.9404 12 17.5 12.5596 17.5 13.25V16.25C17.5 16.9404 16.9404 17.5 16.25 17.5H7.75C7.05964 17.5 6.5 16.9404 6.5 16.25V7.75Z",fill:"currentColor"})})},MapIcon=e=>{let{className:t}=e;return(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5C12.4142 5 12.75 5.33579 12.75 5.75V8.07023C13.2971 8.17405 13.8046 8.38929 14.2481 8.69121L16.7197 6.21967C17.0126 5.92678 17.4874 5.92678 17.7803 6.21967C18.0732 6.51256 18.0732 6.98744 17.7803 7.28033L15.3088 9.75185C15.3669 9.83713 15.4217 9.92476 15.4731 10.0146C15.6894 10.3922 15.8458 10.8086 15.9297 11.25H18.25C18.6642 11.25 19 11.5858 19 12C19 12.4142 18.6642 12.75 18.25 12.75H15.9297C15.8458 13.1914 15.6894 13.6078 15.4731 13.9854C15.4217 14.0752 15.3669 14.1629 15.3088 14.2481L17.7803 16.7197C18.0732 17.0126 18.0732 17.4874 17.7803 17.7803C17.4874 18.0732 17.0126 18.0732 16.7197 17.7803L14.2481 15.3088C13.8046 15.6107 13.2971 15.826 12.75 15.9298V18.25C12.75 18.6642 12.4142 19 12 19C11.5858 19 11.25 18.6642 11.25 18.25V15.9298C10.7029 15.826 10.1954 15.6107 9.75187 15.3088L7.28033 17.7803C6.98744 18.0732 6.51256 18.0732 6.21967 17.7803C5.92678 17.4874 5.92678 17.0126 6.21967 16.7197L8.69119 14.2481C8.63314 14.1629 8.57832 14.0752 8.52689 13.9854C8.31061 13.6078 8.15417 13.1914 8.07033 12.75H5.75C5.33579 12.75 5 12.4142 5 12C5 11.5858 5.33579 11.25 5.75 11.25H8.07033C8.15417 10.8086 8.31061 10.3922 8.52689 10.0146C8.57832 9.92476 8.63314 9.83713 8.69119 9.75185L6.21967 7.28033C5.92678 6.98744 5.92678 6.51256 6.21967 6.21967C6.51256 5.92678 6.98744 5.92678 7.28033 6.21967L9.75187 8.69121C10.1954 8.38929 10.7029 8.17405 11.25 8.07023V5.75C11.25 5.33579 11.5858 5 12 5ZM12 14.5C13.3807 14.5 14.5 13.3807 14.5 12C14.5 10.6193 13.3807 9.5 12 9.5C10.6193 9.5 9.5 10.6193 9.5 12C9.5 13.3807 10.6193 14.5 12 14.5Z",fill:"currentColor"})})},PencilIcon=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.3393 5.97122C14.6343 4.67626 16.7338 4.67626 18.0288 5.97122C19.3238 7.26618 19.3238 9.36572 18.0288 10.6607L11.6333 17.0562C11.5491 17.1403 11.4462 17.2033 11.3329 17.2397L5.97996 18.9639C5.71217 19.0501 5.41863 18.9793 5.21969 18.7803C5.02075 18.5814 4.94988 18.2879 5.03614 18.0201L6.76027 12.6671C6.79676 12.5539 6.85968 12.4509 6.94383 12.3667L13.3393 5.97122ZM16.9681 7.03188C16.259 6.32271 15.1092 6.32271 14.4 7.03188L8.13253 13.2994L6.91234 17.0877L10.7007 15.8675L16.9681 9.60001C17.6773 8.89084 17.6773 7.74105 16.9681 7.03188Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.3393 5.97122C14.6343 4.67626 16.7338 4.67626 18.0288 5.97122C19.3238 7.26618 19.3238 9.36572 18.0288 10.6607C17.7359 10.9536 17.261 10.9536 16.9681 10.6607L13.3393 7.03188C13.0464 6.73898 13.0465 6.26411 13.3393 5.97122Z",fill:"currentColor"})]})},ShortcutText=e=>{let{value:t,highlight:n}=e;return n?(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"font-medium underline",children:t.slice(0,1)}),(0,s.jsx)("span",{children:t.slice(1)})]}):(0,s.jsx)("span",{children:t})};var ra=n(18490),ro=n(30471),ri=n(44080),rs=n(95237);function GraphColor(e){let{loading:t,color:n}=e;return(0,s.jsx)("div",{className:(0,nm.cn)("h-5 w-5 flex-none rounded-md bg-black",{"animate-pulse":t}),style:{backgroundColor:n}})}let MenuItem=e=>{let{children:t,onClick:n,shortcuts:r=[]}=e;return(0,s.jsx)(ro.v.Item,{children:(0,s.jsxs)("button",{onClick:n,className:"\n          group flex w-full\n          rounded-lg px-2.5\n          py-1.5 text-left text-2xs text-coolgray-700 \n          hover:bg-coolgray-100 hover:text-gray-900 dark:text-near-white dark:hover:bg-white/5 dark:hover:text-white\n        ",children:[(0,s.jsx)("div",{className:"flex-1",children:t}),r.length>0?(0,s.jsx)("div",{className:"flex flex-none space-x-1",children:(0,eS.op)(r).map((e,t)=>(0,s.jsx)("code",{className:(0,G.Z)("block rounded-md px-2 py-0 text-xs leading-5","bg-coolgray-100 group-hover:bg-coolgray-200","dark:bg-dark-black-800 dark:group-hover:bg-gray-600"),children:(0,s.jsx)(eS.lt,{shortcut:e})},t))}):null]})})},rl=(0,g.Pi)(()=>{let e=(0,x.Pw)(),t=(0,x.BG)(),n=t.graphs,r=n.filter(e=>e!=t.currentGraph),changeGraph=n=>{t.setCurrentGraph(n),e.setSelectedNote(null)};if(0===r.length)return null;let shortcutsFor=e=>{if(!O.d)return[];let t=n.indexOf(e);return t>=10?[]:["meta","".concat(t+1)]};return(0,s.jsx)("div",{className:"p-1",children:r.map(e=>(0,s.jsx)(MenuItem,{onClick:()=>changeGraph(e),shortcuts:shortcutsFor(e),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2.5",children:[(0,s.jsx)("div",{className:"h-5 w-5 flex-none rounded-md bg-bluegray-500",style:{backgroundColor:e.colorHex}}),(0,s.jsx)("span",{children:e.name||"My Graph"})]})},e.id))})}),rd=(0,g.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.Yh)(),n=(0,x.Jf)(),r=e.noteStore,a=!r.hasSynced,[o,i]=(0,l.useState)(null),[d,c]=(0,l.useState)(null),{styles:u,attributes:h}=(0,rs.D)(o,d,{strategy:"fixed",placement:"top-start",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"preventOverflow",options:{padding:15}}]});return(0,s.jsxs)(ro.v,{children:[(0,s.jsxs)(ro.v.Button,{ref:i,className:" capacitor:touchable-opacity flex cursor-default items-center space-x-2.5 overflow-hidden rounded-md text-coolgray-900 outline-none transition-all duration-100 hover:text-primary capacitor:py-2 capacitor:pl-1 capacitor:pr-3 dark:text-coolgray-300 dark:hover:text-white ",children:[(0,s.jsx)(GraphColor,{loading:a,color:(null==e?void 0:e.colorHex)||"white"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:(null==e?void 0:e.name)||"My Graph"})]}),(0,s.jsx)(np.W,{children:(0,s.jsx)("div",{ref:c,style:u.popper,...h.popper,children:(0,s.jsx)(ri.u,{enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",className:"z-popover w-56 origin-bottom-left",children:(0,s.jsxs)(ro.v.Items,{className:" w-56 divide-y divide-coolgray-100 rounded-md bg-white shadow-lg ring-1 ring-coolgray-900/5 focus:outline-none dark:divide-coolgray-800 dark:bg-gray-800 dark:ring-coolgray-700 ",children:[(0,s.jsx)(rl,{}),(0,s.jsxs)("div",{className:"px-1 py-1 ",children:[(0,s.jsx)(MenuItem,{onClick:()=>t.openPreferencesScreen(),shortcuts:["command",","],children:"Preferences"}),(0,s.jsx)(MenuItem,{onClick:()=>{t.openPreferencesScreen(),n.setScreen(S.JY.Billing)},children:"Billing"})]}),(0,s.jsx)("div",{className:"px-1 py-1",children:(0,s.jsx)(MenuItem,{onClick:()=>(0,D.w)(),children:"Sign out"})})]})})})})]})}),HelpIcon=e=>{let{className:t}=e;return(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5C8.41015 5.5 5.5 8.41015 5.5 12C5.5 15.5899 8.41015 18.5 12 18.5C15.5899 18.5 18.5 15.5899 18.5 12C18.5 8.41015 15.5899 5.5 12 5.5ZM4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20C7.58172 20 4 16.4183 4 12Z",fill:"currentColor"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.6355 8.15346C10.1833 7.4527 11.039 7 12 7C13.6569 7 15 8.34315 15 10C15 10.8365 14.6566 11.5942 14.1051 12.1375C14.0247 12.2166 13.9467 12.292 13.8707 12.3655C13.6886 12.5416 13.5179 12.7067 13.3523 12.8866C13.1234 13.1353 12.9558 13.3596 12.8555 13.5727C12.6791 13.9475 12.2323 14.1083 11.8575 13.9319C11.4827 13.7555 11.3219 13.3087 11.4983 12.9339C11.6923 12.5219 11.9754 12.1676 12.2487 11.8707C12.4459 11.6565 12.6656 11.444 12.8585 11.2574C12.9273 11.1909 12.9927 11.1276 13.0525 11.0688C13.3296 10.7958 13.5 10.4185 13.5 10C13.5 9.17157 12.8284 8.5 12 8.5C11.5201 8.5 11.093 8.72453 10.8172 9.07731C10.755 9.15694 10.7007 9.24283 10.6555 9.33377C10.4712 9.70471 10.021 9.85597 9.65011 9.67164C9.27918 9.4873 9.12791 9.03716 9.31225 8.66623C9.4029 8.48382 9.51144 8.31215 9.6355 8.15346ZM12 15.4861C12.4142 15.4861 12.75 15.8219 12.75 16.2361V16.2461C12.75 16.6603 12.4142 16.9961 12 16.9961C11.5858 16.9961 11.25 16.6603 11.25 16.2461V16.2361C11.25 15.8219 11.5858 15.4861 12 15.4861Z",fill:"currentColor"})]})},rc=(0,g.Pi)(()=>{let e=(0,x.Pw)(),[t,n]=(0,l.useState)(null),[r,a]=(0,l.useState)(null),{styles:o,attributes:i}=(0,rs.D)(t,r,{strategy:"fixed",placement:"top-end",modifiers:[{name:"offset",options:{offset:[5,10]}},{name:"preventOverflow",options:{padding:15}}]});return(0,s.jsxs)(ro.v,{children:[(0,s.jsx)(eP.u,{label:"Help and support",disabled:(0,eX.W)(),children:(0,s.jsx)(ro.v.Button,{ref:n,className:" capacitor:touchable-opacity inline-flex cursor-default items-center justify-center overflow-hidden rounded-md transition-all duration-100 hover:text-primary dark:hover:text-white ",children:(0,s.jsx)(HelpIcon,{})})}),(0,s.jsx)(np.W,{children:(0,s.jsx)("div",{ref:a,style:o.popper,...i.popper,children:(0,s.jsx)(ri.u,{enter:"transition ease-out duration-100",enterFrom:"transform opacity-0 scale-95",enterTo:"transform opacity-100 scale-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100 scale-100",leaveTo:"transform opacity-0 scale-95",className:"z-popover w-56 origin-bottom-right",children:(0,s.jsxs)(ro.v.Items,{className:" w-56 divide-y divide-coolgray-100 rounded-md bg-white shadow-lg ring-1 ring-coolgray-900/5 focus:outline-none dark:divide-coolgray-800 dark:bg-gray-800 dark:ring-coolgray-700 ",children:[(0,s.jsxs)("div",{className:"px-1 py-1",children:[(0,s.jsx)(MenuItem,{onClick:()=>e.openShortcutsModal(),shortcuts:["command","/"],children:"Keyboard shortcuts"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("/download"),children:"Download apps"})]}),(0,s.jsxs)("div",{className:"px-1 py-1",children:[(0,s.jsx)(MenuItem,{onClick:()=>window.open("https://reflect.app/changelog"),children:"App updates and news"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("https://www.youtube.com/@reflect-notes"),children:"YouTube channel"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("https://roadmap.reflect.app"),children:"Roadmap and requests"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("https://reflect.academy"),children:"Academy and learning"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("https://reflect.app/discord"),children:"Community Discord"})]}),(0,s.jsxs)("div",{className:"px-1 py-1",children:[(0,s.jsx)(MenuItem,{onClick:()=>window.open("mailto:support@reflect.app"),children:"Contact support"}),(0,s.jsx)(MenuItem,{onClick:()=>window.open("mailto:feedback@reflect.app"),children:"Give feedback"})]})]})})})})]})}),ru=(0,g.Pi)(e=>{let{className:t}=e;return(0,s.jsxs)("div",{className:(0,G.Z)("flex flex-none px-4 py-3",t),children:[(0,s.jsx)(rd,{}),(0,s.jsx)(ra.L,{}),(0,s.jsx)(rc,{})]})});var rh=n(65234),rm=n(35082),rp=n(85983),rf=n(17323),rg=n(66037),rx=n(81472);let Popover=e=>{var t;let{children:n,render:r,open:a,enabled:o=!0,placement:i="right",onOpenChange:d}=e,c=(0,l.useRef)(null),[u,h]=(0,l.useState)(!1),[m,p]=(0,l.useState)(!1),f="boolean"==typeof a,onOpenChange=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(!f||t)&&(d&&(e=d(e)),e!==u&&(e?(h(!0),p(!1)):(p(!0),setTimeout(()=>h(!1),300))))},{x:g,y:x,reference:v,middlewareData:y,floating:b,context:w}=(0,rm.YF)({placement:i,open:u,onOpenChange,middleware:[(0,rp.uY)({padding:10}),(0,rp.cv)(30),(0,rf.x7)({element:c})],whileElementsMounted:rg.Me}),{y:j}=null!==(t=y.arrow)&&void 0!==t?t:{},{getReferenceProps:k,getFloatingProps:N}=(0,rm.NI)([(0,rm.XI)(w,{handleClose:(0,rm.xp)({restMs:50}),restMs:100,enabled:o}),(0,rm.qs)(w)]),[S,C]=(0,rx.useSpring)(()=>({scale:.99,translateX:10,opacity:0,config:{duration:300,easing:rx.easings.easeOutQuart}}),[u]);return(0,l.useLayoutEffect)(()=>{u&&C.start({opacity:1,scale:1,translateX:0})},[u,C]),(0,l.useLayoutEffect)(()=>{m&&C.start({opacity:0,scale:.99,translateX:0})},[m,C]),(0,l.useEffect)(()=>{f&&onOpenChange(a,!0)},[a]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"popup-reference inline-flex",...k({ref:v}),children:n(u&&!m)}),(0,s.jsx)(rm.ll,{children:u&&(0,s.jsx)(ec.Q2,{children:(0,s.jsx)("div",{ref:b,className:"absolute z-popover drop-shadow-xl",style:{top:null!=x?x:0,left:null!=g?g:0},...N(),children:(0,s.jsx)("div",{style:{filter:"drop-shadow(rgba(17,24,39,0.15) 0px 0px 1px)"},children:(0,s.jsx)(rx.animated.div,{style:{transform:(0,rx.to)([S.scale,S.translateX],(e,t)=>"translate3d(".concat(t,"px,0,0) scale(").concat(e,")")),opacity:S.opacity},children:(0,s.jsxs)("div",{className:" flex flex-col  overflow-hidden  rounded-xl  bg-white dark:bg-bluegray-800 ",children:[r({close:()=>{onOpenChange(!1)}}),(0,s.jsx)("div",{ref:c,className:"arrow absolute -left-4 text-white dark:text-bluegray-800",style:{top:null!=j?j:0},children:(0,s.jsx)("svg",{viewBox:"0 0 100 100",fill:"currentColor",className:"h-4 w-4",children:(0,s.jsx)("polygon",{points:"100 0, 100 100, 50 50"})})})]})})})})})})]})};var rv=n(65422),ry=n(40486),rb=n(39828),rw=n(74691),rj=n.n(rw);async function requestWakeLock(){try{var e;return await (null===(e=navigator.wakeLock)||void 0===e?void 0:e.request("screen"))}catch(e){console.error("Error requesting wake lock: ".concat(e.message))}}(a=i||(i={})).NoAudioData="NoAudioData",a.Internal="Internal";let BrowserRecordingStream=class BrowserRecordingStream{dispose(){}async start(){let e=[],t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t,{audioBitsPerSecond:128e3});let n=await requestWakeLock(),cleanUp=async()=>{await (null==n?void 0:n.release()),t.getTracks().forEach(e=>e.stop())};this.mediaRecorder.addEventListener("start",()=>{this.onStart()});let handleStop=async()=>{var t;if(await cleanUp(),0===e.length){this.onError(i.NoAudioData);return}let n=null===(t=this.mediaRecorder)||void 0===t?void 0:t.mimeType,r=new Blob(e,{type:n});await this.onStop({blob:r})};this.mediaRecorder.addEventListener("stop",()=>{handleStop()}),this.mediaRecorder.addEventListener("dataavailable",t=>{t.data.size>0&&e.push(t.data)}),this.mediaRecorder.start(),this.audioContext=new AudioContext({sampleRate:5e4}),this.audioSource=this.audioContext.createMediaStreamSource(t),this.processingNode=this.audioContext.createScriptProcessor(2048,2,2),this.processingNode.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),n=t.reduce((e,t)=>e+Math.abs(t),0)/t.length,r=rj()(10*n,1e-4,1);this.onBufferSample(r)},this.audioSource.connect(this.processingNode),this.processingNode.connect(this.audioContext.destination)}async stop(){var e,t,n,r;null===(e=this.processingNode)||void 0===e||e.disconnect(),null===(t=this.audioSource)||void 0===t||t.disconnect(),await (null===(n=this.audioContext)||void 0===n?void 0:n.close()),null===(r=this.mediaRecorder)||void 0===r||r.stop(),this.processingNode=null,this.audioSource=null,this.audioContext=null,this.mediaRecorder=null}constructor(e){this.processingNode=null,this.audioSource=null,this.audioContext=null,this.mediaRecorder=null,this.onStart=e.onStart,this.onBufferSample=e.onBufferSample,this.onStop=e.onStop,this.onError=e.onError}};var rk=n(1604),rN=n(10256);let rS=rk.ZP.union([rk.ZP.literal("noMicrophoneAccess"),rk.ZP.literal("noScreenCaptureAccess"),rk.ZP.literal("other")]),rC=rk.ZP.union([rk.ZP.object({command:rk.ZP.literal("recording-started")}),rk.ZP.object({command:rk.ZP.literal("recording-sample"),args:rk.ZP.object({level:rk.ZP.number()})}),rk.ZP.object({command:rk.ZP.literal("recording-finished"),args:rk.ZP.object({buffer:rk.ZP.instanceof(Uint8Array)})}),rk.ZP.object({command:rk.ZP.literal("recording-error"),args:rk.ZP.object({errorType:rS,errorMessage:rk.ZP.union([rk.ZP.string(),rk.ZP.null()]).optional()})})]);let NativeRecordingStream=class NativeRecordingStream{dispose(){this.listeners.forEach(e=>e())}start(){null===tP.Z||void 0===tP.Z||tP.Z.startRecording()}stop(){null===tP.Z||void 0===tP.Z||tP.Z.stopRecording()}async handleMessage(e){let t=rC.safeParse(e.data);if(!t.success){console.warn("Invalid message from Electron",t.error,e.data);return}let n=t.data;switch(n.command){case"recording-started":this.handleRecordingStarted();break;case"recording-sample":this.handleRecordingSample(n.args.level);break;case"recording-finished":await this.handleRecordingFinished(n.args.buffer);break;case"recording-error":await this.handleRecordingError(n.args)}}handleRecordingStarted(){this.onStart()}handleRecordingSample(e){let t=rj()(e/.7,0,1);this.onBufferSample(t)}async handleRecordingFinished(e){let t=new Blob([e],{type:"audio/mp4"});await this.onStop({blob:t})}async handleRecordingError(e){let{errorType:t,errorMessage:n}=e;"noMicrophoneAccess"===t?(this.onCancel(),await (0,rN.Z)(100),this.askForPermission("use your microphone","microphone")):"noScreenCaptureAccess"===t?(this.onCancel(),await (0,rN.Z)(100),this.askForPermission("capture your system audio (you'll have to allow screen recording)","screenRecording")):this.onError(i.Internal,n)}askForPermission(e,t){let n=confirm("It looks like you haven't given us permission to ".concat(e,". Would you like to open your system preferences to change this?"));n&&(null===tP.Z||void 0===tP.Z||tP.Z.openSystemPreference(t))}constructor(e){this.listeners=[],this.onStart=e.onStart,this.onBufferSample=e.onBufferSample,this.onStop=e.onStop,this.onError=e.onError,this.onCancel=e.onCancel;let handler=e=>void this.handleMessage(e);window.addEventListener("message",handler),this.listeners.push(()=>window.removeEventListener("message",handler))}};async function selectRecordingStream(e){var t;let{nativeEnabled:n}=e;if(!n)return BrowserRecordingStream;let r=await (null===tP.Z||void 0===tP.Z?void 0:null===(t=tP.Z.getPlatformInfo)||void 0===t?void 0:t.call(tP.Z)),a=r&&r.major>=22;return a?NativeRecordingStream:BrowserRecordingStream}let RecordingView=class RecordingView{onStartRecording(){this.startedAt=Date.now(),this.state="recording",this.logger.info("[RecordingView] onStartRecording")}async startRecording(){if("starting"===this.state||"recording"===this.state||"processing"===this.state){console.warn("Cannot start recording when starting/recording/processing");return}await this.startRecordingStream()}async stopRecording(){if("recording"!==this.state){console.warn("Cannot stop recording when not recording");return}this.setState("processing"),await this.stopRecordingStream()}async onStopRecording(e){let{blob:t}=e;this.logger.info("[RecordingView] onStopRecording"),await this.uploadAudioRecording({blob:t}),this.setState("idle")}async dispose(){var e;"recording"===this.state&&await this.stopRecording(),null===(e=this.recordingStream)||void 0===e||e.dispose()}async uploadAudioRecording(e){let{blob:t}=e,n=(0,tI.O)(),r=this.noteStore.ensureTodaysDailyNote(),a=r.id,o=this.graph.id,i=this.user.id,s=this.initialPrompt,l=(0,rv.pO)({db:tR.db,graphId:o,audioRecordingId:n});this.logger.info("[RecordingView] setting audio recording ".concat(n)),await (0,rb.setDoc)(l,{note_id:a,user_id:i,status:"processing",created_at:rb.Timestamp.now(),completed_at:null}),this.logger.info("[RecordingView] uploading audio recording ".concat(n));let d={processAs:"audioRecording-v2",graphId:o,noteId:a,userId:i,initialPrompt:null!=s?s:void 0,formatTranscript:String(this.formatTranscript),language:this.transcriptionLanguage},c=this.filterMetadata(d),u=await uploadFileWithUnloadWarning({blob:t,id:n,metadata:c});this.logger.info("[RecordingView] uploaded audio recording ".concat(n," to ").concat(u))}addWaveformBar(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;this.waveformBars.push(e),this.waveformBars=this.waveformBars.slice(-1*t)}get normalizedWaveformBars(){return this.waveformBars.map(e=>e)}get hasWaveformBars(){return this.waveformBars.length>0}get messageState(){return"error-no-audio-data"===this.state?"error-no-audio-data":this.isPending||this.recordingStore.isProcessing?"processing":"default"}calculateDurationFormatted(){var e,t;let n=(0,ry.Z)({start:this.startedAt,end:Date.now()}),r=null!==(e=n.minutes)&&void 0!==e?e:0,a=(null!==(t=n.seconds)&&void 0!==t?t:0).toString().padStart(2,"0");return"".concat(r,":").concat(a)}setDurationFormatted(e){this.durationFormatted=e}resetWaveformBars(){this.waveformBars=[]}setState(e){this.state=e}get isPending(){return this.pendingCount>0}get pendingCount(){let e=this.storeProcessingCount;return"processing"===this.state?Math.max(e,1):e}async toggleRecording(){"recording"===this.state?await this.stopRecording():await this.startRecording()}onBufferSample(e){this.addWaveformBar(e),this.setDurationFormatted(this.calculateDurationFormatted())}onError(e,t){console.error("Error recording audio",e),e===i.NoAudioData?this.setState("error-no-audio-data"):this.setState("error"),t&&alert(t)}async startRecordingStream(){if(this.setState("starting"),!this.recordingStream){let e=await selectRecordingStream({nativeEnabled:this.nativeEnabled});this.recordingStream=new e({onStart:()=>this.onStartRecording(),onStop:e=>this.onStopRecording(e),onBufferSample:e=>this.onBufferSample(e),onError:(e,t)=>this.onError(e,t),onCancel:()=>this.setState("idle")})}this.logger.info("[RecordingView] starting recording stream using ".concat(this.recordingStream.constructor.name)),await this.recordingStream.start()}async stopRecordingStream(){var e;await (null===(e=this.recordingStream)||void 0===e?void 0:e.stop())}get storeProcessingCount(){return this.graph.audioRecordingStore.processingCount}get initialPrompt(){let e=this.user.preferences.transcriptionPrompt;return e?"This transcription mentions names like: ".concat(e):null}get formatTranscript(){return!!this.user.preferences.labs||"en"===this.transcriptionLanguage||"auto"===this.transcriptionLanguage}get transcriptionLanguage(){var e;return null!==(e=this.user.preferences.transcriptionLanguage)&&void 0!==e?e:"auto"}get noteStore(){return this.graph.noteStore}get recordingStore(){return this.graph.audioRecordingStore}filterMetadata(e){let t={};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t}get nativeEnabled(){return this.preferenceStore.labs}get preferenceStore(){return this.graph.assertRootStore.preferenceStore}get logger(){return this.graph.logger}constructor({graph:e,user:t}){this.state="idle",this.startedAt=0,this.durationFormatted="0:00",this.waveformBars=[],this.recordingStream=null,this.graph=e,this.user=t,(0,f.makeObservable)(this),this.logger.info("[RecordingView] instantiated")}};(0,eg.gn)([f.observable],RecordingView.prototype,"state",void 0),(0,eg.gn)([f.observable],RecordingView.prototype,"durationFormatted",void 0),(0,eg.gn)([f.observable.shallow],RecordingView.prototype,"waveformBars",void 0),(0,eg.gn)([f.action],RecordingView.prototype,"onStartRecording",null),(0,eg.gn)([f.action],RecordingView.prototype,"addWaveformBar",null),(0,eg.gn)([f.computed],RecordingView.prototype,"normalizedWaveformBars",null),(0,eg.gn)([f.computed],RecordingView.prototype,"hasWaveformBars",null),(0,eg.gn)([f.computed],RecordingView.prototype,"messageState",null),(0,eg.gn)([f.action],RecordingView.prototype,"setDurationFormatted",null),(0,eg.gn)([f.action],RecordingView.prototype,"resetWaveformBars",null),(0,eg.gn)([f.action],RecordingView.prototype,"setState",null),(0,eg.gn)([f.computed],RecordingView.prototype,"isPending",null),(0,eg.gn)([f.computed],RecordingView.prototype,"pendingCount",null);var rI=n(31351),rV=n.n(rI);let Waveform=e=>{let{waveformBars:t,width:n,height:r}=e,a=(0,l.useRef)(null),o=(0,l.useCallback)(e=>{let t=a.current,o=t.getContext("2d"),i=window.devicePixelRatio;t.width=n*i,t.height=r*i,o.scale(i,i),o.clearRect(0,0,t.width,t.height),o.fillStyle="#f87171";let s=Math.floor(n/8),l=rV()(e).slice(0,s);l.forEach((e,t)=>{let a=(r-e*r)/2,i=Math.max(e*r,2);o.fillRect(n-8*t,a,4,i)})},[n,r]);(0,l.useEffect)(()=>{o(t)},[o,t]);let i=(0,l.useMemo)(()=>({width:n,height:r}),[n,r]);return(0,s.jsx)(rD,{ref:a,style:i})},rD=(0,l.memo)((0,l.forwardRef)((e,t)=>(0,s.jsx)("canvas",{...e,ref:t})));rD.displayName="WaveformCanvas";let rR=(0,g.Pi)(e=>{let{view:t,width:n,height:r}=e;return(0,s.jsx)(Waveform,{waveformBars:t.normalizedWaveformBars,width:n,height:r})});var rT=n(38543);let rP=(0,g.Pi)(e=>{let{view:t}=e,n="starting"===t.state,onFinish=()=>{(0,er.Am)({description:"Uploading and processing your audio memo. The transcription will be added to your daily note.",duration:8e3,icon:"mic"})},handleStateChange=(e,t)=>{switch("".concat(t,"->").concat(e)){case"recording->processing":case"recording->idle":onFinish()}};return(0,l.useEffect)(()=>(0,f.reaction)(()=>t.state,handleStateChange),[t]),(0,l.useEffect)(()=>{t.resetWaveformBars()},[t]),(0,s.jsxs)("div",{className:"flex space-x-1 overflow-hidden py-2 px-2",children:[(0,s.jsx)("div",{className:"h-[22px] w-[200px] flex-1",children:n?(0,s.jsx)("div",{className:"ml-2 flex h-full items-center",children:(0,s.jsx)(rT.X,{})}):(0,s.jsx)(rR,{view:t,width:200,height:22})}),(0,s.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,s.jsx)("span",{className:"px-2 text-sm font-medium tabular-nums",children:n?"0:00":t.durationFormatted})})]})}),rM=(0,g.Pi)(()=>{let{online:e}=(0,x.Yh)(),t=(0,x.Fq)(),n=(0,x.xJ)();(0,ew.hu)(t,"AudioRecording must be used inside a graph"),(0,ew.hu)(n,"AudioRecording must be used inside a user");let r=(0,eu.D)(()=>new RecordingView({graph:t,user:n}),[t,n]),a=!e&&"recording"!==r.state,o="starting"===r.state,i="recording"===r.state,l=r.isPending;(0,_.y)("meta+shift+r",e=>{e.preventDefault(),a||r.toggleRecording()},[r,a]);let d=!i&&r.pendingCount>0;return(0,s.jsx)("div",{className:"flex flex-none items-center justify-center",children:(0,s.jsx)("div",{className:"relative flex flex-none items-center justify-center",children:(0,s.jsx)(Popover,{render:()=>(0,s.jsx)(rP,{view:r}),open:o||i,children:()=>(0,s.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,s.jsx)(eP.u,{delay:500,label:a?"Go online to record":i?"Stop recording":"Record audio memo",shortcut:a?[]:["meta","shift","r"],disabled:(0,eX.W)(),children:(0,s.jsx)("button",{onClick:()=>void r.toggleRecording(),disabled:a,className:(0,G.Z)("\n                    relative flex h-[24px] w-[24px] flex-none cursor-default\n                    items-center justify-center rounded-full disabled:opacity-50\n                    ",{"bg-red-100 ring-[1.5px] ring-red-200 dark:bg-transparent dark:ring-red-500":i}),children:i?(0,s.jsx)("div",{className:"absolute h-[10px] w-[10px] rounded-sm bg-red-600"}):(0,s.jsx)(rh.Z,{className:(0,G.Z)("transition ease-in-out",{"text-coolgray-500 hover:text-coolgray-900 dark:hover:text-white":!l,"animate-pulse text-primary dark:text-primary-dk":l})})})}),d&&(0,s.jsx)(eP.u,{label:"Processing ".concat(r.pendingCount," audio memo").concat(r.pendingCount>1?"s":"","..."),children:(0,s.jsx)("div",{className:" pointer-events-none absolute -top-2 -right-2 flex items-center justify-center rounded-full bg-purple-500 px-1 text-[10px] font-medium tabular-nums text-white ",children:r.pendingCount})})]})})})})}),Menu=e=>{let{children:t}=e;return(0,s.jsx)("nav",{className:"mt-6 flex-none space-y-1 px-4",children:t})},menu_MenuItem=e=>{let{children:t,selected:n=!1,title:r,onClick:a}=e;return(0,s.jsx)("a",{title:r,onMouseDown:a,className:(0,G.Z)(["group flex items-center space-x-3 px-2.5 py-1.5 capacitor:py-2.5","cursor-default rounded-md text-sm font-medium capacitor:rounded-lg","capacitor:active:opacity-90","hover:bg-gray-200/50 dark:hover:bg-white/3",n?"bg-gray-200/50 text-primary dark:bg-transparent dark:text-primary-dk":"text-coolgray-900 dark:text-near-white dark:hover:text-white"]),children:t})},Step=e=>{let{name:t,description:n,index:r,completed:a,ignored:o,open:i}=e;return(0,s.jsx)("div",{className:(0,G.Z)("group relative rounded-md transition-all duration-200",i&&"bg-gray-200 ring-8 ring-gray-200 dark:bg-dark-black-900 dark:ring-dark-black-900",o&&"opacity-30"),children:(0,s.jsxs)("button",{className:"flex cursor-default items-start text-left text-sm font-medium",children:[a?(0,s.jsx)(CompleteCircle,{}):(0,s.jsx)(PendingCircle,{index:r}),(0,s.jsxs)("span",{className:"ml-3 flex min-w-0 flex-col space-y-0.5 pr-1",children:[(0,s.jsx)("span",{className:(0,G.Z)("text-sm font-medium",a?"text-gray-600 dark:text-gray-500":"text-indigo-600"),children:t}),(0,s.jsx)("span",{className:"text-xs font-medium text-gray-400",children:n})]})]})})},CompleteCircle=()=>(0,s.jsx)("span",{className:"flex-shrink-0",children:(0,s.jsx)("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-indigo-600",children:(0,s.jsx)(ti.Z,{className:"h-4 w-4 text-white","aria-hidden":"true"})})}),PendingCircle=e=>{let{index:t}=e;return(0,s.jsx)("span",{className:"flex-shrink-0",children:(0,s.jsx)("span",{className:"flex h-7 w-7 items-center justify-center rounded-full border-2 border-indigo-600",children:(0,s.jsx)("span",{className:"text-indigo-600",children:t})})})};var rE=n(79111);let TextButton=e=>{let{onClick:t,className:n="",children:r}=e;return(0,s.jsx)("span",{className:"".concat(n," inline-flex rounded-md"),children:(0,s.jsx)("button",{onClick:t,type:"button",className:" inline-flex cursor-pointer items-center space-x-1 rounded-md border border-transparent px-3 py-2 text-sm font-medium leading-4 text-bluegray-500 dark:text-near-white ",children:r})})},Footer=e=>{let{children:t}=e;return(0,s.jsx)("footer",{className:" mt-5 flex flex-none justify-between rounded-br-xl rounded-bl-xl  bg-gray-50 px-6 py-4 dark:bg-gray-700 ",children:t})},StepPopover=e=>{let{children:t}=e;return(0,s.jsx)("div",{className:"min-h-[200px] w-[550px]",children:t})},StepPopoverBacklink=()=>{let e=(0,x.xJ)(),ignoreStep=async()=>{await (null==e?void 0:e.updateTraits({onboarding_backlink_ignored:!0}))};return(0,s.jsxs)(StepPopover,{children:[(0,s.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,s.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,s.jsx)("p",{className:"font-semibold",children:"Backlinks are the key to organizing your notes"}),(0,s.jsxs)("p",{children:["To use a backlink, type ",(0,s.jsx)("code",{className:"font-mono",children:"[["})," and select a note from the list. If you type a note that doesn't exist, and then hit return, it will be created automatically."]})]}),(0,s.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(rE.Z,{className:"h-10 w-10 text-purple-400"})}),(0,s.jsxs)("video",{className:"relative min-h-[266px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,s.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-backlinks.mp4?alt=media&token=e84bc6b9-88c8-4d47-89bc-5df0b87a773d",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,s.jsx)(Footer,{children:(0,s.jsx)(TextButton,{onClick:ignoreStep,children:"Ignore"})})]})},StepPopoverLinks=()=>{let e=(0,x.xJ)(),ignoreStep=async()=>{await (null==e?void 0:e.updateTraits({onboarding_links_ignored:!0}))};return(0,s.jsxs)(StepPopover,{children:[(0,s.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,s.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,s.jsx)("p",{className:"font-semibold",children:"Bookmark websites and capture text with a single click"}),(0,s.jsxs)("p",{children:["Reflect lets you capture text and links from any website. To get started,"," ",(0,s.jsx)("a",{className:"text-blue-500",href:"https://reflect.app/extension",target:"_blank",rel:"noreferrer",children:"install our Chrome extension"})," ","and watch this video."]})]}),(0,s.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(rE.Z,{className:"h-10 w-10 text-purple-400"})}),(0,s.jsxs)("video",{className:"relative min-h-[266px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,s.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-links.mp4?alt=media&token=cb8eff93-8f76-4046-9ebb-e5725ed246de",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,s.jsxs)(Footer,{children:[(0,s.jsx)(TextButton,{onClick:ignoreStep,children:"Ignore"}),(0,s.jsx)(I.KM,{onClick:()=>{window.open("/extension","_blank")},children:"Install Chrome extension"})]})]})};var rB=n(22334);let StepPopoverMeetings=()=>{let e=(0,x.xJ)(),ignoreStep=async()=>{await (null==e?void 0:e.updateTraits({onboarding_add_meeting_ignored:!0}))};return(0,s.jsxs)(StepPopover,{children:[(0,s.jsxs)("div",{className:"mb-2 flex flex-1 flex-col space-y-4 px-7 pt-7",children:[(0,s.jsxs)("div",{className:"flex-none space-y-3 text-base",children:[(0,s.jsx)("p",{className:"font-semibold",children:"Quickly take meeting notes by importing your calendar events"}),(0,s.jsx)("p",{children:"We support both Google Calendar and Office 365 integrations."})]}),(0,s.jsxs)("div",{className:"relative flex-none overflow-hidden rounded-md ring-2 ring-purple-200",children:[(0,s.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(rE.Z,{className:"h-10 w-10 text-purple-400"})}),(0,s.jsxs)("video",{className:"relative min-h-[261px]",autoPlay:!0,loop:!0,muted:!0,controls:!0,children:[(0,s.jsx)("source",{src:"https://firebasestorage.googleapis.com/v0/b/reflect-prod.appspot.com/o/website-static%2Fstep-onboarding-meetings.mp4?alt=media&token=64a78563-fac3-422e-9850-75e1d8cf4327",type:"video/mp4"}),"Your browser does not support the video tag."]})]})]}),(0,s.jsxs)(Footer,{children:[(0,s.jsx)(TextButton,{onClick:ignoreStep,children:"Ignore"}),(0,s.jsx)(rB.F,{buttonClassName:"!bg-indigo-600 !text-white !border-none",buttonLabel:"Connect your calendar",placement:"top"})]})]})},rL=(0,g.Pi)(()=>{let e=(0,x.xJ)(),t=[{key:"backlink",name:"Create a backlink",description:"See the power of your connected thoughts.",popoverRender:()=>(0,s.jsx)(StepPopoverBacklink,{}),completed:(null==e?void 0:e.traits.backlink_created)===!0,ignored:(null==e?void 0:e.traits.onboarding_backlink_ignored)===!0},{key:"links",name:"Save a link",description:"Quickly bookmark websites and capture text.",popoverRender:()=>(0,s.jsx)(StepPopoverLinks,{}),completed:(null==e?void 0:e.traits.link_created)===!0,ignored:(null==e?void 0:e.traits.onboarding_links_ignored)===!0},{key:"meetings",name:"Add a meeting",description:"Retain notes from all your meetings.",popoverRender:()=>(0,s.jsx)(StepPopoverMeetings,{}),completed:(null==e?void 0:e.traits.meeting_added)===!0,ignored:(null==e?void 0:e.traits.onboarding_add_meeting_ignored)===!0}];if(!(null==e?void 0:e.ready)||t.every(e=>e.completed||e.ignored))return null;let isVideoFullscreen=()=>!!window.document.fullscreenElement;return(0,s.jsxs)("div",{className:"mx-2 flex-none",children:[(0,s.jsx)("h3",{className:"flex-none px-4 text-xs font-medium leading-5 tracking-wide text-coolgray-400",children:"Account setup"}),(0,s.jsx)("div",{className:"space-y-4 px-4 py-5",children:t.map((e,t)=>(0,s.jsx)(Popover,{render:e.popoverRender,onOpenChange:e=>!!isVideoFullscreen()||e,children:n=>(0,s.jsx)(Step,{open:n,name:e.name,description:e.description,index:t+1,completed:e.completed,ignored:e.ignored})},e.key))})]})});var rF=n(34751);let DraggableList=e=>{let{children:t,onChange:n,itemIds:r,itemHeight:a}=e,o=(0,l.useRef)(r);(0,l.useEffect)(()=>{o.current=r},[r]);let animationCallback=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return s=>{let l=r[s],d=th()(e,r),immediate=e=>"zIndex"===e||d;return t&&s===n?{y:o*a+i,scale:1.05,zIndex:1,shadow:10,config:e=>"y"===e?rx.config.stiff:rx.config.default,immediate}:{y:e.indexOf(l)*a,scale:1,zIndex:0,shadow:0,immediate}}},[i,d]=(0,rx.useSprings)(r.length,animationCallback(r),[r]),c=(0,rF.useDrag)(e=>{let{args:[t],active:i,movement:[,s]}=e,l=r[t],c=o.current.indexOf(l),u=rj()(Math.round((c*a+s)/a),0,r.length-1),h=(0,tr.LF)(o.current,c,u);d.start(animationCallback(h,i,t,c,s)),i||(o.current=h,null==n||n(h))},{threshold:5,dependencies:[r,a]}),u=l.Children.toArray(t);return(0,s.jsx)("div",{className:"relative",style:{height:r.length*a},children:i.map((e,t)=>{let{zIndex:n,shadow:a,y:o,scale:i}=e;return(0,l.createElement)(rx.animated.div,{...c(t),key:r[t],"data-item-id":r[t],className:"absolute left-0 right-0 origin-center touch-none",style:{zIndex:n,filter:a.to(e=>"drop-shadow(0 0 ".concat(e,"px rgba(15, 23, 42, 0.1))")),y:o,scale:i,transformOrigin:"50% 50% 0px"}},u[t])})})},rA=(0,g.Pi)(e=>{let{note:t,selected:n,onClick:r}=e;return(0,s.jsx)("div",{onMouseDown:r,className:(0,G.Z)("mx-2 flex cursor-default flex-col rounded-md px-2 py-1 leading-5","hover:bg-gray-200/50 dark:hover:bg-white/3",n&&"bg-gray-200/50 dark:bg-transparent",n?"text-gray-800 dark:text-primary-dk":"text-gray-500 hover:text-gray-800 dark:text-near-white dark:hover:text-white"),children:(0,s.jsx)("div",{className:"flex items-center space-x-2",children:(0,s.jsx)("div",{className:"flex-1 truncate text-2xs font-medium",children:t.title})})})}),rZ=(0,g.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),n=[S.oK.NoteEdit,S.oK.NoteDaily].includes(t.screen),{pinnnedNotesIndexAsc:r}=e,{selectedNote:a}=t,o=(0,l.useMemo)(()=>tL()(async t=>{await e.updatePinnedIndexes(t)},500),[e]);return 0===r.count?null:(0,s.jsxs)("div",{className:"mx-2 flex flex-1 flex-col",children:[(0,s.jsx)("h3",{className:"flex-none px-4 text-xs font-medium leading-5 tracking-wide text-coolgray-400",children:"Pinned notes"}),(0,s.jsx)("div",{className:"mt-2 flex flex-1 flex-col",children:(0,s.jsx)(DraggableList,{itemHeight:33,itemIds:r.placeholders.map(e=>e.id),onChange:e=>void o(e),children:r.placeholders.map(e=>(0,s.jsx)(rA,{note:e.value,selected:n&&e.value===a,onClick:n=>t.editNote(e.value,{secondary:n.metaKey||n.ctrlKey})},e.id))})})]})}),RegionDrag=()=>(0,s.jsx)("div",{className:"app-region-drag pointer-events-none absolute inset-x-0 top-0 z-0 h-8"}),rz=(0,g.Pi)(()=>{let e=(0,x.Pw)();return(0,s.jsx)("div",{className:"flex flex-1 flex-col",children:(0,s.jsxs)("div",{className:" flex flex-1 cursor-text items-center  space-x-1 rounded-[7px]  border border-coolgray-900/15 bg-white px-2 py-1.5 text-2xs text-coolgray-400 shadow-app-input shadow-black/5  transition duration-150 ease-in-out hover:bg-white hover:text-coolgray-700 capacitor:active:opacity-70 dark:border-white/5 dark:bg-white/5 dark:text-coolgray-500 dark:shadow-black/10 dark:hover:text-near-white ",onClick:()=>e.openSearchModal(),children:[(0,s.jsx)("div",{className:"flex-none",children:(0,s.jsx)(SearchIcon,{})}),(0,s.jsx)("div",{className:" w-0 flex-1 truncate ",children:"Search anything..."}),(0,s.jsx)("kbd",{className:"inline-flex flex-none items-center rounded px-2 font-sans text-xs font-medium uppercase",children:(0,s.jsx)(eS.Ht,{shortcuts:["meta","k"]})})]})})});var rH=n(69864);let r_=(0,g.Pi)(()=>{let e=(0,x.xJ)(),t=(0,x.Jf)(),n=(0,x.Yh)(),goToBilling=()=>{n.openPreferencesScreen(),t.setScreen(S.JY.Billing)};return(0,s.jsx)("div",{className:"flex flex-none",children:(0,s.jsxs)("a",{onClick:()=>goToBilling(),className:" flex w-full cursor-pointer justify-between border-t border-gray-200  bg-gray-100 py-2 px-4  text-sm transition duration-100 hover:bg-gray-200 dark:border-gray-800 dark:bg-gray-900 ",children:[(0,s.jsxs)("span",{className:"text-gray-900 dark:text-near-white",children:[(0,s.jsxs)("strong",{children:[null==e?void 0:e.trialDaysLeft," days left"]})," in your trial"]}),(0,s.jsxs)("span",{className:"flex space-x-1.5 font-medium text-indigo-700 dark:text-primary-dk",children:[(0,s.jsx)("span",{children:"Upgrade"})," ",(0,s.jsx)(rH.Z,{className:"w-3.5"})]})]})})}),rO=(0,g.Pi)(()=>{let e=(0,x.Fq)(),t=(0,x.xJ)(),n=(0,x.Pw)(),r=(0,t_.ze)(),a=null==e?void 0:e.tasksEnabled,o=(0,l.useMemo)(()=>O.EM,[]),[i,d]=(0,l.useState)(!1),c=t&&t.isTrialing&&t.trialDaysLeft<5,u=(0,eX.W)()&&!r.isHidden;return(0,l.useEffect)(()=>{let onKeyDown=e=>{(0,eS.rm)(e)&&d(!0)},onKeyUp=()=>{d(!1)};return window.document.addEventListener("keydown",onKeyDown),window.document.addEventListener("keyup",onKeyUp),()=>{window.document.removeEventListener("keydown",onKeyDown),window.document.removeEventListener("keyup",onKeyUp)}},[]),(0,s.jsxs)("div",{className:" relative flex flex-1 flex-col overflow-y-auto bg-coolgray-50 electron:pt-6 capacitor:pt-5 dark:bg-gray-800/30 ",children:[(0,s.jsx)(RegionDrag,{}),(0,s.jsxs)("div",{className:" flex flex-none flex-col space-y-5 overflow-hidden py-5 ",children:[(0,s.jsxs)("div",{className:"flex flex-none gap-3 px-4",children:[(0,s.jsx)(rz,{}),(0,s.jsx)(rM,{})]}),(0,s.jsxs)(Menu,{children:[(0,s.jsxs)(menu_MenuItem,{selected:n.screen===S.oK.NoteDaily,onClick:()=>n.openNoteDailyScreen(),title:"Shortcut: ".concat(o," shift d"),children:[(0,s.jsx)(PencilIcon,{}),(0,s.jsx)(ShortcutText,{value:"Daily notes",highlight:i})]}),(0,s.jsxs)(menu_MenuItem,{selected:n.screen===S.oK.NoteList||n.screen===S.oK.NoteEdit,onClick:()=>n.openListScreen(),title:"Shortcut: ".concat(o," shift a"),children:[(0,s.jsx)(ListIcon,{}),(0,s.jsx)(ShortcutText,{value:"All notes",highlight:i})]}),a&&(0,s.jsxs)(menu_MenuItem,{selected:n.screen===S.oK.TaskList,onClick:()=>n.openTaskView(),title:"Shortcut: ".concat(o," shift t"),children:[(0,s.jsx)(check_icon_CheckIcon,{}),(0,s.jsx)(ShortcutText,{value:"Tasks",highlight:i})]}),(0,s.jsxs)(menu_MenuItem,{selected:n.screen===S.oK.Map,onClick:()=>n.openMapScreen(),title:"Shortcut: ".concat(o," shift m"),children:[(0,s.jsx)(MapIcon,{}),(0,s.jsx)(ShortcutText,{value:"Map",highlight:i})]})]}),(null==e?void 0:e.hasFlag("pool_debug"))?(0,s.jsx)(rr,{}):null,(0,s.jsx)(rZ,{})]}),(0,s.jsx)(ra.L,{}),(0,s.jsx)(rL,{}),(0,s.jsx)(ru,{className:(0,G.Z)(u&&"hidden")}),c&&(0,s.jsx)(r_,{})]})}),rK=j()(()=>n.e(1155).then(n.bind(n,51155)).then(e=>e.ShortcutsModal),{loadableGenerated:{webpack:()=>[51155]},ssr:!1}),rG=(0,g.Pi)(()=>{let e=(0,x.dw)(),t=(0,x.Pw)(),n=(0,x.B0)(),r=function(e){let t=window.matchMedia(e),[n,r]=(0,l.useState)(t.matches);return(0,l.useEffect)(()=>{let handler=e=>{r(e.matches)};return(0,Z.XU)(t,handler),()=>{(0,Z.nd)(t,handler)}},[]),n}("(max-width: 960px)"),{leftSidebarSize:a}=n;return(0,l.useEffect)(()=>{t.setSemiScreenMedia(r)},[t,r]),(0,l.useEffect)(()=>{let{dailyStore:n,dailyEditorView:r}=e;n.updateGeneratedNotes(r.range),t.ensureSelectedNote()},[e]),(0,s.jsxs)(L.S,{className:"flex flex-col overflow-hidden bg-background-stark",children:[(0,s.jsx)(K,{}),(0,s.jsx)(H,{}),(0,s.jsxs)(A.IF,{sidebarPosition:"start",sidebarSize:a,sizeType:"fixed",sidebarHidden:t.semiScreen,minSidebarSize:175,onResize:e=>n.setLeftSidebarSize(e),className:"flex-1 overflow-hidden",children:[(0,s.jsx)(A.IF.Sidebar,{children:(0,s.jsx)(rO,{})}),(0,s.jsx)(A.IF.Main,{className:"flex flex-col",children:(0,s.jsx)(F.S,{children:(0,s.jsx)(t1,{})})})]}),t.searchModalIsOpen&&(0,s.jsx)(rn,{}),t.shortcutsModalIsOpen&&(0,s.jsx)(rK,{onClose:()=>t.closeModal()})]})}),rU=j()(()=>n.e(2852).then(n.bind(n,72852)).then(e=>e.Preferences),{loadableGenerated:{webpack:()=>[72852]},ssr:!1}),rW=j()(()=>n.e(7390).then(n.bind(n,87390)).then(e=>e.Toasts),{loadableGenerated:{webpack:()=>[87390]},ssr:!1});var rq=n(75396);let rQ=Number.parseInt("1705671553");async function checkAppUpdate(){let e=await fetch("/api/app-version?client=".concat(rQ),{method:"GET"}),t=await e.json(),n=Number.parseInt(t.timestamp);return(0,ew.Rn)(n,"Invalid remote version ".concat(t.timestamp)),n>rQ}async function safeCheckAppUpdate(){try{return await checkAppUpdate()}catch(e){return console.warn("Error checking app update:",e),null}}function AppUpdateNotifier(e){let{online:t}=e,n=(0,l.useRef)(0),r=(0,l.useRef)(null),a=(0,l.useRef)(t);(0,l.useEffect)(()=>{if(a.current=t,!t){var e;null===(e=r.current)||void 0===e||e.call(r),r.current=null}},[t]);let o=(0,l.useCallback)(()=>{a.current&&window.location.reload()},[]),i=(0,l.useCallback)(()=>{n.current=Date.now()},[]),d=(0,l.useCallback)(async()=>{let e=Date.now();if(e-n.current<864e5)return;let t=await safeCheckAppUpdate();if(t){var a;null===(a=r.current)||void 0===a||a.call(r);let{dismiss:e}=(0,er.Am)({title:"A new version of Reflect is available",description:"Do you want to update now?",duration:36e5,action:(0,s.jsx)(AppUpdateActions,{onDismiss:i,onConfirm:o})});r.current=e}},[i,o]);return(0,l.useEffect)(()=>{let e=setTimeout(()=>void d(),5e3);return()=>clearTimeout(e)},[d]),(0,l.useEffect)(()=>{let e=setInterval(()=>void d(),36e5);return()=>clearInterval(e)},[d]),(0,l.useEffect)(()=>{let handleOnline=()=>{d()};return window.addEventListener("online",handleOnline),()=>window.removeEventListener("online",handleOnline)},[d]),null}(0,ew.Rn)(rQ,"Invalid local version");let AppUpdateActions=e=>{let{onConfirm:t,onDismiss:n}=e;return(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)(rq.gD,{altText:"update",onClick:t,children:(0,s.jsx)("span",{className:"whitespace-nowrap",children:"Update"})}),(0,s.jsx)(rq.gD,{altText:"dismiss",onClick:n,children:(0,s.jsx)("span",{className:"whitespace-nowrap",children:"Later"})})]})};async function safeCheckNetworkConnect(){return"boolean"==typeof await safeCheckAppUpdate()}function BackgroundReload(e){let{online:t}=e,n=function(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let handleBlur=()=>{t(!1)},handleFocus=()=>{t(!0)};return window.addEventListener("blur",handleBlur,{passive:!0}),window.addEventListener("focus",handleFocus,{passive:!0}),()=>{window.removeEventListener("blur",handleBlur),window.removeEventListener("focus",handleFocus)}},[]),e}(),r=function(){let[e,t]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=setTimeout(()=>{t(!0)},864e5);return()=>{clearTimeout(e)}}),e}(),a=function(){let e=(0,l.useRef)(0),[t,n]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let t=setInterval(()=>{let t=Date.now()-e.current>3e5;n(t)},3e5);return()=>{clearInterval(t)}},[]),(0,l.useEffect)(()=>{let handleInteraction=()=>{e.current=Date.now(),n(!1)};return window.addEventListener("mouseover",handleInteraction,{passive:!0}),window.addEventListener("pointerdown",handleInteraction,{passive:!0}),()=>{window.removeEventListener("mouseover",handleInteraction),window.removeEventListener("pointerdown",handleInteraction)}},[]),t}(),o=t&&!n&&r&&a;return(0,l.useEffect)(()=>{if(!o)return;let e=!1;return safeCheckNetworkConnect().then(t=>{t&&!e&&window.location.reload()}),()=>{e=!0}},[o]),null}let rY=(0,g.Pi)(()=>{let e=(0,x.Yh)();useMessage(t=>{"open-preferences"===t.command&&e.togglePreferencesScreen()}),(0,_.y)("meta+,",t=>{t.preventDefault(),e.togglePreferencesScreen()},[]);let trackAppLoaded=async()=>{var e;let t=await (null===tP.Z||void 0===tP.Z?void 0:null===(e=tP.Z.getVersion)||void 0===e?void 0:e.call(tP.Z));(0,B.j)("app_loaded",{version:S.q4,electron:!!tP.Z,electron_version:t,sha:"552d0cd9b5bff7644a3a3bd55b896e99f2b9e375",branch:"master",user_agent:navigator.userAgent})};return(0,l.useEffect)(()=>{trackAppLoaded()},[]),(0,s.jsxs)(s.Fragment,{children:[(()=>{switch(e.screen){case S.z2.Main:return(0,s.jsx)(rG,{});case S.z2.Preferences:return(0,s.jsx)(rU,{})}})(),(0,s.jsx)(rW,{}),(0,s.jsx)(AppUpdateNotifier,{online:e.online}),(0,s.jsx)(BackgroundReload,{online:e.online})]})}),Redirect=e=>{let{path:t}=e,n=(0,b.useRouter)();return(0,l.useEffect)(()=>{n.push(t)},[t]),null},rJ=(0,g.Pi)(()=>{let e=(0,x.Yh)();switch(console.log("LoadingState:",e.loadingState),e.loadingState){case S.Gu.Auth:return(0,s.jsx)(k,{});case S.Gu.GraphSetup:return(0,s.jsx)(Redirect,{path:"/setup"});case S.Gu.GraphEncryptionSetup:return(0,s.jsx)(N,{});case S.Gu.Migrating:return(0,s.jsx)(P,{graph:e.currentGraph,message:"Preparing your notes. This may take a sec..."});case S.Gu.MigrationFailed:return(0,s.jsx)(R,{title:"Migration failed",message:"We are sorry about this! Please contact support@reflect.app",refreshLabel:"Try again"});case S.Gu.MigrationOffline:return(0,s.jsx)(R,{title:"Can't reach the database",message:"\n            Migration failed because your device seems to be offline.\n            Please try again, and if the problem persists, contact us at support@reflect.app",refreshLabel:"Try again"});case S.Gu.VersionUnsupported:return(0,s.jsx)(R,{title:"Update required",message:"A new version of Reflect has been released.",refreshLabel:"Upgrade now"});case S.Gu.MainScreen:return(0,s.jsx)(rY,{});case S.Gu.Loading:return(0,s.jsx)(LoadingIndicator,{delayedTimeout:!0});default:return null}});var rX=n(70173);let RouterView=class RouterView{get routePath(){let e=this.routeState;switch(e.rootScreen){case S.z2.Preferences:return"/preferences/".concat(e.preferenceScreen);case S.z2.Main:switch(e.mainScreen){case S.oK.NoteList:if(e.graphId){let t=e.noteListQuery?"/".concat(e.noteListQuery):"";return"/g/".concat(e.graphId,"/list").concat(t)}break;case S.oK.NoteEdit:case S.oK.NoteDaily:if(e.noteId)return"/g/".concat(e.graphId,"/").concat(e.noteId);break;case S.oK.Map:if(e.graphId)return"/g/".concat(e.graphId,"/map");break;case S.oK.TaskList:if(e.graphId)return"/g/".concat(e.graphId,"/tasks")}}return"/"}get routeState(){var e,t,n,r,a;return{rootScreen:this.rootStore.screen,mainScreen:this.rootStore.mainView.screen,preferenceScreen:this.rootStore.preferenceStore.screen,graphId:(null===(e=this.rootStore.graphStore.currentGraph)||void 0===e?void 0:e.id)||null,noteListQuery:(null===(n=this.rootStore.noteStore)||void 0===n?void 0:null===(t=n.listView)||void 0===t?void 0:t.query)||null,noteId:(null===(a=this.rootStore.mainView)||void 0===a?void 0:null===(r=a.selectedNote)||void 0===r?void 0:r.id)||null}}setRouteState(e){var t,n,r,a;let o,i;let{rootScreen:s,mainScreen:l,preferenceScreen:d,graphId:c,noteListQuery:u,noteId:h}=e;h&&l===S.oK.NoteDaily&&(o=(0,rX.cB)(h)),h&&l===S.oK.NoteEdit&&(i=h),s&&this.rootStore.setScreen(s),l&&this.rootStore.mainView.setScreen(l),d&&this.rootStore.preferenceStore.setScreen(d),c&&(this.rootStore.graphStore.ensureVolatileGraphId(c),this.rootStore.graphStore.setCurrentGraphId(c)),o&&(null===(t=this.rootStore.noteStore)||void 0===t||t.dailyEditorView.setSelectedDate(o)),i&&(null===(n=this.rootStore.noteStore)||void 0===n||n.primaryEditorView.setSelectedNoteId(i)),u&&(null===(a=this.rootStore.noteStore)||void 0===a||null===(r=a.listView)||void 0===r||r.setQuery(u))}constructor(e){this.rootStore=e,(0,f.makeObservable)(this)}};(0,eg.gn)([f.computed],RouterView.prototype,"routePath",null),(0,eg.gn)([f.computed],RouterView.prototype,"routeState",null);let r$=(0,g.Pi)(e=>{var t;let{state:n}=e,r=(0,x.Yh)(),a=(0,l.useMemo)(()=>new RouterView(r),[r]),pushState=(e,t)=>{history.pushState(t,"",e)},o=(0,l.useRef)();return(0,l.useEffect)(()=>{n&&a.setRouteState(n)},[n]),(0,l.useEffect)(()=>{a.routePath!==o.current&&(o.current=a.routePath,pushState(a.routePath,a.routeState),(0,B.Md)())},[a.routePath]),t=e=>{o.current=location.pathname;let t=e.state;t&&a.setRouteState(t)},(0,l.useEffect)(()=>(window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)),[]),(0,_.y)("meta+[",e=>{e.preventDefault(),history.back()}),(0,_.y)("meta+]",e=>{e.preventDefault(),history.forward()}),null}),App=e=>{let{state:t={},ready:n=!0}=e;return(0,u.T8)(),(0,l.useEffect)(()=>{var e,t;console.log("Registering service worker"),null===(t=window.workbox)||void 0===t||null===(e=t.register)||void 0===e||e.call(t)},[]),!function(){let handler=async()=>{var e,t;let n=await (null===(t=navigator)||void 0===t?void 0:null===(e=t.serviceWorker)||void 0===e?void 0:e.getRegistrations());if(n)for(let e of n)await e.update()};(0,l.useEffect)(()=>{let e=setInterval(handler,12e5);return()=>clearInterval(e)},[])}(),(0,d.N)(),(0,l.useEffect)(()=>{c.k.info("Loaded app",{version:S.q4,sha:"552d0cd9b5bff7644a3a3bd55b896e99f2b9e375",branch:"master"})},[]),(0,s.jsxs)(h.AppProvider,{ready:n,children:[(0,s.jsx)(rJ,{}),(0,s.jsx)(r$,{state:t}),(0,s.jsx)(y,{})]})}},80182:function(e,t,n){n.d(t,{e:function(){return CapacitorView}});var r=n(74806),a=n(24206);let CapacitorView=class CapacitorView{async dispose(){this.keyboardView.dispose(),await this.keyboardToolbarView.dispose()}constructor(){this.keyboardView=new a.q,this.keyboardToolbarView=new r.q}}},94541:function(e,t,n){n.d(t,{F0:function(){return CapacitorViewProvider},l3:function(){return useCapacitorView},ze:function(){return useKeyboardView},zz:function(){return useKeyboardToolbarView}});var r=n(85893),a=n(67294),o=n(77004),i=n(80182);let s=(0,a.createContext)(void 0),CapacitorViewProvider=e=>{let{children:t}=e,n=(0,o.D)(()=>new i.e,[]);return(0,r.jsx)(s.Provider,{value:n,children:t})};function useCapacitorView(){let e=(0,a.useContext)(s);if(!e)throw Error("useCapacitorView must be used within a CapacitorViewProvider");return e}function useKeyboardView(){let{keyboardView:e}=useCapacitorView();return e}function useKeyboardToolbarView(){let{keyboardToolbarView:e}=useCapacitorView();return e}},23164:function(e,t,n){n.d(t,{ze:function(){return r.ze},zz:function(){return r.zz}}),n(80182);var r=n(94541);n(74806),n(24206)},74806:function(e,t,n){n.d(t,{q:function(){return KeyboardToolbarView}});var r=n(97582),a=n(96826),o=n(64406),i=n(18446),s=n.n(i),l=n(10928),d=n.n(l),c=n(68949),u=n(29895);let KeyboardToolbarWeb=class KeyboardToolbarWeb extends u.Uw{setItems(){}show(){}hide(){}getHasExternalKeyboard(){return Promise.resolve({isConnected:!1})}};let h=(0,u.fo)("KeyboardToolbar",{web:new KeyboardToolbarWeb});let KeyboardToolbarView=class KeyboardToolbarView{async dispose(){for(let e of this.listeners)(await Promise.resolve(e))()}observeEditor(){this.listeners.push((0,c.reaction)(()=>{let{canIndent:e,canDedent:t,canMoveUp:n,canMoveDown:r}=this;return{canIndent:e,canDedent:t,canMoveUp:n,canMoveDown:r}},e=>this.updateToolbar(e),{fireImmediately:!0,equals:s()}))}async observePlugin(){let e=await h.getHasExternalKeyboard();this.setHasExternalKeyboard(e.isConnected),this.listeners.push((await h.addListener("action",e=>{this.handleCommand(e)})).remove),this.listeners.push((await h.addListener("visibility",e=>{this.setIsVisible(e.isVisible)})).remove),this.listeners.push((await h.addListener("externalKeyboard",e=>{this.setHasExternalKeyboard(e.isConnected)})).remove)}setSelectionOptions(e){this.canIndent=e.canIndent,this.canDedent=e.canDedent,this.canMoveUp=e.canMoveUp,this.canMoveDown=e.canMoveDown,this.selectedSubject=e.selectedSubject}setIsVisible(e){this.isVisible=e}setHasExternalKeyboard(e){this.hasExternalKeyboard=e}show(e){this.editorRef=e,h.show()}hide(){h.hide()}updateToolbar(e){h.setItems({items:function(e){let{canIndent:t,canDedent:n,canMoveUp:r,canMoveDown:a}=e;return[{type:"action",icon:"slash",action:"insertCommand"},{type:"action",icon:"bullet-list",action:"insertBullet"},{type:"action",icon:"todo-list",action:"insertTask"},{type:"action",icon:"backlink",action:"insertBacklink"},{type:"action",icon:"hashtag",action:"insertTag"},{type:"action",icon:"outdent",action:"outdent",disabled:!n},{type:"action",icon:"indent",action:"indent",disabled:!t},{type:"action",icon:"move-up",action:"moveUp",disabled:!r,canHide:!0},{type:"action",icon:"move-down",action:"moveDown",disabled:!a,canHide:!0},{type:"action",icon:"image",action:"insertImage"}]}(e)})}handleCommand(e){var t;let{action:n}=e,r=null===(t=this.editorRef)||void 0===t?void 0:t.current;switch(n){case"insertCommand":null==r||r.insertText("/");break;case"insertBullet":null==r||r.turnToBulletList();break;case"insertTask":null==r||r.turnToTaskList();break;case"insertBacklink":null==r||r.insertText("[[");break;case"insertTag":null==r||r.insertText("#");break;case"indent":null==r||r.indentListItem();break;case"outdent":null==r||r.dedentListItem();break;case"moveUp":null==r||r.moveUpListItem();break;case"moveDown":null==r||r.moveDownListItem();break;case"insertImage":this.insertImage();break;case"dismiss":null==r||r.blur()}}async insertImage(){let e=this.editorRef.current,t=[];try{t=(await a.V1.pickImages({width:1e3,quality:80,presentationStyle:"popover"})).photos}catch(e){console.warn(e)}for(let n of t){let{path:t}=n;if(!t)continue;let r=await o.fy.readFile({path:t}),a=d()(t.split("/")),i=await fetch("data:text/plain;base64,"+r.data),s=await i.arrayBuffer(),l=new File([s],a);null==e||e.uploadImages([l])}}constructor(){this.canIndent=!1,this.canDedent=!1,this.canMoveUp=!1,this.canMoveDown=!1,this.selectedSubject=!1,this.isVisible=!1,this.hasExternalKeyboard=!1,this.editorRef={current:null},this.listeners=[],(0,c.makeObservable)(this),this.observeEditor(),this.observePlugin()}};(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"canIndent",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"canDedent",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"canMoveUp",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"canMoveDown",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"selectedSubject",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"isVisible",void 0),(0,r.gn)([c.observable],KeyboardToolbarView.prototype,"hasExternalKeyboard",void 0),(0,r.gn)([c.action],KeyboardToolbarView.prototype,"setSelectionOptions",null),(0,r.gn)([c.action],KeyboardToolbarView.prototype,"setIsVisible",null),(0,r.gn)([c.action],KeyboardToolbarView.prototype,"setHasExternalKeyboard",null)},24206:function(e,t,n){n.d(t,{q:function(){return KeyboardView}});var r=n(97582),a=n(29895),o=n(50842),i=n(68949);let KeyboardView=class KeyboardView{dispose(){this.listeners.forEach(e=>e.remove())}hasKeyboardPlugin(){return a.dV.isPluginAvailable("Keyboard")}setHeight(e){this.keyboardHeight={type:"exact",value:e}}setStatus(e){this.status=e}get wantsSpacer(){return"showing"===this.status||"visible"===this.status}get isHidden(){return"hidden"===this.status||"hiding"===this.status}async observeKeyboard(){this.hasKeyboardPlugin()&&this.listeners.push(await o.N1.addListener("keyboardWillShow",e=>{this.setHeight(e.keyboardHeight),this.setStatus("showing")}),await o.N1.addListener("keyboardDidShow",e=>{this.setHeight(e.keyboardHeight),this.setStatus("visible")}),await o.N1.addListener("keyboardWillHide",()=>{this.setStatus("hiding")}),await o.N1.addListener("keyboardDidHide",()=>{this.setStatus("hidden")}))}constructor(){this.listeners=[],this.keyboardHeight={type:"approx",value:380},this.status="hidden",(0,i.makeObservable)(this),this.observeKeyboard()}};(0,r.gn)([i.observable],KeyboardView.prototype,"keyboardHeight",void 0),(0,r.gn)([i.observable],KeyboardView.prototype,"status",void 0),(0,r.gn)([i.action],KeyboardView.prototype,"setHeight",null),(0,r.gn)([i.action],KeyboardView.prototype,"setStatus",null),(0,r.gn)([i.computed],KeyboardView.prototype,"wantsSpacer",null),(0,r.gn)([i.computed],KeyboardView.prototype,"isHidden",null)},27074:function(e,t,n){n.d(t,{k:function(){return getRootStore}});var r=n(69483),a=n.n(r),o=n(53699),i=n(68825),s=n(95440),l=n(70586),d=n(23279),c=n.n(d),u=n(69963),h=n(47037),m=n.n(h),p=n(80394),f=n(13861);let g={preferences:{key:"preferences-store",version:25},user:{key:"user-store",version:25},graph:{key:"graph-store",version:32},credential:{key:"credential-store",version:25},change:{key:"change-store",version:27,debounceInterval:500,saveOnUnload:!0,migrations:[{from:26,to:27,migrate:e=>{var t;return{...e,pendingCommits:(null!==(t=e.pendingCommits)&&void 0!==t?t:[]).map(e=>{try{let{noteRef:t,...n}=e,{graphId:r,noteId:a}=(0,p.l7)(t.id);return{...n,graphId:r,noteId:a}}catch(e){return null}}).filter(f.Dw)}}}]},uiState:{key:"ui-state-store",version:1}};async function loadFromStorage(e){let{key:t,version:n}=e,r=getStorageKey({key:t,version:n}),a=await s.j.getItem(r);return m()(a)?JSON.parse(a):a}async function saveToStorage(e){let{snapshot:t,key:n,version:r}=e,a=getStorageKey({key:n,version:r}),o=JSON.stringify(t);await s.j.setItem(a,o)}function getStorageKey(e){let{key:t,version:n}=e;return"".concat(t,"-").concat(n)}async function persist(e,t){let{key:n,version:r,debounceInterval:a=2e3,saveOnUnload:i,migrations:s=[]}=t,saveSnapshot=async t=>{"onPersist"in e&&"function"==typeof e.onPersist&&e.onPersist(),await saveToStorage({snapshot:t,key:n,version:r})},l=c()(saveSnapshot,a);(0,o.cfB)(e,l),i&&window.addEventListener("beforeunload",()=>{let t=(0,o.vMv)(e);saveSnapshot(t)});let d=await loadSnapshot({key:n,version:r,migrations:s});d&&(0,o.Xx3)(e,d)}async function loadSnapshot(e){let{key:t,version:n,migrations:r}=e,a=await loadFromStorage({key:t,version:n});return a||migratePreviousVersion({migrations:r,key:t,version:n})}async function migratePreviousVersion(e){let{migrations:t,key:n,version:r}=e,a=t.find(e=>e.to===r);if(!a)return null;let o=await loadFromStorage({key:n,version:a.from});if(o)try{return a.migrate(o)}catch(e){(0,u.Tb)(e)}return null}var x=n(22255);async function createRootStore(){l.k.info("Setting up root store...");let e=new x.M({});return console.time("Loading stores"),await persist(e.preferenceStore,g.preferences),await persist(e.userStore,g.user),await persist(e.graphStore,g.graph),await persist(e.credentialStore,g.credential),await persist(e.changeStore,g.change),await persist(e.uiStateStore,{...g.uiState,debounceInterval:500}),console.timeEnd("Loading stores"),(0,o.m83)(e)||(0,o.v5r)(e),e}(0,o.QbW)({modelIdGenerator:i.O}),s.j.setup(a());let v=null;async function getRootStore(){return v||(v=await createRootStore()),v}},22334:function(e,t,n){n.d(t,{F:function(){return M}});var r=n(85893),a=n(41386),o=n(40263),i=n(42310),s=n(46670),l=n(67294),d=n(35082),c=n(85983),u=n(66037),h=n(13245),m=n(81472),p=n(90512),f=n(37226);let g=(0,l.createContext)(void 0),x=g.Provider,PopoverMenu=e=>{let{children:t,buttonClassName:n,buttonLabel:a,enabled:o=!0,placement:i="bottom-end"}=e,[s,g]=(0,l.useState)(!1),[v,y]=(0,l.useState)(!1),onOpenChange=e=>{e?(g(!0),y(!1)):(y(!0),setTimeout(()=>g(!1),300))},{x:b,y:w,reference:j,floating:k,context:N}=(0,d.YF)({placement:i,open:s,onOpenChange,middleware:[(0,c.uY)({padding:5}),(0,c.cv)(5),(0,c.RR)()],whileElementsMounted:u.Me}),{getReferenceProps:S,getFloatingProps:C}=(0,d.NI)([(0,d.eS)(N,{enabled:o}),(0,d.qs)(N),(0,d.bQ)(N)]),[I,V]=(0,m.useSpring)(()=>({scale:.95,opacity:0,config:{duration:300,easing:m.easings.easeOutQuart}}),[s]);return(0,l.useLayoutEffect)(()=>{s&&V.start({opacity:1,scale:1})},[s,V]),(0,l.useLayoutEffect)(()=>{v&&V.start({opacity:0,scale:.99})},[v,V]),(0,r.jsxs)(x,{value:{onClose:()=>{onOpenChange(!1)}},children:[(0,r.jsx)("div",{className:"popover-menu-reference",...S({ref:j}),children:(0,r.jsxs)("button",{className:(0,p.Z)("\n            inline-flex items-center justify-center\n            rounded-md border border-coolgray-200 bg-background px-3 py-1.5\n            text-sm font-medium text-coolgray-600\n            outline-none ring-offset-coolgray-100\n            hover:bg-coolgray-50 dark:border-coolgray-800\n             dark:text-coolgray-300\n            dark:ring-offset-dark-black-900 dark:hover:bg-gray-800\n          ",n),children:[(0,r.jsx)("span",{children:a}),(0,r.jsx)(h.Z,{className:"-mr-1 ml-1 h-4 w-4","aria-hidden":"true"})]})}),(0,r.jsx)(d.ll,{children:s&&(0,r.jsx)(f.Q2,{children:(0,r.jsx)("div",{ref:k,className:"absolute z-popover drop-shadow-2xl",style:{top:null!=w?w:0,left:null!=b?b:0},...C(),children:(0,r.jsx)("div",{className:"drop-shadow-sm",children:(0,r.jsx)(m.animated.div,{style:{transform:(0,m.to)([I.scale],e=>"scale(".concat(e,")")),opacity:I.opacity},children:(0,r.jsx)("div",{className:" z-popover flex origin-top-right flex-col divide-y divide-coolgray-100 overflow-x-hidden rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:divide-coolgray-900  dark:bg-coolgray-800 ",children:t})})})})})})]})},PopoverMenuItem=e=>{let{onClick:t,children:n}=e,a=(0,l.useContext)(g);return(0,r.jsx)("div",{className:"popover-menu-item",children:(0,r.jsx)("button",{className:" duration-120 flex w-full cursor-pointer items-center space-x-2 whitespace-nowrap px-4 py-2 text-left text-sm text-bluegray-700 transition-all hover:bg-bluegray-100 hover:text-bluegray-900 dark:text-near-white  hover:dark:bg-bluegray-800 ",onClick:()=>{null==t||t(),null==a||a.onClose()},children:n})})};var v=n(25038),y=n(68070),b=n(9878),w=n(70256),j=n(62980),k=n(25702),N=n(20833),S=n(40127),C=n(34009),I=n(12003),V=n(74254);let D=(0,I.j)("relative w-full rounded-lg p-4 [&>svg~*]:pl-7 [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-secondary-foreground",{variants:{variant:{default:"bg-secondary text-secondary-foreground",error:"bg-red-50 text-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),R=l.forwardRef((e,t)=>{let{className:n,variant:a,...o}=e;return(0,r.jsx)("div",{ref:t,role:"alert",className:(0,V.cn)(D({variant:a}),n),...o})});R.displayName="Alert";let T=l.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("h5",{ref:t,className:(0,V.cn)("mb-1 font-medium leading-none tracking-tight",n),...a})});T.displayName="AlertTitle";let P=l.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,V.cn)("text-sm [&_p]:leading-relaxed",n),...a})});P.displayName="AlertDescription";let AppleAuthModal=e=>{let{onClose:t}=e,[n,a]=(0,l.useState)(""),[o,i]=(0,l.useState)(""),[s,d]=(0,l.useState)({type:"idle"}),handleSubmit=async()=>{d({type:"loading"});try{let e=await (0,S.tC)("/api/credentials/auth/apple",{email:n,password:o});if("error"===e.status){d({type:"error",error:e.message});return}d({type:"idle"}),t()}catch(e){console.error("Unable to connect apple account:",e),d({type:"error",error:"Unknown error"})}};return(0,r.jsx)(k.u,{onClose:t,children:(0,r.jsxs)("div",{className:"flex min-h-[420px] w-[460px] flex-1 flex-col px-10 py-10",children:[(0,r.jsx)("h3",{className:"text-center text-2xl font-medium",children:"Connect an iCloud Calendar"}),(0,r.jsxs)("form",{className:"mt-3 flex flex-1 flex-col",onSubmit:e=>{e.preventDefault(),handleSubmit()},children:[(0,r.jsxs)("div",{className:"flex-1 space-y-4",children:["error"===s.type?(0,r.jsxs)(R,{variant:"error",children:[(0,r.jsx)(w.Z,{className:"h-5 w-5 fill-current text-red-400"}),(0,r.jsx)(P,{children:s.error})]}):(0,r.jsxs)(R,{children:[(0,r.jsx)(b.Z,{className:"h-5 w-5"}),(0,r.jsxs)(P,{children:["To sync your iCloud calendar, please generate an app-specific password."," ",(0,r.jsx)("a",{className:"text-primary",href:"https://support.apple.com/en-us/HT204397",target:"_blank",rel:"noreferrer",children:"Learn\xa0how"})]})]}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,r.jsx)("span",{children:"Apple ID"}),(0,r.jsx)(N.o,{value:n,onChange:e=>a(e),autoFocus:!0,autoComplete:"off",placeholder:"your@email.com",disabled:"loading"===s.type,required:!0})]})}),(0,r.jsx)("div",{children:(0,r.jsxs)("label",{className:"block space-y-1.5 text-sm font-medium",children:[(0,r.jsx)("span",{children:"App-specific Password"}),(0,r.jsx)(N.o,{value:o,onChange:e=>i(e),autoComplete:"off",placeholder:"xxxx-xxxx-xxxx-xxxx",disabled:"loading"===s.type,required:!0})]})})]}),(0,r.jsx)("footer",{className:"mt-4",children:(0,r.jsxs)(j.M,{loading:"loading"===s.type,children:[(0,r.jsx)("span",{children:"Connect calendar"}),(0,r.jsx)(C.f,{title:"command return",shortcut:["meta","return"],className:"absolute right-2"})]})})]})]})})},M=(0,s.Pi)(e=>{let{buttonClassName:t,placement:n,buttonLabel:s="Connect an account"}=e,[d,c]=(0,l.useState)(!1),authCredentials=async e=>{if("apple"===e)c(!0);else{let t=await (0,y.CL)(e);window.open(t),(0,v.yV)({credential_auth:!0}),(0,v.j)("credential_auth",{provider:e})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(PopoverMenu,{buttonLabel:s,buttonClassName:t,placement:n,children:[(0,r.jsxs)(PopoverMenuItem,{onClick:()=>authCredentials("google"),children:[(0,r.jsx)(a.S,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect a Google account"})]}),(0,r.jsxs)(PopoverMenuItem,{onClick:()=>authCredentials("microsoft"),children:[(0,r.jsx)(o.D,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect a Microsoft account"})]}),(0,r.jsxs)(PopoverMenuItem,{onClick:()=>authCredentials("apple"),children:[(0,r.jsx)(i.Z,{className:"w-3"}),(0,r.jsx)("span",{children:"Connect an iCloud account"})]})]}),d&&(0,r.jsx)(AppleAuthModal,{onClose:()=>c(!1)})]})})},66165:function(e,t,n){n.d(t,{m:function(){return ButtonAlt}});var r=n(85893),a=n(90512);n(67294);let ButtonAlt=e=>{let{onClick:t,disabled:n,className:o="",small:i=!1,type:s="button",children:l}=e;return(0,r.jsx)("span",{className:"inline-flex",children:(0,r.jsx)("button",{onClick:t,type:s,disabled:n,className:(0,a.Z)(o,i?"px-4 py-2":"px-4 py-2 md:px-4 md:py-2","focus:shadow-outline-indigo inline-flex items-center\n          space-x-2 rounded-md border\n          border-transparent bg-indigo-100 text-2xs\n           font-medium leading-5 text-indigo-600\n          outline-none hover:bg-indigo-50\n          focus:border-indigo-300\n          focus:outline-none active:bg-indigo-200 disabled:pointer-events-none disabled:cursor-default \n          disabled:opacity-75 dark:border dark:border-gray-800\n          dark:bg-gray-900 dark:text-near-white\n          dark:hover:bg-gray-800 dark:hover:text-white"),children:l})})}},55204:function(e,t,n){n.d(t,{zx:function(){return PrimaryButton},mI:function(){return i.m},KM:function(){return PrimaryButton},kq:function(){return SecondaryButton},Mm:function(){return s.M}});var r=n(85893),a=n(90512);n(67294);let PrimaryButton=e=>{let{onClick:t,type:n="button",className:o="",children:i,disabled:s}=e;return(0,r.jsx)("button",{onClick:t,type:n,disabled:s,className:(0,a.Z)("\n        inline-flex cursor-pointer items-center space-x-1 \n        rounded-md border border-transparent bg-indigo-600 px-3 py-2 text-sm font-medium \n        leading-4 text-white shadow-sm transition duration-300 ease-in-out \n        hover:bg-indigo-500 focus:outline-none \n        focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2\n        disabled:cursor-not-allowed disabled:bg-gray-500\n        ",o),children:i})};var o=n(74254);let SecondaryButton=e=>{let{onClick:t,className:n="",children:a}=e;return(0,r.jsx)("button",{onClick:t,type:"button",className:(0,o.cn)("\n          focus:shadow-outline-indigo inline-flex cursor-pointer items-center\n          space-x-1 rounded-md\n          border border-transparent bg-indigo-100\n          px-3 py-2 text-sm font-medium\n          leading-4 text-indigo-700\n          transition duration-150 ease-in-out\n          hover:bg-indigo-50\n          focus:border-indigo-300 focus:outline-none active:bg-indigo-200\n          dark:bg-indigo-900 dark:text-white\n        ",n),children:a})};var i=n(66165),s=n(19897)},62980:function(e,t,n){n.d(t,{M:function(){return SubmitButton}});var r=n(85893),a=n(90512);n(67294);let SubmitButton=e=>{let{loading:t=!1,onClick:n,disabled:o,className:i,children:s}=e,l=t||o;return(0,r.jsxs)("button",{type:"submit",onClick:n,disabled:l,className:(0,a.Z)("\n        focus:shadow-outline-purple relative inline-flex w-full min-w-28 items-center justify-center\n        overflow-hidden rounded-md border border-transparent bg-purple-600 px-4 py-2\n        text-base font-medium leading-6 text-white shadow-sm transition\n        duration-300 ease-in-out focus:outline-none sm:text-sm sm:leading-5\n        ",l&&"cursor-auto opacity-50",!l&&"hover:bg-purple-500 focus:border-purple-700 active:bg-purple-700",i),children:[(0,r.jsx)("div",{className:(0,a.Z)("absolute inset-0 flex items-center justify-center transition duration-200 ease-in-out",!t&&"-translate-y-full opacity-0"),children:(0,r.jsx)(Spinner,{})}),(0,r.jsx)("div",{className:(0,a.Z)("flex items-center space-x-2 transition duration-200 ease-in-out",t&&"translate-y-full opacity-0"),children:s})]})};function Spinner(){return(0,r.jsxs)("svg",{className:"h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}},19897:function(e,t,n){n.d(t,{M:function(){return SubmitButton}});var r=n(85893),a=n(90512);n(67294);let SubmitButton=e=>{let{label:t="Submit",loadingLabel:n="Loading...",loading:o=!1,onClick:i,disabled:s,className:l}=e;return(0,r.jsx)("span",{className:"flex w-full rounded-md shadow-sm",children:(0,r.jsxs)("button",{type:"submit",onClick:i,disabled:o||s,className:(0,a.Z)("relative inline-flex w-full min-w-28 justify-center shadow-sm","rounded-md border border-transparent bg-purple-600 px-4 py-2","text-base font-medium leading-6 text-white sm:text-sm sm:leading-5","focus:shadow-outline-purple hover:bg-purple-500 focus:border-purple-700 focus:outline-none","active:bg-purple-700","transition duration-300 ease-in-out",(o||s)&&"cursor-auto opacity-50",l),children:[o&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("svg",{className:"absolute left-0 ml-2 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),(0,r.jsx)("span",{children:o?n:t})]})})}},26988:function(e,t,n){n.d(t,{L:function(){return useCapacitorContainer},X:function(){return CapacitorContainer}});var r=n(85893),a=n(90512),o=n(46670),i=n(67294),s=n(23164),l=n(88766);let d=(0,i.createContext)(void 0);function useCapacitorContainer(){return(0,i.useContext)(d)}let CapacitorContainer=e=>(0,l.W)()?(0,r.jsx)(c,{...e}):(0,r.jsx)(CapacitorContainerWeb,{...e}),c=(0,o.Pi)(e=>{let{children:t,className:n,...o}=e,l=(0,s.ze)(),c=(0,i.useRef)(null);return(0,r.jsx)(d.Provider,{value:c,children:(0,r.jsxs)("div",{...o,className:(0,a.Z)("h-full overflow-y-auto",n),ref:c,children:[t,l.wantsSpacer&&(0,r.jsx)("div",{style:{height:"".concat(l.keyboardHeight.value,"px")}})]})})}),CapacitorContainerWeb=e=>{let{children:t,className:n,...o}=e;return(0,r.jsx)("div",{...o,className:(0,a.Z)("h-full overflow-y-auto",n),children:t})}},70670:function(e,t,n){n.d(t,{S:function(){return CapacitorScreen}});var r=n(85893),a=n(90512),o=n(23164),i=n(88766),s=n(77004),l=n(97582),d=n(68949);let CapacitorScreenView=class CapacitorScreenView{setDiv(e){this.divRef=e}observeBodyStyle(){let e=window.document.body,t=new MutationObserver(()=>{this.setBodyHeight(e.style.height||null)});t.observe(e,{attributes:!0,attributeFilter:["style"]}),this.listeners.push(()=>t.disconnect())}setBodyHeight(e){this.bodyHeight=e}dispose(){for(let e of this.listeners)e()}constructor({keyboardToolbarView:e}){this.divRef=null,this.bodyHeight=null,this.listeners=[],this.keyboardToolbarView=e,(0,d.makeObservable)(this),this.observeBodyStyle(),this.listeners.push((0,d.reaction)(()=>({bodyHeight:this.bodyHeight,hasExternalKeyboard:this.keyboardToolbarView.hasExternalKeyboard}),e=>{var t;let{bodyHeight:n,hasExternalKeyboard:r}=e,a=r?null:n;null===(t=this.divRef)||void 0===t||t.style.setProperty("height",a||"100vh")},{fireImmediately:!0}))}};function CapacitorScreen(e){return(0,i.W)()?(0,r.jsx)(CapacitorScreenNative,{...e}):(0,r.jsx)(CapacitorScreenWeb,{...e})}function CapacitorScreenNative(e){let{as:t,children:n,style:i,className:l,...d}=e,c=t||"div",u=(0,o.zz)(),h=(0,s.D)(()=>new CapacitorScreenView({keyboardToolbarView:u}),[u]);return(0,r.jsx)(c,{...d,className:(0,a.Z)("fixed top-0 right-0 left-0",l),style:{...i,height:"100vh"},ref:e=>h.setDiv(e),children:n})}function CapacitorScreenWeb(e){let{as:t,children:n,className:o,...i}=e,s=t||"div";return(0,r.jsx)(s,{...i,className:(0,a.Z)("fixed inset-0",o),children:n})}(0,l.gn)([d.observable],CapacitorScreenView.prototype,"keyboardToolbarView",void 0),(0,l.gn)([d.observable],CapacitorScreenView.prototype,"divRef",void 0),(0,l.gn)([d.observable],CapacitorScreenView.prototype,"bodyHeight",void 0),(0,l.gn)([d.action],CapacitorScreenView.prototype,"setDiv",null),(0,l.gn)([d.action],CapacitorScreenView.prototype,"setBodyHeight",null)},35881:function(e,t,n){n.d(t,{X:function(){return Checkbox}});var r=n(85893),a=n(90512);n(67294);let Checkbox=e=>{let{checked:t,disabled:n,onChange:o,onClick:i}=e;return(0,r.jsx)("input",{type:"checkbox",onChange:e=>null==o?void 0:o(e.target.checked),onClick:i,checked:!!t,disabled:n,readOnly:!0,className:(0,a.Z)("\n        note-checkbox\n        form-checkbox relative h-4\n        w-4 cursor-pointer rounded-full border-gray-300\n        text-indigo-600 transition\n        duration-100 hover:scale-105\n        focus:outline-none focus:ring \n        focus:ring-indigo-500 focus:ring-offset-secondary \n        active:scale-95",t?"border-indigo-600":"dark:border-gray-700",!t&&"dark:bg-gray-900")})}},62070:function(e,t,n){n.d(t,{W:function(){return beforeCapture}});function beforeCapture(e,t){(null==t?void 0:t.name)==="ChunkLoadError"&&(console.warn("ChunkLoadError: Loading chunk failed, reloading the page"),location.reload()),e.setTag("error-boundary",!0)}},79283:function(e,t,n){n.d(t,{S:function(){return ErrorBoundary}});var r=n(85893),a=n(24975);n(67294);var o=n(62070);let ErrorBoundary=e=>{let{children:t}=e;return(0,r.jsx)(a.SV,{fallback:ErrorBoundaryFallback,showDialog:!0,beforeCapture:o.W,children:t})},ErrorBoundaryFallback=e=>{var t;let{error:n,componentStack:a}=e,o=(null==(t=n)?void 0:t.name)==="UnsupportedDocumentVersionError"?"This document is not supported by this version of the app. Please update your app to the latest version by closing and re-opening it, or by refreshing the tab.":null;return o?(0,r.jsx)("div",{className:"flex select-text items-center justify-center p-10",children:(0,r.jsx)("h1",{className:"text-center text-sm",children:o})}):(0,r.jsxs)("div",{className:"select-text p-10",children:[(0,r.jsx)("h1",{className:"text-xl",children:"Sorry, something went wrong!"}),(0,r.jsx)("h2",{className:"text-sm",children:n.toString()}),(0,r.jsx)("pre",{className:"text-xs",children:a})]})}},13554:function(e,t,n){n.d(t,{fc:function(){return GoogleTagManager}});var r=n(85893),a=n(4298),o=n.n(a);n(67294);let i="gtm.reflect.app",s="GTM-WHVKHFD",GoogleTagManagerHead=e=>{let{gtmId:t=s,gtmDomain:n=i}=e;return t?(0,r.jsx)(o(),{id:"google-tag-manager",strategy:"afterInteractive",children:"\n        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n        'https://".concat(n,"/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n        })(window,document,'script','dataLayer','").concat(t,"');\n      ")}):null},GoogleTagManagerBody=e=>{let{gtmId:t=s,gtmDomain:n=i}=e;return t?(0,r.jsx)("noscript",{dangerouslySetInnerHTML:{__html:'<iframe src="https://'.concat(n,"/ns.html?id=").concat(t,'" height="0" width="0" style="display: none; visibility: hidden;" />')}}):null},GoogleTagManager=e=>{let{gtmId:t=s,gtmDomain:n=i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(GoogleTagManagerHead,{gtmId:t,gtmDomain:n}),(0,r.jsx)(GoogleTagManagerBody,{gtmId:t,gtmDomain:n})]})}},65234:function(e,t,n){n.d(t,{Z:function(){return MicIcon}});var r=n(85893);n(67294);let MicIcon=e=>{let{className:t}=e;return(0,r.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.99976 8C7.99976 5.79086 9.79062 4 11.9998 4C14.2089 4 15.9998 5.79086 15.9998 8V10C15.9998 12.2091 14.2089 14 11.9998 14C9.79062 14 7.99976 12.2091 7.99976 10V8ZM11.9998 12.5C13.3805 12.5 14.4998 11.3807 14.4998 10V8C14.4998 6.61929 13.3805 5.5 11.9998 5.5C10.619 5.5 9.49976 6.61929 9.49976 8V10C9.49976 11.3807 10.619 12.5 11.9998 12.5Z",fill:"currentColor"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.51254 12.0385C6.9055 11.9075 7.33024 12.1199 7.46123 12.5128C8.08813 14.3935 9.93737 15.5 11.9998 15.5C14.0621 15.5 15.9113 14.3935 16.5382 12.5128C16.6692 12.1199 17.0939 11.9075 17.4869 12.0385C17.8798 12.1695 18.0922 12.5942 17.9612 12.9872C17.1736 15.3502 15.0422 16.7156 12.7497 16.9601L12.7497 19.25C12.7497 19.6642 12.4139 20 11.9997 20C11.5855 20 11.2497 19.6642 11.2497 19.25L11.2497 16.9601C8.95729 16.7156 6.82588 15.3502 6.0382 12.9872C5.90722 12.5942 6.11959 12.1695 6.51254 12.0385Z",fill:"currentColor"})]})}},34009:function(e,t,n){n.d(t,{f:function(){return ShortcutInline}});var r=n(85893),a=n(13385),o=n(74254);let ShortcutInline=e=>{let{title:t,shortcut:n,className:i}=e;return(0,r.jsx)("kbd",{title:t,className:(0,o.cn)("inline-flex items-center rounded bg-white/10 px-1 font-mono text-sm font-medium uppercase tracking-widest ring-[3px] ring-white/10",i),children:(0,r.jsx)(a.Ht,{shortcuts:n})})}},1267:function(e,t,n){n.d(t,{T:function(){return LoadingIndicator}});var r=n(85893);n(67294);var a=n(9037);let LoadingIndicator=e=>{let{duration:t=500,startAt:n=0,children:o}=e;return(0,r.jsx)("div",{className:"absolute inset-0 flex select-none items-center justify-center bg-coolgray-50 media-dark:bg-app-black dark:bg-app-black",children:(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 text-center",children:[(0,r.jsx)(a.P,{duration:t,startAt:n}),(0,r.jsx)("div",{className:"hidden text-gray-900",children:"Loading..."}),o]})})}},84915:function(e,t,n){n.d(t,{E:function(){return EscapeButton}});var r=n(85893),a=n(96445);n(67294);let EscapeButton=e=>{let{onClick:t}=e;return(0,r.jsx)("nav",{className:"fixed right-0 top-0 z-[100] px-4 py-4",children:(0,r.jsxs)("button",{"aria-label":"Close",onClick:t,className:"flex cursor-pointer items-center space-x-2 text-sm text-coolgray-900/50 outline-none transition-all duration-300 hover:text-gray-900 focus:ring-purple-600 dark:text-near-white",tabIndex:-1,children:[(0,r.jsx)("kbd",{className:" inline-flex items-center justify-center rounded-md bg-white px-1.5 py-0.5 font-sans text-[10px] font-medium shadow-md shadow-black/5 ring-1 ring-coolgray-900/10 dark:border-white/10 dark:bg-white/10 ",children:"Esc"}),(0,r.jsx)(a.Z,{className:"w-5"})]})})}},62269:function(e,t,n){n.d(t,{o:function(){return FullModal}});var r=n(85893),a=n(77306),o=n(90512);n(67294);var i=n(37226),s=n(73096),l=n(84915);let FullModal=e=>{let{onClose:t,children:n,className:d}=e;return(0,s.y)("escape",e=>{e.preventDefault(),null==t||t()}),(0,r.jsx)(a.V,{open:!0,static:!0,as:"div",className:"relative z-modal",onClose:()=>!1,children:(0,r.jsx)(i.Q2,{children:(0,r.jsxs)("div",{className:"fixed inset-0 flex bg-white dark:bg-black",children:[t?(0,r.jsx)(l.E,{onClick:t}):null,(0,r.jsx)("div",{className:" flex flex-1 items-center justify-center overflow-y-auto p-4 ",children:(0,r.jsx)(a.V.Panel,{className:(0,o.Z)("flex flex-1 flex-col","max-h-full max-w-4xl",d),children:n})})]})})})}},25702:function(e,t,n){n.d(t,{u:function(){return Modal}});var r=n(85893),a=n(77306),o=n(90512);n(67294);var i=n(37226),s=n(73096),l=n(84915);let Modal=e=>{let{onClose:t,children:n,className:d}=e;return(0,s.y)("escape",e=>{e.preventDefault(),null==t||t()}),(0,r.jsx)(a.V,{open:!0,static:!0,as:"div",className:"relative z-modal",onClose:()=>!1,children:(0,r.jsxs)(i.Q2,{children:[(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-700/15 backdrop-blur-sm dark:bg-black"}),t?(0,r.jsx)(l.E,{onClick:t}):null,(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto p-4",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsx)(a.V.Panel,{className:(0,o.Z)("\n                  flex transform flex-col overflow-hidden\n                  rounded-xl bg-white\n                  shadow-2xl ring-1 ring-coolgray-900/5\n                  dark:bg-gray-900 dark:ring-coolgray-700\n                ",d),children:n})})})]})})}},78789:function(e,t,n){n.d(t,{r:function(){return FullModalDark}});var r=n(85893),a=n(96445),o=n(90512);n(67294);var i=n(33674);let FullModalDark=e=>{let{open:t=!0,onClose:n,children:s}=e;return(0,r.jsx)(i.y,{in:t,children:(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex select-none items-center justify-center overflow-y-auto bg-gradient-to-b from-bluegray-900 to-near-black px-4 pt-4 pb-20",role:"modal",children:[n&&(0,r.jsx)("nav",{className:"absolute right-0 top-0 px-4 py-4",children:(0,r.jsxs)("button",{role:"button","aria-label":"Close",onClick:n,className:"flex cursor-pointer items-center space-x-2 text-sm text-near-white outline-none transition hover:text-gray-900",children:[(0,r.jsx)("span",{children:"Close"}),(0,r.jsx)("span",{className:"rounded-md bg-dark-black-800 px-1.5 py-0.5 text-xs",children:"Esc"}),(0,r.jsx)(a.Z,{height:15,width:15})]})}),(0,r.jsx)("div",{className:(0,o.Z)(["inline-block align-bottom","relative px-4 py-4","transform transition-all","text-gray-900"]),role:"dialog",children:s})]})})}},57143:function(e,t,n){n.d(t,{oU:function(){return FullModal},rG:function(){return c.r},u_:function(){return Modal}});var r=n(85893),a=n(67294),o=n(26988),i=n(70670),s=n(33674);let Modal=e=>{let{open:t=!0,onClose:n,children:a}=e;return(0,r.jsx)(s.y,{in:t,children:(0,r.jsx)(i.S,{className:"z-50",children:(0,r.jsxs)(o.X,{children:[(0,r.jsx)("div",{className:"fixed inset-0 transition-opacity",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-gray-100 dark:bg-gray-900",onClick:n})}),(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20 text-center",children:(0,r.jsx)("div",{className:" transform rounded-xl bg-white px-4 pt-5 pb-4  text-left align-bottom shadow-2xl ring-1 ring-coolgray-900/5 transition-all dark:bg-gray-900 dark:text-white dark:ring-coolgray-800 sm:my-8 sm:w-full sm:max-w-sm sm:p-6 sm:align-middle ",role:"dialog",children:a})})]})})})};var l=n(86158),d=n(96445);let EscapeButton=e=>{let{onClick:t}=e;return(0,r.jsx)("nav",{className:"fixed right-0 top-0 z-[100] px-4 py-4",children:(0,r.jsxs)("button",{"aria-label":"Close",onClick:t,className:"flex cursor-pointer items-center space-x-2 text-sm text-bluegray-500 outline-none transition-all duration-300 hover:text-gray-900 focus:ring-purple-600 dark:text-near-white",tabIndex:-1,children:[(0,r.jsx)("span",{children:"Close"}),(0,r.jsx)("span",{className:"rounded-md bg-bluegray-200 px-1.5 py-0.5 text-xs dark:bg-dark-black-800",children:"Esc"}),(0,r.jsx)(d.Z,{height:15,width:15})]})})},FullModal=e=>{let{open:t=!0,onClose:n,children:o}=e,i=function(e){let{onClose:t,enabled:n=!0}=e,r=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=r.current;if(!e||!n||!t)return;r.current.focus();let onKeyDown=e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),t())};return e.addEventListener("keydown",onKeyDown),()=>e.removeEventListener("keydown",onKeyDown)},[t,n]),r}({onClose:n,enabled:t});return(0,r.jsx)(l.W,{children:(0,r.jsx)(s.y,{in:t,children:(0,r.jsx)("div",{ref:i,tabIndex:-1,className:"fixed inset-0 z-50 overflow-y-auto bg-white dark:bg-black",role:"modal",children:(0,r.jsxs)("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20",children:[n&&(0,r.jsx)(EscapeButton,{onClick:n}),(0,r.jsx)("div",{className:"p-4 dark:text-gray-900",role:"dialog",children:o})]})})})})};var c=n(78789)},98240:function(e,t,n){n.d(t,{f:function(){return note_preview_popover_NotePreviewPopover}});var r=n(85893),a=n(67294),o=n(44080),i=n(95237),s=n(28418),l=n(86779),d=n(39138),c=n.n(d);function NoteBook(e){let{note:t}=e,n=(0,s.v_)(),o=(0,a.useMemo)(()=>t.asin?n.findByAsin(t.asin):null,[n,t.asin]);return o?(0,r.jsxs)("div",{style:{width:300},className:"flex flex-1 px-3 py-3",children:[(0,r.jsx)("div",{className:"h-32 w-20 flex-none overflow-hidden rounded-md",children:(0,r.jsx)("div",{className:"inline-block h-full w-full bg-cover bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(o.coverSrc,")")}})}),(0,r.jsxs)("div",{className:"ml-4 flex-1 space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm text-primary",title:o.title,children:(0,r.jsx)("a",{href:o.listingUrl,target:"_blank",rel:"noreferrer",children:c()(o.title,{length:100})})}),(0,r.jsx)("p",{className:"text-sm text-gray-800 dark:text-near-white",children:o.authors.join(", ")})]})]}):null}var u=n(15965),h=n(37226);function NoteContent(e){let{note:t}=e,n=(0,h.Fg)();return(0,r.jsx)("div",{style:{width:350,height:200},className:"backlink-html-context overflow-hidden px-5 py-4 text-gray-900 dark:text-near-white",children:(0,r.jsx)(u.d1,{size:"xs",html:t.documentHtml,dark:"dark"===n})})}var m=n(52823),p=n(60721);function Person(e){var t;let{person:n}=e;return(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)("div",{className:" relative flex h-10  w-10 flex-none items-center justify-center overflow-hidden rounded-md bg-coolgray-50 dark:bg-black ",children:[(0,r.jsx)(m.Z,{className:"h-8 w-8 text-bluegray-200"}),n.avatar&&(0,r.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(n.avatar,")")}})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm leading-tight text-primary dark:text-primary-dk",children:null===(t=n.name)||void 0===t?void 0:t.fullName}),n.bio&&(0,r.jsx)("div",{className:"text-2xs text-gray-900 dark:text-near-white",title:n.bio,children:c()(n.bio,{length:100})})]})]})}function Company(e){let{company:t}=e;return(0,r.jsxs)("div",{className:"flex space-x-3",children:[(0,r.jsxs)("div",{className:" relative flex h-10  w-10 flex-none items-center justify-center overflow-hidden rounded-md bg-coolgray-50 dark:bg-black ",children:[(0,r.jsx)(p.Z,{className:"h-8 w-8 text-bluegray-200"}),t.logo&&(0,r.jsx)("div",{className:"absolute inset-0 bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url(".concat(t.logo,")")}})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col space-y-1",children:[(0,r.jsx)("h3",{className:"text-sm text-primary dark:text-primary-dk",children:t.name}),t.description&&(0,r.jsx)("div",{className:"text-2xs",title:t.description,children:c()(t.description,{length:50})})]})]})}function NoteEnrichment(e){let{note:t}=e,n=t.enrichment||{},{person:a,company:o}=n;return(0,r.jsxs)("div",{style:{width:300},className:"flex flex-1 flex-col justify-between space-y-3 p-3",children:[a&&(0,r.jsx)(Person,{person:a}),o&&(0,r.jsx)(Company,{company:o})]})}let note_preview_popover_NotePreviewPopover=e=>{let{note:t,offset:n=20}=e,d=(0,s.v_)(),[c,u]=(0,a.useState)(),[h,m]=(0,a.useState)(null),p=(0,a.useMemo)(()=>({getBoundingClientRect:function(){let{x:e,y:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0};return()=>({width:0,height:0,top:t,right:e,bottom:t,left:e,x:e,y:t,toJSON:()=>({x:e,y:t})})}(c)}),[c]),{styles:f,attributes:g}=(0,i.D)(p,h,{strategy:"fixed",placement:"bottom-start",modifiers:[{name:"offset",options:{offset:[n,n]}}]});if((0,a.useEffect)(()=>{let syncCoords=e=>{u({x:e.clientX,y:e.clientY})};return window.document.addEventListener("mousemove",syncCoords),()=>window.document.removeEventListener("mousemove",syncCoords)},[]),!c||!t.document)return null;let x=function(e){var t,n,r,a,o;let{note:i,bookStore:s}=e;return(null===(r=i.enrichment)||void 0===r?void 0:null===(n=r.person)||void 0===n?void 0:null===(t=n.name)||void 0===t?void 0:t.fullName)||(null===(o=i.enrichment)||void 0===o?void 0:null===(a=o.company)||void 0===a?void 0:a.name)?"enrichment":i.asin&&s.findByAsin(i.asin)?"book":"content"}({note:t,bookStore:d});return(0,r.jsx)(l.W,{children:(0,r.jsx)(o.u,{appear:!0,show:!0,enter:"transition-opacity duration-150",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,r.jsx)("div",{ref:m,style:f.popper,...g.popper,className:" absolute z-popover flex flex-col overflow-hidden rounded-md bg-white shadow-lg ring-1 ring-coolgray-900/5 dark:bg-gray-900 dark:ring-coolgray-700 ",children:(()=>{switch(x){case"enrichment":return(0,r.jsx)(NoteEnrichment,{note:t});case"book":return(0,r.jsx)(NoteBook,{note:t});case"content":return(0,r.jsx)(NoteContent,{note:t})}})()})})})}},86158:function(e,t,n){n.d(t,{W:function(){return r.W}});var r=n(86779)},86779:function(e,t,n){n.d(t,{W:function(){return PortalBody}});var r=n(85893);n(67294);var a=n(73935),o=n(37226);let PortalBody=e=>{let{children:t}=e;return a.createPortal((0,r.jsx)(o.Q2,{children:t}),document.body)}},18731:function(e,t,n){n.d(t,{k:function(){return ProgressBar}});var r=n(85893);n(67294);let ProgressBar=e=>{let{progress:t}=e;return(0,r.jsx)("div",{className:" h-3 w-60 overflow-hidden rounded-md bg-coolgray-200 media-dark:bg-white/5 dark:bg-white/5 ",style:{maskImage:"radial-gradient(white, black)"},children:(0,r.jsx)("div",{className:" duration-250 h-full w-full rounded-md bg-coolgray-400 transition-all duration-200 ease-linear media-dark:bg-primary dark:bg-primary ",style:{transform:"translate3d(".concat(-((1-t)*100),"%, 0, 0)")}})})}},9037:function(e,t,n){n.d(t,{P:function(){return PseudoProgressBar}});var r=n(85893),a=n(67294),o=n(18731);let PseudoProgressBar=e=>{let{duration:t,startAt:n=0}=e,[i,s]=(0,a.useState)(n);return(0,a.useEffect)(()=>{let e=setInterval(()=>{s(t=>t>=1?(clearInterval(e),1):t+.01)},t/100);return()=>clearInterval(e)},[]),(0,r.jsx)(o.k,{progress:i})}},13385:function(e,t,n){n.d(t,{Ht:function(){return ShortcutsElement},lt:function(){return ShortcutElement},op:function(){return normalizeShortcuts},rm:function(){return shiftMetaPressed}});var r=n(85893),a=n(44908),o=n.n(a);n(67294);var i=n(81303),s=n(38552);let l={command:s.Pw,meta:s.Pw,control:s.Ao,option:s.uX,apple:i.oG,shift:i.GS,return:i.p4,delete:i.wT,escape:i.qd,rightArrow:i.Vs,leftArrow:i.rE,upArrow:i.Dc,downArrow:i.Di,tab:i.Wk,shiftTab:i.__},d=i.qv;function normalizeShortcut(e){var t;return null!==(t=l[e])&&void 0!==t?t:e}function normalizeShortcuts(e){return o()(e.map(normalizeShortcut))}function shiftMetaPressed(e){return!e.ctrlKey&&!e.altKey&&("Shift"===e.key&&e.metaKey||"Meta"===e.key&&e.shiftKey)}function ShortcutsElement(e){let{shortcuts:t,join:n=d}=e,a=normalizeShortcuts(t).join(n);return(0,r.jsx)("span",{children:a})}function ShortcutElement(e){let{shortcut:t}=e,n=normalizeShortcut(t);return(0,r.jsx)("span",{children:n})}},18490:function(e,t,n){n.d(t,{L:function(){return Spacer}});var r=n(85893);n(67294);let Spacer=()=>(0,r.jsx)("div",{className:"flex-1"})},38543:function(e,t,n){n.d(t,{X:function(){return SmallSpinner}});var r=n(85893);n(67294);let SmallSpinner=e=>{let{className:t=""}=e;return(0,r.jsx)("div",{className:"h-3 w-3 animate-slow-spin rounded-full border border-dashed border-accent ".concat(t)})}},12008:function(e,t,n){n.d(t,{IF:function(){return SplitGrid}});var r=n(85893),a=n(67294),o=n(34751),i=n(74254);let SplitGridGutter=e=>{let{axis:t="x",className:n="",gutterSize:a=1,sidebarPosition:o="left",...s}=e;return(0,r.jsx)("div",{style:"x"===t?{width:a}:{height:a},className:(0,i.cn)("\n        relative z-10 cursor-col-resize bg-coolgray-900/8 transition-all\n        duration-500 before:absolute hover:bg-primary hover:bg-opacity-50 dark:border-black\n        dark:bg-white/5 dark:hover:bg-primary\n        ","before:-inset-0.5 capacitor:before:-inset-1","touch-none",n),...s})},SplitGridDraggableGutter=e=>{let{axis:t,onDrag:n,onDragStart:i,...s}=e,l=(0,a.useRef)(!1),d=(0,o.useDrag)(e=>{!l.current&&e.active&&(null==i||i()),n(e),l.current=e.active},{axis:t});return(0,r.jsx)(SplitGridGutter,{axis:t,...d(),...s})};var s=n(90512);let l=(0,a.forwardRef)((e,t)=>{let{children:n,className:a,gutterSize:o=1,sidebarSize:i=60,minMainSize:l=80,sizeType:d="fixed",sidebarPosition:c="end",axis:u="x"}=e,h="fixed"===d?"".concat(i,"px"):"".concat(100*i,"%"),m="end"===c?"minmax(".concat(l,"px, auto) ").concat(o,"px ").concat(h):"".concat(h," ").concat(o,"px minmax(").concat(l,"px, auto)");return(0,r.jsx)("div",{className:(0,s.Z)("grid",a),style:"x"===u?{gridTemplateColumns:m}:{gridTemplateRows:m},ref:t,children:n})});function SplitGrid(e){let{children:t,sidebarSize:n,sidebarHidden:o=!1,onResize:i,minSidebarSize:s=30,sidebarPosition:d="end",sizeType:c="fixed",axis:u="x",gutterSize:h=1,...m}=e,p=(0,a.useRef)(null),f=(0,a.useRef)(null),clampSize=e=>{e=Math.max(s,e);let t=f.current;return null!==t&&(e=Math.min(e,t-s)),e},[g,x]=a.Children.toArray(t);return(0,r.jsxs)(l,{ref:p,axis:u,sidebarSize:o?0:n,sidebarPosition:d,sizeType:o?"fixed":c,gutterSize:h,...m,children:[g,(0,r.jsx)(SplitGridDraggableGutter,{sidebarPosition:d,axis:u,onDrag:e=>{let{delta:[t]}=e;if(null===f.current)return;let r="fixed"==c?n:f.current*n,a=clampSize("end"===d?r-t:r+t),o="fixed"===c?a:a/f.current;i(o)},onDragStart:()=>{let e=p.current;if(!e)return;let t=e.getBoundingClientRect(),n="x"===u?t.width:t.height;f.current=n},gutterSize:h}),x]})}l.displayName="SplitGridLayout",SplitGrid.Sidebar=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"split-grid-sidebar flex flex-col overflow-hidden",children:t})},SplitGrid.Main=e=>{let{children:t,className:n}=e;return(0,r.jsx)("div",{className:(0,s.Z)("split-grid-main overflow-hidden",n),children:t})}},20833:function(e,t,n){n.d(t,{o:function(){return TextInput}});var r=n(85893),a=n(90512);n(67294);let TextInput=e=>{let{value:t,onChange:n,onClick:o,onBlur:i,onFocus:s,required:l,autoComplete:d,pattern:c,autoFocus:u,disabled:h,placeholder:m,className:p,readOnly:f,type:g="text",error:x=!1}=e;return(0,r.jsx)("input",{type:g,required:l,value:t,autoComplete:d,autoFocus:u,disabled:h,placeholder:m,pattern:c,onChange:e=>null==n?void 0:n(e.target.value),onClick:o,onBlur:i,onFocus:s,readOnly:f,className:(0,a.Z)("\n      block w-full rounded-md border border-coolgray-900/15 px-3 py-2\n      text-sm text-black shadow-app-input shadow-black/2 outline-none\n      transition-all duration-300 focus:border-purple-300\n      focus:ring focus:ring-purple-200/50 dark:border-gray-800 dark:bg-gray-900\n      dark:text-white dark:focus:border-purple-600 dark:focus:ring-purple-900/50",x&&"border-red-300 text-red-900 placeholder-red-300 focus:border-red-500 focus:outline-none focus:ring-red-500",p)})}},37226:function(e,t,n){n.d(t,{Q2:function(){return c},Fg:function(){return useTheme}});var r=n(85893),a=n(90512),o=n(46670);n(67294);var i=n(88766),s=n(25152),l=n(28418),d=n(70729);function useTheme(){let e=(0,d.tv)(),t=function(){let e=(0,l.bG)();return(null==e?void 0:e.theme)||"system"}();return"system"===t?e:t}let c=(0,o.Pi)((e,t)=>{let{children:n}=e,o=useTheme();return(0,r.jsx)("div",{ref:t,className:(0,a.Z)(["app-theme","dark"===o?"dark":"light",(0,s.d)()&&"electron",(0,i.W)()&&"capacitor",(0,s.qx)()&&"iphone",(0,s.HM)()&&"ipad","select-none antialiased"]),children:(0,r.jsx)("div",{className:"bg-background-stark font-sans text-coolgray-900 dark:text-near-white",children:n})})},{forwardRef:!0});c.displayName="Theme"},34199:function(e,t,n){n.d(t,{u:function(){return r.u}});var r=n(58040)},58040:function(e,t,n){n.d(t,{u:function(){return tooltip_Tooltip}});var r=n(85893),a=n(67294),o=n(37226),i=n(66908),s=n(74254);let l=i.zt,d=i.fC,c=i.xz,u=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...o}=e;return(0,r.jsx)(i.VY,{ref:t,sideOffset:a,className:(0,s.cn)("z-tooltip max-w-sm overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})});u.displayName=i.VY.displayName;let h=i.h_,tooltip_Tooltip=e=>{let{label:t,children:n,disabled:a=!1,delay:i=700}=e;return a?(0,r.jsx)(r.Fragment,{children:n}):(0,r.jsx)(l,{children:(0,r.jsxs)(d,{delayDuration:i,children:[(0,r.jsx)(c,{asChild:!0,children:n}),(0,r.jsx)(h,{children:(0,r.jsx)(o.Q2,{children:(0,r.jsx)(u,{children:(0,r.jsx)("p",{children:t})})})})]})})}},33674:function(e,t,n){n.d(t,{y:function(){return FadeInTransition}});var r=n(85893);n(67294);var a=n(16592);let FadeInTransition=e=>{let{in:t,children:n,duration:o=120}=e,i={transition:"opacity ".concat(o,"ms"),opacity:0},s={entering:{opacity:1},entered:{opacity:1},exiting:{opacity:0},exited:{opacity:0},unmounted:{}};return(0,r.jsx)(a.ZP,{timeout:o,in:t,mountOnEnter:!0,unmountOnExit:!0,children:e=>(0,r.jsx)("div",{style:{...i,...s[e]},children:n})})}},40165:function(e,t,n){n.d(t,{d:function(){return l},z:function(){return d}});var r=n(85893),a=n(88426),o=n(12003),i=n(67294),s=n(74254);let l=(0,o.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 transition",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground hover:border-accent",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-secondary hover:text-secondary-foreground text-secondary-foreground/70",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=i.forwardRef((e,t)=>{let{className:n,variant:o,size:i,asChild:d=!1,...c}=e,u=d?a.g7:"button";return(0,r.jsx)(u,{className:(0,s.cn)(l({variant:o,size:i,className:n})),ref:t,...c})});d.displayName="Button"},3955:function(e,t,n){n.d(t,{f:function(){return Calendar}});var r=n(85893),a=n(98814),o=n(64998);n(67294);var i=n(86366),s=n(40165),l=n(74254);function Calendar(e){let{className:t,classNames:n,showOutsideDays:d=!0,...c}=e;return(0,r.jsx)(i._W,{showOutsideDays:d,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,s.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,l.cn)((0,s.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-secondary text-secondary-foreground",day_outside:"text-muted-foreground opacity-50",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...n},components:{IconLeft:()=>(0,r.jsx)(a.Z,{className:"h-4 w-4"}),IconRight:()=>(0,r.jsx)(o.Z,{className:"h-4 w-4"})},...c})}Calendar.displayName="Calendar"},35917:function(e,t,n){n.d(t,{I:function(){return i}});var r=n(85893),a=n(67294),o=n(74254);let i=a.forwardRef((e,t)=>{let{className:n,type:a,...i}=e;return(0,r.jsx)("input",{type:a,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...i})});i.displayName="Input"},75396:function(e,t,n){n.d(t,{FN:function(){return h},Mi:function(){return f},VW:function(){return d},_i:function(){return c},gD:function(){return m},lj:function(){return g},sA:function(){return p}});var r=n(85893),a=n(67626),o=n(12003),i=n(41352),s=n(67294),l=n(74254);let d=a.zt,c=s.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.l_,{hotkey:["FAKE_KEYBOARD_CODE"],ref:t,className:(0,l.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[480px]",n),...o})});c.displayName=a.l_.displayName;let u=(0,o.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),h=s.forwardRef((e,t)=>{let{className:n,variant:o,...i}=e;return(0,r.jsx)(a.fC,{ref:t,className:(0,l.cn)(u({variant:o}),n),...i})});h.displayName=a.fC.displayName;let m=s.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.aU,{ref:t,className:(0,l.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",n),...o})});m.displayName=a.aU.displayName;let p=s.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.x8,{ref:t,className:(0,l.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",n),"toast-close":"",...o,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});p.displayName=a.x8.displayName;let f=s.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.Dx,{ref:t,className:(0,l.cn)("text-sm font-semibold",n),...o})});f.displayName=a.Dx.displayName;let g=s.forwardRef((e,t)=>{let{className:n,...o}=e;return(0,r.jsx)(a.dk,{ref:t,className:(0,l.cn)("text-sm opacity-90",n),...o})});g.displayName=a.dk.displayName},72524:function(e,t,n){n.d(t,{Am:function(){return toast},pm:function(){return useToast}});var r=n(67294);let a=0,o=new Map;function addToRemoveQueue(e){if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)}let i=[],s={toasts:[]};function dispatch(e){s=function(e,t){switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,5)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?addToRemoveQueue(n):e.toasts.forEach(e=>{addToRemoveQueue(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}}(s,e),i.forEach(e=>{e(s)})}function toast(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),dismiss=()=>dispatch({type:"DISMISS_TOAST",toastId:n});return dispatch({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||dismiss()}}}),{id:n,dismiss,update:e=>dispatch({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function useToast(){let[e,t]=r.useState(s);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast,dismiss:e=>dispatch({type:"DISMISS_TOAST",toastId:e})}}},50477:function(e,t,n){n.d(t,{e:function(){return BacklinkDateGenerator}});var r=n(97582),a=n(77349),o=n(11640),i=n(63500),s=n(21593),l=n(7069),d=n(54559),c=n(77982),u=n(59319),h=n(21804),m=n.n(h),p=n(68949),f=n(28418),g=n(88498),x=n(15880),v=n(69119),y=n(45578),b=n.n(y);function uniqDateLabels(e){return b()(e,e=>e[0].toDateString())}function parseDate(e,t){return(0,x.Qc)(e,t).map(e=>[(0,v.Z)(e.date()),e.text])}let w=["Today","Yesterday","Tomorrow","This Sunday","This Monday","This Tuesday","This Wednesday","This Thursday","This Friday","This Saturday","This week","This weekend","This month","Next Sunday","Next Monday","Next Tuesday","Next Wednesday","Next Thursday","Next Friday","Next Saturday","Next week","Next weekend","Next month","Last Sunday","Last Monday","Last Tuesday","Last Wednesday","Last Thursday","Last Friday","Last Saturday","Last week","Last weekend","Last month"];function pluralize(e,t,n){return 1===e?t:n||"".concat(t,"s")}var j=n(70173),k=n(65618);let BacklinkDateGenerator=class BacklinkDateGenerator{generate(e){return e?this.generateRelative(e).slice(0,3):[]}generateRelative(e){let t=[],n=(0,k.N5)(e.toLowerCase()),r=uniqDateLabels([...this.exactDateMatch(e),...function(e,t){var n;let r=(n=(n=e).trim().toLowerCase()).length<3?[]:w.filter(e=>e.toLowerCase().includes(n));return r.length>0?uniqDateLabels(r.flatMap(e=>parseDate(e,t))):uniqDateLabels(parseDate(e,t))}(e),...this.relativeDateMatch(n)]);for(let[e,n]of r)(0,k.Kh)(e,this.minValidDate,this.maxValidDate)&&t.push({id:"relative-".concat((0,j.l5)(e),"-").concat(m()(n)),label:"".concat(n," (").concat((0,g.p6)(e,this.dateFormat),")"),insertLabel:(0,g.l6)(e,this.dateFormat),dailyAt:e});return t}get minValidDate(){return(0,u.Z)(new Date,15)}get maxValidDate(){return(0,s.Z)(new Date,15)}relativeDateMatch(e){return this.relativeDateOptionsForQuery(e).filter(t=>{let[n,r]=t;return r.toLowerCase().includes(e)})}exactDateMatch(e){if(!/\d\//.test(e))return[];let t=(0,g.sG)(e,this.dateFormat);return t?[[t,e]]:[]}relativeDateOptionsForQuery(e){let t=(0,k.aX)(e);if(!t)return[];let n=new Date;return[[(0,a.Z)(n,t),"".concat(t," ").concat(pluralize(t,"day")," from now")],[(0,i.Z)(n,t),"".concat(t," ").concat(pluralize(t,"week")," from now")],[(0,o.Z)(n,t),"".concat(t," ").concat(pluralize(t,"month")," from now")],[(0,s.Z)(n,t),"".concat(t," ").concat(pluralize(t,"year")," from now")],[(0,l.Z)(n,t),"".concat(t," ").concat(pluralize(t,"day")," ago")],[(0,c.Z)(n,t),"".concat(t," ").concat(pluralize(t,"week")," ago")],[(0,d.Z)(n,t),"".concat(t," ").concat(pluralize(t,"month")," ago")],[(0,u.Z)(n,t),"".concat(t," ").concat(pluralize(t,"year")," ago")]]}constructor({dateFormat:e=f.t6.MonthDayYear,weekStart:t=f.L8.Monday}){this.dateFormat=e,this.weekStart=t,(0,p.makeObservable)(this)}};(0,r.gn)([p.computed],BacklinkDateGenerator.prototype,"minValidDate",null),(0,r.gn)([p.computed],BacklinkDateGenerator.prototype,"maxValidDate",null)},65618:function(e,t,n){n.d(t,{Kh:function(){return isBetween},N5:function(){return replaceNumberWordsWithDigits},aX:function(){return parseQueryNumber},gD:function(){return normalizeBacklinkQuery}});var r=n(42699),a=n(313),o=n(44717);function normalizeBacklinkQuery(e){let t=(0,o.U)(e),n=t.replace(/[[\]]/g,"");return n}function parseQueryNumber(e){let t=e.match(/\d+/);if(t)return Number.parseInt(t[0],10)}function replaceNumberWordsWithDigits(e){return e.replace(/\bone\b/g,"1").replace(/\btwo\b/g,"2").replace(/\bthree\b/g,"3").replace(/\bfour\b/g,"4").replace(/\bfive\b/g,"5").replace(/\bsix\b/g,"6").replace(/\bseven\b/g,"7").replace(/\beight\b/g,"8").replace(/\bnine\b/g,"9").replace(/\bten\b/g,"10")}function isBetween(e,t,n){return(0,r.Z)(e,t)&&(0,a.Z)(e,n)}},62431:function(e,t,n){n.d(t,{o:function(){return useBacklinkGenerator}});var r=n(67294),a=n(89734),o=n.n(a),i=n(45578),s=n.n(i),l=n(28418),d=n(50477),c=n(65618);let BacklinkGenerator=class BacklinkGenerator{generate(e){if(!e)return this.getSampleBacklinks();{let t=(0,c.gD)(e),n=this.backlinkStore.searchBacklinks(t),r=this.dateGenerator.generate(t);return this.normalizeBacklinks([...r,...n],t)}}getSampleBacklinks(){let e=this.backlinkStore.getSampleBacklinks(this.sampleMaxItems+5),t=s()(e,e=>e.id);return t.slice(0,this.sampleMaxItems)}normalizeBacklinks(e,t){let n=e,r=this.excludeNote;return r&&(n=n.filter(e=>e.id!==r.id)),(n=o()(n,e=>e.normalizedLabel===t?-1:0)).slice(0,this.maxItems)}constructor({backlinkStore:e,dateFormat:t=l.t6.MonthDayYear,weekStart:n=l.L8.Monday,maxItems:r=10,sampleMaxItems:a=5,excludeNote:o}){this.backlinkStore=e,this.excludeNote=o,this.maxItems=r,this.sampleMaxItems=a,this.dateGenerator=new d.e({dateFormat:t,weekStart:n})}};function useBacklinkGenerator(e){let{backlinkStore:t,dateFormat:n,weekStart:a,excludeNote:o,maxItems:i,sampleMaxItems:s}=e,l=(0,r.useMemo)(()=>new BacklinkGenerator({backlinkStore:t,dateFormat:n,weekStart:a,excludeNote:o,maxItems:i,sampleMaxItems:s}),[t,n,a,o,i,s]);return(0,r.useCallback)(e=>l.generate(null!=e?e:""),[l])}},53522:function(e,t,n){n.d(t,{N:function(){return useTagGenerator}});var r=n(67294);function useTagGenerator(e){return(0,r.useCallback)(t=>e.matchTags(null!=t?t:""),[e])}},61518:function(e,t,n){n.d(t,{N:function(){return useIndexCookie},z:function(){return setIndexCookie}});var r=n(62286),a=n(67294);function setIndexCookie(){(0,r.setCookie)(null,"indexApp","1",{maxAge:93312e4,path:"/"})}function useIndexCookie(){(0,a.useEffect)(()=>{setIndexCookie()},[])}},8677:function(e,t,n){n.d(t,{q:function(){return retries}});function retries(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((r,a)=>{let attempt=async e=>{try{r(await t())}catch(t){e>0?(console.error(t),setTimeout(()=>attempt(e-1),n)):a(t)}};attempt(e)})}},81303:function(e,t,n){n.d(t,{DB:function(){return i},Dc:function(){return p},Di:function(){return f},GS:function(){return l},PV:function(){return o},Vs:function(){return h},Wk:function(){return g},__:function(){return x},iW:function(){return a},oG:function(){return s},p4:function(){return d},qd:function(){return u},qv:function(){return r},rE:function(){return m},wT:function(){return c}});let r=" ",a="⌘",o="⌥",i="⌃",s="",l="⇧",d="↩",c="⌫",u="⎋",h="→",m="←",p="↑",f="↓",g="⇥",x="⇤"},70729:function(e,t,n){n.d(t,{XU:function(){return addChangeListenerToMatchMedia},nd:function(){return removeChangeListenerFromMatchMedia},tv:function(){return useColorScheme}});var r=n(67294);let a="function"==typeof window.matchMedia;function useColorScheme(){var e;let t=a?window.matchMedia("(prefers-color-scheme: dark)"):{matches:!1},[n,o]=(0,r.useState)(t.matches?"dark":"light");return e=()=>{o(t.matches?"dark":"light")},(0,r.useEffect)(()=>{if(a){let t=window.matchMedia("(prefers-color-scheme: dark)");return addChangeListenerToMatchMedia(t,e),()=>{removeChangeListenerFromMatchMedia(t,e)}}},[a]),n}function addChangeListenerToMatchMedia(e,t){e.addEventListener?e.addEventListener("change",e=>{t(e)}):e.addListener(e=>{t(e)})}function removeChangeListenerFromMatchMedia(e,t){e.removeEventListener?e.removeEventListener("change",t):e.removeListener(t)}},73096:function(e,t,n){n.d(t,{y:function(){return useHotkeys}}),n(67294);var r=n(69887),a=n(38552);function useHotkeys(e,t,n,o){return Array.isArray(n)&&(o=n,n=void 0),(0,r.y1)(a.Zx?e.replace(/meta/g,"command"):e.replace(/meta/g,"control").replace(/option/g,"alt"),t,{enableOnContentEditable:!0,enableOnTags:["INPUT","TEXTAREA"],...n},o)}},77004:function(e,t,n){n.d(t,{D:function(){return useViewModel}});var r=n(67294);function useViewModel(e,t){let n=(0,r.useRef)(null),a=(0,r.useMemo)(()=>{var t;null===(t=n.current)||void 0===t||t.dispose();let r=e();return n.current=r,r},t);return(0,r.useEffect)(()=>()=>{var e;null===(e=n.current)||void 0===e||e.dispose(),n.current=null},[]),a}},38552:function(e,t,n){n.d(t,{Ao:function(){return l},EM:function(){return i},Pw:function(){return o},Zx:function(){return a},d:function(){return d},uX:function(){return s}});var r=n(81303);let a=/Mac|iP(hone|[ao]d)/.test(navigator.platform),o=a?r.iW:"ctrl",i=a?"cmd":"ctrl",s=a?r.PV:"alt",l=a?r.DB:"ctrl";/Mac/.test(navigator.platform);let d=/electron/i.test(navigator.userAgent);/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},74254:function(e,t,n){n.d(t,{cn:function(){return cn}});var r=n(90512),a=n(57851);function cn(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m)((0,r.W)(t))}},97197:function(e,t,n){n.d(t,{_:function(){return createAccessToken},w:function(){return signOut}});var r=n(26655),a=n(40127);async function createAccessToken(e){let t=await (0,a.lI)();return fetch("/api/auth/client-token",{method:"POST",headers:{Authorization:"Firebase ".concat(t),"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({client_token:e,id_token:t})})}async function signOut(){let{resetDatabases:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};await r.I8.signOut(),e&&window.location.replace("/sign-out?confirm=true")}},45332:function(e,t,n){n.d(t,{Z:function(){return a},u:function(){return r}});let r=window.electron;var a=r}}]);